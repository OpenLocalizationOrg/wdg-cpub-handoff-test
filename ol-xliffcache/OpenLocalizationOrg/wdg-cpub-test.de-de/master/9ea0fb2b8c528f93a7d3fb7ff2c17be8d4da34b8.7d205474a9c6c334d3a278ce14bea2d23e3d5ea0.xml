{"nodes":[{"pos":[11,50],"content":"How to suspend an app (DirectX and C++)","needQuote":true,"needEscape":true,"nodes":[{"content":"How to suspend an app (DirectX and C++)","pos":[0,39]}]},{"pos":[64,204],"content":"This topic shows how to save important system state and app data when the system suspends your Universal Windows Platform (UWP) DirectX app.","needQuote":true,"needEscape":true,"nodes":[{"content":"This topic shows how to save important system state and app data when the system suspends your Universal Windows Platform (UWP) DirectX app.","pos":[0,140]}]},{"content":"How to suspend an app (DirectX and C++)","pos":[261,300]},{"content":"\\[ Updated for UWP apps on Windows 10.","pos":[303,341]},{"content":"For Windows 8.x articles, see the <bpt id=\"p1\">[</bpt>archive<ept id=\"p1\">](http://go.microsoft.com/fwlink/p/?linkid=619132)</ept> \\]","pos":[342,437],"source":" For Windows 8.x articles, see the [archive](http://go.microsoft.com/fwlink/p/?linkid=619132) \\]"},{"content":"This topic shows how to save important system state and app data when the system suspends your Universal Windows Platform (UWP) DirectX app.","pos":[439,579]},{"content":"Register the suspending event handler","pos":[584,621]},{"pos":[624,840],"content":"First, register to handle the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>CoreApplication::Suspending<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br205860)</ept> event, which is raised when your app is moved to a suspended state by a user or system action.","source":"First, register to handle the [**CoreApplication::Suspending**](https://msdn.microsoft.com/library/windows/apps/br205860) event, which is raised when your app is moved to a suspended state by a user or system action."},{"pos":[842,1006],"content":"Add this code to your implementation of the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>IFrameworkView::Initialize<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/hh700495)</ept> method of your view provider:","source":"Add this code to your implementation of the [**IFrameworkView::Initialize**](https://msdn.microsoft.com/library/windows/apps/hh700495) method of your view provider:"},{"content":"Save any app data before suspending","pos":[1219,1254]},{"content":"When your app handles the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>CoreApplication::Suspending<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br205860)</ept> event, it has the opportunity to save its important application data in the handler function.","pos":[1257,1468],"source":"When your app handles the [**CoreApplication::Suspending**](https://msdn.microsoft.com/library/windows/apps/br205860) event, it has the opportunity to save its important application data in the handler function."},{"content":"The app should use the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>LocalSettings<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br241622)</ept> storage API to save simple application data synchronously.","pos":[1469,1628],"source":" The app should use the [**LocalSettings**](https://msdn.microsoft.com/library/windows/apps/br241622) storage API to save simple application data synchronously."},{"content":"If you are developing a game, save any critical game state information.","pos":[1629,1700]},{"content":"Don't forget to suspend the audio processing!","pos":[1701,1746]},{"content":"Now, implement the callback.","pos":[1748,1776]},{"content":"Save the app data in this method.","pos":[1777,1810]},{"content":"This callback must complete with 5 seconds.","pos":[2424,2467]},{"content":"During this callback, you must request a deferral by calling <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>SuspendingOperation::GetDeferral<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br224690)</ept>, which starts the countdown.","pos":[2468,2654],"source":" During this callback, you must request a deferral by calling [**SuspendingOperation::GetDeferral**](https://msdn.microsoft.com/library/windows/apps/br224690), which starts the countdown."},{"content":"When your app completes the save operation, call <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>SuspendingDeferral::Complete<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br224685)</ept> to tell the system that your app is now ready to be suspended.","pos":[2655,2859],"source":" When your app completes the save operation, call [**SuspendingDeferral::Complete**](https://msdn.microsoft.com/library/windows/apps/br224685) to tell the system that your app is now ready to be suspended."},{"content":"If you do not request a deferral, or if your app takes longer than 5 seconds to save the data, your app is automatically suspended.","pos":[2860,2991]},{"content":"This callback occurs as an event message processed by the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>CoreDispatcher<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br208211)</ept> for the app's <bpt id=\"p3\">[</bpt><bpt id=\"p4\">**</bpt>CoreWindow<ept id=\"p4\">**</ept><ept id=\"p3\">](https://msdn.microsoft.com/library/windows/apps/br208225)</ept>.","pos":[2993,3219],"source":"This callback occurs as an event message processed by the [**CoreDispatcher**](https://msdn.microsoft.com/library/windows/apps/br208211) for the app's [**CoreWindow**](https://msdn.microsoft.com/library/windows/apps/br208225)."},{"content":"This callback will not be invoked if you do not call <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>CoreDispatcher::ProcessEvents<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br208215)</ept> from your app's main loop (implemented in the <bpt id=\"p3\">[</bpt><bpt id=\"p4\">**</bpt>IFrameworkView::Run<ept id=\"p4\">**</ept><ept id=\"p3\">](https://msdn.microsoft.com/library/windows/apps/hh700505)</ept> method of your view provider).","pos":[3220,3527],"source":" This callback will not be invoked if you do not call [**CoreDispatcher::ProcessEvents**](https://msdn.microsoft.com/library/windows/apps/br208215) from your app's main loop (implemented in the [**IFrameworkView::Run**](https://msdn.microsoft.com/library/windows/apps/hh700505) method of your view provider)."},{"content":"Call Trim()","pos":[4132,4143]},{"content":"Starting in Windows 8.1, all DirectX Windows Store apps must call <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>IDXGIDevice3::Trim<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/desktop/dn280346)</ept> when suspending.","pos":[4146,4314],"source":"Starting in Windows 8.1, all DirectX Windows Store apps must call [**IDXGIDevice3::Trim**](https://msdn.microsoft.com/library/windows/desktop/dn280346) when suspending."},{"content":"This call tells the graphics driver to release all temporary buffers allocated for the app, which reduces the chance that the app will be terminated to reclaim memory resources while in the suspend state.","pos":[4315,4519]},{"content":"This is a certification requirement for Windows 8.1.","pos":[4520,4572]},{"content":"Release any exclusive resources and file handles","pos":[5508,5556]},{"content":"When your app handles the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>CoreApplication::Suspending<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br205860)</ept> event, it also has the opportunity to release exclusive resources and file handles.","pos":[5559,5760],"source":"When your app handles the [**CoreApplication::Suspending**](https://msdn.microsoft.com/library/windows/apps/br205860) event, it also has the opportunity to release exclusive resources and file handles."},{"content":"Explicitly releasing exclusive resources and file handles helps to ensure that other apps can access them while your app isn't using them.","pos":[5761,5899]},{"content":"When the app is activated after termination, it should open its exclusive resources and file handles.","pos":[5900,6001]},{"content":"Remarks","pos":[6006,6013]},{"content":"The system suspends your app whenever the user switches to another app or to the desktop.","pos":[6016,6105]},{"content":"The system resumes your app whenever the user switches back to it.","pos":[6106,6172]},{"content":"When the system resumes your app, the content of your variables and data structures is the same as it was before the system suspended the app.","pos":[6173,6315]},{"content":"The system restores the app exactly where it left off, so that it appears to the user as if it's been running in the background.","pos":[6316,6444]},{"content":"The system attempts to keep your app and its data in memory while it's suspended.","pos":[6446,6527]},{"content":"However, if the system does not have the resources to keep your app in memory, the system will terminate your app.","pos":[6528,6642]},{"content":"When the user switches back to a suspended app that has been terminated, the system sends an <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>Activated<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br225018)</ept> event and should restore its application data in its handler for the <bpt id=\"p3\">**</bpt>CoreApplicationView::Activated<ept id=\"p3\">**</ept> event.","pos":[6643,6920],"source":" When the user switches back to a suspended app that has been terminated, the system sends an [**Activated**](https://msdn.microsoft.com/library/windows/apps/br225018) event and should restore its application data in its handler for the **CoreApplicationView::Activated** event."},{"content":"The system doesn't notify an app when it's terminated, so your app must save its application data and release exclusive resources and file handles when it's suspended, and restore them when the app is activated after termination.","pos":[6922,7151]},{"content":"Related topics","pos":[7156,7170]},{"content":"How to resume an app (DirectX and C++)","pos":[7175,7213]},{"content":"How to activate an app (DirectX and C++)","pos":[7259,7299]}],"content":"---\ntitle: How to suspend an app (DirectX and C++)\ndescription: This topic shows how to save important system state and app data when the system suspends your Universal Windows Platform (UWP) DirectX app.\nms.assetid: 5dd435e5-ec7e-9445-fed4-9c0d872a239e\n---\n\n# How to suspend an app (DirectX and C++)\n\n\n\\[ Updated for UWP apps on Windows 10. For Windows 8.x articles, see the [archive](http://go.microsoft.com/fwlink/p/?linkid=619132) \\]\n\nThis topic shows how to save important system state and app data when the system suspends your Universal Windows Platform (UWP) DirectX app.\n\n## Register the suspending event handler\n\n\nFirst, register to handle the [**CoreApplication::Suspending**](https://msdn.microsoft.com/library/windows/apps/br205860) event, which is raised when your app is moved to a suspended state by a user or system action.\n\nAdd this code to your implementation of the [**IFrameworkView::Initialize**](https://msdn.microsoft.com/library/windows/apps/hh700495) method of your view provider:\n\n```cpp\nvoid App::Initialize(CoreApplicationView^ applicationView)\n{\n  //...\n  \n    CoreApplication::Suspending +=\n        ref new EventHandler<SuspendingEventArgs^>(this, &App::OnSuspending);\n\n  //...\n}\n```\n\n## Save any app data before suspending\n\n\nWhen your app handles the [**CoreApplication::Suspending**](https://msdn.microsoft.com/library/windows/apps/br205860) event, it has the opportunity to save its important application data in the handler function. The app should use the [**LocalSettings**](https://msdn.microsoft.com/library/windows/apps/br241622) storage API to save simple application data synchronously. If you are developing a game, save any critical game state information. Don't forget to suspend the audio processing!\n\nNow, implement the callback. Save the app data in this method.\n\n```cpp\nvoid App::OnSuspending(Platform::Object^ sender, SuspendingEventArgs^ args)\n{\n    // Save app state asynchronously after requesting a deferral. Holding a deferral\n    // indicates that the application is busy performing suspending operations. Be\n    // aware that a deferral may not be held indefinitely. After about five seconds,\n    // the app will be forced to exit.\n    SuspendingDeferral^ deferral = args->SuspendingOperation->GetDeferral();\n\n    create_task([this, deferral]()\n    {\n        m_deviceResources->Trim();\n\n        // Insert your code here.\n\n        deferral->Complete();\n    });\n}\n```\n\nThis callback must complete with 5 seconds. During this callback, you must request a deferral by calling [**SuspendingOperation::GetDeferral**](https://msdn.microsoft.com/library/windows/apps/br224690), which starts the countdown. When your app completes the save operation, call [**SuspendingDeferral::Complete**](https://msdn.microsoft.com/library/windows/apps/br224685) to tell the system that your app is now ready to be suspended. If you do not request a deferral, or if your app takes longer than 5 seconds to save the data, your app is automatically suspended.\n\nThis callback occurs as an event message processed by the [**CoreDispatcher**](https://msdn.microsoft.com/library/windows/apps/br208211) for the app's [**CoreWindow**](https://msdn.microsoft.com/library/windows/apps/br208225). This callback will not be invoked if you do not call [**CoreDispatcher::ProcessEvents**](https://msdn.microsoft.com/library/windows/apps/br208215) from your app's main loop (implemented in the [**IFrameworkView::Run**](https://msdn.microsoft.com/library/windows/apps/hh700505) method of your view provider).\n\n``` syntax\n// This method is called after the window becomes active.\nvoid App::Run()\n{\n    while (!m_windowClosed)\n    {\n        if (m_windowVisible)\n        {\n            CoreWindow::GetForCurrentThread()->Dispatcher->ProcessEvents(CoreProcessEventsOption::ProcessAllIfPresent);\n\n            m_main->Update();\n\n            if (m_main->Render())\n            {\n                m_deviceResources->Present();\n            }\n        }\n        else\n        {\n            CoreWindow::GetForCurrentThread()->Dispatcher->ProcessEvents(CoreProcessEventsOption::ProcessOneAndAllPending);\n        }\n    }\n}\n```\n\n## Call Trim()\n\n\nStarting in Windows 8.1, all DirectX Windows Store apps must call [**IDXGIDevice3::Trim**](https://msdn.microsoft.com/library/windows/desktop/dn280346) when suspending. This call tells the graphics driver to release all temporary buffers allocated for the app, which reduces the chance that the app will be terminated to reclaim memory resources while in the suspend state. This is a certification requirement for Windows 8.1.\n\n```cpp\nvoid App::OnSuspending(Platform::Object^ sender, SuspendingEventArgs^ args)\n{\n    // Save app state asynchronously after requesting a deferral. Holding a deferral\n    // indicates that the application is busy performing suspending operations. Be\n    // aware that a deferral may not be held indefinitely. After about five seconds,\n    // the app will be forced to exit.\n    SuspendingDeferral^ deferral = args->SuspendingOperation->GetDeferral();\n\n    create_task([this, deferral]()\n    {\n        m_deviceResources->Trim();\n\n        // Insert your code here.\n\n        deferral->Complete();\n    });\n}\n\n// Call this method when the app suspends. It provides a hint to the driver that the app \n// is entering an idle state and that temporary buffers can be reclaimed for use by other apps.\nvoid DX::DeviceResources::Trim()\n{\n    ComPtr<IDXGIDevice3> dxgiDevice;\n    m_d3dDevice.As(&dxgiDevice);\n\n    dxgiDevice->Trim();\n}\n```\n\n## Release any exclusive resources and file handles\n\n\nWhen your app handles the [**CoreApplication::Suspending**](https://msdn.microsoft.com/library/windows/apps/br205860) event, it also has the opportunity to release exclusive resources and file handles. Explicitly releasing exclusive resources and file handles helps to ensure that other apps can access them while your app isn't using them. When the app is activated after termination, it should open its exclusive resources and file handles.\n\n## Remarks\n\n\nThe system suspends your app whenever the user switches to another app or to the desktop. The system resumes your app whenever the user switches back to it. When the system resumes your app, the content of your variables and data structures is the same as it was before the system suspended the app. The system restores the app exactly where it left off, so that it appears to the user as if it's been running in the background.\n\nThe system attempts to keep your app and its data in memory while it's suspended. However, if the system does not have the resources to keep your app in memory, the system will terminate your app. When the user switches back to a suspended app that has been terminated, the system sends an [**Activated**](https://msdn.microsoft.com/library/windows/apps/br225018) event and should restore its application data in its handler for the **CoreApplicationView::Activated** event.\n\nThe system doesn't notify an app when it's terminated, so your app must save its application data and release exclusive resources and file handles when it's suspended, and restore them when the app is activated after termination.\n\n## Related topics\n\n* [How to resume an app (DirectX and C++)](how-to-resume-an-app-directx-and-cpp.md)\n* [How to activate an app (DirectX and C++)](how-to-activate-an-app-directx-and-cpp.md)\n\n \n\n \n\n\n\n\n"}