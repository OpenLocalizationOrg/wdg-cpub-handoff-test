{"nodes":[{"pos":[86,234],"content":"This topic provides an overview of how to add PlayReady hardware-based digital rights management (DRM) to your Universal Windows Platform (UWP) app.","needQuote":true,"needEscape":true,"nodes":[{"content":"This topic provides an overview of how to add PlayReady hardware-based digital rights management (DRM) to your Universal Windows Platform (UWP) app.","pos":[0,148]}]},{"pos":[242,254],"content":"Hardware DRM","needQuote":true,"needEscape":true,"nodes":[{"content":"Hardware DRM","pos":[0,12]}]},{"content":"Hardware DRM","pos":[262,274]},{"content":"\\[ Updated for UWP apps on Windows 10.","pos":[276,314]},{"content":"For Windows 8.x articles, see the <bpt id=\"p1\">[</bpt>archive<ept id=\"p1\">](http://go.microsoft.com/fwlink/p/?linkid=619132)</ept> \\]","pos":[315,410],"source":" For Windows 8.x articles, see the [archive](http://go.microsoft.com/fwlink/p/?linkid=619132) \\]"},{"content":"This topic provides an overview of how to add PlayReady hardware-based digital rights management (DRM) to your Universal Windows Platform (UWP) app.","pos":[412,560]},{"pos":[564,859],"content":"[!NOTE] \nHardware-based PlayReady DRM is supported on a multitude of devices, including both Windows and non-Windows devices such as TV sets, phones, and tablets. For a Windows device to support PlayReady Hardware DRM, it must be running Windows 10 and have a supported hardware configuration.","leadings":["","> "],"nodes":[{"content":"Hardware-based PlayReady DRM is supported on a multitude of devices, including both Windows and non-Windows devices such as TV sets, phones, and tablets. For a Windows device to support PlayReady Hardware DRM, it must be running Windows 10 and have a supported hardware configuration.","pos":[9,293],"nodes":[{"content":"Hardware-based PlayReady DRM is supported on a multitude of devices, including both Windows and non-Windows devices such as TV sets, phones, and tablets.","pos":[0,153]},{"content":"For a Windows device to support PlayReady Hardware DRM, it must be running Windows 10 and have a supported hardware configuration.","pos":[154,284]}]}]},{"content":"Increasingly, content providers are moving towards hardware-based protections for granting permission to play back full high value content in apps.","pos":[861,1008]},{"content":"Robust support for a hardware implementation of the cryptographic core has been added to PlayReady to meet this need.","pos":[1009,1126]},{"content":"This support enables secure playback of high definition (1080p) and ultra-high definition (UHD) content on multiple device platforms.","pos":[1127,1260]},{"content":"Key material (including private keys, content keys, and any other key material used to derive or unlock said keys), and decrypted compressed and uncompressed video samples are protected by leveraging hardware security.","pos":[1261,1479]},{"content":"Windows TEE Implementation","pos":[1484,1510]},{"content":"This topic provides a brief overview of how Windows 10 implements the trusted execution environment.","pos":[1512,1612]},{"content":"The details of the Windows TEE implementation is out of scope for this document.","pos":[1614,1694]},{"content":"However, a brief discussion of the difference between the standard porting kit TEE port and the Windows port will be beneficial.","pos":[1695,1823]},{"content":"Windows implements the OEM proxy layer and transfers the serialized PRITEE functions calls to a user mode driver in the Windows Media Foundation subsystem.","pos":[1824,1979]},{"content":"This will eventually get routed to either the Windows TrEE (Trusted Execution Environment) driver or the OEM’s graphics driver.","pos":[1980,2107]},{"content":"The details of either of these approaches is out of scope for this document.","pos":[2108,2184]},{"content":"The following diagram shows the general component interaction for the Windows port.","pos":[2185,2268]},{"content":"If you want to develop a Windows PlayReady TEE implementation, you can contact <bpt id=\"p1\">&lt;</bpt>WMLA@Microsoft.com<ept id=\"p1\">&gt;</ept>.","pos":[2269,2369],"source":" If you want to develop a Windows PlayReady TEE implementation, you can contact <WMLA@Microsoft.com>."},{"content":"windows tee component diagram","pos":[2373,2402]},{"content":"Considerations for Using Hardware DRM","pos":[2450,2487]},{"content":"This topic provides a brief list of items that should be considered when developing apps designed to use hardware DRM.","pos":[2489,2607]},{"content":"As explained in <bpt id=\"p1\">[</bpt>PlayReady DRM<ept id=\"p1\">](playready-client-sdk.md#output-protection)</ept>, with PlayReady HWDRM for Windows 10, all output protections are enforced from within the Windows TEE implementation, which has some consequences on output protection behaviors:","pos":[2608,2860],"source":" As explained in [PlayReady DRM](playready-client-sdk.md#output-protection), with PlayReady HWDRM for Windows 10, all output protections are enforced from within the Windows TEE implementation, which has some consequences on output protection behaviors:"},{"content":"<bpt id=\"p1\">**</bpt>Support for output protection level (OPL) for uncompressed digital video 270:<ept id=\"p1\">**</ept> PlayReady HWDRM for Windows 10 doesn't support down-resolution and will enforce that HDCP is engaged.","pos":[2866,3049],"source":"**Support for output protection level (OPL) for uncompressed digital video 270:** PlayReady HWDRM for Windows 10 doesn't support down-resolution and will enforce that HDCP is engaged."},{"content":"Microsoft recommends that high definition content for HWDRM have an OPL greater than 270 (although it is not required).","pos":[3050,3169]},{"content":"Additionally, Microsoft recommends that you set HDCP type restriction in the license (HDCP version 2.2 on Windows 10).","pos":[3170,3288]},{"content":"Unlike software DRM, output protections are enforced on all monitors based on the least capable monitor.","pos":[3293,3397]},{"content":"For example, if the user has two monitors connected where one of the monitors supports HDCP and the other does not, playback will fail if the license requires HDCP even if the content is only being rendered on the monitor that supports HDCP.","pos":[3398,3639]},{"content":"In software DRM (SWDRM), content would play back as long as it is only being rendered on the monitor that supports HDCP.","pos":[3640,3760]},{"content":"HWDRM is not guaranteed to be used by the client and secure unless the following conditions are met by the content keys and licenses:","pos":[3765,3898]},{"content":"The license used for the video content key must have a Minimum Security level property of 3000.","pos":[3907,4002]},{"content":"Audio must be encrypted to a different content key than video, and the license used for the audio must have a Minimum Security level property of 2000.","pos":[4011,4161]},{"content":"Alternatively, audio could be left in the clear.","pos":[4162,4210]},{"content":"Additionally, you should take the following items into consideration when using HWDRM:","pos":[4216,4302]},{"content":"Protected Media Process (PMP) is not supported.","pos":[4308,4355]},{"pos":[4360,4472],"content":"Windows Media Video (also known as VC-1) is not supported (see <bpt id=\"p1\">[</bpt>Override Hardware DRM<ept id=\"p1\">](#override-hardware-drm)</ept>).","source":"Windows Media Video (also known as VC-1) is not supported (see [Override Hardware DRM](#override-hardware-drm))."},{"content":"Multiple graphics processing units (GPUs) are not supported for persistent licenses.","pos":[4477,4561]},{"content":"To handle persistent licenses on machines with multiple GPUs, consider the following scenario:","pos":[4563,4657]},{"content":"A customer buys a new machine with an integrated graphics card.","pos":[4663,4726]},{"content":"The customer uses an app that acquires persistent licenses while using hardware DRM.","pos":[4731,4815]},{"content":"The persistent license is now bound to that graphics card’s hardware keys.","pos":[4820,4894]},{"content":"The customer then installs a new graphics card.","pos":[4899,4946]},{"content":"All licenses in the hashed data store (HDS) are bound to the integrated video card, but the customer now wants to play back protected content using the newly-installed graphics card.","pos":[4951,5133]},{"content":"In order to prevent playback from failing because the licenses can’t be decrypted by the hardware, PlayReady uses a separate HDS for each graphics card that it encounters.","pos":[5135,5306]},{"content":"This will cause PlayReady to attempt license acquisition for a piece of content where PlayReady would normally already have a license (that is, in the software DRM case or any case without a hardware change, PlayReady wouldn’t need to reacquire a license).","pos":[5307,5563]},{"content":"Therefore, if the app acquires a persistent license while using hardware DRM, your app needs to be able to handle the case where that license is effectively “lost” if the end user installs (or uninstalls) a graphics card.","pos":[5564,5785]},{"content":"Because this is not a common scenario, you may decide to handle the support calls when the content no longer plays after a hardware change rather than figure out how to deal with a hardware change in the client/server code.","pos":[5786,6009]},{"content":"Override Hardware DRM","pos":[6014,6035]},{"content":"This section describes how to override hardware DRM (HWDRM) if the content to be played back does not support hardware DRM.","pos":[6037,6160]},{"content":"By default, hardware DRM is used if the system supports it.","pos":[6162,6221]},{"content":"However, some content is not supported in hardware DRM.","pos":[6222,6277]},{"content":"One example of this is Cocktail content.","pos":[6278,6318]},{"content":"Another example is any content that uses a video codec other than H.264 and HEVC.","pos":[6319,6400]},{"content":"Another example is HEVC content, as some hardware DRM will support HEVC and some will not.","pos":[6401,6491]},{"content":"Therefore, if you want to play a piece of content and hardware DRM doesn’t support it on the system in question, you may want to opt out of hardware DRM.","pos":[6492,6645]},{"content":"The following example shows how to opt-out of hardware DRM.","pos":[6647,6706]},{"content":"You only need to do this before you switch.","pos":[6707,6750]},{"content":"Also, make sure you don’t have any PlayReady object in memory, otherwise behavior is undefined.","pos":[6751,6846]},{"pos":[7105,7181],"content":"To switch back to hardware DRM, set the <bpt id=\"p1\">**</bpt>SoftwareOverride<ept id=\"p1\">**</ept> value to <bpt id=\"p2\">**</bpt>0<ept id=\"p2\">**</ept>.","source":"To switch back to hardware DRM, set the **SoftwareOverride** value to **0**."},{"pos":[7183,7255],"content":"For every media playback, you need to set <bpt id=\"p1\">**</bpt>MediaProtectionManager<ept id=\"p1\">**</ept> to:","source":"For every media playback, you need to set **MediaProtectionManager** to:"},{"content":"The best way to tell if you are in hardware DRM or software DRM is look at C:\\\\Users\\\\<ph id=\"ph1\">&amp;lt;</ph>username<ph id=\"ph2\">&amp;gt;</ph>\\\\AppData\\\\Local\\\\Packages\\\\<ph id=\"ph3\">&amp;lt;</ph>application name<ph id=\"ph4\">&amp;gt;</ph>\\\\LocalState\\\\PlayReady\\\\\\*","pos":[7365,7546],"source":"The best way to tell if you are in hardware DRM or software DRM is look at C:\\\\Users\\\\&lt;username&gt;\\\\AppData\\\\Local\\\\Packages\\\\&lt;application name&gt;\\\\LocalState\\\\PlayReady\\\\\\*"},{"content":"If there is an mspr.hds file, then you are in software DRM.","pos":[7552,7611]},{"content":"If you have another \\*.hds file, then you are in hardware DRM.","pos":[7616,7678]},{"content":"You can delete the entire PlayReady folder and retry your test as well.","pos":[7683,7754]},{"content":"Detect the Type of Hardware DRM","pos":[7759,7790]},{"content":"This section describes how to detect what type of hardware DRM is supported on the system.","pos":[7792,7882]},{"content":"You can use the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>PlayReadyStatics.CheckSupportedHardware<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn986441)</ept> method to determine whether the system supports a specific hardware digital rights management (DRM) feature.","pos":[7884,8112],"source":"You can use the [**PlayReadyStatics.CheckSupportedHardware**](https://msdn.microsoft.com/library/windows/apps/dn986441) method to determine whether the system supports a specific hardware digital rights management (DRM) feature."},{"content":"For example:","pos":[8113,8125]},{"content":"The <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>PlayReadyHardwareDRMFeatures<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn986265)</ept> enumeration contains the valid list of hardware DRM feature values that can be queried.","pos":[8224,8408],"source":"The [**PlayReadyHardwareDRMFeatures**](https://msdn.microsoft.com/library/windows/apps/dn986265) enumeration contains the valid list of hardware DRM feature values that can be queried."},{"content":"To determine if hardware DRM is supported, use the <bpt id=\"p1\">**</bpt>HardwareDRM<ept id=\"p1\">**</ept> member in the query.","pos":[8409,8496],"source":" To determine if hardware DRM is supported, use the **HardwareDRM** member in the query."},{"content":"To determine if the hardware supports the High Efficiency Video Coding (HEVC)/H.265 codec, use the <bpt id=\"p1\">**</bpt>HEVC<ept id=\"p1\">**</ept> member in the query.","pos":[8497,8625],"source":" To determine if the hardware supports the High Efficiency Video Coding (HEVC)/H.265 codec, use the **HEVC** member in the query."},{"content":"You can also use the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>PlayReadyStatics.PlayReadyCertificateSecurityLevel<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/windows.media.protection.playready.playreadystatics.playreadycertificatesecuritylevel.aspx)</ept> property to get the security level of the client certificate to determine if hardware DRM is supported.","pos":[8627,8948],"source":"You can also use the [**PlayReadyStatics.PlayReadyCertificateSecurityLevel**](https://msdn.microsoft.com/library/windows/apps/windows.media.protection.playready.playreadystatics.playreadycertificatesecuritylevel.aspx) property to get the security level of the client certificate to determine if hardware DRM is supported."},{"content":"Unless the returned certificate security level is greater than or equal to 3000, either the client is not individualized or provisioned (in which case this property returns 0) or hardware DRM is not in use (in which case this property returns a value that is less than 3000).","pos":[8949,9224]}],"content":"---\nauthor: eliotcowley\nms.assetid: A7E0DA1E-535A-459E-9A35-68A4150EE9F5\ndescription: This topic provides an overview of how to add PlayReady hardware-based digital rights management (DRM) to your Universal Windows Platform (UWP) app.\ntitle: Hardware DRM\n---\n\n# Hardware DRM\n\n\\[ Updated for UWP apps on Windows 10. For Windows 8.x articles, see the [archive](http://go.microsoft.com/fwlink/p/?linkid=619132) \\]\n\nThis topic provides an overview of how to add PlayReady hardware-based digital rights management (DRM) to your Universal Windows Platform (UWP) app.\n\n> [!NOTE] \n> Hardware-based PlayReady DRM is supported on a multitude of devices, including both Windows and non-Windows devices such as TV sets, phones, and tablets. For a Windows device to support PlayReady Hardware DRM, it must be running Windows 10 and have a supported hardware configuration.\n\nIncreasingly, content providers are moving towards hardware-based protections for granting permission to play back full high value content in apps. Robust support for a hardware implementation of the cryptographic core has been added to PlayReady to meet this need. This support enables secure playback of high definition (1080p) and ultra-high definition (UHD) content on multiple device platforms. Key material (including private keys, content keys, and any other key material used to derive or unlock said keys), and decrypted compressed and uncompressed video samples are protected by leveraging hardware security.\n\n## Windows TEE Implementation\n\nThis topic provides a brief overview of how Windows 10 implements the trusted execution environment.\n\nThe details of the Windows TEE implementation is out of scope for this document. However, a brief discussion of the difference between the standard porting kit TEE port and the Windows port will be beneficial. Windows implements the OEM proxy layer and transfers the serialized PRITEE functions calls to a user mode driver in the Windows Media Foundation subsystem. This will eventually get routed to either the Windows TrEE (Trusted Execution Environment) driver or the OEM’s graphics driver. The details of either of these approaches is out of scope for this document. The following diagram shows the general component interaction for the Windows port. If you want to develop a Windows PlayReady TEE implementation, you can contact <WMLA@Microsoft.com>.\n\n![windows tee component diagram](images/windowsteecomponentdiagram720.jpg)\n\n## Considerations for Using Hardware DRM\n\nThis topic provides a brief list of items that should be considered when developing apps designed to use hardware DRM. As explained in [PlayReady DRM](playready-client-sdk.md#output-protection), with PlayReady HWDRM for Windows 10, all output protections are enforced from within the Windows TEE implementation, which has some consequences on output protection behaviors:\n\n-   **Support for output protection level (OPL) for uncompressed digital video 270:** PlayReady HWDRM for Windows 10 doesn't support down-resolution and will enforce that HDCP is engaged. Microsoft recommends that high definition content for HWDRM have an OPL greater than 270 (although it is not required). Additionally, Microsoft recommends that you set HDCP type restriction in the license (HDCP version 2.2 on Windows 10).\n-   Unlike software DRM, output protections are enforced on all monitors based on the least capable monitor. For example, if the user has two monitors connected where one of the monitors supports HDCP and the other does not, playback will fail if the license requires HDCP even if the content is only being rendered on the monitor that supports HDCP. In software DRM (SWDRM), content would play back as long as it is only being rendered on the monitor that supports HDCP.\n-   HWDRM is not guaranteed to be used by the client and secure unless the following conditions are met by the content keys and licenses:\n    -   The license used for the video content key must have a Minimum Security level property of 3000.\n    -   Audio must be encrypted to a different content key than video, and the license used for the audio must have a Minimum Security level property of 2000. Alternatively, audio could be left in the clear.\n    \nAdditionally, you should take the following items into consideration when using HWDRM:\n\n-   Protected Media Process (PMP) is not supported.\n-   Windows Media Video (also known as VC-1) is not supported (see [Override Hardware DRM](#override-hardware-drm)).\n-   Multiple graphics processing units (GPUs) are not supported for persistent licenses.\n\nTo handle persistent licenses on machines with multiple GPUs, consider the following scenario:\n\n1.  A customer buys a new machine with an integrated graphics card.\n2.  The customer uses an app that acquires persistent licenses while using hardware DRM.\n3.  The persistent license is now bound to that graphics card’s hardware keys.\n4.  The customer then installs a new graphics card.\n5.  All licenses in the hashed data store (HDS) are bound to the integrated video card, but the customer now wants to play back protected content using the newly-installed graphics card.\n\nIn order to prevent playback from failing because the licenses can’t be decrypted by the hardware, PlayReady uses a separate HDS for each graphics card that it encounters. This will cause PlayReady to attempt license acquisition for a piece of content where PlayReady would normally already have a license (that is, in the software DRM case or any case without a hardware change, PlayReady wouldn’t need to reacquire a license). Therefore, if the app acquires a persistent license while using hardware DRM, your app needs to be able to handle the case where that license is effectively “lost” if the end user installs (or uninstalls) a graphics card. Because this is not a common scenario, you may decide to handle the support calls when the content no longer plays after a hardware change rather than figure out how to deal with a hardware change in the client/server code.\n\n## Override Hardware DRM\n\nThis section describes how to override hardware DRM (HWDRM) if the content to be played back does not support hardware DRM.\n\nBy default, hardware DRM is used if the system supports it. However, some content is not supported in hardware DRM. One example of this is Cocktail content. Another example is any content that uses a video codec other than H.264 and HEVC. Another example is HEVC content, as some hardware DRM will support HEVC and some will not. Therefore, if you want to play a piece of content and hardware DRM doesn’t support it on the system in question, you may want to opt out of hardware DRM.\n\nThe following example shows how to opt-out of hardware DRM. You only need to do this before you switch. Also, make sure you don’t have any PlayReady object in memory, otherwise behavior is undefined.\n\n```js\nvar applicationData = Windows.Storage.ApplicationData.current;\nvar localSettings = applicationData.localSettings.createContainer(\"PlayReady\", Windows.Storage.ApplicationDataCreateDisposition.always);\nlocalSettings.values[\"SoftwareOverride\"] = 1;\n```\n\nTo switch back to hardware DRM, set the **SoftwareOverride** value to **0**.\n\nFor every media playback, you need to set **MediaProtectionManager** to:\n\n```js\nmediaProtectionManager.properties[\"Windows.Media.Protection.UseSoftwareProtectionLayer\"] = true;\n```\n\nThe best way to tell if you are in hardware DRM or software DRM is look at C:\\\\Users\\\\&lt;username&gt;\\\\AppData\\\\Local\\\\Packages\\\\&lt;application name&gt;\\\\LocalState\\\\PlayReady\\\\\\*\n\n-   If there is an mspr.hds file, then you are in software DRM.\n-   If you have another \\*.hds file, then you are in hardware DRM.\n-   You can delete the entire PlayReady folder and retry your test as well.\n\n## Detect the Type of Hardware DRM\n\nThis section describes how to detect what type of hardware DRM is supported on the system.\n\nYou can use the [**PlayReadyStatics.CheckSupportedHardware**](https://msdn.microsoft.com/library/windows/apps/dn986441) method to determine whether the system supports a specific hardware digital rights management (DRM) feature. For example:\n\n```cpp\nboolean PlayReadyStatics->CheckSupportedHardware(PlayReadyHardwareDRMFeatures enum);\n```\n\nThe [**PlayReadyHardwareDRMFeatures**](https://msdn.microsoft.com/library/windows/apps/dn986265) enumeration contains the valid list of hardware DRM feature values that can be queried. To determine if hardware DRM is supported, use the **HardwareDRM** member in the query. To determine if the hardware supports the High Efficiency Video Coding (HEVC)/H.265 codec, use the **HEVC** member in the query.\n\nYou can also use the [**PlayReadyStatics.PlayReadyCertificateSecurityLevel**](https://msdn.microsoft.com/library/windows/apps/windows.media.protection.playready.playreadystatics.playreadycertificatesecuritylevel.aspx) property to get the security level of the client certificate to determine if hardware DRM is supported. Unless the returned certificate security level is greater than or equal to 3000, either the client is not individualized or provisioned (in which case this property returns 0) or hardware DRM is not in use (in which case this property returns a value that is less than 3000).\n\n"}