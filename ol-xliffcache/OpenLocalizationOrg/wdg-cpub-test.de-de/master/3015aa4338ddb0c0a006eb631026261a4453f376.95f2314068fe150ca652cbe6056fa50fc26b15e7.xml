{"nodes":[{"pos":[85,170],"content":"The AdvancedPhotoCapture class allows you to capture High Dynamic Range (HDR) photos.","needQuote":true,"needEscape":true,"nodes":[{"content":"The AdvancedPhotoCapture class allows you to capture High Dynamic Range (HDR) photos.","pos":[0,85]}]},{"pos":[178,216],"content":"High Dynamic Range (HDR) photo capture","needQuote":true,"needEscape":true,"nodes":[{"content":"High Dynamic Range (HDR) photo capture","pos":[0,38]}]},{"content":"High Dynamic Range (HDR) photo capture","pos":[224,262]},{"content":"\\[ Updated for UWP apps on Windows 10.","pos":[264,302]},{"content":"For Windows 8.x articles, see the <bpt id=\"p1\">[</bpt>archive<ept id=\"p1\">](http://go.microsoft.com/fwlink/p/?linkid=619132)</ept> \\]","pos":[303,398],"source":" For Windows 8.x articles, see the [archive](http://go.microsoft.com/fwlink/p/?linkid=619132) \\]"},{"content":"The <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>AdvancedPhotoCapture<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/mt181386)</ept> class allows you to capture High Dynamic Range (HDR) photos.","pos":[401,550],"source":"The [**AdvancedPhotoCapture**](https://msdn.microsoft.com/library/windows/apps/mt181386) class allows you to capture High Dynamic Range (HDR) photos."},{"content":"This API also allows you to obtain a reference frame from the HDR capture before the processing of the final image is complete.","pos":[551,678]},{"content":"Other articles related to HDR capture include:","pos":[680,726]},{"content":"You can use the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>SceneAnalysisEffect<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn948902)</ept> to allow the system to evaluate the content of the media capture preview stream to determine if HDR processing would improve the capture result.","pos":[732,976],"source":"You can use the [**SceneAnalysisEffect**](https://msdn.microsoft.com/library/windows/apps/dn948902) to allow the system to evaluate the content of the media capture preview stream to determine if HDR processing would improve the capture result."},{"content":"For more information, see <bpt id=\"p1\">[</bpt>Scene Analysis for Media Capture<ept id=\"p1\">](scene-analysis-for-media-capture.md)</ept>.","pos":[977,1075],"source":" For more information, see [Scene Analysis for Media Capture](scene-analysis-for-media-capture.md)."},{"content":"Use the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>HdrVideoControl<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn926680)</ept> to capture video using the Windows built-in HDR processing algorithm.","pos":[1081,1238],"source":"Use the [**HdrVideoControl**](https://msdn.microsoft.com/library/windows/apps/dn926680) to capture video using the Windows built-in HDR processing algorithm."},{"content":"For more information, see <bpt id=\"p1\">[</bpt>Capture device controls for video capture<ept id=\"p1\">](capture-device-controls-for-video-capture.md)</ept>.","pos":[1239,1355],"source":" For more information, see [Capture device controls for video capture](capture-device-controls-for-video-capture.md)."},{"content":"You can use the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>VariablePhotoSequenceCapture<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn652564)</ept> to capture a sequence of photos, each with different capture settings, and implement your own HDR or other processing algorithm.","pos":[1361,1598],"source":"You can use the [**VariablePhotoSequenceCapture**](https://msdn.microsoft.com/library/windows/apps/dn652564) to capture a sequence of photos, each with different capture settings, and implement your own HDR or other processing algorithm."},{"content":"For more information, see <bpt id=\"p1\">[</bpt>Variable photo sequence<ept id=\"p1\">](variable-photo-sequence.md)</ept>.","pos":[1599,1679],"source":" For more information, see [Variable photo sequence](variable-photo-sequence.md)."},{"content":"Note","pos":[1683,1687]},{"pos":[1694,1789],"content":"Concurrently recording video and photo capture using <bpt id=\"p1\">**</bpt>AdvancedPhotoCapture<ept id=\"p1\">**</ept> is not supported.","source":"Concurrently recording video and photo capture using **AdvancedPhotoCapture** is not supported."},{"content":"Using the camera flash during advanced photo capture is not supported.","pos":[1795,1865]},{"content":"<bpt id=\"p1\">**</bpt>Note<ept id=\"p1\">**</ept> This article builds on concepts and code discussed in <bpt id=\"p2\">[</bpt>Capture Photos and Video with MediaCapture<ept id=\"p2\">](capture-photos-and-video-with-mediacapture.md)</ept>, which describes the steps for implementing basic photo and video capture.","pos":[1867,2096],"source":"**Note** This article builds on concepts and code discussed in [Capture Photos and Video with MediaCapture](capture-photos-and-video-with-mediacapture.md), which describes the steps for implementing basic photo and video capture."},{"content":"It is recommended that you familiarize yourself with the basic media capture pattern in that article before moving on to more advanced capture scenarios.","pos":[2097,2250]},{"content":"The code in this article assumes that your app already has an instance of MediaCapture that has been properly initialized.","pos":[2251,2373]},{"content":"HDR photo capture namespaces","pos":[2378,2406]},{"content":"To use HDR photo capture, your app must include the following namespaces in addition to the namespaces required for basic media capture.","pos":[2408,2544]},{"pos":[2556,2569],"content":"HDRPhotoUsing"},{"content":"Determine if HDR photo capture is supported on the current device","pos":[2649,2714]},{"content":"The HDR capture technique described in this article is performed using the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>AdvancedPhotoCapture<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/mt181386)</ept> object.","pos":[2716,2883],"source":"The HDR capture technique described in this article is performed using the [**AdvancedPhotoCapture**](https://msdn.microsoft.com/library/windows/apps/mt181386) object."},{"content":"Not all devices support HDR capture with <bpt id=\"p1\">**</bpt>AdvancedPhotoCapture<ept id=\"p1\">**</ept>.","pos":[2884,2950],"source":" Not all devices support HDR capture with **AdvancedPhotoCapture**."},{"content":"Determine if the device on which your app is currently running supports the technique by getting the <bpt id=\"p1\">**</bpt>MediaCapture<ept id=\"p1\">**</ept> object's <bpt id=\"p2\">[</bpt><bpt id=\"p3\">**</bpt>VideoDeviceController<ept id=\"p3\">**</ept><ept id=\"p2\">](https://msdn.microsoft.com/library/windows/apps/br226825)</ept> and then getting the <bpt id=\"p4\">[</bpt><bpt id=\"p5\">**</bpt>AdvancedPhotoControl<ept id=\"p5\">**</ept><ept id=\"p4\">](https://msdn.microsoft.com/library/windows/apps/mt147840)</ept> property.","pos":[2951,3279],"source":" Determine if the device on which your app is currently running supports the technique by getting the **MediaCapture** object's [**VideoDeviceController**](https://msdn.microsoft.com/library/windows/apps/br226825) and then getting the [**AdvancedPhotoControl**](https://msdn.microsoft.com/library/windows/apps/mt147840) property."},{"content":"Check the video device controller's <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>SupportedModes<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/mt147844)</ept> collection to see if it includes <bpt id=\"p3\">[</bpt><bpt id=\"p4\">**</bpt>AdvancedPhotoMode.Hdr<ept id=\"p4\">**</ept><ept id=\"p3\">](https://msdn.microsoft.com/library/windows/apps/mt147845)</ept>.","pos":[3280,3514],"source":" Check the video device controller's [**SupportedModes**](https://msdn.microsoft.com/library/windows/apps/mt147844) collection to see if it includes [**AdvancedPhotoMode.Hdr**](https://msdn.microsoft.com/library/windows/apps/mt147845)."},{"content":"If it does, HDR capture using <bpt id=\"p1\">**</bpt>AdvancedPhotoCapture<ept id=\"p1\">**</ept> is supported.","pos":[3515,3583],"source":" If it does, HDR capture using **AdvancedPhotoCapture** is supported."},{"pos":[3595,3607],"content":"HdrSupported"},{"content":"Configure and prepare the AdvancedPhotoCapture object","pos":[3685,3738]},{"pos":[3740,3963],"content":"Since you will need to access the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>AdvancedPhotoCapture<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/mt181386)</ept> instance from multiple places within your code, you should declare a member variable to hold the object.","source":"Since you will need to access the [**AdvancedPhotoCapture**](https://msdn.microsoft.com/library/windows/apps/mt181386) instance from multiple places within your code, you should declare a member variable to hold the object."},{"pos":[3975,3997],"content":"DeclareAdvancedCapture"},{"content":"In your app, after you have initialized the <bpt id=\"p1\">**</bpt>MediaCapture<ept id=\"p1\">**</ept> object, create an <bpt id=\"p2\">[</bpt><bpt id=\"p3\">**</bpt>AdvancedPhotoCaptureSettings<ept id=\"p3\">**</ept><ept id=\"p2\">](https://msdn.microsoft.com/library/windows/apps/mt147837)</ept> object and set the mode to <bpt id=\"p4\">[</bpt><bpt id=\"p5\">**</bpt>AdvancedPhotoMode.Hdr<ept id=\"p5\">**</ept><ept id=\"p4\">](https://msdn.microsoft.com/library/windows/apps/mt147845)</ept>.","pos":[4082,4367],"source":"In your app, after you have initialized the **MediaCapture** object, create an [**AdvancedPhotoCaptureSettings**](https://msdn.microsoft.com/library/windows/apps/mt147837) object and set the mode to [**AdvancedPhotoMode.Hdr**](https://msdn.microsoft.com/library/windows/apps/mt147845)."},{"content":"Call the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>AdvancedPhotoControl<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/mt147840)</ept> object's <bpt id=\"p3\">[</bpt><bpt id=\"p4\">**</bpt>Configure<ept id=\"p4\">**</ept><ept id=\"p3\">](https://msdn.microsoft.com/library/windows/apps/mt147841)</ept> method, passing in the <bpt id=\"p5\">**</bpt>AdvancedPhotoCaptureSettings<ept id=\"p5\">**</ept> object you created.","pos":[4368,4620],"source":" Call the [**AdvancedPhotoControl**](https://msdn.microsoft.com/library/windows/apps/mt147840) object's [**Configure**](https://msdn.microsoft.com/library/windows/apps/mt147841) method, passing in the **AdvancedPhotoCaptureSettings** object you created."},{"content":"Call the <bpt id=\"p1\">**</bpt>MediaCapture<ept id=\"p1\">**</ept> object's <bpt id=\"p2\">[</bpt><bpt id=\"p3\">**</bpt>PrepareAdvancedPhotoCaptureAsync<ept id=\"p3\">**</ept><ept id=\"p2\">](https://msdn.microsoft.com/library/windows/apps/mt181403)</ept>, passing in an <bpt id=\"p4\">[</bpt><bpt id=\"p5\">**</bpt>ImageEncodingProperties<ept id=\"p5\">**</ept><ept id=\"p4\">](https://msdn.microsoft.com/library/windows/apps/hh700993)</ept> object specifying the type of encoding the capture should use.","pos":[4622,4919],"source":"Call the **MediaCapture** object's [**PrepareAdvancedPhotoCaptureAsync**](https://msdn.microsoft.com/library/windows/apps/mt181403), passing in an [**ImageEncodingProperties**](https://msdn.microsoft.com/library/windows/apps/hh700993) object specifying the type of encoding the capture should use."},{"content":"The <bpt id=\"p1\">**</bpt>ImageEncodingProperties<ept id=\"p1\">**</ept> class provides static methods for creating the image encodings that are supported by <bpt id=\"p2\">**</bpt>MediaCapture<ept id=\"p2\">**</ept>.","pos":[4920,5054],"source":" The **ImageEncodingProperties** class provides static methods for creating the image encodings that are supported by **MediaCapture**."},{"content":"<bpt id=\"p1\">**</bpt>PrepareAdvancedPhotoCaptureAsync<ept id=\"p1\">**</ept> returns the <bpt id=\"p2\">[</bpt><bpt id=\"p3\">**</bpt>AdvancedPhotoCapture<ept id=\"p3\">**</ept><ept id=\"p2\">](https://msdn.microsoft.com/library/windows/apps/mt181386)</ept> object you will use to initiate photo capture.","pos":[5056,5236],"source":"**PrepareAdvancedPhotoCaptureAsync** returns the [**AdvancedPhotoCapture**](https://msdn.microsoft.com/library/windows/apps/mt181386) object you will use to initiate photo capture."},{"content":"You can use this object to register handlers for the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>OptionalReferencePhotoCaptured<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/mt181392)</ept> and <bpt id=\"p3\">[</bpt><bpt id=\"p4\">**</bpt>AllPhotosCaptured<ept id=\"p4\">**</ept><ept id=\"p3\">](https://msdn.microsoft.com/library/windows/apps/mt181387)</ept> which are discussed later in this article.","pos":[5237,5513],"source":" You can use this object to register handlers for the [**OptionalReferencePhotoCaptured**](https://msdn.microsoft.com/library/windows/apps/mt181392) and [**AllPhotosCaptured**](https://msdn.microsoft.com/library/windows/apps/mt181387) which are discussed later in this article."},{"pos":[5525,5551],"content":"CreateAdvancedCaptureAsync"},{"content":"Capture an HDR photo","pos":[5643,5663]},{"content":"Capture an HDR photo by calling the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>AdvancedPhotoCapture<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/mt181386)</ept> object's <bpt id=\"p3\">[</bpt><bpt id=\"p4\">**</bpt>CaptureAsync<ept id=\"p4\">**</ept><ept id=\"p3\">](https://msdn.microsoft.com/library/windows/apps/mt181388)</ept> method.","pos":[5665,5879],"source":"Capture an HDR photo by calling the [**AdvancedPhotoCapture**](https://msdn.microsoft.com/library/windows/apps/mt181386) object's [**CaptureAsync**](https://msdn.microsoft.com/library/windows/apps/mt181388) method."},{"content":"This method returns a <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>AdvancedCapturedPhoto<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/mt181378)</ept> object that provides the captured photo in its <bpt id=\"p3\">[</bpt><bpt id=\"p4\">**</bpt>Frame<ept id=\"p4\">**</ept><ept id=\"p3\">](https://msdn.microsoft.com/library/windows/apps/mt181382)</ept> property.","pos":[5880,6114],"source":" This method returns a [**AdvancedCapturedPhoto**](https://msdn.microsoft.com/library/windows/apps/mt181378) object that provides the captured photo in its [**Frame**](https://msdn.microsoft.com/library/windows/apps/mt181382) property."},{"pos":[6126,6146],"content":"CaptureHdrPhotoAsync"},{"pos":[6229,6493],"content":"<bpt id=\"p1\">**</bpt>ConvertOrientationToPhotoOrientation<ept id=\"p1\">**</ept> and <bpt id=\"p2\">**</bpt>ReencodeAndSavePhotoAsync<ept id=\"p2\">**</ept> are helper methods that are discussed as part of the basic media capture scenario in the article <bpt id=\"p3\">[</bpt>Capture Photos and Video with MediaCapture<ept id=\"p3\">](capture-photos-and-video-with-mediacapture.md)</ept>.","source":"**ConvertOrientationToPhotoOrientation** and **ReencodeAndSavePhotoAsync** are helper methods that are discussed as part of the basic media capture scenario in the article [Capture Photos and Video with MediaCapture](capture-photos-and-video-with-mediacapture.md)."},{"content":"Get optional reference frame","pos":[6498,6526]},{"content":"The HDR process captures multiple frames and then composites them into a single image after all of the frames have been captured.","pos":[6528,6657]},{"content":"You can get access to a frame after it is captured but before the entire HDR process is complete by handling the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>OptionalReferencePhotoCaptured<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/mt181392)</ept> event.","pos":[6658,6872],"source":" You can get access to a frame after it is captured but before the entire HDR process is complete by handling the [**OptionalReferencePhotoCaptured**](https://msdn.microsoft.com/library/windows/apps/mt181392) event."},{"content":"You don't need to do this if you are only interested in the final HDR photo result.","pos":[6873,6956]},{"content":"<bpt id=\"p1\">**</bpt>Important<ept id=\"p1\">**</ept> <bpt id=\"p2\">[</bpt><bpt id=\"p3\">**</bpt>OptionalReferencePhotoCaptured<ept id=\"p3\">**</ept><ept id=\"p2\">](https://msdn.microsoft.com/library/windows/apps/mt181392)</ept> is not raised on devices that support hardware HDR and therefore do not generate reference frames.","pos":[6958,7165],"source":"**Important** [**OptionalReferencePhotoCaptured**](https://msdn.microsoft.com/library/windows/apps/mt181392) is not raised on devices that support hardware HDR and therefore do not generate reference frames."},{"content":"Your app should handle the case where this event is not raised.","pos":[7166,7229]},{"content":"Because the reference frame arrives out of context of the call to <bpt id=\"p1\">**</bpt>CaptureAsync<ept id=\"p1\">**</ept>, a mechanism is provided to pass context information to the <bpt id=\"p2\">**</bpt>OptionalReferencePhotoCaptured<ept id=\"p2\">**</ept> handler.","pos":[7231,7417],"source":"Because the reference frame arrives out of context of the call to **CaptureAsync**, a mechanism is provided to pass context information to the **OptionalReferencePhotoCaptured** handler."},{"content":"First you should an object that will contain your context information.","pos":[7418,7488]},{"content":"The name and contents of this object is up to you.","pos":[7489,7539]},{"content":"This example defines an object that has members to track the file name and camera orientation of the capture.","pos":[7540,7649]},{"pos":[7661,7683],"content":"AdvancedCaptureContext"},{"pos":[7768,7989],"content":"Create a new instance of your context object, populate its members, and then pass it into the overload of <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>CaptureAsync<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/mt181388)</ept> that accepts an object as a parameter.","source":"Create a new instance of your context object, populate its members, and then pass it into the overload of [**CaptureAsync**](https://msdn.microsoft.com/library/windows/apps/mt181388) that accepts an object as a parameter."},{"pos":[8001,8019],"content":"CaptureWithContext"},{"content":"In the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>OptionalReferencePhotoCaptured<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/mt181392)</ept> event handler, cast the <bpt id=\"p3\">[</bpt><bpt id=\"p4\">**</bpt>Context<ept id=\"p4\">**</ept><ept id=\"p3\">](https://msdn.microsoft.com/library/windows/apps/mt181405)</ept> property of the <bpt id=\"p5\">[</bpt><bpt id=\"p6\">**</bpt>OptionalReferencePhotoCapturedEventArgs<ept id=\"p6\">**</ept><ept id=\"p5\">](https://msdn.microsoft.com/library/windows/apps/mt181404)</ept> object to your context object class.","pos":[8100,8454],"source":"In the [**OptionalReferencePhotoCaptured**](https://msdn.microsoft.com/library/windows/apps/mt181392) event handler, cast the [**Context**](https://msdn.microsoft.com/library/windows/apps/mt181405) property of the [**OptionalReferencePhotoCapturedEventArgs**](https://msdn.microsoft.com/library/windows/apps/mt181404) object to your context object class."},{"content":"This example modifies the file name to distinguish the reference frame image from the final HDR image and then calls the <bpt id=\"p1\">**</bpt>ReencodeAndSavePhotoAsync<ept id=\"p1\">**</ept> helper method to save the image.","pos":[8455,8638],"source":" This example modifies the file name to distinguish the reference frame image from the final HDR image and then calls the **ReencodeAndSavePhotoAsync** helper method to save the image."},{"pos":[8650,8680],"content":"OptionalReferencePhotoCaptured"},{"content":"Receive a notification when all frames have been captured","pos":[8776,8833]},{"content":"The HDR photo capture has two steps.","pos":[8835,8871]},{"content":"First, multiple frames are captured, and then the frames are processed into the final HDR image.","pos":[8872,8968]},{"content":"You can't initiate another capture while the source HDR frames are still being captured, but you can initiate a capture after all of the frames have been captured but before the HDR post-processing is complete.","pos":[8969,9179]},{"content":"The <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>AllPhotosCaptured<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/mt181387)</ept> event is raised when the HDR captures are complete, letting you know that you can initiate another capture.","pos":[9180,9373],"source":" The [**AllPhotosCaptured**](https://msdn.microsoft.com/library/windows/apps/mt181387) event is raised when the HDR captures are complete, letting you know that you can initiate another capture."},{"content":"A typical scenario is to disable your UI's capture button when HDR capture begins and then reenable it when <bpt id=\"p1\">**</bpt>AllPhotosCaptured<ept id=\"p1\">**</ept> is raised.","pos":[9374,9514],"source":" A typical scenario is to disable your UI's capture button when HDR capture begins and then reenable it when **AllPhotosCaptured** is raised."},{"pos":[9526,9543],"content":"AllPhotosCaptured"},{"content":"Clean up the AdvancedPhotoCapture object","pos":[9626,9666]},{"pos":[9668,9995],"content":"When your app is done capturing, before disposing of the <bpt id=\"p1\">**</bpt>MediaCapture<ept id=\"p1\">**</ept> object, you should shut down the <bpt id=\"p2\">[</bpt><bpt id=\"p3\">**</bpt>AdvancedPhotoCapture<ept id=\"p3\">**</ept><ept id=\"p2\">](https://msdn.microsoft.com/library/windows/apps/mt181386)</ept> object by calling <bpt id=\"p4\">[</bpt><bpt id=\"p5\">**</bpt>FinishAsync<ept id=\"p5\">**</ept><ept id=\"p4\">](https://msdn.microsoft.com/library/windows/apps/mt181391)</ept> and setting your member variable to null.","source":"When your app is done capturing, before disposing of the **MediaCapture** object, you should shut down the [**AdvancedPhotoCapture**](https://msdn.microsoft.com/library/windows/apps/mt181386) object by calling [**FinishAsync**](https://msdn.microsoft.com/library/windows/apps/mt181391) and setting your member variable to null."},{"pos":[10007,10034],"content":"CleanUpAdvancedPhotoCapture"},{"content":"Related topics","pos":[10127,10141]},{"content":"Capture photos and video with MediaCapture","pos":[10146,10188]}],"content":"---\nauthor: drewbatgit\nms.assetid: 0186EA01-8446-45BA-A109-C5EB4B80F368\ndescription: The AdvancedPhotoCapture class allows you to capture High Dynamic Range (HDR) photos.\ntitle: High Dynamic Range (HDR) photo capture\n---\n\n# High Dynamic Range (HDR) photo capture\n\n\\[ Updated for UWP apps on Windows 10. For Windows 8.x articles, see the [archive](http://go.microsoft.com/fwlink/p/?linkid=619132) \\]\n\n\nThe [**AdvancedPhotoCapture**](https://msdn.microsoft.com/library/windows/apps/mt181386) class allows you to capture High Dynamic Range (HDR) photos. This API also allows you to obtain a reference frame from the HDR capture before the processing of the final image is complete.\n\nOther articles related to HDR capture include:\n\n-   You can use the [**SceneAnalysisEffect**](https://msdn.microsoft.com/library/windows/apps/dn948902) to allow the system to evaluate the content of the media capture preview stream to determine if HDR processing would improve the capture result. For more information, see [Scene Analysis for Media Capture](scene-analysis-for-media-capture.md).\n\n-   Use the [**HdrVideoControl**](https://msdn.microsoft.com/library/windows/apps/dn926680) to capture video using the Windows built-in HDR processing algorithm. For more information, see [Capture device controls for video capture](capture-device-controls-for-video-capture.md).\n\n-   You can use the [**VariablePhotoSequenceCapture**](https://msdn.microsoft.com/library/windows/apps/dn652564) to capture a sequence of photos, each with different capture settings, and implement your own HDR or other processing algorithm. For more information, see [Variable photo sequence](variable-photo-sequence.md).\n\n**Note**\n-   Concurrently recording video and photo capture using **AdvancedPhotoCapture** is not supported.\n\n-   Using the camera flash during advanced photo capture is not supported.\n\n**Note** This article builds on concepts and code discussed in [Capture Photos and Video with MediaCapture](capture-photos-and-video-with-mediacapture.md), which describes the steps for implementing basic photo and video capture. It is recommended that you familiarize yourself with the basic media capture pattern in that article before moving on to more advanced capture scenarios. The code in this article assumes that your app already has an instance of MediaCapture that has been properly initialized.\n\n## HDR photo capture namespaces\n\nTo use HDR photo capture, your app must include the following namespaces in addition to the namespaces required for basic media capture.\n\n[!code-cs[HDRPhotoUsing](./code/BasicMediaCaptureWin10/cs/MainPage.xaml.cs#SnippetHDRPhotoUsing)]\n\n\n## Determine if HDR photo capture is supported on the current device\n\nThe HDR capture technique described in this article is performed using the [**AdvancedPhotoCapture**](https://msdn.microsoft.com/library/windows/apps/mt181386) object. Not all devices support HDR capture with **AdvancedPhotoCapture**. Determine if the device on which your app is currently running supports the technique by getting the **MediaCapture** object's [**VideoDeviceController**](https://msdn.microsoft.com/library/windows/apps/br226825) and then getting the [**AdvancedPhotoControl**](https://msdn.microsoft.com/library/windows/apps/mt147840) property. Check the video device controller's [**SupportedModes**](https://msdn.microsoft.com/library/windows/apps/mt147844) collection to see if it includes [**AdvancedPhotoMode.Hdr**](https://msdn.microsoft.com/library/windows/apps/mt147845). If it does, HDR capture using **AdvancedPhotoCapture** is supported.\n\n[!code-cs[HdrSupported](./code/BasicMediaCaptureWin10/cs/MainPage.xaml.cs#SnippetHdrSupported)]\n\n## Configure and prepare the AdvancedPhotoCapture object\n\nSince you will need to access the [**AdvancedPhotoCapture**](https://msdn.microsoft.com/library/windows/apps/mt181386) instance from multiple places within your code, you should declare a member variable to hold the object.\n\n[!code-cs[DeclareAdvancedCapture](./code/BasicMediaCaptureWin10/cs/MainPage.xaml.cs#SnippetDeclareAdvancedCapture)]\n\nIn your app, after you have initialized the **MediaCapture** object, create an [**AdvancedPhotoCaptureSettings**](https://msdn.microsoft.com/library/windows/apps/mt147837) object and set the mode to [**AdvancedPhotoMode.Hdr**](https://msdn.microsoft.com/library/windows/apps/mt147845). Call the [**AdvancedPhotoControl**](https://msdn.microsoft.com/library/windows/apps/mt147840) object's [**Configure**](https://msdn.microsoft.com/library/windows/apps/mt147841) method, passing in the **AdvancedPhotoCaptureSettings** object you created.\n\nCall the **MediaCapture** object's [**PrepareAdvancedPhotoCaptureAsync**](https://msdn.microsoft.com/library/windows/apps/mt181403), passing in an [**ImageEncodingProperties**](https://msdn.microsoft.com/library/windows/apps/hh700993) object specifying the type of encoding the capture should use. The **ImageEncodingProperties** class provides static methods for creating the image encodings that are supported by **MediaCapture**.\n\n**PrepareAdvancedPhotoCaptureAsync** returns the [**AdvancedPhotoCapture**](https://msdn.microsoft.com/library/windows/apps/mt181386) object you will use to initiate photo capture. You can use this object to register handlers for the [**OptionalReferencePhotoCaptured**](https://msdn.microsoft.com/library/windows/apps/mt181392) and [**AllPhotosCaptured**](https://msdn.microsoft.com/library/windows/apps/mt181387) which are discussed later in this article.\n\n[!code-cs[CreateAdvancedCaptureAsync](./code/BasicMediaCaptureWin10/cs/MainPage.xaml.cs#SnippetCreateAdvancedCaptureAsync)]\n\n## Capture an HDR photo\n\nCapture an HDR photo by calling the [**AdvancedPhotoCapture**](https://msdn.microsoft.com/library/windows/apps/mt181386) object's [**CaptureAsync**](https://msdn.microsoft.com/library/windows/apps/mt181388) method. This method returns a [**AdvancedCapturedPhoto**](https://msdn.microsoft.com/library/windows/apps/mt181378) object that provides the captured photo in its [**Frame**](https://msdn.microsoft.com/library/windows/apps/mt181382) property.\n\n[!code-cs[CaptureHdrPhotoAsync](./code/BasicMediaCaptureWin10/cs/MainPage.xaml.cs#SnippetCaptureHdrPhotoAsync)]\n\n**ConvertOrientationToPhotoOrientation** and **ReencodeAndSavePhotoAsync** are helper methods that are discussed as part of the basic media capture scenario in the article [Capture Photos and Video with MediaCapture](capture-photos-and-video-with-mediacapture.md).\n\n## Get optional reference frame\n\nThe HDR process captures multiple frames and then composites them into a single image after all of the frames have been captured. You can get access to a frame after it is captured but before the entire HDR process is complete by handling the [**OptionalReferencePhotoCaptured**](https://msdn.microsoft.com/library/windows/apps/mt181392) event. You don't need to do this if you are only interested in the final HDR photo result.\n\n**Important** [**OptionalReferencePhotoCaptured**](https://msdn.microsoft.com/library/windows/apps/mt181392) is not raised on devices that support hardware HDR and therefore do not generate reference frames. Your app should handle the case where this event is not raised.\n\nBecause the reference frame arrives out of context of the call to **CaptureAsync**, a mechanism is provided to pass context information to the **OptionalReferencePhotoCaptured** handler. First you should an object that will contain your context information. The name and contents of this object is up to you. This example defines an object that has members to track the file name and camera orientation of the capture.\n\n[!code-cs[AdvancedCaptureContext](./code/BasicMediaCaptureWin10/cs/MainPage.xaml.cs#SnippetAdvancedCaptureContext)]\n\nCreate a new instance of your context object, populate its members, and then pass it into the overload of [**CaptureAsync**](https://msdn.microsoft.com/library/windows/apps/mt181388) that accepts an object as a parameter.\n\n[!code-cs[CaptureWithContext](./code/BasicMediaCaptureWin10/cs/MainPage.xaml.cs#SnippetCaptureWithContext)]\n\nIn the [**OptionalReferencePhotoCaptured**](https://msdn.microsoft.com/library/windows/apps/mt181392) event handler, cast the [**Context**](https://msdn.microsoft.com/library/windows/apps/mt181405) property of the [**OptionalReferencePhotoCapturedEventArgs**](https://msdn.microsoft.com/library/windows/apps/mt181404) object to your context object class. This example modifies the file name to distinguish the reference frame image from the final HDR image and then calls the **ReencodeAndSavePhotoAsync** helper method to save the image.\n\n[!code-cs[OptionalReferencePhotoCaptured](./code/BasicMediaCaptureWin10/cs/MainPage.xaml.cs#SnippetOptionalReferencePhotoCaptured)]\n\n## Receive a notification when all frames have been captured\n\nThe HDR photo capture has two steps. First, multiple frames are captured, and then the frames are processed into the final HDR image. You can't initiate another capture while the source HDR frames are still being captured, but you can initiate a capture after all of the frames have been captured but before the HDR post-processing is complete. The [**AllPhotosCaptured**](https://msdn.microsoft.com/library/windows/apps/mt181387) event is raised when the HDR captures are complete, letting you know that you can initiate another capture. A typical scenario is to disable your UI's capture button when HDR capture begins and then reenable it when **AllPhotosCaptured** is raised.\n\n[!code-cs[AllPhotosCaptured](./code/BasicMediaCaptureWin10/cs/MainPage.xaml.cs#SnippetAllPhotosCaptured)]\n\n## Clean up the AdvancedPhotoCapture object\n\nWhen your app is done capturing, before disposing of the **MediaCapture** object, you should shut down the [**AdvancedPhotoCapture**](https://msdn.microsoft.com/library/windows/apps/mt181386) object by calling [**FinishAsync**](https://msdn.microsoft.com/library/windows/apps/mt181391) and setting your member variable to null.\n\n[!code-cs[CleanUpAdvancedPhotoCapture](./code/BasicMediaCaptureWin10/cs/MainPage.xaml.cs#SnippetCleanUpAdvancedPhotoCapture)]\n\n## Related topics\n\n* [Capture photos and video with MediaCapture](capture-photos-and-video-with-mediacapture.md)\n"}