{"nodes":[{"content":"Getting Started with Universal Windows drivers","pos":[0,46]},{"content":"Universal Windows drivers enable developers to create a single driver that runs across multiple different device types, from embedded systems to tablets and desktop PCs.","pos":[161,330]},{"content":"Hardware developers can use their existing components and device drivers across different form factors.","pos":[331,434]},{"content":"Universal Windows drivers run on Windows 10 for desktop editions (Home, Pro, and Enterprise), Windows 10 Mobile, Windows 10 IoT Core, Windows Server 2016 Technical Preview, as well as other Windows 10 editions that share a common set of interfaces.","pos":[435,683]},{"pos":[865,906],"content":"Introduction to Universal Windows drivers"},{"content":"Windows 10 provides a set of API and DDI interfaces that are common to multiple editions of Windows.","pos":[1130,1230]},{"content":"This set of interfaces is called the Universal Windows Platform (UWP).","pos":[1231,1301]},{"content":"A Universal Windows driver is a kernel-mode or user-mode driver binary that installs and runs on UWP-based editions of Windows 10.","pos":[1303,1433]},{"content":"A Universal Windows driver calls only device driver interfaces (DDIs) that are part of UWP.","pos":[1435,1526]},{"content":"These DDIs are marked as <bpt id=\"p1\">**</bpt>Universal<ept id=\"p1\">**</ept> on the corresponding MSDN reference pages.","pos":[1527,1608],"source":" These DDIs are marked as **Universal** on the corresponding MSDN reference pages."},{"content":"To determine if your existing driver calls any interfaces outside of UWP, recompile your driver as a Universal Windows driver.","pos":[1610,1736]},{"content":"The compiler displays <bpt id=\"p1\">[</bpt>ApiValidator errors<ept id=\"p1\">](validating_universal_drivers.md)</ept> if the driver calls interfaces that are not part of UWP.","pos":[1737,1870],"source":" The compiler displays [ApiValidator errors](validating_universal_drivers.md) if the driver calls interfaces that are not part of UWP."},{"content":"In some cases, you can replace these calls with alternate DDIs that are listed on the MSDN reference pages for the desktop-only DDI.","pos":[1871,2003]},{"content":"If you cannot find a suitable replacement, please submit <bpt id=\"p1\">[</bpt>feedback<ept id=\"p1\">](http://go.microsoft.com/fwlink/p/?linkid=529549)</ept>.","pos":[2004,2121],"source":" If you cannot find a suitable replacement, please submit [feedback](http://go.microsoft.com/fwlink/p/?linkid=529549)."},{"content":"In other cases, you may have to code a workaround if there is not a suitable replacement.","pos":[2123,2212]},{"content":"If you need to, write a new Universal Windows driver starting from the driver templates in the unified WDK.","pos":[2213,2320]},{"pos":[2322,2558],"content":"The compiler might also display <bpt id=\"p1\">[</bpt>INF validation errors<ept id=\"p1\">](https://msdn.microsoft.com/en-us/Library/Windows/Hardware/Dn929320)</ept> if you are not <bpt id=\"p2\">[</bpt>using a universal INF file<ept id=\"p2\">](https://msdn.microsoft.com/en-us/Library/Windows/Hardware/Dn941087)</ept>.","source":"The compiler might also display [INF validation errors](https://msdn.microsoft.com/en-us/Library/Windows/Hardware/Dn929320) if you are not [using a universal INF file](https://msdn.microsoft.com/en-us/Library/Windows/Hardware/Dn941087)."},{"pos":[2560,2782],"content":"A Universal Windows driver can use <bpt id=\"p1\">[</bpt>KMDF<ept id=\"p1\">](https://msdn.microsoft.com/en-us/Library/Windows/Hardware/Ff557565)</ept>, <bpt id=\"p2\">[</bpt>UMDF 2<ept id=\"p2\">](https://msdn.microsoft.com/en-us/Library/Windows/Hardware/Dn384105)</ept> or the Windows Driver Model (WDM).","source":"A Universal Windows driver can use [KMDF](https://msdn.microsoft.com/en-us/Library/Windows/Hardware/Ff557565), [UMDF 2](https://msdn.microsoft.com/en-us/Library/Windows/Hardware/Dn384105) or the Windows Driver Model (WDM)."},{"pos":[2946,2981],"content":"Building a Universal Windows driver"},{"content":"You can use Microsoft Visual Studio 2015 in conjunction with Windows Driver Kit (WDK) 10 to build drivers for desktop, mobile, or universal.","pos":[3181,3321]},{"content":"You can download kits and tools from the <bpt id=\"p1\">[</bpt>Windows Hardware Dev Center<ept id=\"p1\">](http://go.microsoft.com/fwlink/p/?LinkId=524487)</ept>.","pos":[3322,3442],"source":" You can download kits and tools from the [Windows Hardware Dev Center](http://go.microsoft.com/fwlink/p/?LinkId=524487)."},{"content":"In many cases, you can recompile an existing kernel-mode driver that runs on Windows 8.1 as a Universal Windows driver, as long as the driver does not work with any user-mode components.","pos":[3444,3630]},{"content":"WDM and KMDF drivers that work with Windows 8.1 should recompile as Universal Windows drivers targeting Windows 10 with no conversion required.","pos":[3631,3774]},{"content":"In contrast, existing user-mode drivers may require modification to compile as Universal Windows drivers.","pos":[3776,3881]},{"content":"Specifically, your driver package must not have any dependencies outside of UWP.","pos":[3882,3962]},{"content":"For example, only some of the Win32 APIs are part of UWP.","pos":[3963,4020]},{"content":"Converting an existing driver project to a Universal Windows driver project","pos":[4024,4099]},{"content":"In Visual Studio 2015, open the existing driver project.","pos":[4107,4163]},{"content":"In the Solution Explorer pane, right-click the solution and choose <bpt id=\"p1\">**</bpt>Configuration Manager<ept id=\"p1\">**</ept>.","pos":[4168,4261],"source":"In the Solution Explorer pane, right-click the solution and choose **Configuration Manager**."},{"content":"Set the target operating system to Windows 10.","pos":[4262,4308]},{"content":"Right-click the driver project and choose <bpt id=\"p1\">**</bpt>Properties<ept id=\"p1\">**</ept>.","pos":[4313,4370],"source":"Right-click the driver project and choose **Properties**."},{"content":"Under Configuration Properties-<ph id=\"ph1\">&amp;gt;</ph>Driver, verify that <bpt id=\"p1\">**</bpt>Target Platform<ept id=\"p1\">**</ept> is set to <bpt id=\"p2\">**</bpt>Universal<ept id=\"p2\">**</ept>.","pos":[4371,4470],"source":" Under Configuration Properties-&gt;Driver, verify that **Target Platform** is set to **Universal**."},{"content":"Other choices include <bpt id=\"p1\">**</bpt>Desktop<ept id=\"p1\">**</ept>, to build a driver that runs on Windows 10 for desktop editions only, and <bpt id=\"p2\">**</bpt>Mobile<ept id=\"p2\">**</ept>, to build a driver that runs on Windows 10 Mobile only.","pos":[4471,4645],"source":" Other choices include **Desktop**, to build a driver that runs on Windows 10 for desktop editions only, and **Mobile**, to build a driver that runs on Windows 10 Mobile only."},{"content":"Build the driver.","pos":[4650,4667]},{"content":"You might see linker errors.","pos":[4668,4696]},{"content":"Fix the errors one by one by going through the error log.","pos":[4701,4758]},{"content":"Refer to individual reference pages in the documentation for possible alternate APIs.","pos":[4759,4844]},{"content":"If replacements are not available, you may need to redesign your driver.","pos":[4845,4917]},{"content":"Creating a New Universal Windows driver Project in Microsoft Visual Studio","pos":[4921,4995]},{"pos":[5003,5203],"content":"Create a new driver from a template (<bpt id=\"p1\">**</bpt>File<ph id=\"ph1\">&amp;gt;</ph>New Project-<ph id=\"ph2\">&amp;gt;</ph>Templates-<ph id=\"ph3\">&amp;gt;</ph>Visual C++-<ph id=\"ph4\">&amp;gt;</ph>Windows Driver-<ph id=\"ph5\">&amp;gt;</ph>WDF<ept id=\"p1\">**</ept>) and choose either <bpt id=\"p2\">**</bpt>User Mode Driver (UMDF V2)<ept id=\"p2\">**</ept> or <bpt id=\"p3\">**</bpt>Kernel Mode Driver (KMDF)<ept id=\"p3\">**</ept>.","source":"Create a new driver from a template (**File&gt;New Project-&gt;Templates-&gt;Visual C++-&gt;Windows Driver-&gt;WDF**) and choose either **User Mode Driver (UMDF V2)** or **Kernel Mode Driver (KMDF)**."},{"content":"After you create the project, in the Solution Explorer pane, right-click the solution and choose <bpt id=\"p1\">**</bpt>Configuration Manager<ept id=\"p1\">**</ept>.","pos":[5208,5331],"source":"After you create the project, in the Solution Explorer pane, right-click the solution and choose **Configuration Manager**."},{"content":"Set <bpt id=\"p1\">**</bpt>Active solution configuration<ept id=\"p1\">**</ept> to the desired target Windows version, and set <bpt id=\"p2\">**</bpt>Active solution platform<ept id=\"p2\">**</ept> to <bpt id=\"p3\">**</bpt>Win32<ept id=\"p3\">**</ept> or <bpt id=\"p4\">**</bpt>x64<ept id=\"p4\">**</ept>.","pos":[5332,5470],"source":" Set **Active solution configuration** to the desired target Windows version, and set **Active solution platform** to **Win32** or **x64**."},{"content":"If <bpt id=\"p1\">**</bpt>ARM<ept id=\"p1\">**</ept> is not listed, choose <bpt id=\"p2\">**</bpt><ph id=\"ph1\">&amp;lt;</ph>New...<ph id=\"ph2\">&amp;gt;</ph><ept id=\"p2\">**</ept> to build for ARM.","pos":[5471,5540],"source":" If **ARM** is not listed, choose **&lt;New...&gt;** to build for ARM."},{"pos":[5546,5615],"content":"If you choose Windows 10, the driver model defaults to <bpt id=\"p1\">**</bpt>Universal<ept id=\"p1\">**</ept>.","source":"If you choose Windows 10, the driver model defaults to **Universal**."},{"content":"To change driver model manually, right-click the driver project and choose Properties.","pos":[5621,5707]},{"content":"Under <bpt id=\"p1\">**</bpt>Configuration Properties-<ph id=\"ph1\">&amp;gt;</ph>Driver Settings-<ph id=\"ph2\">&amp;gt;</ph>General<ept id=\"p1\">**</ept>, find the <bpt id=\"p2\">**</bpt>Target Platform<ept id=\"p2\">**</ept> entry.","pos":[5708,5811],"source":" Under **Configuration Properties-&gt;Driver Settings-&gt;General**, find the **Target Platform** entry."},{"content":"Choose <bpt id=\"p1\">**</bpt>Universal<ept id=\"p1\">**</ept>, <bpt id=\"p2\">**</bpt>Desktop<ept id=\"p2\">**</ept>, or <bpt id=\"p3\">**</bpt>Mobile<ept id=\"p3\">**</ept>.","pos":[5812,5861],"source":" Choose **Universal**, **Desktop**, or **Mobile**."},{"content":"Microsoft Visual Studio uses this setting to determine what libraries to link against.","pos":[5862,5948]},{"pos":[5954,6053],"content":"<bpt id=\"p1\">**</bpt>Note<ept id=\"p1\">**</ept>  You cannot build a Universal Windows driver for Windows versions earlier than Windows 10.","source":"**Note**  You cannot build a Universal Windows driver for Windows versions earlier than Windows 10."},{"content":"You might need to modify the .inf file to specify the provider, specified as an <bpt id=\"p1\">**</bpt><ph id=\"ph1\">%</ph><ept id=\"p1\">**</ept><bpt id=\"p2\">*</bpt>ManufacturerName<ept id=\"p2\">*</ept><bpt id=\"p3\">**</bpt><ph id=\"ph2\">%</ph><ept id=\"p3\">**</ept> token that is expanded later in the INF file's <bpt id=\"p4\">[</bpt><bpt id=\"p5\">**</bpt>Strings<ept id=\"p5\">**</ept><ept id=\"p4\">](https://msdn.microsoft.com/en-us/Library/Windows/Hardware/Ff547485)</ept> section.","pos":[6058,6304],"source":"You might need to modify the .inf file to specify the provider, specified as an **%***ManufacturerName***%** token that is expanded later in the INF file's [**Strings**](https://msdn.microsoft.com/en-us/Library/Windows/Hardware/Ff547485) section."},{"content":"For example:","pos":[6305,6317]},{"content":"You can now build the solution.","pos":[6370,6401]},{"content":"Visual Studio links against the required libraries and generates a .cat file, an .inf file, and a driver binary.","pos":[6402,6514]},{"pos":[6516,6680],"content":"For information about the configuration settings you can use in Visual Studio when building your driver, see <bpt id=\"p1\">[</bpt>Building a Driver with the WDK<ept id=\"p1\">](building_a_driver.md)</ept>.","source":"For information about the configuration settings you can use in Visual Studio when building your driver, see [Building a Driver with the WDK](building_a_driver.md)."},{"pos":[6850,6887],"content":"Installing a Universal Windows driver"},{"pos":[7095,7216],"content":"<bpt id=\"p1\">**</bpt>Note<ept id=\"p1\">**</ept>  The SetupAPI component is not part of UWP, so a Universal Windows driver cannot call functions in this API set.","source":"**Note**  The SetupAPI component is not part of UWP, so a Universal Windows driver cannot call functions in this API set."},{"content":"If you want to install a Universal Windows driver on a device that is running Windows 10 for desktop editions, you can still use an INF file, with a few caveats.","pos":[7221,7382]},{"content":"An INF for a Universal Windows driver cannot include any of the following:","pos":[7383,7457]},{"content":"Coinstallers","pos":[7463,7475]},{"content":"Class installers","pos":[7480,7496]},{"content":"RegisterDLL, DelFile, or DelReg directives","pos":[7501,7543]},{"content":"Non-HKR AddReg directives","pos":[7548,7573]},{"pos":[7575,7698],"content":"For more information, see <bpt id=\"p1\">[</bpt>Using a Universal INF File<ept id=\"p1\">](https://msdn.microsoft.com/en-us/Library/Windows/Hardware/Dn941087)</ept>.","source":"For more information, see [Using a Universal INF File](https://msdn.microsoft.com/en-us/Library/Windows/Hardware/Dn941087)."},{"content":"If you want to install your Universal Windows driver on Windows 10 Mobile, you can use an .spkg file.","pos":[7700,7801]},{"content":"An .spkg (\"<bpt id=\"p1\">*</bpt>package file<ept id=\"p1\">*</ept>\") is a standalone module that contains your driver package.","pos":[7802,7887],"source":" An .spkg (\"*package file*\") is a standalone module that contains your driver package."},{"content":"If you are not deploying to Windows 10 Mobile, you do not need to generate a package file.","pos":[7888,7978]},{"content":"You can still compile a Universal Windows driver (as defined by the driver source code) without a package file.","pos":[7979,8090]},{"content":"WDK 10 includes PkgGen, a tool that generates package files.","pos":[8092,8152]},{"content":"You run PkgGen in Visual Studio when you build your driver, using the following procedure.","pos":[8153,8243]},{"content":"Using PkgGen to generate a package file","pos":[8247,8286]},{"content":"Right-click the driver project and choose <bpt id=\"p1\">**</bpt>Add-<ph id=\"ph1\">&amp;gt;</ph>New Item<ept id=\"p1\">**</ept>.","pos":[8294,8357],"source":"Right-click the driver project and choose **Add-&gt;New Item**."},{"content":"Next, under <bpt id=\"p1\">**</bpt>Visual C++-<ph id=\"ph1\">&amp;gt;</ph>Windows Driver<ept id=\"p1\">**</ept>, choose <bpt id=\"p2\">**</bpt>Package Manifest<ept id=\"p2\">**</ept>.","pos":[8358,8433],"source":" Next, under **Visual C++-&gt;Windows Driver**, choose **Package Manifest**."},{"content":"Click <bpt id=\"p1\">**</bpt>Add<ept id=\"p1\">**</ept>.","pos":[8434,8448],"source":" Click **Add**."},{"content":"Visual Studio adds a file called Package.pkg.xml to your driver project.","pos":[8453,8525]},{"content":"You can right-click the file and choose properties to verify that the item type is <bpt id=\"p1\">**</bpt>PkgGen<ept id=\"p1\">**</ept>.","pos":[8526,8620],"source":" You can right-click the file and choose properties to verify that the item type is **PkgGen**."},{"content":"(On this same property page, you can set <bpt id=\"p1\">**</bpt>Excluded from Build<ept id=\"p1\">**</ept> to <bpt id=\"p2\">**</bpt>Yes<ept id=\"p2\">**</ept> if you decide later that you want to build this driver project and not generate a package file.) Click <bpt id=\"p3\">**</bpt>OK<ept id=\"p3\">**</ept>.","pos":[8621,8807],"source":" (On this same property page, you can set **Excluded from Build** to **Yes** if you decide later that you want to build this driver project and not generate a package file.) Click **OK**."},{"content":"Right-click the driver project and choose <bpt id=\"p1\">**</bpt>Properties<ept id=\"p1\">**</ept>.","pos":[8812,8869],"source":"Right-click the driver project and choose **Properties**."},{"content":"Under Configuration Properties, open the PackageGen node and change Version to any value you like.","pos":[8870,8968]},{"content":"Save your work and restart Visual Studio as administrator.","pos":[8973,9031]},{"content":"Build your driver.","pos":[9036,9054]},{"content":"Visual Studio links against the required libraries and generates a .cat file, an .inf file, a driver binary, and an .spkg file.","pos":[9055,9182]},{"content":"To view the contents of the package file, append a .cab suffix to the file name and then open the cab file in Windows Explorer.","pos":[9184,9311]},{"pos":[9313,9461],"content":"To learn about running PkgGen outside of Visual Studio, see <bpt id=\"p1\">[</bpt>Creating packages<ept id=\"p1\">](https://msdn.microsoft.com/en-us/Library/Windows/Hardware/Dn756642)</ept>.","source":"To learn about running PkgGen outside of Visual Studio, see [Creating packages](https://msdn.microsoft.com/en-us/Library/Windows/Hardware/Dn756642)."},{"content":"To install a mobile driver package (.spkg file), you have two options.","pos":[9463,9533]},{"content":"If you are updating an existing package on a target system or adding a new package to the target, use IUTool.exe to install an .spkg driver package.","pos":[9539,9687]},{"content":"If you are combining packages into a mobile OS image, use ImgGen to add the .spkg driver package to a full flash update (FFU) image that can then be flashed to a mobile device.","pos":[9692,9868]},{"content":"Using IUTool to add a mobile driver package (.spkg) to a running device","pos":[9872,9943]},{"pos":[9951,10083],"content":"<bpt id=\"p1\">[</bpt>IUTool.exe<ept id=\"p1\">](http://go.microsoft.com/fwlink/p/?linkid=617385)</ept> is in the \\\\tools\\\\bin\\\\<bpt id=\"p2\">*</bpt><ph id=\"ph1\">&amp;lt;</ph>architecture<ph id=\"ph2\">&amp;gt;</ph><ept id=\"p2\">*</ept> subdirectory of WDK 10.","source":"[IUTool.exe](http://go.microsoft.com/fwlink/p/?linkid=617385) is in the \\\\tools\\\\bin\\\\*&lt;architecture&gt;* subdirectory of WDK 10."},{"content":"Attach your mobile device to the PC.","pos":[10089,10125]},{"content":"Then, from an elevated command prompt, issue the following command:","pos":[10126,10193]},{"pos":[10264,10486],"content":"For more information, see <bpt id=\"p1\">[</bpt>IUTool.exe: Update packages on a phone<ept id=\"p1\">](http://go.microsoft.com/fwlink/p/?linkid=617385)</ept> and <bpt id=\"p2\">[</bpt>Adding a driver to a test image<ept id=\"p2\">](https://msdn.microsoft.com/en-us/Library/Windows/Hardware/Mt131832)</ept>.","source":"For more information, see [IUTool.exe: Update packages on a phone](http://go.microsoft.com/fwlink/p/?linkid=617385) and [Adding a driver to a test image](https://msdn.microsoft.com/en-us/Library/Windows/Hardware/Mt131832)."},{"content":"Using ImgGen to add a driver package (.spkg) to a mobile OS image (.ffu)","pos":[10490,10562]},{"content":"After you install Visual Studio, on the Start screen, click the Visual Studio 2015 folder.","pos":[10570,10660]},{"content":"Right-click <bpt id=\"p1\">**</bpt>Developer Command Prompt for VS2015<ept id=\"p1\">**</ept>, and choose <bpt id=\"p2\">**</bpt>Run as Administrator<ept id=\"p2\">**</ept>.","pos":[10661,10750],"source":" Right-click **Developer Command Prompt for VS2015**, and choose **Run as Administrator**."},{"pos":[10755,10885],"content":"For more information about ImgGen, see <bpt id=\"p1\">[</bpt>Building a phone image using ImgGen.cmd<ept id=\"p1\">](http://go.microsoft.com/fwlink/p/?linkid=617386)</ept>.","source":"For more information about ImgGen, see [Building a phone image using ImgGen.cmd](http://go.microsoft.com/fwlink/p/?linkid=617386)."},{"pos":[11043,11076],"content":"Flashing a mobile OS image (.ffu)"},{"content":"To flash the image to the device, either use the Microsoft-supplied FFUTool, or develop custom OEM flashing tools.","pos":[11268,11382]},{"content":"For more information, see <bpt id=\"p1\">[</bpt>Update packages in an .FFU image file<ept id=\"p1\">](http://go.microsoft.com/fwlink/p/?linkid=617387)</ept>.","pos":[11383,11498],"source":" For more information, see [Update packages in an .FFU image file](http://go.microsoft.com/fwlink/p/?linkid=617387)."},{"pos":[11665,11701],"content":"Debugging a Universal Windows driver"},{"content":"Starting in Windows 10, you can build your KMDF or UMDF driver so that it gets additional driver debugging information through the <bpt id=\"p1\">[</bpt>Inflight Trace Recorder<ept id=\"p1\">](https://msdn.microsoft.com/en-us/Library/Windows/Hardware/Dn914610)</ept>.","pos":[11905,12130],"source":"Starting in Windows 10, you can build your KMDF or UMDF driver so that it gets additional driver debugging information through the [Inflight Trace Recorder](https://msdn.microsoft.com/en-us/Library/Windows/Hardware/Dn914610)."},{"content":"Universal Windows drivers can take advantage of this feature.","pos":[12131,12192]},{"content":"In addition, if you used the Visual Studio KMDF template, your driver uses Windows software trace preprocessor (WPP) to write trace messages.","pos":[12194,12335]},{"content":"Your driver is an ETW provider with a provider GUID.","pos":[12336,12388]},{"content":"To send a trace message from your driver, use this code:","pos":[12390,12446]},{"pos":[12559,12806],"content":"You can access the ETW logs either using Tracelog via the <bpt id=\"p1\">[</bpt>TShell tool<ept id=\"p1\">](http://go.microsoft.com/fwlink/p/?linkid=617388)</ept> on a phone, or by using <bpt id=\"p2\">[</bpt>!wmitrace<ept id=\"p2\">](https://msdn.microsoft.com/en-us/Library/Windows/Hardware/Ff561362)</ept> in a debugger session.","source":"You can access the ETW logs either using Tracelog via the [TShell tool](http://go.microsoft.com/fwlink/p/?linkid=617388) on a phone, or by using [!wmitrace](https://msdn.microsoft.com/en-us/Library/Windows/Hardware/Ff561362) in a debugger session."},{"content":"To use Tracelog on a phone:","pos":[12808,12835]},{"content":"Establish a kernel-mode debugging session between a host computer and the phone.","pos":[12841,12921]},{"content":"On the host computer, in TShell, enter this command:","pos":[12926,12978]},{"content":"Reboot the phone, and watch for trace messages in the debugger.","pos":[13121,13184]},{"content":"All existing kernel mode debug transports continue to work on Windows 10 for desktop editions.","pos":[13186,13280]},{"content":"However, for both user-mode and kernel-mode drivers, you must use a remote debugger session over KDNET to test Windows 10 Mobile.","pos":[13281,13410]},{"content":"For more info, see <bpt id=\"p1\">[</bpt>Setting Up Kernel-Mode Debugging over a Network Cable Manually<ept id=\"p1\">](https://msdn.microsoft.com/en-us/Library/Windows/Hardware/Hh439346)</ept> in Visual Studio.","pos":[13411,13580],"source":" For more info, see [Setting Up Kernel-Mode Debugging over a Network Cable Manually](https://msdn.microsoft.com/en-us/Library/Windows/Hardware/Hh439346) in Visual Studio."},{"pos":[13615,13629],"content":"Related topics"},{"content":"Building a Driver with the WDK","pos":[13682,13712]},{"content":"Windows 10 Editions for Universal Windows drivers","pos":[13739,13788]},{"content":"Write a Universal Windows driver (UMDF 2) based on a template","pos":[13839,13900]},{"content":"Write a universal Hello World driver (KMDF)","pos":[13973,14016]},{"content":"Write a Universal Windows driver (KMDF) based on a template","pos":[14089,14148]},{"content":"Provision a computer for driver deployment and testing (WDK 10)","pos":[14221,14284]},{"content":"What's new in driver development","pos":[14357,14389]},{"pos":[14465,15430],"content":"<bpt id=\"p1\">[</bpt>Send comments about this topic to Microsoft<ept id=\"p1\">]</ept><bpt id=\"p2\">(mailto:wsddocfb@microsoft.com?subject=Documentation%20feedback%20[VsDriver\\vsdriver]:%20Getting%20Started%20with%20Universal%20Windows%20drivers%20%20RELEASE:%20%289/30/2015%29&amp;body=%0A%0APRIVACY%20STATEMENT%0A%0AWe%20use%20your%20feedback%20to%20improve%20the%20documentation.%20We%20don't%20use%20your%20email%20address%20for%20any%20other%20purpose,%20and%20we'll%20remove%20your%20email%20address%20from%20our%20system%20after%20the%20issue%20that%20you're%20reporting%20is%20fixed.%20While%20we're%20working%20to%20fix%20this%20issue,%20we%20might%20send%20you%20an%20email%20message%20to%20ask%20for%20more%20info.%20Later,%20we%20might%20also%20send%20you%20an%20email%20message%20to%20let%20you%20know%20that%20we've%20addressed%20your%20feedback.%0A%0AFor%20more%20info%20about%20Microsoft's%20privacy%20policy,%20see%20http://privacy.microsoft.com/en-us/default. \"</bpt>Send comments about this topic to Microsoft<ept id=\"p2\">\")</ept>","source":"[Send comments about this topic to Microsoft](mailto:wsddocfb@microsoft.com?subject=Documentation%20feedback%20[VsDriver\\vsdriver]:%20Getting%20Started%20with%20Universal%20Windows%20drivers%20%20RELEASE:%20%289/30/2015%29&body=%0A%0APRIVACY%20STATEMENT%0A%0AWe%20use%20your%20feedback%20to%20improve%20the%20documentation.%20We%20don't%20use%20your%20email%20address%20for%20any%20other%20purpose,%20and%20we'll%20remove%20your%20email%20address%20from%20our%20system%20after%20the%20issue%20that%20you're%20reporting%20is%20fixed.%20While%20we're%20working%20to%20fix%20this%20issue,%20we%20might%20send%20you%20an%20email%20message%20to%20ask%20for%20more%20info.%20Later,%20we%20might%20also%20send%20you%20an%20email%20message%20to%20let%20you%20know%20that%20we've%20addressed%20your%20feedback.%0A%0AFor%20more%20info%20about%20Microsoft's%20privacy%20policy,%20see%20http://privacy.microsoft.com/en-us/default. \"Send comments about this topic to Microsoft\")"}],"content":"Getting Started with Universal Windows drivers\n================================================================================================================\n\nUniversal Windows drivers enable developers to create a single driver that runs across multiple different device types, from embedded systems to tablets and desktop PCs. Hardware developers can use their existing components and device drivers across different form factors. Universal Windows drivers run on Windows 10 for desktop editions (Home, Pro, and Enterprise), Windows 10 Mobile, Windows 10 IoT Core, Windows Server 2016 Technical Preview, as well as other Windows 10 editions that share a common set of interfaces.\n\n<span id=\"Introduction_to_Universal_Windows_drivers\"></span><span id=\"introduction_to_universal_windows_drivers\"></span><span id=\"INTRODUCTION_TO_UNIVERSAL_WINDOWS_DRIVERS\"></span>Introduction to Universal Windows drivers\n-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------\n\nWindows 10 provides a set of API and DDI interfaces that are common to multiple editions of Windows. This set of interfaces is called the Universal Windows Platform (UWP).\n\nA Universal Windows driver is a kernel-mode or user-mode driver binary that installs and runs on UWP-based editions of Windows 10.\n\nA Universal Windows driver calls only device driver interfaces (DDIs) that are part of UWP. These DDIs are marked as **Universal** on the corresponding MSDN reference pages.\n\nTo determine if your existing driver calls any interfaces outside of UWP, recompile your driver as a Universal Windows driver. The compiler displays [ApiValidator errors](validating_universal_drivers.md) if the driver calls interfaces that are not part of UWP. In some cases, you can replace these calls with alternate DDIs that are listed on the MSDN reference pages for the desktop-only DDI. If you cannot find a suitable replacement, please submit [feedback](http://go.microsoft.com/fwlink/p/?linkid=529549).\n\nIn other cases, you may have to code a workaround if there is not a suitable replacement. If you need to, write a new Universal Windows driver starting from the driver templates in the unified WDK.\n\nThe compiler might also display [INF validation errors](https://msdn.microsoft.com/en-us/Library/Windows/Hardware/Dn929320) if you are not [using a universal INF file](https://msdn.microsoft.com/en-us/Library/Windows/Hardware/Dn941087).\n\nA Universal Windows driver can use [KMDF](https://msdn.microsoft.com/en-us/Library/Windows/Hardware/Ff557565), [UMDF 2](https://msdn.microsoft.com/en-us/Library/Windows/Hardware/Dn384105) or the Windows Driver Model (WDM).\n\n<span id=\"Building_a_Universal_Windows_driver\"></span><span id=\"building_a_universal_windows_driver\"></span><span id=\"BUILDING_A_UNIVERSAL_WINDOWS_DRIVER\"></span>Building a Universal Windows driver\n-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------\n\nYou can use Microsoft Visual Studio 2015 in conjunction with Windows Driver Kit (WDK) 10 to build drivers for desktop, mobile, or universal. You can download kits and tools from the [Windows Hardware Dev Center](http://go.microsoft.com/fwlink/p/?LinkId=524487).\n\nIn many cases, you can recompile an existing kernel-mode driver that runs on Windows 8.1 as a Universal Windows driver, as long as the driver does not work with any user-mode components. WDM and KMDF drivers that work with Windows 8.1 should recompile as Universal Windows drivers targeting Windows 10 with no conversion required.\n\nIn contrast, existing user-mode drivers may require modification to compile as Universal Windows drivers. Specifically, your driver package must not have any dependencies outside of UWP. For example, only some of the Win32 APIs are part of UWP.\n\n**Converting an existing driver project to a Universal Windows driver project**\n\n1.  In Visual Studio 2015, open the existing driver project.\n2.  In the Solution Explorer pane, right-click the solution and choose **Configuration Manager**. Set the target operating system to Windows 10.\n3.  Right-click the driver project and choose **Properties**. Under Configuration Properties-&gt;Driver, verify that **Target Platform** is set to **Universal**. Other choices include **Desktop**, to build a driver that runs on Windows 10 for desktop editions only, and **Mobile**, to build a driver that runs on Windows 10 Mobile only.\n4.  Build the driver. You might see linker errors.\n5.  Fix the errors one by one by going through the error log. Refer to individual reference pages in the documentation for possible alternate APIs. If replacements are not available, you may need to redesign your driver.\n\n**Creating a New Universal Windows driver Project in Microsoft Visual Studio**\n\n1.  Create a new driver from a template (**File&gt;New Project-&gt;Templates-&gt;Visual C++-&gt;Windows Driver-&gt;WDF**) and choose either **User Mode Driver (UMDF V2)** or **Kernel Mode Driver (KMDF)**.\n2.  After you create the project, in the Solution Explorer pane, right-click the solution and choose **Configuration Manager**. Set **Active solution configuration** to the desired target Windows version, and set **Active solution platform** to **Win32** or **x64**. If **ARM** is not listed, choose **&lt;New...&gt;** to build for ARM.\n\n    If you choose Windows 10, the driver model defaults to **Universal**.\n\n    To change driver model manually, right-click the driver project and choose Properties. Under **Configuration Properties-&gt;Driver Settings-&gt;General**, find the **Target Platform** entry. Choose **Universal**, **Desktop**, or **Mobile**. Microsoft Visual Studio uses this setting to determine what libraries to link against.\n\n    **Note**  You cannot build a Universal Windows driver for Windows versions earlier than Windows 10.\n3.  You might need to modify the .inf file to specify the provider, specified as an **%***ManufacturerName***%** token that is expanded later in the INF file's [**Strings**](https://msdn.microsoft.com/en-us/Library/Windows/Hardware/Ff547485) section. For example:\n\n    ``` syntax\n    Provider=\"Contoso\"\n    ```\n\n4.  You can now build the solution. Visual Studio links against the required libraries and generates a .cat file, an .inf file, and a driver binary.\n\nFor information about the configuration settings you can use in Visual Studio when building your driver, see [Building a Driver with the WDK](building_a_driver.md).\n\n<span id=\"Installing_a_Universal_Windows_driver\"></span><span id=\"installing_a_universal_windows_driver\"></span><span id=\"INSTALLING_A_UNIVERSAL_WINDOWS_DRIVER\"></span>Installing a Universal Windows driver\n-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------\n\n**Note**  The SetupAPI component is not part of UWP, so a Universal Windows driver cannot call functions in this API set.\n\n \n\nIf you want to install a Universal Windows driver on a device that is running Windows 10 for desktop editions, you can still use an INF file, with a few caveats. An INF for a Universal Windows driver cannot include any of the following:\n\n-   Coinstallers\n-   Class installers\n-   RegisterDLL, DelFile, or DelReg directives\n-   Non-HKR AddReg directives\n\nFor more information, see [Using a Universal INF File](https://msdn.microsoft.com/en-us/Library/Windows/Hardware/Dn941087).\n\nIf you want to install your Universal Windows driver on Windows 10 Mobile, you can use an .spkg file. An .spkg (\"*package file*\") is a standalone module that contains your driver package. If you are not deploying to Windows 10 Mobile, you do not need to generate a package file. You can still compile a Universal Windows driver (as defined by the driver source code) without a package file.\n\nWDK 10 includes PkgGen, a tool that generates package files. You run PkgGen in Visual Studio when you build your driver, using the following procedure.\n\n**Using PkgGen to generate a package file**\n\n1.  Right-click the driver project and choose **Add-&gt;New Item**. Next, under **Visual C++-&gt;Windows Driver**, choose **Package Manifest**. Click **Add**.\n2.  Visual Studio adds a file called Package.pkg.xml to your driver project. You can right-click the file and choose properties to verify that the item type is **PkgGen**. (On this same property page, you can set **Excluded from Build** to **Yes** if you decide later that you want to build this driver project and not generate a package file.) Click **OK**.\n3.  Right-click the driver project and choose **Properties**. Under Configuration Properties, open the PackageGen node and change Version to any value you like.\n4.  Save your work and restart Visual Studio as administrator.\n5.  Build your driver. Visual Studio links against the required libraries and generates a .cat file, an .inf file, a driver binary, and an .spkg file.\n\nTo view the contents of the package file, append a .cab suffix to the file name and then open the cab file in Windows Explorer.\n\nTo learn about running PkgGen outside of Visual Studio, see [Creating packages](https://msdn.microsoft.com/en-us/Library/Windows/Hardware/Dn756642).\n\nTo install a mobile driver package (.spkg file), you have two options.\n\n-   If you are updating an existing package on a target system or adding a new package to the target, use IUTool.exe to install an .spkg driver package.\n-   If you are combining packages into a mobile OS image, use ImgGen to add the .spkg driver package to a full flash update (FFU) image that can then be flashed to a mobile device.\n\n**Using IUTool to add a mobile driver package (.spkg) to a running device**\n\n1.  [IUTool.exe](http://go.microsoft.com/fwlink/p/?linkid=617385) is in the \\\\tools\\\\bin\\\\*&lt;architecture&gt;* subdirectory of WDK 10.\n\n    Attach your mobile device to the PC. Then, from an elevated command prompt, issue the following command:\n\n       ``` syntax\n       IUTool -p MyKmdfDriver.spkg\n       ```\n\n2.  For more information, see [IUTool.exe: Update packages on a phone](http://go.microsoft.com/fwlink/p/?linkid=617385) and [Adding a driver to a test image](https://msdn.microsoft.com/en-us/Library/Windows/Hardware/Mt131832).\n\n**Using ImgGen to add a driver package (.spkg) to a mobile OS image (.ffu)**\n\n1.  After you install Visual Studio, on the Start screen, click the Visual Studio 2015 folder. Right-click **Developer Command Prompt for VS2015**, and choose **Run as Administrator**.\n2.  For more information about ImgGen, see [Building a phone image using ImgGen.cmd](http://go.microsoft.com/fwlink/p/?linkid=617386).\n\n<span id=\"Flashing_a_mobile_OS_image__.ffu_\"></span><span id=\"flashing_a_mobile_os_image__.ffu_\"></span><span id=\"FLASHING_A_MOBILE_OS_IMAGE__.FFU_\"></span>Flashing a mobile OS image (.ffu)\n---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------\n\nTo flash the image to the device, either use the Microsoft-supplied FFUTool, or develop custom OEM flashing tools. For more information, see [Update packages in an .FFU image file](http://go.microsoft.com/fwlink/p/?linkid=617387).\n\n<span id=\"Debugging_a_Universal_Windows_driver\"></span><span id=\"debugging_a_universal_windows_driver\"></span><span id=\"DEBUGGING_A_UNIVERSAL_WINDOWS_DRIVER\"></span>Debugging a Universal Windows driver\n---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------\n\nStarting in Windows 10, you can build your KMDF or UMDF driver so that it gets additional driver debugging information through the [Inflight Trace Recorder](https://msdn.microsoft.com/en-us/Library/Windows/Hardware/Dn914610). Universal Windows drivers can take advantage of this feature.\n\nIn addition, if you used the Visual Studio KMDF template, your driver uses Windows software trace preprocessor (WPP) to write trace messages. Your driver is an ETW provider with a provider GUID.\n\nTo send a trace message from your driver, use this code:\n\n   ``` syntax\n   TraceEvents(TRACE_LEVEL_INFORMATION, TRACE_DRIVER, &quot;%!FUNC! Entry&quot;);\n   ```\n       \nYou can access the ETW logs either using Tracelog via the [TShell tool](http://go.microsoft.com/fwlink/p/?linkid=617388) on a phone, or by using [!wmitrace](https://msdn.microsoft.com/en-us/Library/Windows/Hardware/Ff561362) in a debugger session.\n\nTo use Tracelog on a phone:\n\n1.  Establish a kernel-mode debugging session between a host computer and the phone.\n2.  On the host computer, in TShell, enter this command:\n\n       ``` syntax\n       exec-device tracelog -addautologger MyLogger05 -guid c:\\SteveGuid.txt -level 4 -flag 0xF –kd\n       ```\n       \n3.  Reboot the phone, and watch for trace messages in the debugger.\n\nAll existing kernel mode debug transports continue to work on Windows 10 for desktop editions. However, for both user-mode and kernel-mode drivers, you must use a remote debugger session over KDNET to test Windows 10 Mobile. For more info, see [Setting Up Kernel-Mode Debugging over a Network Cable Manually](https://msdn.microsoft.com/en-us/Library/Windows/Hardware/Hh439346) in Visual Studio.\n\n<span id=\"related_topics\"></span>Related topics\n-----------------------------------------------\n\n* [Building a Driver with the WDK](building_a_driver.md)\n* [Windows 10 Editions for Universal Windows drivers](windows_10_editions_for_universal_drivers.md)\n* [Write a Universal Windows driver (UMDF 2) based on a template](https://msdn.microsoft.com/en-us/Library/Windows/Hardware/Hh439659)\n* [Write a universal Hello World driver (KMDF)](https://msdn.microsoft.com/en-us/Library/Windows/Hardware/Hh439665)\n* [Write a Universal Windows driver (KMDF) based on a template](https://msdn.microsoft.com/en-us/Library/Windows/Hardware/Hh439654)\n* [Provision a computer for driver deployment and testing (WDK 10)](https://msdn.microsoft.com/en-us/Library/Windows/Hardware/Dn745909)\n* [What's new in driver development](https://msdn.microsoft.com/en-us/Library/Windows/Hardware/Dn927349)\n \n\n \n\n[Send comments about this topic to Microsoft](mailto:wsddocfb@microsoft.com?subject=Documentation%20feedback%20[VsDriver\\vsdriver]:%20Getting%20Started%20with%20Universal%20Windows%20drivers%20%20RELEASE:%20%289/30/2015%29&body=%0A%0APRIVACY%20STATEMENT%0A%0AWe%20use%20your%20feedback%20to%20improve%20the%20documentation.%20We%20don't%20use%20your%20email%20address%20for%20any%20other%20purpose,%20and%20we'll%20remove%20your%20email%20address%20from%20our%20system%20after%20the%20issue%20that%20you're%20reporting%20is%20fixed.%20While%20we're%20working%20to%20fix%20this%20issue,%20we%20might%20send%20you%20an%20email%20message%20to%20ask%20for%20more%20info.%20Later,%20we%20might%20also%20send%20you%20an%20email%20message%20to%20let%20you%20know%20that%20we've%20addressed%20your%20feedback.%0A%0AFor%20more%20info%20about%20Microsoft's%20privacy%20policy,%20see%20http://privacy.microsoft.com/en-us/default. \"Send comments about this topic to Microsoft\")\n\n\n"}