{"nodes":[{"pos":[85,278],"content":"This article describes the steps for capturing photos and video using the MediaCapture API, including initializing and shutting down the MediaCapture and handling changes in device orientation.","needQuote":true,"needEscape":true,"nodes":[{"content":"This article describes the steps for capturing photos and video using the MediaCapture API, including initializing and shutting down the MediaCapture and handling changes in device orientation.","pos":[0,193]}]},{"pos":[286,328],"content":"Capture photos and video with MediaCapture","needQuote":true,"needEscape":true,"nodes":[{"content":"Capture photos and video with MediaCapture","pos":[0,42]}]},{"content":"Capture photos and video with MediaCapture","pos":[336,378]},{"content":"\\[ Updated for UWP apps on Windows 10.","pos":[380,418]},{"content":"For Windows 8.x articles, see the <bpt id=\"p1\">[</bpt>archive<ept id=\"p1\">](http://go.microsoft.com/fwlink/p/?linkid=619132)</ept> \\]","pos":[419,514],"source":" For Windows 8.x articles, see the [archive](http://go.microsoft.com/fwlink/p/?linkid=619132) \\]"},{"pos":[517,778],"content":"This article describes the steps for capturing photos and video using the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>MediaCapture<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br241124)</ept> API, including initializing and shutting down the <bpt id=\"p3\">**</bpt>MediaCapture<ept id=\"p3\">**</ept> and handling changes in device orientation.","source":"This article describes the steps for capturing photos and video using the [**MediaCapture**](https://msdn.microsoft.com/library/windows/apps/br241124) API, including initializing and shutting down the **MediaCapture** and handling changes in device orientation."},{"content":"<bpt id=\"p1\">**</bpt>MediaCapture<ept id=\"p1\">**</ept> is provided to support apps that require low-level control of the media capture process and that implement scenarios that require advanced capture capabilities.","pos":[780,957],"source":"**MediaCapture** is provided to support apps that require low-level control of the media capture process and that implement scenarios that require advanced capture capabilities."},{"content":"Using <bpt id=\"p1\">**</bpt>MediaCapture<ept id=\"p1\">**</ept> also requires you to provide your own capture UI.","pos":[958,1030],"source":" Using **MediaCapture** also requires you to provide your own capture UI."},{"content":"If your app only needs to capture a photo or video and is unconcerned with advanced capture techniques, the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>CameraCaptureUI<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br241030)</ept> makes it easy to capture a photo or video with only a few lines of code.","pos":[1031,1291],"source":" If your app only needs to capture a photo or video and is unconcerned with advanced capture techniques, the [**CameraCaptureUI**](https://msdn.microsoft.com/library/windows/apps/br241030) makes it easy to capture a photo or video with only a few lines of code."},{"content":"For more information, see <bpt id=\"p1\">[</bpt>Capture photos and video with CameraCaptureUI<ept id=\"p1\">](capture-photos-and-video-with-cameracaptureui.md)</ept>.","pos":[1292,1416],"source":" For more information, see [Capture photos and video with CameraCaptureUI](capture-photos-and-video-with-cameracaptureui.md)."},{"content":"The code in this article was adapted from the <bpt id=\"p1\">[</bpt>CameraStarterKit sample<ept id=\"p1\">](http://go.microsoft.com/fwlink/?LinkId=619479)</ept>.","pos":[1418,1537],"source":"The code in this article was adapted from the [CameraStarterKit sample](http://go.microsoft.com/fwlink/?LinkId=619479)."},{"content":"You can download the sample to see the code used in context or to use the sample as a starting point for your own app.","pos":[1538,1656]},{"content":"Configure your project","pos":[1661,1683]},{"content":"Add capability declarations to the app manifest","pos":[1689,1736]},{"content":"In order for your app to access a device's camera, you must declare that your app uses the <bpt id=\"p1\">*</bpt>webcam<ept id=\"p1\">*</ept> and <bpt id=\"p2\">*</bpt>microphone<ept id=\"p2\">*</ept> device capabilities.","pos":[1738,1875],"source":"In order for your app to access a device's camera, you must declare that your app uses the *webcam* and *microphone* device capabilities."},{"content":"If you want to save captured photos and videos to the users's Pictures or Videos library, you must also declare the <bpt id=\"p1\">*</bpt>picturesLibrary<ept id=\"p1\">*</ept> and <bpt id=\"p2\">*</bpt>videosLibrary<ept id=\"p2\">*</ept> capability.","pos":[1876,2041],"source":" If you want to save captured photos and videos to the users's Pictures or Videos library, you must also declare the *picturesLibrary* and *videosLibrary* capability."},{"content":"Add capabilities to the app manifest","pos":[2045,2081]},{"pos":[2089,2243],"content":"In Microsoft Visual Studio, in <bpt id=\"p1\">**</bpt>Solution Explorer<ept id=\"p1\">**</ept>, open the designer for the application manifest by double-clicking the <bpt id=\"p2\">**</bpt>package.appxmanifest<ept id=\"p2\">**</ept> item.","source":"In Microsoft Visual Studio, in **Solution Explorer**, open the designer for the application manifest by double-clicking the **package.appxmanifest** item."},{"pos":[2248,2280],"content":"Select the <bpt id=\"p1\">**</bpt>Capabilities<ept id=\"p1\">**</ept> tab.","source":"Select the **Capabilities** tab."},{"pos":[2285,2345],"content":"Check the box for <bpt id=\"p1\">**</bpt>Webcam<ept id=\"p1\">**</ept> and the box for <bpt id=\"p2\">**</bpt>Microphone<ept id=\"p2\">**</ept>.","source":"Check the box for **Webcam** and the box for **Microphone**."},{"pos":[2350,2472],"content":"For access to the Pictures and Videos library check the boxes for <bpt id=\"p1\">**</bpt>Pictures Library<ept id=\"p1\">**</ept> and the box for <bpt id=\"p2\">**</bpt>Videos Library<ept id=\"p2\">**</ept>.","source":"For access to the Pictures and Videos library check the boxes for **Pictures Library** and the box for **Videos Library**."},{"content":"Add using directives for media capture-related APIs","pos":[2478,2529]},{"content":"The following code listing shows the namespaces that are referenced by the sample code in this article and describes what functionality each namespace provides.","pos":[2531,2691]},{"pos":[2703,2708],"content":"Using"},{"content":"Initialize the MediaCapture object","pos":[2779,2813]},{"content":"The <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>MediaCapture<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br241124)</ept> class in the <bpt id=\"p3\">[</bpt><bpt id=\"p4\">**</bpt>Windows.Media.Capture<ept id=\"p4\">**</ept><ept id=\"p3\">](https://msdn.microsoft.com/library/windows/apps/br226738)</ept> namespace is the fundamental interface for all media capture operations.","pos":[2815,3067],"source":"The [**MediaCapture**](https://msdn.microsoft.com/library/windows/apps/br241124) class in the [**Windows.Media.Capture**](https://msdn.microsoft.com/library/windows/apps/br226738) namespace is the fundamental interface for all media capture operations."},{"content":"Apps typically declare a variable of this type scoped to a single page.","pos":[3068,3139]},{"content":"Your app needs to track the current state of the <bpt id=\"p1\">**</bpt>MediaCapture<ept id=\"p1\">**</ept>, so you should declare boolean variables for the initialization, previewing, and recording state of the object.","pos":[3140,3317],"source":" Your app needs to track the current state of the **MediaCapture**, so you should declare boolean variables for the initialization, previewing, and recording state of the object."},{"pos":[3329,3350],"content":"MediaCaptureVariables"},{"content":"To help orient the preview video correctly, create member variables to track whether the camera is external and whether the app is currently mirroring the preview stream.","pos":[3434,3604]},{"content":"Your app should mirror the preview stream when you think the video feed is capturing the user because that is a more natural user experience.","pos":[3605,3746]},{"pos":[3758,3774],"content":"PreviewVariables"},{"content":"The following example method initializes the media capture object.","pos":[3853,3919]},{"content":"First, the code searches for a video capture device that can be used for media capture.","pos":[3920,4007]},{"content":"Once found, the <bpt id=\"p1\">**</bpt>MediaCapture<ept id=\"p1\">**</ept> object is initialized and handlers for its events are registered.","pos":[4008,4106],"source":" Once found, the **MediaCapture** object is initialized and handlers for its events are registered."},{"content":"Next a <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>MediaCaptureInitializationSettings<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/desktop/hh802710)</ept> object is created using the ID of the video capture device.","pos":[4107,4275],"source":" Next a [**MediaCaptureInitializationSettings**](https://msdn.microsoft.com/library/windows/desktop/hh802710) object is created using the ID of the video capture device."},{"content":"The <bpt id=\"p1\">**</bpt>MediaCapture<ept id=\"p1\">**</ept> is then initialized with a call to <bpt id=\"p2\">[</bpt><bpt id=\"p3\">**</bpt>InitializeAsync<ept id=\"p3\">**</ept><ept id=\"p2\">](https://msdn.microsoft.com/library/windows/apps/br226598)</ept>.","pos":[4276,4412],"source":" The **MediaCapture** is then initialized with a call to [**InitializeAsync**](https://msdn.microsoft.com/library/windows/apps/br226598)."},{"pos":[4424,4445],"content":"InitializeCameraAsync"},{"content":"The <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>DeviceInformation.FindAllAsync<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br225432)</ept> method can be used to find all devices of a specified type.","pos":[4533,4691],"source":"The [**DeviceInformation.FindAllAsync**](https://msdn.microsoft.com/library/windows/apps/br225432) method can be used to find all devices of a specified type."},{"content":"In this example, the <bpt id=\"p1\">**</bpt>DeviceClass.VideoCapture<ept id=\"p1\">**</ept> enumeration value is passed in to indicate that only video capture devices should be returned.","pos":[4692,4836],"source":" In this example, the **DeviceClass.VideoCapture** enumeration value is passed in to indicate that only video capture devices should be returned."},{"content":"Note that a video capture device is used for capturing both photos and videos.","pos":[4837,4915]},{"content":"<bpt id=\"p1\">**</bpt>FindAllAsync<ept id=\"p1\">**</ept> returns a <bpt id=\"p2\">[</bpt><bpt id=\"p3\">**</bpt>DeviceInformationCollection<ept id=\"p3\">**</ept><ept id=\"p2\">](https://msdn.microsoft.com/library/windows/apps/br225395)</ept> object that contains a <bpt id=\"p4\">[</bpt><bpt id=\"p5\">**</bpt>DeviceInformation<ept id=\"p5\">**</ept><ept id=\"p4\">](https://msdn.microsoft.com/library/windows/apps/br225393)</ept> object for each found device of the requested type.","pos":[4921,5196],"source":"**FindAllAsync** returns a [**DeviceInformationCollection**](https://msdn.microsoft.com/library/windows/apps/br225395) object that contains a [**DeviceInformation**](https://msdn.microsoft.com/library/windows/apps/br225393) object for each found device of the requested type."},{"content":"The <bpt id=\"p1\">**</bpt>FirstOrDefault<ept id=\"p1\">**</ept> extension method from the <bpt id=\"p2\">**</bpt>System.Linq<ept id=\"p2\">**</ept> namespace provides an easy syntax for selecting an item from a list based on specified conditions.","pos":[5197,5360],"source":" The **FirstOrDefault** extension method from the **System.Linq** namespace provides an easy syntax for selecting an item from a list based on specified conditions."},{"content":"The first call attempts to select the first <bpt id=\"p1\">**</bpt>DeviceInformation<ept id=\"p1\">**</ept> in the list that has an <bpt id=\"p2\">[</bpt><bpt id=\"p3\">**</bpt>EnclosureLocation.Panel<ept id=\"p3\">**</ept><ept id=\"p2\">](https://msdn.microsoft.com/library/windows/apps/br229906)</ept> value of <bpt id=\"p4\">**</bpt>Panel.Back<ept id=\"p4\">**</ept>, indicating that the camera is on the back panel of the device's enclosure.","pos":[5361,5638],"source":" The first call attempts to select the first **DeviceInformation** in the list that has an [**EnclosureLocation.Panel**](https://msdn.microsoft.com/library/windows/apps/br229906) value of **Panel.Back**, indicating that the camera is on the back panel of the device's enclosure."},{"content":"If the device does not have a camera on the back panel, the first available camera is used.","pos":[5639,5730]},{"pos":[5736,5966],"content":"If you do not specify a device ID when you initialize the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>MediaCaptureInitializationSettings<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br226573)</ept>, the system will choose the first device in its internal list of devices.","source":"If you do not specify a device ID when you initialize the [**MediaCaptureInitializationSettings**](https://msdn.microsoft.com/library/windows/apps/br226573), the system will choose the first device in its internal list of devices."},{"content":"The call to <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>MediaCapture.InitializeAsync<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br226598)</ept> initializes the object to use the specified capture device.","pos":[5972,6136],"source":"The call to [**MediaCapture.InitializeAsync**](https://msdn.microsoft.com/library/windows/apps/br226598) initializes the object to use the specified capture device."},{"content":"This call is made inside a <bpt id=\"p1\">**</bpt>try<ept id=\"p1\">**</ept> block because it will throw an <bpt id=\"p2\">**</bpt>UnauthorizedAccessException<ept id=\"p2\">**</ept> if the user has denied the calling app access to the camera.","pos":[6137,6295],"source":" This call is made inside a **try** block because it will throw an **UnauthorizedAccessException** if the user has denied the calling app access to the camera."},{"content":"If the call succeeds, the <bpt id=\"p1\">**</bpt>\\_isInitialized<ept id=\"p1\">**</ept> variable is set to true so that subsequent method calls can determine if the capture device has been initialized.","pos":[6296,6455],"source":" If the call succeeds, the **\\_isInitialized** variable is set to true so that subsequent method calls can determine if the capture device has been initialized."},{"content":"<bpt id=\"p1\">**</bpt>Important<ept id=\"p1\">**</ept> On some device families, a user consent prompt is displayed to the user before your app is granted access to the device's camera.","pos":[6459,6602],"source":"**Important** On some device families, a user consent prompt is displayed to the user before your app is granted access to the device's camera."},{"content":"For this reason, you must only call <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>MediaCapture.InitializeAsync<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br226598)</ept> from the main UI thread.","pos":[6603,6756],"source":" For this reason, you must only call [**MediaCapture.InitializeAsync**](https://msdn.microsoft.com/library/windows/apps/br226598) from the main UI thread."},{"content":"Attempting to initialize the camera from another thread may result in initialization failure.","pos":[6757,6850]},{"content":"If the initialization of the capture device is successful, variables are set to reflect whether the capture device is external, or if it is on the front panel of the device.","pos":[6856,7029]},{"content":"These values will be used to orient the capture preview correctly for the user.","pos":[7030,7109]},{"content":"Finally, the UI is updated to reflect that capture is available and the preview stream from the capture device is started.","pos":[7110,7232]},{"content":"All of these tasks are performed in helper methods that will be described later in this article.","pos":[7233,7329]},{"content":"Start the capture preview","pos":[7334,7359]},{"content":"For the user to be able to see what they are capturing, you need to provide a preview of what the video capture device is currently seeing in your UI.","pos":[7361,7511]},{"pos":[7513,7654],"content":"<bpt id=\"p1\">**</bpt>Important<ept id=\"p1\">**</ept> You must start the capture preview in order for the capture device to enable auto focus, auto exposure, and auto white balance.","source":"**Important** You must start the capture preview in order for the capture device to enable auto focus, auto exposure, and auto white balance."},{"content":"The <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>CaptureElement<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br209278)</ept> control is provided to enable capture preview.","pos":[7656,7785],"source":"The [**CaptureElement**](https://msdn.microsoft.com/library/windows/apps/br209278) control is provided to enable capture preview."},{"content":"The following shows example XAML code that defines the capture element.","pos":[7786,7857]},{"pos":[7870,7884],"content":"CaptureElement"},{"content":"Users expect that the screen will stay on while they are previewing the video capture screen and not turn off due to inactivity.","pos":[7958,8086]},{"content":"To enable this, you must create a <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>DisplayRequest<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br241816)</ept> object.","pos":[8087,8207],"source":" To enable this, you must create a [**DisplayRequest**](https://msdn.microsoft.com/library/windows/apps/br241816) object."},{"content":"Declare this variable with page scope so that it persists throughout the capture session.","pos":[8208,8297]},{"pos":[8309,8323],"content":"DisplayRequest"},{"content":"The following method starts up the media capture preview.","pos":[8400,8457]},{"content":"First, it requests that the display remain active by calling <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>RequestActive<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br241818)</ept> on the <bpt id=\"p3\">[</bpt><bpt id=\"p4\">**</bpt>DisplayRequest<ept id=\"p4\">**</ept><ept id=\"p3\">](https://msdn.microsoft.com/library/windows/apps/br241816)</ept>.","pos":[8458,8683],"source":" First, it requests that the display remain active by calling [**RequestActive**](https://msdn.microsoft.com/library/windows/apps/br241818) on the [**DisplayRequest**](https://msdn.microsoft.com/library/windows/apps/br241816)."},{"content":"Next, the preview is started by calling <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>StartPreviewAsync<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br226613)</ept>.","pos":[8684,8806],"source":" Next, the preview is started by calling [**StartPreviewAsync**](https://msdn.microsoft.com/library/windows/apps/br226613)."},{"pos":[8818,8835],"content":"StartPreviewAsync"},{"pos":[8919,9098],"content":"The <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>RequestActive<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br241818)</ept> method is called on the <bpt id=\"p3\">**</bpt>DisplayRequest<ept id=\"p3\">**</ept> object to request that the system leave the screen on.","source":"The [**RequestActive**](https://msdn.microsoft.com/library/windows/apps/br241818) method is called on the **DisplayRequest** object to request that the system leave the screen on."},{"pos":[9104,9294],"content":"The <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>Source<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br227419)</ept> property of the <bpt id=\"p3\">**</bpt>CaptureElement<ept id=\"p3\">**</ept> is set to the app's <bpt id=\"p4\">**</bpt>MediaCapture<ept id=\"p4\">**</ept> object to define the source of the preview.","source":"The [**Source**](https://msdn.microsoft.com/library/windows/apps/br227419) property of the **CaptureElement** is set to the app's **MediaCapture** object to define the source of the preview."},{"content":"The <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>FlowDirection<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br208716)</ept> property is provided by the XAML framework to support bi-directional user interfaces.","pos":[9300,9467],"source":"The [**FlowDirection**](https://msdn.microsoft.com/library/windows/apps/br208716) property is provided by the XAML framework to support bi-directional user interfaces."},{"content":"Setting the flow direction of the <bpt id=\"p1\">**</bpt>CaptureElement<ept id=\"p1\">**</ept> to <bpt id=\"p2\">[</bpt><bpt id=\"p3\">**</bpt>FlowDirection.RightToLeft<ept id=\"p3\">**</ept><ept id=\"p2\">](https://msdn.microsoft.com/library/windows/apps/br242397)</ept> causes the preview video to be flipped horizontally.","pos":[9468,9666],"source":" Setting the flow direction of the **CaptureElement** to [**FlowDirection.RightToLeft**](https://msdn.microsoft.com/library/windows/apps/br242397) causes the preview video to be flipped horizontally."},{"content":"This is used when the capture device is on the front panel of the device so that the preview in the correct direction from the user's perspective.","pos":[9667,9813]},{"content":"The <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>StartPreviewAsync<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br226613)</ept> method starts the display of the preview stream within the <bpt id=\"p3\">**</bpt>CaptureElement<ept id=\"p3\">**</ept>.","pos":[9819,9983],"source":"The [**StartPreviewAsync**](https://msdn.microsoft.com/library/windows/apps/br226613) method starts the display of the preview stream within the **CaptureElement**."},{"content":"If the preview is started successfully, the <bpt id=\"p1\">**</bpt>\\_isPreviewing<ept id=\"p1\">**</ept> variable is set to allow other parts of the app to know that the app is currently previewing, and the helper method for setting the preview rotation is called.","pos":[9984,10206],"source":" If the preview is started successfully, the **\\_isPreviewing** variable is set to allow other parts of the app to know that the app is currently previewing, and the helper method for setting the preview rotation is called."},{"content":"This method is defined in the next section.","pos":[10207,10250]},{"content":"Detect screen and device orientation","pos":[10255,10291]},{"content":"There are several areas of a media capture app that, when running on a mobile device like a phone or a tablet, are impacted by the current orientation of the device.","pos":[10293,10458]},{"content":"These areas include properly rotating the preview stream from the camera and properly encoding captured images and videos so that, when viewed by the user, they are correctly oriented.","pos":[10459,10643]},{"content":"The term \"display orientation\" refers to the way the system rotates the XAML page on the device to keep it upright for the user.","pos":[10645,10773]},{"content":"\"Device orientation\" refers to the orientation of the device in world space and, therefore, the orientation of the physical camera device in world space.","pos":[10774,10927]},{"content":"Both kinds of orientation a relevant to a media capture app.","pos":[10928,10988]},{"content":"To handle display orientation, declare and initialize a page-scoped variable for the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>DisplayInformation<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn264258)</ept> class.","pos":[10989,11163],"source":" To handle display orientation, declare and initialize a page-scoped variable for the [**DisplayInformation**](https://msdn.microsoft.com/library/windows/apps/dn264258) class."},{"content":"Declare another variable of type <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>DisplayOrientations<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br226142)</ept> to track the current orientation of the display.","pos":[11164,11329],"source":" Declare another variable of type [**DisplayOrientations**](https://msdn.microsoft.com/library/windows/apps/br226142) to track the current orientation of the display."},{"content":"Declare a <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>SimpleOrientationSensor<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br206400)</ept> variable and a <bpt id=\"p3\">[</bpt><bpt id=\"p4\">**</bpt>SimpleOrientation<ept id=\"p4\">**</ept><ept id=\"p3\">](https://msdn.microsoft.com/library/windows/apps/br206399)</ept> variable to track device orientation.","pos":[11330,11562],"source":" Declare a [**SimpleOrientationSensor**](https://msdn.microsoft.com/library/windows/apps/br206400) variable and a [**SimpleOrientation**](https://msdn.microsoft.com/library/windows/apps/br206399) variable to track device orientation."},{"pos":[11574,11606],"content":"DisplayInformationAndOrientation"},{"content":"The following helper methods register and unregister event handlers for the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>DisplayInformation.OrientationChanged<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn264268)</ept> and <bpt id=\"p3\">[</bpt><bpt id=\"p4\">**</bpt>SimpleOrientationSensor.OrientationChanged<ept id=\"p4\">**</ept><ept id=\"p3\">](https://msdn.microsoft.com/library/windows/apps/br206407)</ept> events and initialize the tracking variables with the current orientation.","pos":[11701,12064],"source":"The following helper methods register and unregister event handlers for the [**DisplayInformation.OrientationChanged**](https://msdn.microsoft.com/library/windows/apps/dn264268) and [**SimpleOrientationSensor.OrientationChanged**](https://msdn.microsoft.com/library/windows/apps/br206407) events and initialize the tracking variables with the current orientation."},{"content":"Note that not all devices have a <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>SimpleOrientationSensor<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br206400)</ept>, so you should check before registering the handler or attempting to get the current orientation.","pos":[12065,12283],"source":" Note that not all devices have a [**SimpleOrientationSensor**](https://msdn.microsoft.com/library/windows/apps/br206400), so you should check before registering the handler or attempting to get the current orientation."},{"pos":[12295,12327],"content":"RegisterOrientationEventHandlers"},{"pos":[12432,12466],"content":"UnregisterOrientationEventHandlers"},{"content":"In the event handler for the <bpt id=\"p1\">**</bpt>SimpleOrientationSensor.OrientationChanged<ept id=\"p1\">**</ept> event, update the device orientation variable with the current orientation.","pos":[12563,12714],"source":"In the event handler for the **SimpleOrientationSensor.OrientationChanged** event, update the device orientation variable with the current orientation."},{"content":"You should not update the orientation if the device is facing up or down.","pos":[12715,12788]},{"pos":[12800,12824],"content":"SimpleOrientationChanged"},{"content":"In the event handler for the <bpt id=\"p1\">**</bpt>DisplayInformation.OrientationChanged<ept id=\"p1\">**</ept> event, update the display orientation variable with the current orientation.","pos":[12911,13058],"source":"In the event handler for the **DisplayInformation.OrientationChanged** event, update the display orientation variable with the current orientation."},{"content":"If the video preview of the capture device is currently being displayed, update the rotation of the preview video stream.","pos":[13059,13180]},{"content":"The <bpt id=\"p1\">**</bpt>SetPreviewRotationAsync<ept id=\"p1\">**</ept> helper method is described in the following section.","pos":[13181,13265],"source":" The **SetPreviewRotationAsync** helper method is described in the following section."},{"pos":[13277,13302],"content":"DisplayOrientationChanged"},{"content":"Set the media capture preview rotation","pos":[13393,13431]},{"content":"Users expect for UI controls to rotate when the orientation of their mobile device changes, so that the text in the UI is vertically aligned and readable.","pos":[13433,13587]},{"content":"For the <bpt id=\"p1\">**</bpt>CaptureElement<ept id=\"p1\">**</ept> control, however, users typically do not want the orientation of the video preview to rotate when the device does.","pos":[13588,13729],"source":" For the **CaptureElement** control, however, users typically do not want the orientation of the video preview to rotate when the device does."},{"content":"In order to provide the expected user experience, you should rotate the preview stream to match the orientation of the device.","pos":[13730,13856]},{"content":"The preview stream orientation must be expressed in degrees.","pos":[13858,13918]},{"content":"The following helper method to converts the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>DisplayOrientations<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br226142)</ept> enumeration values into degrees.","pos":[13919,14079],"source":" The following helper method to converts the [**DisplayOrientations**](https://msdn.microsoft.com/library/windows/apps/br226142) enumeration values into degrees."},{"pos":[14091,14125],"content":"ConvertDisplayOrientationToDegrees"},{"pos":[14222,14518],"content":"And this helper method converts a <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>SimpleOrientation<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br206399)</ept> enumeration value, which is used by the <bpt id=\"p3\">[</bpt><bpt id=\"p4\">**</bpt>SimpleOrientationSensor<ept id=\"p4\">**</ept><ept id=\"p3\">](https://msdn.microsoft.com/library/windows/apps/br206400)</ept> to express the rotation of the device, into degrees.","source":"And this helper method converts a [**SimpleOrientation**](https://msdn.microsoft.com/library/windows/apps/br206399) enumeration value, which is used by the [**SimpleOrientationSensor**](https://msdn.microsoft.com/library/windows/apps/br206400) to express the rotation of the device, into degrees."},{"pos":[14530,14563],"content":"ConvertDeviceOrientationToDegrees"},{"content":"At a low-level, the rotation of a stream is actually performed by the Microsoft Media Foundation framework.","pos":[14659,14766]},{"content":"The rotation is specified using the <bpt id=\"p1\">[</bpt>MF\\_MT\\_VIDEO\\_ROTATION<ept id=\"p1\">](https://msdn.microsoft.com/library/windows/desktop/hh162880)</ept> attribute.","pos":[14767,14900],"source":" The rotation is specified using the [MF\\_MT\\_VIDEO\\_ROTATION](https://msdn.microsoft.com/library/windows/desktop/hh162880) attribute."},{"content":"Since this is a Windows Runtime app, the rotation is specified using the GUID for the attribute, rather than the attribute name.","pos":[14901,15029]},{"content":"Define the following GUID to identify the video rotation attribute.","pos":[15030,15097]},{"pos":[15109,15120],"content":"RotationKey"},{"content":"The following method sets the rotation of the preview stream.","pos":[15194,15255]},{"content":"The <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>GetMediaStreamProperties<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br211995)</ept> method of the media capture's <bpt id=\"p3\">[</bpt><bpt id=\"p4\">**</bpt>VideoDeviceController<ept id=\"p4\">**</ept><ept id=\"p3\">](https://msdn.microsoft.com/library/windows/apps/br226825)</ept> returns a property set made up of key/value pairs.","pos":[15256,15515],"source":" The [**GetMediaStreamProperties**](https://msdn.microsoft.com/library/windows/apps/br211995) method of the media capture's [**VideoDeviceController**](https://msdn.microsoft.com/library/windows/apps/br226825) returns a property set made up of key/value pairs."},{"content":"<bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>MediaStreamType.VideoPreview<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br226640)</ept> is specified to indicate that we want the properties for the video preview stream, as opposed to the video recording stream or the audio stream.","pos":[15516,15753],"source":"[**MediaStreamType.VideoPreview**](https://msdn.microsoft.com/library/windows/apps/br226640) is specified to indicate that we want the properties for the video preview stream, as opposed to the video recording stream or the audio stream."},{"content":"The property set is a general purpose interface for setting stream properties, but for this task the video rotation GUID defined above is added as the property key and the desired orientation of the video stream, in degrees, is specified as the value.","pos":[15754,16005]},{"content":"<bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>SetEncodingPropertiesAsync<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn297781)</ept> updates the encoding properties with the new values.","pos":[16006,16149],"source":"[**SetEncodingPropertiesAsync**](https://msdn.microsoft.com/library/windows/apps/dn297781) updates the encoding properties with the new values."},{"content":"Once again, <bpt id=\"p1\">**</bpt>MediaStreamType.VideoPreview<ept id=\"p1\">**</ept> is specified to indicate that the properies being set are for the video preview stream.","pos":[16150,16282],"source":" Once again, **MediaStreamType.VideoPreview** is specified to indicate that the properies being set are for the video preview stream."},{"pos":[16294,16312],"content":"SetPreviewRotation"},{"content":"For devices with external cameras, the user does not expect for the camera stream to be rotated when the device rotates.","pos":[16397,16517]},{"content":"If the preview is being mirrored for a camera on the front panel, the rotation direction must be inverted to match the rotation of the device.","pos":[16523,16665]},{"content":"Some devices, typically phones, support setting <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>DisplayInformation.AutoRotationPreferences<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn264259)</ept> to an orientation value such as <bpt id=\"p3\">[</bpt><bpt id=\"p4\">**</bpt>DisplayOrientations.Landscape<ept id=\"p4\">**</ept><ept id=\"p3\">](https://msdn.microsoft.com/library/windows/apps/br226142)</ept> to force the display to rotate with the device.","pos":[16671,16999],"source":"Some devices, typically phones, support setting [**DisplayInformation.AutoRotationPreferences**](https://msdn.microsoft.com/library/windows/apps/dn264259) to an orientation value such as [**DisplayOrientations.Landscape**](https://msdn.microsoft.com/library/windows/apps/br226142) to force the display to rotate with the device."},{"content":"You should set this value because it provides a good experience on devices that support it, but you should still implement the above pattern in your app to support devices that don't support auto-rotation preferences.","pos":[17000,17217]},{"content":"In previous releases, the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>SetPreviewRotation<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br226611)</ept> method was the only way to rotate the preview stream.","pos":[17223,17385],"source":"In previous releases, the [**SetPreviewRotation**](https://msdn.microsoft.com/library/windows/apps/br226611) method was the only way to rotate the preview stream."},{"content":"This method is still present in the API surface to support existing apps, but this method inefficient and should not be used for new apps.","pos":[17386,17524]},{"content":"Capture a photo","pos":[17529,17544]},{"content":"The following method captures a photo using the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>CapturePhotoToStreamAsync<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/hh700840)</ept> method and passing in the requested encoding properties and an <bpt id=\"p3\">[</bpt><bpt id=\"p4\">**</bpt>InMemoryRandomAccessStream<ept id=\"p4\">**</ept><ept id=\"p3\">](https://msdn.microsoft.com/library/windows/apps/br241720)</ept> object that will contain the output of the capture operation.","pos":[17546,17899],"source":"The following method captures a photo using the [**CapturePhotoToStreamAsync**](https://msdn.microsoft.com/library/windows/apps/hh700840) method and passing in the requested encoding properties and an [**InMemoryRandomAccessStream**](https://msdn.microsoft.com/library/windows/apps/br241720) object that will contain the output of the capture operation."},{"content":"The <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>ImageEncodingProperties<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/hh700993)</ept> class provides helper methods, like <bpt id=\"p3\">[</bpt><bpt id=\"p4\">**</bpt>CreateJpeg<ept id=\"p4\">**</ept><ept id=\"p3\">](https://msdn.microsoft.com/library/windows/apps/hh700994)</ept>, to generate encoding properties for the file types supported by media capture.","pos":[17900,18182],"source":" The [**ImageEncodingProperties**](https://msdn.microsoft.com/library/windows/apps/hh700993) class provides helper methods, like [**CreateJpeg**](https://msdn.microsoft.com/library/windows/apps/hh700994), to generate encoding properties for the file types supported by media capture."},{"pos":[18194,18208],"content":"TakePhotoAsync"},{"content":"Before saving the photo to a file, you need to determine the correct orientation of the photo.","pos":[18285,18379]},{"content":"The <bpt id=\"p1\">**</bpt>MediaCapture<ept id=\"p1\">**</ept> object doesn't know about the device's orientation and so it encodes the captured photo data as if the capture device is in its default orientation.","pos":[18380,18549],"source":" The **MediaCapture** object doesn't know about the device's orientation and so it encodes the captured photo data as if the capture device is in its default orientation."},{"content":"This can result in a negative user experience when the user is viewing the captured photo, as the photo will be oriented incorrectly.","pos":[18550,18683]},{"content":"The following helper methods determine the correct photo orientation and then save the file with the correct orientation.","pos":[18684,18805]},{"content":"The <bpt id=\"p1\">**</bpt>GetCameraOrientation<ept id=\"p1\">**</ept> helper method starts with the current device orientation and then rotates that value depending on the native orientation of the device and the location of the camera on the device.","pos":[18807,19016],"source":"The **GetCameraOrientation** helper method starts with the current device orientation and then rotates that value depending on the native orientation of the device and the location of the camera on the device."},{"content":"If the camera is mounted on the front panel of the device, as indicated in this example by the <bpt id=\"p1\">**</bpt>\\_mirroringPreview<ept id=\"p1\">**</ept> variable, then the camera orientation should be inverted.","pos":[19017,19192],"source":" If the camera is mounted on the front panel of the device, as indicated in this example by the **\\_mirroringPreview** variable, then the camera orientation should be inverted."},{"pos":[19204,19224],"content":"GetCameraOrientation"},{"pos":[19307,19666],"content":"The following helper method simply converts values from the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>SimpleOrientation<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br206399)</ept> enumeration values used by the orientation sensor to the equivalent <bpt id=\"p3\">[</bpt><bpt id=\"p4\">**</bpt>PhotoOrientation<ept id=\"p4\">**</ept><ept id=\"p3\">](https://msdn.microsoft.com/library/windows/apps/hh965476)</ept> value used by the bitmap encoder that will be used to save the file.","source":"The following helper method simply converts values from the [**SimpleOrientation**](https://msdn.microsoft.com/library/windows/apps/br206399) enumeration values used by the orientation sensor to the equivalent [**PhotoOrientation**](https://msdn.microsoft.com/library/windows/apps/hh965476) value used by the bitmap encoder that will be used to save the file."},{"pos":[19678,19714],"content":"ConvertOrientationToPhotoOrientation"},{"content":"Finally, the captured photo can be encoded and saved.","pos":[19813,19866]},{"content":"Create a <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>BitmapDecoder<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br226176)</ept> object from the input stream containing the captured photo data.","pos":[19867,20018],"source":" Create a [**BitmapDecoder**](https://msdn.microsoft.com/library/windows/apps/br226176) object from the input stream containing the captured photo data."},{"content":"Create a new <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>StorageFile<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br227171)</ept> and open it for reading and writing.","pos":[20019,20144],"source":" Create a new [**StorageFile**](https://msdn.microsoft.com/library/windows/apps/br227171) and open it for reading and writing."},{"content":"Create a <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>BitmapEncoder<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br226206)</ept> object, passing in the output file and the decoder containing the image data.","pos":[20145,20309],"source":" Create a [**BitmapEncoder**](https://msdn.microsoft.com/library/windows/apps/br226206) object, passing in the output file and the decoder containing the image data."},{"content":"Create a new <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>BitmapPropertySet<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/hh974338)</ept> and add a new property.","pos":[20310,20428],"source":" Create a new [**BitmapPropertySet**](https://msdn.microsoft.com/library/windows/apps/hh974338) and add a new property."},{"content":"The key for the property, \"System.Photo.Orientation\" specifies that the property represents the orientation of the photo.","pos":[20429,20550]},{"content":"The value is the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>PhotoOrientation<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/hh965476)</ept> value that was previously calculated.","pos":[20551,20686],"source":" The value is the [**PhotoOrientation**](https://msdn.microsoft.com/library/windows/apps/hh965476) value that was previously calculated."},{"content":"Call <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>SetPropertiesAsync<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br226252)</ept> to update the properties on the encoder and then call <bpt id=\"p3\">[</bpt><bpt id=\"p4\">**</bpt>FlushAsync<ept id=\"p4\">**</ept><ept id=\"p3\">](https://msdn.microsoft.com/library/dn237883)</ept> to write the photo to the storage file.","pos":[20687,20930],"source":" Call [**SetPropertiesAsync**](https://msdn.microsoft.com/library/windows/apps/br226252) to update the properties on the encoder and then call [**FlushAsync**](https://msdn.microsoft.com/library/dn237883) to write the photo to the storage file."},{"pos":[20942,20967],"content":"ReencodeAndSavePhotoAsync"},{"content":"Setting the \"System.Photo.Orientation\" bitmap property encodes the orientation of the photo into the metadata of the file.","pos":[21059,21181]},{"content":"It does not cause the actual image data to be encoded differently.","pos":[21182,21248]},{"content":"For more information about embedding metadata into image files, see <bpt id=\"p1\">[</bpt>Image metadata<ept id=\"p1\">](image-metadata.md)</ept>.","pos":[21249,21353],"source":" For more information about embedding metadata into image files, see [Image metadata](image-metadata.md)."},{"pos":[21359,21473],"content":"For more information about working with images, including encoding and decoding images, see <bpt id=\"p1\">[</bpt>Imaging<ept id=\"p1\">](imaging.md)</ept>.","source":"For more information about working with images, including encoding and decoding images, see [Imaging](imaging.md)."},{"content":"Capture a video","pos":[21478,21493]},{"content":"To start capturing video, first create a storage file to which the video will be recorded.","pos":[21495,21585]},{"content":"Next create the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>MediaEncodingProfile<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/hh701026)</ept> that the <bpt id=\"p3\">**</bpt>MediaCapture<ept id=\"p3\">**</ept> will use to encode the video to the file.","pos":[21586,21754],"source":" Next create the [**MediaEncodingProfile**](https://msdn.microsoft.com/library/windows/apps/hh701026) that the **MediaCapture** will use to encode the video to the file."},{"content":"The <bpt id=\"p1\">**</bpt>MediaEncodingProfile<ept id=\"p1\">**</ept> class provides methods, like <bpt id=\"p2\">[</bpt><bpt id=\"p3\">**</bpt>CreateMp4<ept id=\"p3\">**</ept><ept id=\"p2\">](https://msdn.microsoft.com/library/windows/apps/hh701078)</ept>, that create encoding profiles for the supported video formats.","pos":[21755,21950],"source":" The **MediaEncodingProfile** class provides methods, like [**CreateMp4**](https://msdn.microsoft.com/library/windows/apps/hh701078), that create encoding profiles for the supported video formats."},{"content":"Use the helper methods discussed previously to get the correct rotation for the video, in degrees.","pos":[21951,22049]},{"content":"Unlike the photo scenario, the video rotation information is encoded into the stream by the <bpt id=\"p1\">**</bpt>MediaCapture<ept id=\"p1\">**</ept>.","pos":[22050,22159],"source":" Unlike the photo scenario, the video rotation information is encoded into the stream by the **MediaCapture**."},{"content":"Add the rotation information to the encoding profile by adding it to the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>VideoEncodingProperties.Properties<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/hh701254)</ept> collection.","pos":[22160,22343],"source":" Add the rotation information to the encoding profile by adding it to the [**VideoEncodingProperties.Properties**](https://msdn.microsoft.com/library/windows/apps/hh701254) collection."},{"content":"The previously defined GUID for video rotation is used as the key and the rotation, in degrees, is the value.","pos":[22344,22453]},{"content":"Finally, call <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>MediaCapture.StartRecordToStorageFileAsync<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/hh700863)</ept>, specifying the encoding properties and the output file to begin recording.","pos":[22454,22650],"source":" Finally, call [**MediaCapture.StartRecordToStorageFileAsync**](https://msdn.microsoft.com/library/windows/apps/hh700863), specifying the encoding properties and the output file to begin recording."},{"pos":[22662,22681],"content":"StartRecordingAsync"},{"pos":[22763,22887],"content":"To stop recording, simply call <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>MediaCapture.StopRecordAsync<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br226623)</ept>.","source":"To stop recording, simply call [**MediaCapture.StopRecordAsync**](https://msdn.microsoft.com/library/windows/apps/br226623)."},{"pos":[22899,22917],"content":"StopRecordingAsync"},{"content":"A handler for the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>MediaCapture.RecordLimitationExceeded<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/hh973312)</ept> event was registered when the <bpt id=\"p3\">**</bpt>MediaCapture<ept id=\"p3\">**</ept> was initialized.","pos":[22998,23181],"source":"A handler for the [**MediaCapture.RecordLimitationExceeded**](https://msdn.microsoft.com/library/windows/apps/hh973312) event was registered when the **MediaCapture** was initialized."},{"content":"In the handler, call the <bpt id=\"p1\">**</bpt>StopRecordingAsync<ept id=\"p1\">**</ept> method to stop video recording.","pos":[23182,23261],"source":" In the handler, call the **StopRecordingAsync** method to stop video recording."},{"pos":[23273,23297],"content":"RecordLimitationExceeded"},{"content":"Pause and resume video capture","pos":[23387,23417]},{"content":"For some scenarios you may want to pause and resume an ongoing video capture rather than stopping the capture and starting a new one.","pos":[23419,23552]},{"content":"To pause recording call <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>PauseRecordAsync<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn858102)</ept>.","pos":[23553,23658],"source":" To pause recording call [**PauseRecordAsync**](https://msdn.microsoft.com/library/windows/apps/dn858102)."},{"content":"If you specify <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>MediaCapturePauseBehavior.RetainHardwareResources<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn926686)</ept>, then on devices that don't support simultaneous video and photo capture, the app will be unable to capture photos while the video is paused.","pos":[23659,23929],"source":" If you specify [**MediaCapturePauseBehavior.RetainHardwareResources**](https://msdn.microsoft.com/library/windows/apps/dn926686), then on devices that don't support simultaneous video and photo capture, the app will be unable to capture photos while the video is paused."},{"content":"For information on determining if a device supports simultaneous photo and video capture, see <bpt id=\"p1\">[</bpt>Camera profiles<ept id=\"p1\">](camera-profiles.md)</ept>.","pos":[23930,24062],"source":" For information on determining if a device supports simultaneous photo and video capture, see [Camera profiles](camera-profiles.md)."},{"pos":[24074,24093],"content":"PauseRecordingAsync"},{"pos":[24175,24307],"content":"To resume a previously paused video capture, call <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>ResumeRecordAsync<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn858103)</ept>.","source":"To resume a previously paused video capture, call [**ResumeRecordAsync**](https://msdn.microsoft.com/library/windows/apps/dn858103)."},{"pos":[24319,24339],"content":"ResumeRecordingAsync"},{"content":"Clean up capture resources","pos":[24425,24451]},{"content":"It is very important that you shut down and release the media capture resources properly.","pos":[24453,24542]},{"content":"Failure to do so can cause unexpected camera behavior after your app closes, which results in a negative user experience for your app.","pos":[24543,24677]},{"content":"The following sections walk through the different steps you should take to shut down the camera.","pos":[24678,24774]},{"content":"Shut down the capture preview","pos":[24780,24809]},{"content":"To shut down the capture preview, first call <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>MediaCapture.StopPreviewAsync<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br226622)</ept>.","pos":[24811,24950],"source":"To shut down the capture preview, first call [**MediaCapture.StopPreviewAsync**](https://msdn.microsoft.com/library/windows/apps/br226622)."},{"content":"Set the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>Source<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br227419)</ept> property of your <bpt id=\"p3\">[</bpt><bpt id=\"p4\">**</bpt>MediaElement<ept id=\"p4\">**</ept><ept id=\"p3\">](https://msdn.microsoft.com/library/windows/apps/br242926)</ept> to null.","pos":[24951,25132],"source":" Set the [**Source**](https://msdn.microsoft.com/library/windows/apps/br227419) property of your [**MediaElement**](https://msdn.microsoft.com/library/windows/apps/br242926) to null."},{"content":"Then, call the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>RequestRelease<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br241819)</ept> on your <bpt id=\"p3\">[</bpt><bpt id=\"p4\">**</bpt>DisplayRequest<ept id=\"p4\">**</ept><ept id=\"p3\">](https://msdn.microsoft.com/library/windows/apps/br241816)</ept> variable to allow the system to turn off the display when needed.","pos":[25133,25379],"source":" Then, call the [**RequestRelease**](https://msdn.microsoft.com/library/windows/apps/br241819) on your [**DisplayRequest**](https://msdn.microsoft.com/library/windows/apps/br241816) variable to allow the system to turn off the display when needed."},{"pos":[25391,25407],"content":"StopPreviewAsync"},{"pos":[25490,25780],"content":"You can't access the UI from a non-UI thread, so the setting the <bpt id=\"p1\">**</bpt>MediaElement.Source<ept id=\"p1\">**</ept> property and calling <bpt id=\"p2\">**</bpt>RequestRelease<ept id=\"p2\">**</ept> must be made using the <bpt id=\"p3\">[</bpt><bpt id=\"p4\">**</bpt>CoreDispatcher.RunAsync<ept id=\"p4\">**</ept><ept id=\"p3\">](https://msdn.microsoft.com/library/windows/apps/hh750317)</ept> method so that the calls execute on the UI thread.","source":"You can't access the UI from a non-UI thread, so the setting the **MediaElement.Source** property and calling **RequestRelease** must be made using the [**CoreDispatcher.RunAsync**](https://msdn.microsoft.com/library/windows/apps/hh750317) method so that the calls execute on the UI thread."},{"content":"Shut down and dispose of the MediaCapture object","pos":[25786,25834]},{"content":"Before disposing of the <bpt id=\"p1\">**</bpt>MediaCapture<ept id=\"p1\">**</ept> object, stop any recording that is ongoing and stop the preview stream by calling the helper methods defined previously.","pos":[25836,25997],"source":"Before disposing of the **MediaCapture** object, stop any recording that is ongoing and stop the preview stream by calling the helper methods defined previously."},{"content":"Once this has been done, remove any event handlers registered with the <bpt id=\"p1\">**</bpt>MediaCapture<ept id=\"p1\">**</ept>, then call <bpt id=\"p2\">[</bpt><bpt id=\"p3\">**</bpt>Dispose<ept id=\"p3\">**</ept><ept id=\"p2\">](https://msdn.microsoft.com/library/windows/apps/dn278858)</ept> to free any resources associated with the object and set the <bpt id=\"p4\">**</bpt>MediaCapture<ept id=\"p4\">**</ept> variable to null","pos":[25998,26263],"source":" Once this has been done, remove any event handlers registered with the **MediaCapture**, then call [**Dispose**](https://msdn.microsoft.com/library/windows/apps/dn278858) to free any resources associated with the object and set the **MediaCapture** variable to null"},{"pos":[26275,26293],"content":"CleanupCameraAsync"},{"pos":[26374,26580],"content":"You should call this method to shut down and dispose of the <bpt id=\"p1\">**</bpt>MediaCapture<ept id=\"p1\">**</ept> object from inside the handler for the <bpt id=\"p2\">[</bpt><bpt id=\"p3\">**</bpt>MediaCapture.Failed<ept id=\"p3\">**</ept><ept id=\"p2\">](https://msdn.microsoft.com/library/windows/apps/br226593)</ept> event.","source":"You should call this method to shut down and dispose of the **MediaCapture** object from inside the handler for the [**MediaCapture.Failed**](https://msdn.microsoft.com/library/windows/apps/br226593) event."},{"pos":[26592,26605],"content":"CaptureFailed"},{"content":"Handle app lifetime and page navigation events","pos":[26685,26731]},{"content":"The app lifetime events give your app an opportunity to initialize and release resources.","pos":[26733,26822]},{"content":"This is especially important with the <bpt id=\"p1\">**</bpt>Application.Suspending<ept id=\"p1\">**</ept> event, where it is essential that your app properly disposes of media capture resources.","pos":[26823,26976],"source":" This is especially important with the **Application.Suspending** event, where it is essential that your app properly disposes of media capture resources."},{"content":"You can register handlers for the application lifetime events in your page's constructor.","pos":[26978,27067]},{"pos":[27079,27104],"content":"RegisterAppLifetimeEvents"},{"content":"In the handler for the <bpt id=\"p1\">**</bpt>Application.Suspending<ept id=\"p1\">**</ept> event, you should unregister the handlers for the display and device orientation events and shut down the <bpt id=\"p2\">**</bpt>MediaCapture<ept id=\"p2\">**</ept> object.","pos":[27192,27372],"source":"In the handler for the **Application.Suspending** event, you should unregister the handlers for the display and device orientation events and shut down the **MediaCapture** object."},{"content":"The <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>SystemMediaTransportControls.PropertyChanged<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn278720)</ept> event unregistered here is needed for another application lifecycle-related task that is described later in this article.","pos":[27373,27607],"source":" The [**SystemMediaTransportControls.PropertyChanged**](https://msdn.microsoft.com/library/windows/apps/dn278720) event unregistered here is needed for another application lifecycle-related task that is described later in this article."},{"content":"<bpt id=\"p1\">**</bpt>Caution<ept id=\"p1\">**</ept> You must request a suspending deferral by calling <bpt id=\"p2\">[</bpt><bpt id=\"p3\">**</bpt>SuspendingOperation.GetDeferral<ept id=\"p3\">**</ept><ept id=\"p2\">](https://msdn.microsoft.com/library/windows/apps/br224690)</ept> at the beginning of your suspending event handler.","pos":[27609,27818],"source":"**Caution** \nYou must request a suspending deferral by calling [**SuspendingOperation.GetDeferral**](https://msdn.microsoft.com/library/windows/apps/br224690) at the beginning of your suspending event handler."},{"content":"This requests that the system wait for you to signal that the operation is complete before tearing down your app.","pos":[27819,27932]},{"content":"This is necessary because the <bpt id=\"p1\">**</bpt>MediaCapture<ept id=\"p1\">**</ept> shutdown operations are asynchronous, so the <bpt id=\"p2\">**</bpt>Application.Suspending<ept id=\"p2\">**</ept> event handler may complete before the camera is properly shut down.","pos":[27933,28119],"source":" This is necessary because the **MediaCapture** shutdown operations are asynchronous, so the **Application.Suspending** event handler may complete before the camera is properly shut down."},{"content":"After your awaited asynchronous calls complete, you should release the deferral by calling <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>SuspendingDeferral.Complete<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br224685)</ept>.","pos":[28120,28303],"source":" After your awaited asynchronous calls complete, you should release the deferral by calling [**SuspendingDeferral.Complete**](https://msdn.microsoft.com/library/windows/apps/br224685)."},{"pos":[28315,28325],"content":"Suspending"},{"pos":[28398,28641],"content":"In the handler for the <bpt id=\"p1\">**</bpt>Application.Resuming<ept id=\"p1\">**</ept> event, you should register handlers for the display and device orientation events, register the <bpt id=\"p2\">**</bpt>SystemMediaTransportControls.PropertyChanged<ept id=\"p2\">**</ept> event, and initialize the <bpt id=\"p3\">**</bpt>MediaCapture<ept id=\"p3\">**</ept> object.","source":"In the handler for the **Application.Resuming** event, you should register handlers for the display and device orientation events, register the **SystemMediaTransportControls.PropertyChanged** event, and initialize the **MediaCapture** object."},{"pos":[28653,28661],"content":"Resuming"},{"pos":[28732,28961],"content":"The <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>OnNavigatedTo<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br227508)</ept> event gives an opportunity to initially register handlers for the display and device orientation events and initialize the <bpt id=\"p3\">**</bpt>MediaCapture<ept id=\"p3\">**</ept> object.","source":"The [**OnNavigatedTo**](https://msdn.microsoft.com/library/windows/apps/br227508) event gives an opportunity to initially register handlers for the display and device orientation events and initialize the **MediaCapture** object."},{"pos":[28973,28986],"content":"OnNavigatedTo"},{"pos":[29062,29243],"content":"If your app has multiple pages, you should clean up your media capture objects in the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>OnNavigatingFrom<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br227509)</ept> event handler.","source":"If your app has multiple pages, you should clean up your media capture objects in the [**OnNavigatingFrom**](https://msdn.microsoft.com/library/windows/apps/br227509) event handler."},{"pos":[29255,29271],"content":"OnNavigatingFrom"},{"content":"For your app to behave properly on devices that support multiple simultaneous windows, you must respond when your app is minimized or restored.","pos":[29350,29493]},{"content":"To do this, you must handle the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>SystemMediaTransportControls.PropertyChanged<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn278720)</ept> event.","pos":[29494,29641],"source":" To do this, you must handle the [**SystemMediaTransportControls.PropertyChanged**](https://msdn.microsoft.com/library/windows/apps/dn278720) event."},{"content":"Initialize a member variable to store a reference to the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>SystemMediaTransportControls<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn278677)</ept> object for your app.","pos":[29642,29812],"source":" Initialize a member variable to store a reference to the [**SystemMediaTransportControls**](https://msdn.microsoft.com/library/windows/apps/dn278677) object for your app."},{"pos":[29824,29859],"content":"DeclareSystemMediaTransportControls"},{"content":"The code to register and unregister the <bpt id=\"p1\">**</bpt>PropertyChanged<ept id=\"p1\">**</ept> event should be added to the app life cycle events as shown in the examples above.","pos":[29957,30099],"source":"The code to register and unregister the **PropertyChanged** event should be added to the app life cycle events as shown in the examples above."},{"content":"In the handler for the event, check to see if the property change that triggered the event was the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>SystemMediaTransportControlsProperty.SoundLevel<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn278721)</ept> property.","pos":[30100,30320],"source":" In the handler for the event, check to see if the property change that triggered the event was the [**SystemMediaTransportControlsProperty.SoundLevel**](https://msdn.microsoft.com/library/windows/apps/dn278721) property."},{"content":"If this was the property that changed, check the value of the property.","pos":[30321,30392]},{"content":"If the value is <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>SoundLevel.Muted<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/hh700852)</ept>, then your app was minimized and you should clean up your media capture resources appropriately.","pos":[30393,30586],"source":" If the value is [**SoundLevel.Muted**](https://msdn.microsoft.com/library/windows/apps/hh700852), then your app was minimized and you should clean up your media capture resources appropriately."},{"content":"Otherwise, the event signals that your app window was restored and you should reinitialize you media capture resources.","pos":[30587,30706]},{"content":"The <bpt id=\"p1\">**</bpt>SoundLevel<ept id=\"p1\">**</ept> property must be accessed on the UI thread, so the code in this method is wrapped in a call to <bpt id=\"p2\">[</bpt><bpt id=\"p3\">**</bpt>Dispatcher.RunAsync<ept id=\"p3\">**</ept><ept id=\"p2\">](https://msdn.microsoft.com/library/windows/apps/hh750317)</ept>.","pos":[30707,30905],"source":" The **SoundLevel** property must be accessed on the UI thread, so the code in this method is wrapped in a call to [**Dispatcher.RunAsync**](https://msdn.microsoft.com/library/windows/apps/hh750317)."},{"pos":[30917,30951],"content":"SystemMediaControlsPropertyChanged"},{"content":"Additional UI considerations for media capture","pos":[31051,31097]},{"content":"Set auto-rotation preferences","pos":[31103,31132]},{"content":"As mentioned in the previous section on rotating the preview stream, some devices support setting <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>DisplayInformation.AutoRotationPreferences<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn264259)</ept> to prevent the page, including the <bpt id=\"p3\">[</bpt><bpt id=\"p4\">**</bpt>CaptureElement<ept id=\"p4\">**</ept><ept id=\"p3\">](https://msdn.microsoft.com/library/windows/apps/br209278)</ept> that displays the preview, from rotating as the device is rotating.","pos":[31134,31520],"source":"As mentioned in the previous section on rotating the preview stream, some devices support setting [**DisplayInformation.AutoRotationPreferences**](https://msdn.microsoft.com/library/windows/apps/dn264259) to prevent the page, including the [**CaptureElement**](https://msdn.microsoft.com/library/windows/apps/br209278) that displays the preview, from rotating as the device is rotating."},{"content":"This provides a good user experience on devices that support it.","pos":[31521,31585]},{"content":"Set this value when your app launches or when you begin displaying the preview.","pos":[31586,31665]},{"content":"Note that you should still implement preview rotation handling for devices that don't support auto-rotation preferences.","pos":[31666,31786]},{"pos":[31798,31824],"content":"SetAutoRotationPreferences"},{"content":"Handle UI element orientation","pos":[31917,31946]},{"content":"Users typically expect for the UI elements in a camera app, such as the buttons for initiating photo or video capture, to rotate along with the video preview.","pos":[31948,32106]},{"content":"The following method illustrates the use of the previously defined orientation helper methods to properly orient the buttons in the camera UI.","pos":[32107,32249]},{"content":"You should call this method from the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>DisplayInformation.OrientationChanged<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn264268)</ept> and <bpt id=\"p3\">[</bpt><bpt id=\"p4\">**</bpt>SimpleOrientationSensor.OrientationChanged<ept id=\"p4\">**</ept><ept id=\"p3\">](https://msdn.microsoft.com/library/windows/apps/br206407)</ept> event handlers and when your app first launches.","pos":[32250,32548],"source":" You should call this method from the [**DisplayInformation.OrientationChanged**](https://msdn.microsoft.com/library/windows/apps/dn264268) and [**SimpleOrientationSensor.OrientationChanged**](https://msdn.microsoft.com/library/windows/apps/br206407) event handlers and when your app first launches."},{"content":"Your implementation my vary depending on your app's UI.","pos":[32549,32604]},{"pos":[32616,32639],"content":"UpdateButtonOrientation"},{"pos":[32725,32961],"content":"When your app is shutting down or if you navigate to a page that is unrelated to media capture, set the auto-rotation preference to <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>None<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br226142)</ept> to allow the UI to rotate normally.","source":"When your app is shutting down or if you navigate to a page that is unrelated to media capture, set the auto-rotation preference to [**None**](https://msdn.microsoft.com/library/windows/apps/br226142) to allow the UI to rotate normally."},{"pos":[32973,33002],"content":"RevertAutoRotationPreferences"},{"content":"Support simultaneous photo and video capture","pos":[33098,33142]},{"content":"The <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>Windows.Media.Capture<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br226738)</ept> API allows you to capture photos and videos simultaneously on devices that support it.","pos":[33144,33320],"source":"The [**Windows.Media.Capture**](https://msdn.microsoft.com/library/windows/apps/br226738) API allows you to capture photos and videos simultaneously on devices that support it."},{"content":"For brevity, this example uses the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>ConcurrentRecordAndPhotoSupported<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn278843)</ept> property to determine if simultaneous video and photo capture is supported, but a more robust and recommended way to do this is to use camera profiles.","pos":[33321,33605],"source":" For brevity, this example uses the [**ConcurrentRecordAndPhotoSupported**](https://msdn.microsoft.com/library/windows/apps/dn278843) property to determine if simultaneous video and photo capture is supported, but a more robust and recommended way to do this is to use camera profiles."},{"content":"For more information, see <bpt id=\"p1\">[</bpt>Camera profiles<ept id=\"p1\">](camera-profiles.md)</ept>.","pos":[33606,33670],"source":" For more information, see [Camera profiles](camera-profiles.md)."},{"content":"The following helper method updates the app's controls to match the current capture state of the app.","pos":[33672,33773]},{"content":"Call this method whenever the capture state of your app changes, such as when video capture is started or stopped.","pos":[33774,33888]},{"pos":[33900,33921],"content":"UpdateCaptureControls"},{"content":"Support mobile-specific UI features","pos":[34009,34044]},{"content":"All of the code shown in this article will work in a Universal Windows app.","pos":[34046,34121]},{"content":"With a few additional lines of code, you can take advantage of special UI features that are only present on mobile devices.","pos":[34122,34245]},{"content":"To use these features, you must add a reference to the Microsoft Mobile Extension SDK for Universal App Platform to your project.","pos":[34246,34375]},{"content":"To add a reference to the mobile extension SDK for hardware camera button support","pos":[34379,34460]},{"pos":[34468,34552],"content":"In <bpt id=\"p1\">**</bpt>Solution Explorer<ept id=\"p1\">**</ept>, right-click <bpt id=\"p2\">**</bpt>References<ept id=\"p2\">**</ept> and select <bpt id=\"p3\">**</bpt>Add Reference...<ept id=\"p3\">**</ept>","source":"In **Solution Explorer**, right-click **References** and select **Add Reference...**"},{"pos":[34558,34622],"content":"Expand the <bpt id=\"p1\">**</bpt>Windows Universal<ept id=\"p1\">**</ept> node and select <bpt id=\"p2\">**</bpt>Extensions<ept id=\"p2\">**</ept>.","source":"Expand the **Windows Universal** node and select **Extensions**."},{"pos":[34628,34717],"content":"Click the checkbox next to <bpt id=\"p1\">**</bpt>Microsoft Mobile Extension SDK for Universal App Platform<ept id=\"p1\">**</ept>.","source":"Click the checkbox next to **Microsoft Mobile Extension SDK for Universal App Platform**."},{"content":"Mobile devices have a <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>StatusBar<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn633864)</ept> control that provides the user with status information about the device.","pos":[34719,34887],"source":"Mobile devices have a [**StatusBar**](https://msdn.microsoft.com/library/windows/apps/dn633864) control that provides the user with status information about the device."},{"content":"This control takes up space on the screen that can interfere with the media capture UI.","pos":[34888,34975]},{"content":"You can hide the status bar by calling <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>HideAsync<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn610339)</ept>, but you must make this call from within a conditional block where you use the <bpt id=\"p3\">[</bpt><bpt id=\"p4\">**</bpt>ApiInformation.IsTypePresent<ept id=\"p4\">**</ept><ept id=\"p3\">](https://msdn.microsoft.com/library/windows/apps/dn949016)</ept> method to determine if the API is available.","pos":[34976,35305],"source":" You can hide the status bar by calling [**HideAsync**](https://msdn.microsoft.com/library/windows/apps/dn610339), but you must make this call from within a conditional block where you use the [**ApiInformation.IsTypePresent**](https://msdn.microsoft.com/library/windows/apps/dn949016) method to determine if the API is available."},{"content":"This method will only return true on mobile devices that support the status bar.","pos":[35306,35386]},{"content":"You should hide the status bar when your app launches or when you begin previewing from the camera.","pos":[35387,35486]},{"pos":[35498,35511],"content":"HideStatusBar"},{"content":"When your app is shutting down or when the user navigates away from the media capture page of your app, you make the control visible again.","pos":[35587,35726]},{"pos":[35738,35751],"content":"ShowStatusBar"},{"content":"Some mobile devices have a dedicated hardware camera button that some users prefer over an on-screen control.","pos":[35827,35936]},{"content":"To be notified when the hardware camera button is pressed, register a handler for the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>HardwareButtons.CameraPressed<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn653805)</ept> event.","pos":[35937,36123],"source":" To be notified when the hardware camera button is pressed, register a handler for the [**HardwareButtons.CameraPressed**](https://msdn.microsoft.com/library/windows/apps/dn653805) event."},{"content":"Because this API is available on mobile devices only, you must again use the <bpt id=\"p1\">**</bpt>IsTypePresent<ept id=\"p1\">**</ept> to make sure the API is supported on the current device before attempting to access it.","pos":[36124,36306],"source":" Because this API is available on mobile devices only, you must again use the **IsTypePresent** to make sure the API is supported on the current device before attempting to access it."},{"pos":[36318,36328],"content":"PhoneUsing"},{"pos":[36411,36438],"content":"RegisterCameraButtonHandler"},{"pos":[36528,36609],"content":"In the handler for the <bpt id=\"p1\">**</bpt>CameraPressed<ept id=\"p1\">**</ept> event, you can initiate a photo capture.","source":"In the handler for the **CameraPressed** event, you can initiate a photo capture."},{"pos":[36621,36634],"content":"CameraPressed"},{"content":"When your app is shutting down or the user moves away from the media capture page of your app, unregister the hardware button handler.","pos":[36710,36844]},{"pos":[36856,36885],"content":"UnregisterCameraButtonHandler"},{"content":"<bpt id=\"p1\">**</bpt>Note<ept id=\"p1\">**</ept> This article is for Windows 10 developers writing Universal Windows Platform (UWP) apps.","pos":[36977,37074],"source":"**Note** This article is for Windows 10 developers writing Universal Windows Platform (UWP) apps."},{"content":"If you're developing for Windows 8.x or Windows Phone 8.x, see the <bpt id=\"p1\">[</bpt>archived documentation<ept id=\"p1\">](http://go.microsoft.com/fwlink/p/?linkid=619132)</ept>.","pos":[37075,37216],"source":" If you're developing for Windows 8.x or Windows Phone 8.x, see the [archived documentation](http://go.microsoft.com/fwlink/p/?linkid=619132)."},{"content":"Related topics","pos":[37221,37235]},{"content":"Camera profiles","pos":[37240,37255]},{"content":"High Dynamic Range (HDR) photo capture","pos":[37280,37318]},{"content":"Capture device controls for photo and video capture","pos":[37364,37415]},{"content":"Capture device controls for video capture","pos":[37476,37517]},{"content":"Effects for video capture","pos":[37568,37593]},{"content":"Scene analysis for media capture","pos":[37628,37660]},{"content":"Variable photo sequence","pos":[37702,37725]},{"content":"Get a preview frame","pos":[37758,37777]},{"content":"CameraStarterKit sample","pos":[37806,37829]}],"content":"---\nauthor: drewbatgit\nms.assetid: 1361E82A-202F-40F7-9239-56F00DFCA54B\ndescription: This article describes the steps for capturing photos and video using the MediaCapture API, including initializing and shutting down the MediaCapture and handling changes in device orientation.\ntitle: Capture photos and video with MediaCapture\n---\n\n# Capture photos and video with MediaCapture\n\n\\[ Updated for UWP apps on Windows 10. For Windows 8.x articles, see the [archive](http://go.microsoft.com/fwlink/p/?linkid=619132) \\]\n\n\nThis article describes the steps for capturing photos and video using the [**MediaCapture**](https://msdn.microsoft.com/library/windows/apps/br241124) API, including initializing and shutting down the **MediaCapture** and handling changes in device orientation.\n\n**MediaCapture** is provided to support apps that require low-level control of the media capture process and that implement scenarios that require advanced capture capabilities. Using **MediaCapture** also requires you to provide your own capture UI. If your app only needs to capture a photo or video and is unconcerned with advanced capture techniques, the [**CameraCaptureUI**](https://msdn.microsoft.com/library/windows/apps/br241030) makes it easy to capture a photo or video with only a few lines of code. For more information, see [Capture photos and video with CameraCaptureUI](capture-photos-and-video-with-cameracaptureui.md).\n\nThe code in this article was adapted from the [CameraStarterKit sample](http://go.microsoft.com/fwlink/?LinkId=619479). You can download the sample to see the code used in context or to use the sample as a starting point for your own app.\n\n## Configure your project\n\n### Add capability declarations to the app manifest\n\nIn order for your app to access a device's camera, you must declare that your app uses the *webcam* and *microphone* device capabilities. If you want to save captured photos and videos to the users's Pictures or Videos library, you must also declare the *picturesLibrary* and *videosLibrary* capability.\n\n**Add capabilities to the app manifest**\n\n1.  In Microsoft Visual Studio, in **Solution Explorer**, open the designer for the application manifest by double-clicking the **package.appxmanifest** item.\n2.  Select the **Capabilities** tab.\n3.  Check the box for **Webcam** and the box for **Microphone**.\n4.  For access to the Pictures and Videos library check the boxes for **Pictures Library** and the box for **Videos Library**.\n\n### Add using directives for media capture-related APIs\n\nThe following code listing shows the namespaces that are referenced by the sample code in this article and describes what functionality each namespace provides.\n\n[!code-cs[Using](./code/BasicMediaCaptureWin10/cs/MainPage.xaml.cs#SnippetUsing)]\n\n## Initialize the MediaCapture object\n\nThe [**MediaCapture**](https://msdn.microsoft.com/library/windows/apps/br241124) class in the [**Windows.Media.Capture**](https://msdn.microsoft.com/library/windows/apps/br226738) namespace is the fundamental interface for all media capture operations. Apps typically declare a variable of this type scoped to a single page. Your app needs to track the current state of the **MediaCapture**, so you should declare boolean variables for the initialization, previewing, and recording state of the object.\n\n[!code-cs[MediaCaptureVariables](./code/BasicMediaCaptureWin10/cs/MainPage.xaml.cs#SnippetMediaCaptureVariables)]\n\nTo help orient the preview video correctly, create member variables to track whether the camera is external and whether the app is currently mirroring the preview stream. Your app should mirror the preview stream when you think the video feed is capturing the user because that is a more natural user experience.\n\n[!code-cs[PreviewVariables](./code/BasicMediaCaptureWin10/cs/MainPage.xaml.cs#SnippetPreviewVariables)]\n\nThe following example method initializes the media capture object. First, the code searches for a video capture device that can be used for media capture. Once found, the **MediaCapture** object is initialized and handlers for its events are registered. Next a [**MediaCaptureInitializationSettings**](https://msdn.microsoft.com/library/windows/desktop/hh802710) object is created using the ID of the video capture device. The **MediaCapture** is then initialized with a call to [**InitializeAsync**](https://msdn.microsoft.com/library/windows/apps/br226598).\n\n[!code-cs[InitializeCameraAsync](./code/BasicMediaCaptureWin10/cs/MainPage.xaml.cs#SnippetInitializeCameraAsync)]\n\n-   The [**DeviceInformation.FindAllAsync**](https://msdn.microsoft.com/library/windows/apps/br225432) method can be used to find all devices of a specified type. In this example, the **DeviceClass.VideoCapture** enumeration value is passed in to indicate that only video capture devices should be returned. Note that a video capture device is used for capturing both photos and videos.\n\n-   **FindAllAsync** returns a [**DeviceInformationCollection**](https://msdn.microsoft.com/library/windows/apps/br225395) object that contains a [**DeviceInformation**](https://msdn.microsoft.com/library/windows/apps/br225393) object for each found device of the requested type. The **FirstOrDefault** extension method from the **System.Linq** namespace provides an easy syntax for selecting an item from a list based on specified conditions. The first call attempts to select the first **DeviceInformation** in the list that has an [**EnclosureLocation.Panel**](https://msdn.microsoft.com/library/windows/apps/br229906) value of **Panel.Back**, indicating that the camera is on the back panel of the device's enclosure. If the device does not have a camera on the back panel, the first available camera is used.\n\n-   If you do not specify a device ID when you initialize the [**MediaCaptureInitializationSettings**](https://msdn.microsoft.com/library/windows/apps/br226573), the system will choose the first device in its internal list of devices.\n\n-   The call to [**MediaCapture.InitializeAsync**](https://msdn.microsoft.com/library/windows/apps/br226598) initializes the object to use the specified capture device. This call is made inside a **try** block because it will throw an **UnauthorizedAccessException** if the user has denied the calling app access to the camera. If the call succeeds, the **\\_isInitialized** variable is set to true so that subsequent method calls can determine if the capture device has been initialized.\n\n- **Important** On some device families, a user consent prompt is displayed to the user before your app is granted access to the device's camera. For this reason, you must only call [**MediaCapture.InitializeAsync**](https://msdn.microsoft.com/library/windows/apps/br226598) from the main UI thread. Attempting to initialize the camera from another thread may result in initialization failure.\n\n-   If the initialization of the capture device is successful, variables are set to reflect whether the capture device is external, or if it is on the front panel of the device. These values will be used to orient the capture preview correctly for the user. Finally, the UI is updated to reflect that capture is available and the preview stream from the capture device is started. All of these tasks are performed in helper methods that will be described later in this article.\n\n## Start the capture preview\n\nFor the user to be able to see what they are capturing, you need to provide a preview of what the video capture device is currently seeing in your UI.\n\n**Important** You must start the capture preview in order for the capture device to enable auto focus, auto exposure, and auto white balance.\n\nThe [**CaptureElement**](https://msdn.microsoft.com/library/windows/apps/br209278) control is provided to enable capture preview. The following shows example XAML code that defines the capture element.\n\n[!code-xml[CaptureElement](./code/BasicMediaCaptureWin10/cs/MainPage.xaml#SnippetCaptureElement)]\n\nUsers expect that the screen will stay on while they are previewing the video capture screen and not turn off due to inactivity. To enable this, you must create a [**DisplayRequest**](https://msdn.microsoft.com/library/windows/apps/br241816) object. Declare this variable with page scope so that it persists throughout the capture session.\n\n[!code-cs[DisplayRequest](./code/BasicMediaCaptureWin10/cs/MainPage.xaml.cs#SnippetDisplayRequest)]\n\nThe following method starts up the media capture preview. First, it requests that the display remain active by calling [**RequestActive**](https://msdn.microsoft.com/library/windows/apps/br241818) on the [**DisplayRequest**](https://msdn.microsoft.com/library/windows/apps/br241816). Next, the preview is started by calling [**StartPreviewAsync**](https://msdn.microsoft.com/library/windows/apps/br226613).\n\n[!code-cs[StartPreviewAsync](./code/BasicMediaCaptureWin10/cs/MainPage.xaml.cs#SnippetStartPreviewAsync)]\n\n-   The [**RequestActive**](https://msdn.microsoft.com/library/windows/apps/br241818) method is called on the **DisplayRequest** object to request that the system leave the screen on.\n\n-   The [**Source**](https://msdn.microsoft.com/library/windows/apps/br227419) property of the **CaptureElement** is set to the app's **MediaCapture** object to define the source of the preview.\n\n-   The [**FlowDirection**](https://msdn.microsoft.com/library/windows/apps/br208716) property is provided by the XAML framework to support bi-directional user interfaces. Setting the flow direction of the **CaptureElement** to [**FlowDirection.RightToLeft**](https://msdn.microsoft.com/library/windows/apps/br242397) causes the preview video to be flipped horizontally. This is used when the capture device is on the front panel of the device so that the preview in the correct direction from the user's perspective.\n\n-   The [**StartPreviewAsync**](https://msdn.microsoft.com/library/windows/apps/br226613) method starts the display of the preview stream within the **CaptureElement**. If the preview is started successfully, the **\\_isPreviewing** variable is set to allow other parts of the app to know that the app is currently previewing, and the helper method for setting the preview rotation is called. This method is defined in the next section.\n\n## Detect screen and device orientation\n\nThere are several areas of a media capture app that, when running on a mobile device like a phone or a tablet, are impacted by the current orientation of the device. These areas include properly rotating the preview stream from the camera and properly encoding captured images and videos so that, when viewed by the user, they are correctly oriented.\n\nThe term \"display orientation\" refers to the way the system rotates the XAML page on the device to keep it upright for the user. \"Device orientation\" refers to the orientation of the device in world space and, therefore, the orientation of the physical camera device in world space. Both kinds of orientation a relevant to a media capture app. To handle display orientation, declare and initialize a page-scoped variable for the [**DisplayInformation**](https://msdn.microsoft.com/library/windows/apps/dn264258) class. Declare another variable of type [**DisplayOrientations**](https://msdn.microsoft.com/library/windows/apps/br226142) to track the current orientation of the display. Declare a [**SimpleOrientationSensor**](https://msdn.microsoft.com/library/windows/apps/br206400) variable and a [**SimpleOrientation**](https://msdn.microsoft.com/library/windows/apps/br206399) variable to track device orientation.\n\n[!code-cs[DisplayInformationAndOrientation](./code/BasicMediaCaptureWin10/cs/MainPage.xaml.cs#SnippetDisplayInformationAndOrientation)]\n\nThe following helper methods register and unregister event handlers for the [**DisplayInformation.OrientationChanged**](https://msdn.microsoft.com/library/windows/apps/dn264268) and [**SimpleOrientationSensor.OrientationChanged**](https://msdn.microsoft.com/library/windows/apps/br206407) events and initialize the tracking variables with the current orientation. Note that not all devices have a [**SimpleOrientationSensor**](https://msdn.microsoft.com/library/windows/apps/br206400), so you should check before registering the handler or attempting to get the current orientation.\n\n[!code-cs[RegisterOrientationEventHandlers](./code/BasicMediaCaptureWin10/cs/MainPage.xaml.cs#SnippetRegisterOrientationEventHandlers)]\n\n[!code-cs[UnregisterOrientationEventHandlers](./code/BasicMediaCaptureWin10/cs/MainPage.xaml.cs#SnippetUnregisterOrientationEventHandlers)]\n\nIn the event handler for the **SimpleOrientationSensor.OrientationChanged** event, update the device orientation variable with the current orientation. You should not update the orientation if the device is facing up or down.\n\n[!code-cs[SimpleOrientationChanged](./code/BasicMediaCaptureWin10/cs/MainPage.xaml.cs#SnippetSimpleOrientationChanged)]\n\nIn the event handler for the **DisplayInformation.OrientationChanged** event, update the display orientation variable with the current orientation. If the video preview of the capture device is currently being displayed, update the rotation of the preview video stream. The **SetPreviewRotationAsync** helper method is described in the following section.\n\n[!code-cs[DisplayOrientationChanged](./code/BasicMediaCaptureWin10/cs/MainPage.xaml.cs#SnippetDisplayOrientationChanged)]\n\n## Set the media capture preview rotation\n\nUsers expect for UI controls to rotate when the orientation of their mobile device changes, so that the text in the UI is vertically aligned and readable. For the **CaptureElement** control, however, users typically do not want the orientation of the video preview to rotate when the device does. In order to provide the expected user experience, you should rotate the preview stream to match the orientation of the device.\n\nThe preview stream orientation must be expressed in degrees. The following helper method to converts the [**DisplayOrientations**](https://msdn.microsoft.com/library/windows/apps/br226142) enumeration values into degrees.\n\n[!code-cs[ConvertDisplayOrientationToDegrees](./code/BasicMediaCaptureWin10/cs/MainPage.xaml.cs#SnippetConvertDisplayOrientationToDegrees)]\n\nAnd this helper method converts a [**SimpleOrientation**](https://msdn.microsoft.com/library/windows/apps/br206399) enumeration value, which is used by the [**SimpleOrientationSensor**](https://msdn.microsoft.com/library/windows/apps/br206400) to express the rotation of the device, into degrees.\n\n[!code-cs[ConvertDeviceOrientationToDegrees](./code/BasicMediaCaptureWin10/cs/MainPage.xaml.cs#SnippetConvertDeviceOrientationToDegrees)]\n\nAt a low-level, the rotation of a stream is actually performed by the Microsoft Media Foundation framework. The rotation is specified using the [MF\\_MT\\_VIDEO\\_ROTATION](https://msdn.microsoft.com/library/windows/desktop/hh162880) attribute. Since this is a Windows Runtime app, the rotation is specified using the GUID for the attribute, rather than the attribute name. Define the following GUID to identify the video rotation attribute.\n\n[!code-cs[RotationKey](./code/BasicMediaCaptureWin10/cs/MainPage.xaml.cs#SnippetRotationKey)]\n\nThe following method sets the rotation of the preview stream. The [**GetMediaStreamProperties**](https://msdn.microsoft.com/library/windows/apps/br211995) method of the media capture's [**VideoDeviceController**](https://msdn.microsoft.com/library/windows/apps/br226825) returns a property set made up of key/value pairs. [**MediaStreamType.VideoPreview**](https://msdn.microsoft.com/library/windows/apps/br226640) is specified to indicate that we want the properties for the video preview stream, as opposed to the video recording stream or the audio stream. The property set is a general purpose interface for setting stream properties, but for this task the video rotation GUID defined above is added as the property key and the desired orientation of the video stream, in degrees, is specified as the value. [**SetEncodingPropertiesAsync**](https://msdn.microsoft.com/library/windows/apps/dn297781) updates the encoding properties with the new values. Once again, **MediaStreamType.VideoPreview** is specified to indicate that the properies being set are for the video preview stream.\n\n[!code-cs[SetPreviewRotation](./code/BasicMediaCaptureWin10/cs/MainPage.xaml.cs#SnippetSetPreviewRotation)]\n\n-   For devices with external cameras, the user does not expect for the camera stream to be rotated when the device rotates.\n\n-   If the preview is being mirrored for a camera on the front panel, the rotation direction must be inverted to match the rotation of the device.\n\n-   Some devices, typically phones, support setting [**DisplayInformation.AutoRotationPreferences**](https://msdn.microsoft.com/library/windows/apps/dn264259) to an orientation value such as [**DisplayOrientations.Landscape**](https://msdn.microsoft.com/library/windows/apps/br226142) to force the display to rotate with the device. You should set this value because it provides a good experience on devices that support it, but you should still implement the above pattern in your app to support devices that don't support auto-rotation preferences.\n\n-   In previous releases, the [**SetPreviewRotation**](https://msdn.microsoft.com/library/windows/apps/br226611) method was the only way to rotate the preview stream. This method is still present in the API surface to support existing apps, but this method inefficient and should not be used for new apps.\n\n## Capture a photo\n\nThe following method captures a photo using the [**CapturePhotoToStreamAsync**](https://msdn.microsoft.com/library/windows/apps/hh700840) method and passing in the requested encoding properties and an [**InMemoryRandomAccessStream**](https://msdn.microsoft.com/library/windows/apps/br241720) object that will contain the output of the capture operation. The [**ImageEncodingProperties**](https://msdn.microsoft.com/library/windows/apps/hh700993) class provides helper methods, like [**CreateJpeg**](https://msdn.microsoft.com/library/windows/apps/hh700994), to generate encoding properties for the file types supported by media capture.\n\n[!code-cs[TakePhotoAsync](./code/BasicMediaCaptureWin10/cs/MainPage.xaml.cs#SnippetTakePhotoAsync)]\n\nBefore saving the photo to a file, you need to determine the correct orientation of the photo. The **MediaCapture** object doesn't know about the device's orientation and so it encodes the captured photo data as if the capture device is in its default orientation. This can result in a negative user experience when the user is viewing the captured photo, as the photo will be oriented incorrectly. The following helper methods determine the correct photo orientation and then save the file with the correct orientation.\n\nThe **GetCameraOrientation** helper method starts with the current device orientation and then rotates that value depending on the native orientation of the device and the location of the camera on the device. If the camera is mounted on the front panel of the device, as indicated in this example by the **\\_mirroringPreview** variable, then the camera orientation should be inverted.\n\n[!code-cs[GetCameraOrientation](./code/BasicMediaCaptureWin10/cs/MainPage.xaml.cs#SnippetGetCameraOrientation)]\n\nThe following helper method simply converts values from the [**SimpleOrientation**](https://msdn.microsoft.com/library/windows/apps/br206399) enumeration values used by the orientation sensor to the equivalent [**PhotoOrientation**](https://msdn.microsoft.com/library/windows/apps/hh965476) value used by the bitmap encoder that will be used to save the file.\n\n[!code-cs[ConvertOrientationToPhotoOrientation](./code/BasicMediaCaptureWin10/cs/MainPage.xaml.cs#SnippetConvertOrientationToPhotoOrientation)]\n\nFinally, the captured photo can be encoded and saved. Create a [**BitmapDecoder**](https://msdn.microsoft.com/library/windows/apps/br226176) object from the input stream containing the captured photo data. Create a new [**StorageFile**](https://msdn.microsoft.com/library/windows/apps/br227171) and open it for reading and writing. Create a [**BitmapEncoder**](https://msdn.microsoft.com/library/windows/apps/br226206) object, passing in the output file and the decoder containing the image data. Create a new [**BitmapPropertySet**](https://msdn.microsoft.com/library/windows/apps/hh974338) and add a new property. The key for the property, \"System.Photo.Orientation\" specifies that the property represents the orientation of the photo. The value is the [**PhotoOrientation**](https://msdn.microsoft.com/library/windows/apps/hh965476) value that was previously calculated. Call [**SetPropertiesAsync**](https://msdn.microsoft.com/library/windows/apps/br226252) to update the properties on the encoder and then call [**FlushAsync**](https://msdn.microsoft.com/library/dn237883) to write the photo to the storage file.\n\n[!code-cs[ReencodeAndSavePhotoAsync](./code/BasicMediaCaptureWin10/cs/MainPage.xaml.cs#SnippetReencodeAndSavePhotoAsync)]\n\n-   Setting the \"System.Photo.Orientation\" bitmap property encodes the orientation of the photo into the metadata of the file. It does not cause the actual image data to be encoded differently. For more information about embedding metadata into image files, see [Image metadata](image-metadata.md).\n\n-   For more information about working with images, including encoding and decoding images, see [Imaging](imaging.md).\n\n## Capture a video\n\nTo start capturing video, first create a storage file to which the video will be recorded. Next create the [**MediaEncodingProfile**](https://msdn.microsoft.com/library/windows/apps/hh701026) that the **MediaCapture** will use to encode the video to the file. The **MediaEncodingProfile** class provides methods, like [**CreateMp4**](https://msdn.microsoft.com/library/windows/apps/hh701078), that create encoding profiles for the supported video formats. Use the helper methods discussed previously to get the correct rotation for the video, in degrees. Unlike the photo scenario, the video rotation information is encoded into the stream by the **MediaCapture**. Add the rotation information to the encoding profile by adding it to the [**VideoEncodingProperties.Properties**](https://msdn.microsoft.com/library/windows/apps/hh701254) collection. The previously defined GUID for video rotation is used as the key and the rotation, in degrees, is the value. Finally, call [**MediaCapture.StartRecordToStorageFileAsync**](https://msdn.microsoft.com/library/windows/apps/hh700863), specifying the encoding properties and the output file to begin recording.\n\n[!code-cs[StartRecordingAsync](./code/BasicMediaCaptureWin10/cs/MainPage.xaml.cs#SnippetStartRecordingAsync)]\n\nTo stop recording, simply call [**MediaCapture.StopRecordAsync**](https://msdn.microsoft.com/library/windows/apps/br226623).\n\n[!code-cs[StopRecordingAsync](./code/BasicMediaCaptureWin10/cs/MainPage.xaml.cs#SnippetStopRecordingAsync)]\n\nA handler for the [**MediaCapture.RecordLimitationExceeded**](https://msdn.microsoft.com/library/windows/apps/hh973312) event was registered when the **MediaCapture** was initialized. In the handler, call the **StopRecordingAsync** method to stop video recording.\n\n[!code-cs[RecordLimitationExceeded](./code/BasicMediaCaptureWin10/cs/MainPage.xaml.cs#SnippetRecordLimitationExceeded)]\n\n## Pause and resume video capture\n\nFor some scenarios you may want to pause and resume an ongoing video capture rather than stopping the capture and starting a new one. To pause recording call [**PauseRecordAsync**](https://msdn.microsoft.com/library/windows/apps/dn858102). If you specify [**MediaCapturePauseBehavior.RetainHardwareResources**](https://msdn.microsoft.com/library/windows/apps/dn926686), then on devices that don't support simultaneous video and photo capture, the app will be unable to capture photos while the video is paused. For information on determining if a device supports simultaneous photo and video capture, see [Camera profiles](camera-profiles.md).\n\n[!code-cs[PauseRecordingAsync](./code/BasicMediaCaptureWin10/cs/MainPage.xaml.cs#SnippetPauseRecordingAsync)]\n\nTo resume a previously paused video capture, call [**ResumeRecordAsync**](https://msdn.microsoft.com/library/windows/apps/dn858103).\n\n[!code-cs[ResumeRecordingAsync](./code/BasicMediaCaptureWin10/cs/MainPage.xaml.cs#SnippetResumeRecordingAsync)]\n\n## Clean up capture resources\n\nIt is very important that you shut down and release the media capture resources properly. Failure to do so can cause unexpected camera behavior after your app closes, which results in a negative user experience for your app. The following sections walk through the different steps you should take to shut down the camera.\n\n### Shut down the capture preview\n\nTo shut down the capture preview, first call [**MediaCapture.StopPreviewAsync**](https://msdn.microsoft.com/library/windows/apps/br226622). Set the [**Source**](https://msdn.microsoft.com/library/windows/apps/br227419) property of your [**MediaElement**](https://msdn.microsoft.com/library/windows/apps/br242926) to null. Then, call the [**RequestRelease**](https://msdn.microsoft.com/library/windows/apps/br241819) on your [**DisplayRequest**](https://msdn.microsoft.com/library/windows/apps/br241816) variable to allow the system to turn off the display when needed.\n\n[!code-cs[StopPreviewAsync](./code/BasicMediaCaptureWin10/cs/MainPage.xaml.cs#SnippetStopPreviewAsync)]\n\n-   You can't access the UI from a non-UI thread, so the setting the **MediaElement.Source** property and calling **RequestRelease** must be made using the [**CoreDispatcher.RunAsync**](https://msdn.microsoft.com/library/windows/apps/hh750317) method so that the calls execute on the UI thread.\n\n### Shut down and dispose of the MediaCapture object\n\nBefore disposing of the **MediaCapture** object, stop any recording that is ongoing and stop the preview stream by calling the helper methods defined previously. Once this has been done, remove any event handlers registered with the **MediaCapture**, then call [**Dispose**](https://msdn.microsoft.com/library/windows/apps/dn278858) to free any resources associated with the object and set the **MediaCapture** variable to null\n\n[!code-cs[CleanupCameraAsync](./code/BasicMediaCaptureWin10/cs/MainPage.xaml.cs#SnippetCleanupCameraAsync)]\n\nYou should call this method to shut down and dispose of the **MediaCapture** object from inside the handler for the [**MediaCapture.Failed**](https://msdn.microsoft.com/library/windows/apps/br226593) event.\n\n[!code-cs[CaptureFailed](./code/BasicMediaCaptureWin10/cs/MainPage.xaml.cs#SnippetCaptureFailed)]\n\n### Handle app lifetime and page navigation events\n\nThe app lifetime events give your app an opportunity to initialize and release resources. This is especially important with the **Application.Suspending** event, where it is essential that your app properly disposes of media capture resources.\n\nYou can register handlers for the application lifetime events in your page's constructor.\n\n[!code-cs[RegisterAppLifetimeEvents](./code/BasicMediaCaptureWin10/cs/MainPage.xaml.cs#SnippetRegisterAppLifetimeEvents)]\n\nIn the handler for the **Application.Suspending** event, you should unregister the handlers for the display and device orientation events and shut down the **MediaCapture** object. The [**SystemMediaTransportControls.PropertyChanged**](https://msdn.microsoft.com/library/windows/apps/dn278720) event unregistered here is needed for another application lifecycle-related task that is described later in this article.\n\n**Caution** \nYou must request a suspending deferral by calling [**SuspendingOperation.GetDeferral**](https://msdn.microsoft.com/library/windows/apps/br224690) at the beginning of your suspending event handler. This requests that the system wait for you to signal that the operation is complete before tearing down your app. This is necessary because the **MediaCapture** shutdown operations are asynchronous, so the **Application.Suspending** event handler may complete before the camera is properly shut down. After your awaited asynchronous calls complete, you should release the deferral by calling [**SuspendingDeferral.Complete**](https://msdn.microsoft.com/library/windows/apps/br224685).\n\n[!code-cs[Suspending](./code/BasicMediaCaptureWin10/cs/MainPage.xaml.cs#SnippetSuspending)]\n\nIn the handler for the **Application.Resuming** event, you should register handlers for the display and device orientation events, register the **SystemMediaTransportControls.PropertyChanged** event, and initialize the **MediaCapture** object.\n\n[!code-cs[Resuming](./code/BasicMediaCaptureWin10/cs/MainPage.xaml.cs#SnippetResuming)]\n\nThe [**OnNavigatedTo**](https://msdn.microsoft.com/library/windows/apps/br227508) event gives an opportunity to initially register handlers for the display and device orientation events and initialize the **MediaCapture** object.\n\n[!code-cs[OnNavigatedTo](./code/BasicMediaCaptureWin10/cs/MainPage.xaml.cs#SnippetOnNavigatedTo)]\n\nIf your app has multiple pages, you should clean up your media capture objects in the [**OnNavigatingFrom**](https://msdn.microsoft.com/library/windows/apps/br227509) event handler.\n\n[!code-cs[OnNavigatingFrom](./code/BasicMediaCaptureWin10/cs/MainPage.xaml.cs#SnippetOnNavigatingFrom)]\n\nFor your app to behave properly on devices that support multiple simultaneous windows, you must respond when your app is minimized or restored. To do this, you must handle the [**SystemMediaTransportControls.PropertyChanged**](https://msdn.microsoft.com/library/windows/apps/dn278720) event. Initialize a member variable to store a reference to the [**SystemMediaTransportControls**](https://msdn.microsoft.com/library/windows/apps/dn278677) object for your app.\n\n[!code-cs[DeclareSystemMediaTransportControls](./code/BasicMediaCaptureWin10/cs/MainPage.xaml.cs#SnippetDeclareSystemMediaTransportControls)]\n\nThe code to register and unregister the **PropertyChanged** event should be added to the app life cycle events as shown in the examples above. In the handler for the event, check to see if the property change that triggered the event was the [**SystemMediaTransportControlsProperty.SoundLevel**](https://msdn.microsoft.com/library/windows/apps/dn278721) property. If this was the property that changed, check the value of the property. If the value is [**SoundLevel.Muted**](https://msdn.microsoft.com/library/windows/apps/hh700852), then your app was minimized and you should clean up your media capture resources appropriately. Otherwise, the event signals that your app window was restored and you should reinitialize you media capture resources. The **SoundLevel** property must be accessed on the UI thread, so the code in this method is wrapped in a call to [**Dispatcher.RunAsync**](https://msdn.microsoft.com/library/windows/apps/hh750317).\n\n[!code-cs[SystemMediaControlsPropertyChanged](./code/BasicMediaCaptureWin10/cs/MainPage.xaml.cs#SnippetSystemMediaControlsPropertyChanged)]\n\n## Additional UI considerations for media capture\n\n### Set auto-rotation preferences\n\nAs mentioned in the previous section on rotating the preview stream, some devices support setting [**DisplayInformation.AutoRotationPreferences**](https://msdn.microsoft.com/library/windows/apps/dn264259) to prevent the page, including the [**CaptureElement**](https://msdn.microsoft.com/library/windows/apps/br209278) that displays the preview, from rotating as the device is rotating. This provides a good user experience on devices that support it. Set this value when your app launches or when you begin displaying the preview. Note that you should still implement preview rotation handling for devices that don't support auto-rotation preferences.\n\n[!code-cs[SetAutoRotationPreferences](./code/BasicMediaCaptureWin10/cs/MainPage.xaml.cs#SnippetSetAutoRotationPreferences)]\n\n### Handle UI element orientation\n\nUsers typically expect for the UI elements in a camera app, such as the buttons for initiating photo or video capture, to rotate along with the video preview. The following method illustrates the use of the previously defined orientation helper methods to properly orient the buttons in the camera UI. You should call this method from the [**DisplayInformation.OrientationChanged**](https://msdn.microsoft.com/library/windows/apps/dn264268) and [**SimpleOrientationSensor.OrientationChanged**](https://msdn.microsoft.com/library/windows/apps/br206407) event handlers and when your app first launches. Your implementation my vary depending on your app's UI.\n\n[!code-cs[UpdateButtonOrientation](./code/BasicMediaCaptureWin10/cs/MainPage.xaml.cs#SnippetUpdateButtonOrientation)]\n\nWhen your app is shutting down or if you navigate to a page that is unrelated to media capture, set the auto-rotation preference to [**None**](https://msdn.microsoft.com/library/windows/apps/br226142) to allow the UI to rotate normally.\n\n[!code-cs[RevertAutoRotationPreferences](./code/BasicMediaCaptureWin10/cs/MainPage.xaml.cs#SnippetRevertAutoRotationPreferences)]\n\n### Support simultaneous photo and video capture\n\nThe [**Windows.Media.Capture**](https://msdn.microsoft.com/library/windows/apps/br226738) API allows you to capture photos and videos simultaneously on devices that support it. For brevity, this example uses the [**ConcurrentRecordAndPhotoSupported**](https://msdn.microsoft.com/library/windows/apps/dn278843) property to determine if simultaneous video and photo capture is supported, but a more robust and recommended way to do this is to use camera profiles. For more information, see [Camera profiles](camera-profiles.md).\n\nThe following helper method updates the app's controls to match the current capture state of the app. Call this method whenever the capture state of your app changes, such as when video capture is started or stopped.\n\n[!code-cs[UpdateCaptureControls](./code/BasicMediaCaptureWin10/cs/MainPage.xaml.cs#SnippetUpdateCaptureControls)]\n\n### Support mobile-specific UI features\n\nAll of the code shown in this article will work in a Universal Windows app. With a few additional lines of code, you can take advantage of special UI features that are only present on mobile devices. To use these features, you must add a reference to the Microsoft Mobile Extension SDK for Universal App Platform to your project.\n\n**To add a reference to the mobile extension SDK for hardware camera button support**\n\n1.  In **Solution Explorer**, right-click **References** and select **Add Reference...**\n\n2.  Expand the **Windows Universal** node and select **Extensions**.\n\n3.  Click the checkbox next to **Microsoft Mobile Extension SDK for Universal App Platform**.\n\nMobile devices have a [**StatusBar**](https://msdn.microsoft.com/library/windows/apps/dn633864) control that provides the user with status information about the device. This control takes up space on the screen that can interfere with the media capture UI. You can hide the status bar by calling [**HideAsync**](https://msdn.microsoft.com/library/windows/apps/dn610339), but you must make this call from within a conditional block where you use the [**ApiInformation.IsTypePresent**](https://msdn.microsoft.com/library/windows/apps/dn949016) method to determine if the API is available. This method will only return true on mobile devices that support the status bar. You should hide the status bar when your app launches or when you begin previewing from the camera.\n\n[!code-cs[HideStatusBar](./code/BasicMediaCaptureWin10/cs/MainPage.xaml.cs#SnippetHideStatusBar)]\n\nWhen your app is shutting down or when the user navigates away from the media capture page of your app, you make the control visible again.\n\n[!code-cs[ShowStatusBar](./code/BasicMediaCaptureWin10/cs/MainPage.xaml.cs#SnippetShowStatusBar)]\n\nSome mobile devices have a dedicated hardware camera button that some users prefer over an on-screen control. To be notified when the hardware camera button is pressed, register a handler for the [**HardwareButtons.CameraPressed**](https://msdn.microsoft.com/library/windows/apps/dn653805) event. Because this API is available on mobile devices only, you must again use the **IsTypePresent** to make sure the API is supported on the current device before attempting to access it.\n\n[!code-cs[PhoneUsing](./code/BasicMediaCaptureWin10/cs/MainPage.xaml.cs#SnippetPhoneUsing)]\n\n[!code-cs[RegisterCameraButtonHandler](./code/BasicMediaCaptureWin10/cs/MainPage.xaml.cs#SnippetRegisterCameraButtonHandler)]\n\nIn the handler for the **CameraPressed** event, you can initiate a photo capture.\n\n[!code-cs[CameraPressed](./code/BasicMediaCaptureWin10/cs/MainPage.xaml.cs#SnippetCameraPressed)]\n\nWhen your app is shutting down or the user moves away from the media capture page of your app, unregister the hardware button handler.\n\n[!code-cs[UnregisterCameraButtonHandler](./code/BasicMediaCaptureWin10/cs/MainPage.xaml.cs#SnippetUnregisterCameraButtonHandler)]\n\n**Note** This article is for Windows 10 developers writing Universal Windows Platform (UWP) apps. If you're developing for Windows 8.x or Windows Phone 8.x, see the [archived documentation](http://go.microsoft.com/fwlink/p/?linkid=619132).\n\n## Related topics\n\n* [Camera profiles](camera-profiles.md)\n* [High Dynamic Range (HDR) photo capture](high-dynamic-range-hdr-photo-capture.md)\n* [Capture device controls for photo and video capture](capture-device-controls-for-photo-and-video-capture.md)\n* [Capture device controls for video capture](capture-device-controls-for-video-capture.md)\n* [Effects for video capture](effects-for-video-capture.md)\n* [Scene analysis for media capture](scene-analysis-for-media-capture.md)\n* [Variable photo sequence](variable-photo-sequence.md)\n* [Get a preview frame](get-a-preview-frame.md)\n* [CameraStarterKit sample](http://go.microsoft.com/fwlink/?LinkId=619479)\n"}