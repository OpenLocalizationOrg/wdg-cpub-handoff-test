{"nodes":[{"pos":[66,291],"content":"The MediaSource class provides a common way to reference and play back media from different sources such as local or remote files and exposes a common model for accessing media data, regardless of the underlying media format.","needQuote":true,"needEscape":true,"nodes":[{"content":"The MediaSource class provides a common way to reference and play back media from different sources such as local or remote files and exposes a common model for accessing media data, regardless of the underlying media format.","pos":[0,225]}]},{"pos":[299,330],"content":"Media playback with MediaSource","needQuote":true,"needEscape":true,"nodes":[{"content":"Media playback with MediaSource","pos":[0,31]}]},{"content":"Media playback with MediaSource","pos":[338,369]},{"content":"\\[ Updated for UWP apps on Windows 10.","pos":[371,409]},{"content":"For Windows 8.x articles, see the <bpt id=\"p1\">[</bpt>archive<ept id=\"p1\">](http://go.microsoft.com/fwlink/p/?linkid=619132)</ept> \\]","pos":[410,505],"source":" For Windows 8.x articles, see the [archive](http://go.microsoft.com/fwlink/p/?linkid=619132) \\]"},{"content":"\\[Some information relates to pre-released product which may be substantially modified before it's commercially released.","pos":[508,629]},{"content":"Microsoft makes no warranties, express or implied, with respect to the information provided here.\\]","pos":[630,729]},{"content":"The <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>MediaSource<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn930905)</ept> class provides a common way to reference and play back media from different sources such as local or remote files and exposes a common model for accessing media data, regardless of the underlying media format.","pos":[731,1020],"source":"The [**MediaSource**](https://msdn.microsoft.com/library/windows/apps/dn930905) class provides a common way to reference and play back media from different sources such as local or remote files and exposes a common model for accessing media data, regardless of the underlying media format."},{"content":"The <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>MediaPlaybackItem<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn930939)</ept> class extends the functionality of <bpt id=\"p3\">**</bpt>MediaSource<ept id=\"p3\">**</ept>, allowing you to manage and select from multiple audio, video, and metadata tracks contained in a media item.","pos":[1021,1267],"source":" The [**MediaPlaybackItem**](https://msdn.microsoft.com/library/windows/apps/dn930939) class extends the functionality of **MediaSource**, allowing you to manage and select from multiple audio, video, and metadata tracks contained in a media item."},{"content":"<bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>MediaPlaybackList<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn930955)</ept> allows you to create playback lists from one or more media playback items.","pos":[1268,1424],"source":"[**MediaPlaybackList**](https://msdn.microsoft.com/library/windows/apps/dn930955) allows you to create playback lists from one or more media playback items."},{"content":"The code in this article was adapted from the <bpt id=\"p1\">[</bpt>Video Playback SDK<ept id=\"p1\">](http://go.microsoft.com/fwlink/p/?LinkId=620020&amp;clcid=0x409)</ept> sample.","pos":[1426,1561],"source":"The code in this article was adapted from the [Video Playback SDK](http://go.microsoft.com/fwlink/p/?LinkId=620020&clcid=0x409) sample."},{"content":"You can download this sample to see the code used in context or to use as a starting point for your own app.","pos":[1562,1670]},{"content":"Create and play a MediaSource","pos":[1675,1704]},{"pos":[1706,1806],"content":"Create a new instance of <bpt id=\"p1\">**</bpt>MediaSource<ept id=\"p1\">**</ept> by calling one of the factory methods exposed by the class:","source":"Create a new instance of **MediaSource** by calling one of the factory methods exposed by the class:"},{"content":"CreateFromAdaptiveMediaSource","pos":[1815,1844]},{"content":"CreateFromIMediaSource","pos":[1913,1935]},{"content":"CreateFromMediaStreamSource","pos":[2004,2031]},{"content":"CreateFromMseStreamSource","pos":[2100,2125]},{"content":"CreateFromStorageFile","pos":[2194,2215]},{"content":"CreateFromStream","pos":[2284,2300]},{"content":"CreateFromStreamReference","pos":[2369,2394]},{"content":"CreateFromUri","pos":[2463,2476]},{"content":"After creating a <bpt id=\"p1\">**</bpt>MediaSource<ept id=\"p1\">**</ept> you can play the source directly with a <bpt id=\"p2\">[</bpt><bpt id=\"p3\">**</bpt>MediaElement<ept id=\"p3\">**</ept><ept id=\"p2\">](https://msdn.microsoft.com/library/windows/apps/br242926)</ept>, by calling <bpt id=\"p4\">[</bpt><bpt id=\"p5\">**</bpt>SetPlaybackSource<ept id=\"p5\">**</ept><ept id=\"p4\">](https://msdn.microsoft.com/library/windows/apps/dn899085)</ept>, or with a <bpt id=\"p6\">[</bpt><bpt id=\"p7\">**</bpt>MediaPlayer<ept id=\"p7\">**</ept><ept id=\"p6\">](https://msdn.microsoft.com/library/windows/apps/dn652535)</ept>, by setting the <bpt id=\"p8\">[</bpt><bpt id=\"p9\">**</bpt>Source<ept id=\"p9\">**</ept><ept id=\"p8\">](https://msdn.microsoft.com/library/windows/apps/dn987010)</ept> property.","pos":[2539,2966],"source":"After creating a **MediaSource** you can play the source directly with a [**MediaElement**](https://msdn.microsoft.com/library/windows/apps/br242926), by calling [**SetPlaybackSource**](https://msdn.microsoft.com/library/windows/apps/dn899085), or with a [**MediaPlayer**](https://msdn.microsoft.com/library/windows/apps/dn652535), by setting the [**Source**](https://msdn.microsoft.com/library/windows/apps/dn987010) property."},{"content":"The following example shows how to play back a user-selected media file in a <bpt id=\"p1\">**</bpt>MediaElement<ept id=\"p1\">**</ept> using <bpt id=\"p2\">**</bpt>MediaSource<ept id=\"p2\">**</ept>.","pos":[2967,3083],"source":" The following example shows how to play back a user-selected media file in a **MediaElement** using **MediaSource**."},{"pos":[3085,3334],"content":"You will need to include the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>Windows.Media.Core<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn278962)</ept> and <bpt id=\"p3\">[</bpt><bpt id=\"p4\">**</bpt>Windows.Media.Playback<ept id=\"p4\">**</ept><ept id=\"p3\">](https://msdn.microsoft.com/library/windows/apps/dn640562)</ept> namespaces in order to complete this scenario.","source":"You will need to include the [**Windows.Media.Core**](https://msdn.microsoft.com/library/windows/apps/dn278962) and [**Windows.Media.Playback**](https://msdn.microsoft.com/library/windows/apps/dn640562) namespaces in order to complete this scenario."},{"pos":[3346,3351],"content":"Using"},{"content":"Declare a variable of type <bpt id=\"p1\">**</bpt>MediaSource<ept id=\"p1\">**</ept>.","pos":[3414,3457],"source":"Declare a variable of type **MediaSource**."},{"content":"For the examples in this article, the media source is declared as a class member so that it can be accessed from multiple locations.","pos":[3458,3590]},{"pos":[3602,3620],"content":"DeclareMediaSource"},{"content":"To allow the user to pick a media file to play, use a <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>FileOpenPicker<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br207847)</ept>.","pos":[3696,3829],"source":"To allow the user to pick a media file to play, use a [**FileOpenPicker**](https://msdn.microsoft.com/library/windows/apps/br207847)."},{"content":"With the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>StorageFile<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br227171)</ept> object returned from the picker's <bpt id=\"p3\">[</bpt><bpt id=\"p4\">**</bpt>PickSingleFileAsync<ept id=\"p4\">**</ept><ept id=\"p3\">](https://msdn.microsoft.com/library/windows/apps/jj635275)</ept> method, initialize a new MediaObject by calling <bpt id=\"p5\">[</bpt><bpt id=\"p6\">**</bpt>MediaSource.CreateFromStorageFile<ept id=\"p6\">**</ept><ept id=\"p5\">](https://msdn.microsoft.com/library/windows/apps/dn930909)</ept>.","pos":[3830,4179],"source":" With the [**StorageFile**](https://msdn.microsoft.com/library/windows/apps/br227171) object returned from the picker's [**PickSingleFileAsync**](https://msdn.microsoft.com/library/windows/apps/jj635275) method, initialize a new MediaObject by calling [**MediaSource.CreateFromStorageFile**](https://msdn.microsoft.com/library/windows/apps/dn930909)."},{"content":"Finally, set the media source as the playback source for the <bpt id=\"p1\">**</bpt>MediaElement<ept id=\"p1\">**</ept> by calling the <bpt id=\"p2\">[</bpt><bpt id=\"p3\">**</bpt>SetPlaybackSource<ept id=\"p3\">**</ept><ept id=\"p2\">](https://msdn.microsoft.com/library/windows/apps/dn899085)</ept> method.","pos":[4180,4362],"source":" Finally, set the media source as the playback source for the **MediaElement** by calling the [**SetPlaybackSource**](https://msdn.microsoft.com/library/windows/apps/dn899085) method."},{"pos":[4374,4389],"content":"PlayMediaSource"},{"content":"Handle multiple audio, video, and metadata tracks with MediaPlaybackItem","pos":[4465,4537]},{"content":"Using a <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>MediaSource<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn930905)</ept> for playback is convenient because it provides a common way to playback media from different kinds of sources, but more advanced behavior can be accessed by using a <bpt id=\"p3\">[</bpt><bpt id=\"p4\">**</bpt>MediaPlaybackItem<ept id=\"p4\">**</ept><ept id=\"p3\">](https://msdn.microsoft.com/library/windows/apps/dn930939)</ept>.","pos":[4539,4870],"source":"Using a [**MediaSource**](https://msdn.microsoft.com/library/windows/apps/dn930905) for playback is convenient because it provides a common way to playback media from different kinds of sources, but more advanced behavior can be accessed by using a [**MediaPlaybackItem**](https://msdn.microsoft.com/library/windows/apps/dn930939)."},{"content":"This includes the ability to access and manage multiple audio, video, and data tracks for a media item.","pos":[4871,4974]},{"pos":[4976,5031],"content":"Declare a variable to store your <bpt id=\"p1\">**</bpt>MediaPlaybackItem<ept id=\"p1\">**</ept>.","source":"Declare a variable to store your **MediaPlaybackItem**."},{"pos":[5043,5067],"content":"DeclareMediaPlaybackItem"},{"pos":[5149,5260],"content":"Create a <bpt id=\"p1\">**</bpt>MediaPlaybackItem<ept id=\"p1\">**</ept> by calling the constructor and passing in an initialized <bpt id=\"p2\">**</bpt>MediaSource<ept id=\"p2\">**</ept> object.","source":"Create a **MediaPlaybackItem** by calling the constructor and passing in an initialized **MediaSource** object."},{"pos":[5262,5648],"content":"If your app supports multiple audio, video, or data tracks in a media playback item, register event handlers for the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>AudioTracksChanged<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn930948)</ept>, <bpt id=\"p3\">[</bpt><bpt id=\"p4\">**</bpt>VideoTracksChanged<ept id=\"p4\">**</ept><ept id=\"p3\">](https://msdn.microsoft.com/library/windows/apps/dn930954)</ept>, or <bpt id=\"p5\">[</bpt><bpt id=\"p6\">**</bpt>TimedMetadataTracksChanged<ept id=\"p6\">**</ept><ept id=\"p5\">](https://msdn.microsoft.com/library/windows/apps/dn930952)</ept> events.","source":"If your app supports multiple audio, video, or data tracks in a media playback item, register event handlers for the [**AudioTracksChanged**](https://msdn.microsoft.com/library/windows/apps/dn930948), [**VideoTracksChanged**](https://msdn.microsoft.com/library/windows/apps/dn930954), or [**TimedMetadataTracksChanged**](https://msdn.microsoft.com/library/windows/apps/dn930952) events."},{"pos":[5650,5756],"content":"Finally, set the playback source of the <bpt id=\"p1\">**</bpt>MediaElement<ept id=\"p1\">**</ept> or <bpt id=\"p2\">**</bpt>MediaPlayer<ept id=\"p2\">**</ept> to your <bpt id=\"p3\">**</bpt>MediaPlaybackItem<ept id=\"p3\">**</ept>.","source":"Finally, set the playback source of the **MediaElement** or **MediaPlayer** to your **MediaPlaybackItem**."},{"pos":[5768,5789],"content":"PlayMediaPlaybackItem"},{"content":"Note","pos":[5870,5874]},{"content":"A <bpt id=\"p1\">**</bpt>MediaSource<ept id=\"p1\">**</ept> can only be associated with a single <bpt id=\"p2\">**</bpt>MediaPlaybackItem<ept id=\"p2\">**</ept>.","pos":[5879,5956],"source":"A **MediaSource** can only be associated with a single **MediaPlaybackItem**."},{"content":"After creating a <bpt id=\"p1\">**</bpt>MediaPlaybackItem<ept id=\"p1\">**</ept> from a source, attempting to create another playback item from the same source will result in an error.","pos":[5957,6099],"source":" After creating a **MediaPlaybackItem** from a source, attempting to create another playback item from the same source will result in an error."},{"content":"Also, after creating a <bpt id=\"p1\">**</bpt>MediaPlaybackItem<ept id=\"p1\">**</ept> from a media source, you can't set the <bpt id=\"p2\">**</bpt>MediaSource<ept id=\"p2\">**</ept> object directly as the source for a <bpt id=\"p3\">**</bpt>MediaElement<ept id=\"p3\">**</ept> or <bpt id=\"p4\">**</bpt>MediaPlayer<ept id=\"p4\">**</ept> but should instead use the <bpt id=\"p5\">**</bpt>MediaPlaybackItem<ept id=\"p5\">**</ept>.","pos":[6100,6321],"source":" Also, after creating a **MediaPlaybackItem** from a media source, you can't set the **MediaSource** object directly as the source for a **MediaElement** or **MediaPlayer** but should instead use the **MediaPlaybackItem**."},{"content":"The <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>VideoTracksChanged<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn930954)</ept> event is raised after a <bpt id=\"p3\">**</bpt>MediaPlaybackItem<ept id=\"p3\">**</ept> containing multiple video tracks is assigned as a playback source, and can be raised again if the list of video tracks changes for the item changes.","pos":[6323,6604],"source":"The [**VideoTracksChanged**](https://msdn.microsoft.com/library/windows/apps/dn930954) event is raised after a **MediaPlaybackItem** containing multiple video tracks is assigned as a playback source, and can be raised again if the list of video tracks changes for the item changes."},{"content":"The handler for this event gives you the opportunity to update your UI to allow the user to switch between available tracks.","pos":[6605,6729]},{"content":"This example uses a <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>ComboBox<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br209348)</ept> to display the available video tracks.","pos":[6730,6861],"source":" This example uses a [**ComboBox**](https://msdn.microsoft.com/library/windows/apps/br209348) to display the available video tracks."},{"pos":[6874,6887],"content":"VideoComboBox"},{"content":"In the <bpt id=\"p1\">**</bpt>VideoTracksChanged<ept id=\"p1\">**</ept> handler, loop through all of the tracks in the playback item's <bpt id=\"p2\">[</bpt><bpt id=\"p3\">**</bpt>VideoTracks<ept id=\"p3\">**</ept><ept id=\"p2\">](https://msdn.microsoft.com/library/windows/apps/dn930953)</ept> list.","pos":[6955,7129],"source":"In the **VideoTracksChanged** handler, loop through all of the tracks in the playback item's [**VideoTracks**](https://msdn.microsoft.com/library/windows/apps/dn930953) list."},{"content":"For each track, a new <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>ComboBoxItem<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br209349)</ept> is created.","pos":[7130,7240],"source":" For each track, a new [**ComboBoxItem**](https://msdn.microsoft.com/library/windows/apps/br209349) is created."},{"content":"If the track does not already have a label, a label is generated from the track index.","pos":[7241,7327]},{"content":"The <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>Tag<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br208745)</ept> property of the combo box item is set to the track index so that it can be identified later.","pos":[7328,7492],"source":" The [**Tag**](https://msdn.microsoft.com/library/windows/apps/br208745) property of the combo box item is set to the track index so that it can be identified later."},{"content":"Finally, the item is added to the combo box.","pos":[7493,7537]},{"content":"Note that these operations are performed within a <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>CoreDispatcher.RunAsync<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/hh750317)</ept> call because all UI changes must be made on the UI thread and this event is raised on a different thread.","pos":[7538,7781],"source":" Note that these operations are performed within a [**CoreDispatcher.RunAsync**](https://msdn.microsoft.com/library/windows/apps/hh750317) call because all UI changes must be made on the UI thread and this event is raised on a different thread."},{"pos":[7793,7811],"content":"VideoTracksChanged"},{"content":"In the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>SelectionChanged<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br209776)</ept> handler for the combo box, the track index is retrieved from the selected item's <bpt id=\"p3\">**</bpt>Tag<ept id=\"p3\">**</ept> property.","pos":[7887,8073],"source":"In the [**SelectionChanged**](https://msdn.microsoft.com/library/windows/apps/br209776) handler for the combo box, the track index is retrieved from the selected item's **Tag** property."},{"content":"Setting the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>SelectedIndex<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn956634)</ept> property of the media playback item's <bpt id=\"p3\">[</bpt><bpt id=\"p4\">**</bpt>VideoTracks<ept id=\"p4\">**</ept><ept id=\"p3\">](https://msdn.microsoft.com/library/windows/apps/dn930953)</ept> list causes the <bpt id=\"p5\">**</bpt>MediaElement<ept id=\"p5\">**</ept> or <bpt id=\"p6\">**</bpt>MediaPlayer<ept id=\"p6\">**</ept> to switch the active video track to the specified index.","pos":[8074,8386],"source":" Setting the [**SelectedIndex**](https://msdn.microsoft.com/library/windows/apps/dn956634) property of the media playback item's [**VideoTracks**](https://msdn.microsoft.com/library/windows/apps/dn930953) list causes the **MediaElement** or **MediaPlayer** to switch the active video track to the specified index."},{"pos":[8398,8425],"content":"VideoTracksSelectionChanged"},{"content":"Managing media items with multiple audio tracks works exactly the same as with video tracks.","pos":[8510,8602]},{"content":"Handle the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>AudioTracksChanged<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn930948)</ept> to update your UI with the audio tracks found in the playback item's <bpt id=\"p3\">[</bpt><bpt id=\"p4\">**</bpt>AudioTracks<ept id=\"p4\">**</ept><ept id=\"p3\">](https://msdn.microsoft.com/library/windows/apps/dn930947)</ept> list.","pos":[8603,8847],"source":" Handle the [**AudioTracksChanged**](https://msdn.microsoft.com/library/windows/apps/dn930948) to update your UI with the audio tracks found in the playback item's [**AudioTracks**](https://msdn.microsoft.com/library/windows/apps/dn930947) list."},{"content":"When the user selects an audio track, set the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>SelectedIndex<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn930937)</ept> property of the <bpt id=\"p3\">**</bpt>AudioTracks<ept id=\"p3\">**</ept> list to cause the <bpt id=\"p4\">**</bpt>MediaElement<ept id=\"p4\">**</ept> or <bpt id=\"p5\">**</bpt>MediaPlayer<ept id=\"p5\">**</ept> to switch the active audio track to the specified index.","pos":[8848,9114],"source":" When the user selects an audio track, set the [**SelectedIndex**](https://msdn.microsoft.com/library/windows/apps/dn930937) property of the **AudioTracks** list to cause the **MediaElement** or **MediaPlayer** to switch the active audio track to the specified index."},{"pos":[9127,9140],"content":"AudioComboBox"},{"pos":[9218,9236],"content":"AudioTracksChanged"},{"pos":[9322,9349],"content":"AudioTracksSelectionChanged"},{"content":"In addition to audio and video, a <bpt id=\"p1\">**</bpt>MediaPlaybackItem<ept id=\"p1\">**</ept> object may contain zero or more <bpt id=\"p2\">[</bpt><bpt id=\"p3\">**</bpt>TimedMetadataTrack<ept id=\"p3\">**</ept><ept id=\"p2\">](https://msdn.microsoft.com/library/windows/apps/dn956580)</ept> objects.","pos":[9434,9613],"source":"In addition to audio and video, a **MediaPlaybackItem** object may contain zero or more [**TimedMetadataTrack**](https://msdn.microsoft.com/library/windows/apps/dn956580) objects."},{"content":"A timed metadata track can contain subtitle or caption text, or it may contain custom data that is proprietary to your app.","pos":[9614,9737]},{"content":"A timed metadata track contains a list of cues represented by objects that inherit from <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>IMediaCue<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn930899)</ept>, such as a <bpt id=\"p3\">[</bpt><bpt id=\"p4\">**</bpt>DataCue<ept id=\"p4\">**</ept><ept id=\"p3\">](https://msdn.microsoft.com/library/windows/apps/dn930892)</ept> or a <bpt id=\"p5\">[</bpt><bpt id=\"p6\">**</bpt>TimedTextCue<ept id=\"p6\">**</ept><ept id=\"p5\">](https://msdn.microsoft.com/library/windows/apps/dn956655)</ept>.","pos":[9738,10065],"source":" A timed metadata track contains a list of cues represented by objects that inherit from [**IMediaCue**](https://msdn.microsoft.com/library/windows/apps/dn930899), such as a [**DataCue**](https://msdn.microsoft.com/library/windows/apps/dn930892) or a [**TimedTextCue**](https://msdn.microsoft.com/library/windows/apps/dn956655)."},{"content":"Each cue has a start time and a duration that determines when the cue is activated and for how long.","pos":[10066,10166]},{"content":"Similar to audio tracks and video tracks, the timed metadata tracks for a media item can be discovered by handling the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>TimedMetadataTracksChanged<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn930952)</ept> event of a <bpt id=\"p3\">**</bpt>MediaPlaybackItem<ept id=\"p3\">**</ept>.","pos":[10168,10411],"source":"Similar to audio tracks and video tracks, the timed metadata tracks for a media item can be discovered by handling the [**TimedMetadataTracksChanged**](https://msdn.microsoft.com/library/windows/apps/dn930952) event of a **MediaPlaybackItem**."},{"content":"With timed metadata tracks, however, the user may want to enable more than one metadata track at a time.","pos":[10412,10516]},{"content":"Also, depending on your app scenario, you may want to enable or disable metadata tracks automatically, without user intervention.","pos":[10517,10646]},{"content":"For illustration purposes, this example adds a <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>ToggleButton<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br209795)</ept> for each metadata track in a media item to allow the user to enable and disable the track.","pos":[10647,10861],"source":" For illustration purposes, this example adds a [**ToggleButton**](https://msdn.microsoft.com/library/windows/apps/br209795) for each metadata track in a media item to allow the user to enable and disable the track."},{"content":"The <bpt id=\"p1\">**</bpt>Tag<ept id=\"p1\">**</ept> property of each button is set to the index of the associated metadata track so that it can be identified when the button is toggled.","pos":[10862,11007],"source":" The **Tag** property of each button is set to the index of the associated metadata track so that it can be identified when the button is toggled."},{"pos":[11020,11034],"content":"MetaStackPanel"},{"pos":[11113,11139],"content":"TimedMetadataTrackschanged"},{"content":"Because more than one metadata track can be active at a time, you don't simply set the active index for the metadata track list.","pos":[11223,11351]},{"content":"Instead, call the <bpt id=\"p1\">**</bpt>MediaPlaybackItem<ept id=\"p1\">**</ept> object's <bpt id=\"p2\">[</bpt><bpt id=\"p3\">**</bpt>SetPresentationMode<ept id=\"p3\">**</ept><ept id=\"p2\">](https://msdn.microsoft.com/library/windows/apps/dn986977)</ept> method, passing in the index of the track you want to toggle, and then providing a value from the <bpt id=\"p4\">[</bpt><bpt id=\"p5\">**</bpt>TimedMetadataTrackPresentationMode<ept id=\"p5\">**</ept><ept id=\"p4\">](https://msdn.microsoft.com/library/windows/apps/dn987016)</ept> enumeration.","pos":[11352,11694],"source":" Instead, call the **MediaPlaybackItem** object's [**SetPresentationMode**](https://msdn.microsoft.com/library/windows/apps/dn986977) method, passing in the index of the track you want to toggle, and then providing a value from the [**TimedMetadataTrackPresentationMode**](https://msdn.microsoft.com/library/windows/apps/dn987016) enumeration."},{"content":"The presentation mode you choose depends on the implementation of your app.","pos":[11695,11770]},{"content":"In this example, the metadata track is set to <bpt id=\"p1\">**</bpt>PlatformPresented<ept id=\"p1\">**</ept> when enabled.","pos":[11771,11852],"source":" In this example, the metadata track is set to **PlatformPresented** when enabled."},{"content":"For text-based tracks, this means that the system will automatically display the text cues in the track.","pos":[11853,11957]},{"content":"When the toggle button is toggled off, the presentation mode is set to <bpt id=\"p1\">**</bpt>Disabled<ept id=\"p1\">**</ept>, which means that no text is displayed and no cue events are raised.","pos":[11958,12110],"source":" When the toggle button is toggled off, the presentation mode is set to **Disabled**, which means that no text is displayed and no cue events are raised."},{"content":"Cue events are discussed later in this article.","pos":[12111,12158]},{"pos":[12170,12183],"content":"ToggleChecked"},{"pos":[12264,12279],"content":"ToggleUnchecked"},{"content":"Add external timed text with TimedTextSource","pos":[12355,12399]},{"content":"For some scenarios, you may have external files that contains timed text associated with a media item, such as separate files that contain subtitles for different locales.","pos":[12401,12572]},{"content":"Use the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>TimedTextSource<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn956679)</ept> class to load in external timed text files from a stream or URI.","pos":[12573,12725],"source":" Use the [**TimedTextSource**](https://msdn.microsoft.com/library/windows/apps/dn956679) class to load in external timed text files from a stream or URI."},{"pos":[12727,12974],"content":"This example uses a <bpt id=\"p1\">**</bpt>Dictionary<ept id=\"p1\">**</ept> collection to store a list of the timed text sources for the media item using the source URI and the <bpt id=\"p2\">**</bpt>TimedTextSource<ept id=\"p2\">**</ept> object as the key/value pair in order to identify the tracks after they have been resolved.","source":"This example uses a **Dictionary** collection to store a list of the timed text sources for the media item using the source URI and the **TimedTextSource** object as the key/value pair in order to identify the tracks after they have been resolved."},{"pos":[12986,13004],"content":"TimedTextSourceMap"},{"content":"Create a new <bpt id=\"p1\">**</bpt>TimedTextSource<ept id=\"p1\">**</ept> for each external timed text file by calling <bpt id=\"p2\">[</bpt><bpt id=\"p3\">**</bpt>CreateFromUri<ept id=\"p3\">**</ept><ept id=\"p2\">](https://msdn.microsoft.com/library/windows/apps/dn708190)</ept>.","pos":[13080,13236],"source":"Create a new **TimedTextSource** for each external timed text file by calling [**CreateFromUri**](https://msdn.microsoft.com/library/windows/apps/dn708190)."},{"content":"Add an entry to the <bpt id=\"p1\">**</bpt>Dictionary<ept id=\"p1\">**</ept> for the timed text source.","pos":[13237,13298],"source":" Add an entry to the **Dictionary** for the timed text source."},{"content":"Add a handler for the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>TimedTextSource.Resolved<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn965540)</ept> event to handle if the item failed to load or to set additional properties after the item was loaded successfully.","pos":[13299,13524],"source":" Add a handler for the [**TimedTextSource.Resolved**](https://msdn.microsoft.com/library/windows/apps/dn965540) event to handle if the item failed to load or to set additional properties after the item was loaded successfully."},{"content":"Register all of your <bpt id=\"p1\">**</bpt>TimedTextSource<ept id=\"p1\">**</ept> objects with the <bpt id=\"p2\">**</bpt>MediaSource<ept id=\"p2\">**</ept> by adding them to the <bpt id=\"p3\">[</bpt><bpt id=\"p4\">**</bpt>ExternalTimedTextSources<ept id=\"p4\">**</ept><ept id=\"p3\">](https://msdn.microsoft.com/library/windows/apps/dn930916)</ept> collection.","pos":[13526,13722],"source":"Register all of your **TimedTextSource** objects with the **MediaSource** by adding them to the [**ExternalTimedTextSources**](https://msdn.microsoft.com/library/windows/apps/dn930916) collection."},{"content":"Note that external timed text sources are added to directly the <bpt id=\"p1\">**</bpt>MediaSource<ept id=\"p1\">**</ept> and not the <bpt id=\"p2\">**</bpt>MediaPlaybackItem<ept id=\"p2\">**</ept> created from the source.","pos":[13723,13861],"source":" Note that external timed text sources are added to directly the **MediaSource** and not the **MediaPlaybackItem** created from the source."},{"content":"To update your UI to reflect the external text tracks, register and handle the <bpt id=\"p1\">**</bpt>TimedMetadataTracksChanged<ept id=\"p1\">**</ept> event as described previously in this article.","pos":[13862,14018],"source":" To update your UI to reflect the external text tracks, register and handle the **TimedMetadataTracksChanged** event as described previously in this article."},{"pos":[14030,14045],"content":"TimedTextSource"},{"content":"In the handler for the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>TimedTextSource.Resolved<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn965540)</ept> event, check the <bpt id=\"p3\">**</bpt>Error<ept id=\"p3\">**</ept> property of the <bpt id=\"p4\">[</bpt><bpt id=\"p5\">**</bpt>TimedTextSourceResolveResultEventArgs<ept id=\"p5\">**</ept><ept id=\"p4\">](https://msdn.microsoft.com/library/windows/apps/dn965537)</ept> passed into the handler to determine if an error occurred while trying to load the timed text data.","pos":[14118,14474],"source":"In the handler for the [**TimedTextSource.Resolved**](https://msdn.microsoft.com/library/windows/apps/dn965540) event, check the **Error** property of the [**TimedTextSourceResolveResultEventArgs**](https://msdn.microsoft.com/library/windows/apps/dn965537) passed into the handler to determine if an error occurred while trying to load the timed text data."},{"content":"If the item was resolved successfully, you can use this handler to update additional properties of the resolved track.","pos":[14475,14593]},{"content":"This example adds a label for each track based on the URI previously stored in the <bpt id=\"p1\">**</bpt>Dictionary<ept id=\"p1\">**</ept>.","pos":[14594,14692],"source":" This example adds a label for each track based on the URI previously stored in the **Dictionary**."},{"pos":[14704,14727],"content":"TimedTextSourceResolved"},{"content":"Add additional metadata tracks","pos":[14811,14841]},{"content":"You can dynamically create custom metadata tracks in code and associate them with a media source.","pos":[14843,14940]},{"content":"The tracks you create can contain subtitle or caption text, or they can contain your proprietary app data.","pos":[14941,15047]},{"content":"Create a new <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>TimedMetadataTrack<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn956580)</ept> by calling the constructor and specifying an ID, the language identifier, and a value from the <bpt id=\"p3\">[</bpt><bpt id=\"p4\">**</bpt>TimedMetadataKind<ept id=\"p4\">**</ept><ept id=\"p3\">](https://msdn.microsoft.com/library/windows/apps/dn956578)</ept> enumeration.","pos":[15049,15334],"source":"Create a new [**TimedMetadataTrack**](https://msdn.microsoft.com/library/windows/apps/dn956580) by calling the constructor and specifying an ID, the language identifier, and a value from the [**TimedMetadataKind**](https://msdn.microsoft.com/library/windows/apps/dn956578) enumeration."},{"content":"Register handlers for the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>CueEntered<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn956583)</ept> and <bpt id=\"p3\">[</bpt><bpt id=\"p4\">**</bpt>CueExited<ept id=\"p4\">**</ept><ept id=\"p3\">](https://msdn.microsoft.com/library/windows/apps/dn956584)</ept> events.","pos":[15335,15521],"source":" Register handlers for the [**CueEntered**](https://msdn.microsoft.com/library/windows/apps/dn956583) and [**CueExited**](https://msdn.microsoft.com/library/windows/apps/dn956584) events."},{"content":"These events are raised when the start time for a cue has been reached and when the duration for a cue has expired, respectively.","pos":[15522,15651]},{"content":"Create a new cue object, appropriate for the type of metadata track you created, and set the ID, start time, and duration for the track.","pos":[15653,15789]},{"content":"This example creates a data track, so a set of <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>DataCue<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn930892)</ept> objects are generated and a buffer containing app-specific data is provided for each cue.","pos":[15790,15998],"source":" This example creates a data track, so a set of [**DataCue**](https://msdn.microsoft.com/library/windows/apps/dn930892) objects are generated and a buffer containing app-specific data is provided for each cue."},{"content":"To register the new track, add it to the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>ExternalTimedMetadataTracks<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn930915)</ept> collection of the <bpt id=\"p3\">**</bpt>MediaSource<ept id=\"p3\">**</ept> object.","pos":[15999,16173],"source":" To register the new track, add it to the [**ExternalTimedMetadataTracks**](https://msdn.microsoft.com/library/windows/apps/dn930915) collection of the **MediaSource** object."},{"pos":[16185,16197],"content":"AddDataTrack"},{"content":"The <bpt id=\"p1\">**</bpt>CueEntered<ept id=\"p1\">**</ept> event is raised when a cue's start time has been reached as long as the associated track has a presentation mode of <bpt id=\"p2\">**</bpt>ApplicationPresented<ept id=\"p2\">**</ept>, <bpt id=\"p3\">**</bpt>Hidden<ept id=\"p3\">**</ept>, or <bpt id=\"p4\">**</bpt>PlatformPresented.<ept id=\"p4\">**</ept>","pos":[16267,16465],"source":"The **CueEntered** event is raised when a cue's start time has been reached as long as the associated track has a presentation mode of **ApplicationPresented**, **Hidden**, or **PlatformPresented.**"},{"content":"Cue events are not raised for metadata tracks while the presentation mode for the track is <bpt id=\"p1\">**</bpt>Disabled<ept id=\"p1\">**</ept>.","pos":[16466,16570],"source":" Cue events are not raised for metadata tracks while the presentation mode for the track is **Disabled**."},{"content":"This example simply outputs the custom data associated with the cue to the debug window.","pos":[16571,16659]},{"pos":[16671,16685],"content":"DataCueEntered"},{"pos":[16757,16983],"content":"This example adds a custom text track by specifying <bpt id=\"p1\">**</bpt>TimedMetadataKind.Caption<ept id=\"p1\">**</ept> when creating the track and using <bpt id=\"p2\">[</bpt><bpt id=\"p3\">**</bpt>TimedTextCue<ept id=\"p3\">**</ept><ept id=\"p2\">](https://msdn.microsoft.com/library/windows/apps/dn956655)</ept> objects to add cues to the track.","source":"This example adds a custom text track by specifying **TimedMetadataKind.Caption** when creating the track and using [**TimedTextCue**](https://msdn.microsoft.com/library/windows/apps/dn956655) objects to add cues to the track."},{"pos":[16995,17007],"content":"AddTextTrack"},{"pos":[17087,17101],"content":"TextCueEntered"},{"content":"Play a list of media items with MediaPlaybackList","pos":[17176,17225]},{"pos":[17227,17416],"content":"The <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>MediaPlaybackList<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn930955)</ept> allows you to create a playlist of media items, which are represented by <bpt id=\"p3\">**</bpt>MediaPlaybackItem<ept id=\"p3\">**</ept> objects.","source":"The [**MediaPlaybackList**](https://msdn.microsoft.com/library/windows/apps/dn930955) allows you to create a playlist of media items, which are represented by **MediaPlaybackItem** objects."},{"content":"<bpt id=\"p1\">**</bpt>Note<ept id=\"p1\">**</ept>  Items in a <bpt id=\"p2\">[</bpt><bpt id=\"p3\">**</bpt>MediaPlaybackList<ept id=\"p3\">**</ept><ept id=\"p2\">](https://msdn.microsoft.com/library/windows/apps/dn930955)</ept> are rendered using gapless playback.","pos":[17418,17557],"source":"**Note**  Items in a [**MediaPlaybackList**](https://msdn.microsoft.com/library/windows/apps/dn930955) are rendered using gapless playback."},{"content":"The system will use provided metadata in MP3 or AAC encoded files to determine the delay or padding compensation needed for gapless playback.","pos":[17558,17699]},{"content":"If the MP3 or AAC encoded files don't provide this metadata, then the system determines the delay or padding heuristically.","pos":[17700,17823]},{"content":"For lossless formats, such as PCM, FLAC, or ALAC, the system takes no action because these encoders don't introduce delay or padding.","pos":[17824,17957]},{"pos":[17959,18030],"content":"To get started, declare a variable to store your <bpt id=\"p1\">**</bpt>MediaPlaybackList<ept id=\"p1\">**</ept>.","source":"To get started, declare a variable to store your **MediaPlaybackList**."},{"pos":[18042,18066],"content":"DeclareMediaPlaybackList"},{"content":"Create a <bpt id=\"p1\">**</bpt>MediaPlaybackItem<ept id=\"p1\">**</ept> for each media item you want to add to your list using the same procedure described previously in this article.","pos":[18148,18290],"source":"Create a **MediaPlaybackItem** for each media item you want to add to your list using the same procedure described previously in this article."},{"content":"Initialize your <bpt id=\"p1\">**</bpt>MediaPlaybackList<ept id=\"p1\">**</ept> object and add the media playback items to it.","pos":[18291,18375],"source":" Initialize your **MediaPlaybackList** object and add the media playback items to it."},{"content":"Register a handler for the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>CurrentItemChanged<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn930957)</ept> event.","pos":[18376,18492],"source":" Register a handler for the [**CurrentItemChanged**](https://msdn.microsoft.com/library/windows/apps/dn930957) event."},{"content":"This event allows you to update your UI to reflect the currently playing media item.","pos":[18493,18577]},{"content":"Finally, set the playback source of the <bpt id=\"p1\">**</bpt>MediaElement<ept id=\"p1\">**</ept> or <bpt id=\"p2\">**</bpt>MediaPlayer<ept id=\"p2\">**</ept> to your <bpt id=\"p3\">**</bpt>MediaPlaybackList<ept id=\"p3\">**</ept>.","pos":[18578,18684],"source":" Finally, set the playback source of the **MediaElement** or **MediaPlayer** to your **MediaPlaybackList**."},{"pos":[18696,18717],"content":"PlayMediaPlaybackList"},{"content":"In the <bpt id=\"p1\">**</bpt>CurrentItemChanged<ept id=\"p1\">**</ept> event handler, update your UI to reflect the currently playing item, which can be retrieved using the <bpt id=\"p2\">[</bpt><bpt id=\"p3\">**</bpt>NewItem<ept id=\"p3\">**</ept><ept id=\"p2\">](https://msdn.microsoft.com/library/windows/apps/dn930930)</ept> property of the <bpt id=\"p4\">[</bpt><bpt id=\"p5\">**</bpt>CurrentMediaPlaybackItemChangedEventArgs<ept id=\"p5\">**</ept><ept id=\"p4\">](https://msdn.microsoft.com/library/windows/apps/dn930929)</ept> object passed into the event.","pos":[18796,19150],"source":"In the **CurrentItemChanged** event handler, update your UI to reflect the currently playing item, which can be retrieved using the [**NewItem**](https://msdn.microsoft.com/library/windows/apps/dn930930) property of the [**CurrentMediaPlaybackItemChangedEventArgs**](https://msdn.microsoft.com/library/windows/apps/dn930929) object passed into the event."},{"content":"Remember that if you update the UI from this event, you should do so within a call to <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>CoreDispatcher.RunAsync<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/hh750317)</ept> so that the updates are made on the UI thread.","pos":[19151,19371],"source":" Remember that if you update the UI from this event, you should do so within a call to [**CoreDispatcher.RunAsync**](https://msdn.microsoft.com/library/windows/apps/hh750317) so that the updates are made on the UI thread."},{"pos":[19383,19411],"content":"MediaPlaybackListItemChanged"},{"pos":[19497,19745],"content":"Call <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>MovePrevious<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/mt146455)</ept> or <bpt id=\"p3\">[</bpt><bpt id=\"p4\">**</bpt>MoveNext<ept id=\"p4\">**</ept><ept id=\"p3\">](https://msdn.microsoft.com/library/windows/apps/mt146454)</ept> to cause the media player to play the previous or next item in your <bpt id=\"p5\">**</bpt>MediaPlaybackList<ept id=\"p5\">**</ept>.","source":"Call [**MovePrevious**](https://msdn.microsoft.com/library/windows/apps/mt146455) or [**MoveNext**](https://msdn.microsoft.com/library/windows/apps/mt146454) to cause the media player to play the previous or next item in your **MediaPlaybackList**."},{"pos":[19757,19767],"content":"PrevButton"},{"pos":[19845,19855],"content":"NextButton"},{"pos":[19923,20106],"content":"Set the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>ShuffleEnabled<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/mt146457)</ept> property to specify whether the media player should play the items in your list in random order.","source":"Set the [**ShuffleEnabled**](https://msdn.microsoft.com/library/windows/apps/mt146457) property to specify whether the media player should play the items in your list in random order."},{"pos":[20118,20131],"content":"ShuffleButton"},{"pos":[20202,20371],"content":"Set the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>AutoRepeatEnabled<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/mt146452)</ept> property to specify whether the media player should loop playback of your list.","source":"Set the [**AutoRepeatEnabled**](https://msdn.microsoft.com/library/windows/apps/mt146452) property to specify whether the media player should loop playback of your list."},{"pos":[20383,20395],"content":"RepeatButton"}],"content":"---\nms.assetid: C5623861-6280-4352-8F22-80EB009D662C\ndescription: The MediaSource class provides a common way to reference and play back media from different sources such as local or remote files and exposes a common model for accessing media data, regardless of the underlying media format.\ntitle: Media playback with MediaSource\n---\n\n# Media playback with MediaSource\n\n\\[ Updated for UWP apps on Windows 10. For Windows 8.x articles, see the [archive](http://go.microsoft.com/fwlink/p/?linkid=619132) \\]\n\n\n\\[Some information relates to pre-released product which may be substantially modified before it's commercially released. Microsoft makes no warranties, express or implied, with respect to the information provided here.\\]\n\nThe [**MediaSource**](https://msdn.microsoft.com/library/windows/apps/dn930905) class provides a common way to reference and play back media from different sources such as local or remote files and exposes a common model for accessing media data, regardless of the underlying media format. The [**MediaPlaybackItem**](https://msdn.microsoft.com/library/windows/apps/dn930939) class extends the functionality of **MediaSource**, allowing you to manage and select from multiple audio, video, and metadata tracks contained in a media item. [**MediaPlaybackList**](https://msdn.microsoft.com/library/windows/apps/dn930955) allows you to create playback lists from one or more media playback items.\n\nThe code in this article was adapted from the [Video Playback SDK](http://go.microsoft.com/fwlink/p/?LinkId=620020&clcid=0x409) sample. You can download this sample to see the code used in context or to use as a starting point for your own app.\n\n## Create and play a MediaSource\n\nCreate a new instance of **MediaSource** by calling one of the factory methods exposed by the class:\n\n-   [**CreateFromAdaptiveMediaSource**](https://msdn.microsoft.com/library/windows/apps/dn930906)\n-   [**CreateFromIMediaSource**](https://msdn.microsoft.com/library/windows/apps/dn965527)\n-   [**CreateFromMediaStreamSource**](https://msdn.microsoft.com/library/windows/apps/dn930907)\n-   [**CreateFromMseStreamSource**](https://msdn.microsoft.com/library/windows/apps/dn930908)\n-   [**CreateFromStorageFile**](https://msdn.microsoft.com/library/windows/apps/dn930909)\n-   [**CreateFromStream**](https://msdn.microsoft.com/library/windows/apps/dn930910)\n-   [**CreateFromStreamReference**](https://msdn.microsoft.com/library/windows/apps/dn930911)\n-   [**CreateFromUri**](https://msdn.microsoft.com/library/windows/apps/dn930912)\n\nAfter creating a **MediaSource** you can play the source directly with a [**MediaElement**](https://msdn.microsoft.com/library/windows/apps/br242926), by calling [**SetPlaybackSource**](https://msdn.microsoft.com/library/windows/apps/dn899085), or with a [**MediaPlayer**](https://msdn.microsoft.com/library/windows/apps/dn652535), by setting the [**Source**](https://msdn.microsoft.com/library/windows/apps/dn987010) property. The following example shows how to play back a user-selected media file in a **MediaElement** using **MediaSource**.\n\nYou will need to include the [**Windows.Media.Core**](https://msdn.microsoft.com/library/windows/apps/dn278962) and [**Windows.Media.Playback**](https://msdn.microsoft.com/library/windows/apps/dn640562) namespaces in order to complete this scenario.\n\n[!code-cs[Using](./code/MediaSource_Win10/cs/MainPage.xaml.cs#SnippetUsing)]\n\nDeclare a variable of type **MediaSource**. For the examples in this article, the media source is declared as a class member so that it can be accessed from multiple locations.\n\n[!code-cs[DeclareMediaSource](./code/MediaSource_Win10/cs/MainPage.xaml.cs#SnippetDeclareMediaSource)]\n\nTo allow the user to pick a media file to play, use a [**FileOpenPicker**](https://msdn.microsoft.com/library/windows/apps/br207847). With the [**StorageFile**](https://msdn.microsoft.com/library/windows/apps/br227171) object returned from the picker's [**PickSingleFileAsync**](https://msdn.microsoft.com/library/windows/apps/jj635275) method, initialize a new MediaObject by calling [**MediaSource.CreateFromStorageFile**](https://msdn.microsoft.com/library/windows/apps/dn930909). Finally, set the media source as the playback source for the **MediaElement** by calling the [**SetPlaybackSource**](https://msdn.microsoft.com/library/windows/apps/dn899085) method.\n\n[!code-cs[PlayMediaSource](./code/MediaSource_Win10/cs/MainPage.xaml.cs#SnippetPlayMediaSource)]\n\n## Handle multiple audio, video, and metadata tracks with MediaPlaybackItem\n\nUsing a [**MediaSource**](https://msdn.microsoft.com/library/windows/apps/dn930905) for playback is convenient because it provides a common way to playback media from different kinds of sources, but more advanced behavior can be accessed by using a [**MediaPlaybackItem**](https://msdn.microsoft.com/library/windows/apps/dn930939). This includes the ability to access and manage multiple audio, video, and data tracks for a media item.\n\nDeclare a variable to store your **MediaPlaybackItem**.\n\n[!code-cs[DeclareMediaPlaybackItem](./code/MediaSource_Win10/cs/MainPage.xaml.cs#SnippetDeclareMediaPlaybackItem)]\n\nCreate a **MediaPlaybackItem** by calling the constructor and passing in an initialized **MediaSource** object.\n\nIf your app supports multiple audio, video, or data tracks in a media playback item, register event handlers for the [**AudioTracksChanged**](https://msdn.microsoft.com/library/windows/apps/dn930948), [**VideoTracksChanged**](https://msdn.microsoft.com/library/windows/apps/dn930954), or [**TimedMetadataTracksChanged**](https://msdn.microsoft.com/library/windows/apps/dn930952) events.\n\nFinally, set the playback source of the **MediaElement** or **MediaPlayer** to your **MediaPlaybackItem**.\n\n[!code-cs[PlayMediaPlaybackItem](./code/MediaSource_Win10/cs/MainPage.xaml.cs#SnippetPlayMediaPlaybackItem)]\n\n**Note**  \nA **MediaSource** can only be associated with a single **MediaPlaybackItem**. After creating a **MediaPlaybackItem** from a source, attempting to create another playback item from the same source will result in an error. Also, after creating a **MediaPlaybackItem** from a media source, you can't set the **MediaSource** object directly as the source for a **MediaElement** or **MediaPlayer** but should instead use the **MediaPlaybackItem**.\n\nThe [**VideoTracksChanged**](https://msdn.microsoft.com/library/windows/apps/dn930954) event is raised after a **MediaPlaybackItem** containing multiple video tracks is assigned as a playback source, and can be raised again if the list of video tracks changes for the item changes. The handler for this event gives you the opportunity to update your UI to allow the user to switch between available tracks. This example uses a [**ComboBox**](https://msdn.microsoft.com/library/windows/apps/br209348) to display the available video tracks.\n\n[!code-xml[VideoComboBox](./code/MediaSource_Win10/cs/MainPage.xaml#SnippetVideoComboBox)]\n\nIn the **VideoTracksChanged** handler, loop through all of the tracks in the playback item's [**VideoTracks**](https://msdn.microsoft.com/library/windows/apps/dn930953) list. For each track, a new [**ComboBoxItem**](https://msdn.microsoft.com/library/windows/apps/br209349) is created. If the track does not already have a label, a label is generated from the track index. The [**Tag**](https://msdn.microsoft.com/library/windows/apps/br208745) property of the combo box item is set to the track index so that it can be identified later. Finally, the item is added to the combo box. Note that these operations are performed within a [**CoreDispatcher.RunAsync**](https://msdn.microsoft.com/library/windows/apps/hh750317) call because all UI changes must be made on the UI thread and this event is raised on a different thread.\n\n[!code-cs[VideoTracksChanged](./code/MediaSource_Win10/cs/MainPage.xaml.cs#SnippetVideoTracksChanged)]\n\nIn the [**SelectionChanged**](https://msdn.microsoft.com/library/windows/apps/br209776) handler for the combo box, the track index is retrieved from the selected item's **Tag** property. Setting the [**SelectedIndex**](https://msdn.microsoft.com/library/windows/apps/dn956634) property of the media playback item's [**VideoTracks**](https://msdn.microsoft.com/library/windows/apps/dn930953) list causes the **MediaElement** or **MediaPlayer** to switch the active video track to the specified index.\n\n[!code-cs[VideoTracksSelectionChanged](./code/MediaSource_Win10/cs/MainPage.xaml.cs#SnippetVideoTracksSelectionChanged)]\n\nManaging media items with multiple audio tracks works exactly the same as with video tracks. Handle the [**AudioTracksChanged**](https://msdn.microsoft.com/library/windows/apps/dn930948) to update your UI with the audio tracks found in the playback item's [**AudioTracks**](https://msdn.microsoft.com/library/windows/apps/dn930947) list. When the user selects an audio track, set the [**SelectedIndex**](https://msdn.microsoft.com/library/windows/apps/dn930937) property of the **AudioTracks** list to cause the **MediaElement** or **MediaPlayer** to switch the active audio track to the specified index.\n\n[!code-xml[AudioComboBox](./code/MediaSource_Win10/cs/MainPage.xaml#SnippetAudioComboBox)]\n\n[!code-cs[AudioTracksChanged](./code/MediaSource_Win10/cs/MainPage.xaml.cs#SnippetAudioTracksChanged)]\n\n[!code-cs[AudioTracksSelectionChanged](./code/MediaSource_Win10/cs/MainPage.xaml.cs#SnippetAudioTracksSelectionChanged)]\n\nIn addition to audio and video, a **MediaPlaybackItem** object may contain zero or more [**TimedMetadataTrack**](https://msdn.microsoft.com/library/windows/apps/dn956580) objects. A timed metadata track can contain subtitle or caption text, or it may contain custom data that is proprietary to your app. A timed metadata track contains a list of cues represented by objects that inherit from [**IMediaCue**](https://msdn.microsoft.com/library/windows/apps/dn930899), such as a [**DataCue**](https://msdn.microsoft.com/library/windows/apps/dn930892) or a [**TimedTextCue**](https://msdn.microsoft.com/library/windows/apps/dn956655). Each cue has a start time and a duration that determines when the cue is activated and for how long.\n\nSimilar to audio tracks and video tracks, the timed metadata tracks for a media item can be discovered by handling the [**TimedMetadataTracksChanged**](https://msdn.microsoft.com/library/windows/apps/dn930952) event of a **MediaPlaybackItem**. With timed metadata tracks, however, the user may want to enable more than one metadata track at a time. Also, depending on your app scenario, you may want to enable or disable metadata tracks automatically, without user intervention. For illustration purposes, this example adds a [**ToggleButton**](https://msdn.microsoft.com/library/windows/apps/br209795) for each metadata track in a media item to allow the user to enable and disable the track. The **Tag** property of each button is set to the index of the associated metadata track so that it can be identified when the button is toggled.\n\n[!code-xml[MetaStackPanel](./code/MediaSource_Win10/cs/MainPage.xaml#SnippetMetaStackPanel)]\n\n[!code-cs[TimedMetadataTrackschanged](./code/MediaSource_Win10/cs/MainPage.xaml.cs#SnippetTimedMetadataTrackschanged)]\n\nBecause more than one metadata track can be active at a time, you don't simply set the active index for the metadata track list. Instead, call the **MediaPlaybackItem** object's [**SetPresentationMode**](https://msdn.microsoft.com/library/windows/apps/dn986977) method, passing in the index of the track you want to toggle, and then providing a value from the [**TimedMetadataTrackPresentationMode**](https://msdn.microsoft.com/library/windows/apps/dn987016) enumeration. The presentation mode you choose depends on the implementation of your app. In this example, the metadata track is set to **PlatformPresented** when enabled. For text-based tracks, this means that the system will automatically display the text cues in the track. When the toggle button is toggled off, the presentation mode is set to **Disabled**, which means that no text is displayed and no cue events are raised. Cue events are discussed later in this article.\n\n[!code-cs[ToggleChecked](./code/MediaSource_Win10/cs/MainPage.xaml.cs#SnippetToggleChecked)]\n\n[!code-cs[ToggleUnchecked](./code/MediaSource_Win10/cs/MainPage.xaml.cs#SnippetToggleUnchecked)]\n\n## Add external timed text with TimedTextSource\n\nFor some scenarios, you may have external files that contains timed text associated with a media item, such as separate files that contain subtitles for different locales. Use the [**TimedTextSource**](https://msdn.microsoft.com/library/windows/apps/dn956679) class to load in external timed text files from a stream or URI.\n\nThis example uses a **Dictionary** collection to store a list of the timed text sources for the media item using the source URI and the **TimedTextSource** object as the key/value pair in order to identify the tracks after they have been resolved.\n\n[!code-cs[TimedTextSourceMap](./code/MediaSource_Win10/cs/MainPage.xaml.cs#SnippetTimedTextSourceMap)]\n\nCreate a new **TimedTextSource** for each external timed text file by calling [**CreateFromUri**](https://msdn.microsoft.com/library/windows/apps/dn708190). Add an entry to the **Dictionary** for the timed text source. Add a handler for the [**TimedTextSource.Resolved**](https://msdn.microsoft.com/library/windows/apps/dn965540) event to handle if the item failed to load or to set additional properties after the item was loaded successfully.\n\nRegister all of your **TimedTextSource** objects with the **MediaSource** by adding them to the [**ExternalTimedTextSources**](https://msdn.microsoft.com/library/windows/apps/dn930916) collection. Note that external timed text sources are added to directly the **MediaSource** and not the **MediaPlaybackItem** created from the source. To update your UI to reflect the external text tracks, register and handle the **TimedMetadataTracksChanged** event as described previously in this article.\n\n[!code-cs[TimedTextSource](./code/MediaSource_Win10/cs/MainPage.xaml.cs#SnippetTimedTextSource)]\n\nIn the handler for the [**TimedTextSource.Resolved**](https://msdn.microsoft.com/library/windows/apps/dn965540) event, check the **Error** property of the [**TimedTextSourceResolveResultEventArgs**](https://msdn.microsoft.com/library/windows/apps/dn965537) passed into the handler to determine if an error occurred while trying to load the timed text data. If the item was resolved successfully, you can use this handler to update additional properties of the resolved track. This example adds a label for each track based on the URI previously stored in the **Dictionary**.\n\n[!code-cs[TimedTextSourceResolved](./code/MediaSource_Win10/cs/MainPage.xaml.cs#SnippetTimedTextSourceResolved)]\n\n## Add additional metadata tracks\n\nYou can dynamically create custom metadata tracks in code and associate them with a media source. The tracks you create can contain subtitle or caption text, or they can contain your proprietary app data.\n\nCreate a new [**TimedMetadataTrack**](https://msdn.microsoft.com/library/windows/apps/dn956580) by calling the constructor and specifying an ID, the language identifier, and a value from the [**TimedMetadataKind**](https://msdn.microsoft.com/library/windows/apps/dn956578) enumeration. Register handlers for the [**CueEntered**](https://msdn.microsoft.com/library/windows/apps/dn956583) and [**CueExited**](https://msdn.microsoft.com/library/windows/apps/dn956584) events. These events are raised when the start time for a cue has been reached and when the duration for a cue has expired, respectively.\n\nCreate a new cue object, appropriate for the type of metadata track you created, and set the ID, start time, and duration for the track. This example creates a data track, so a set of [**DataCue**](https://msdn.microsoft.com/library/windows/apps/dn930892) objects are generated and a buffer containing app-specific data is provided for each cue. To register the new track, add it to the [**ExternalTimedMetadataTracks**](https://msdn.microsoft.com/library/windows/apps/dn930915) collection of the **MediaSource** object.\n\n[!code-cs[AddDataTrack](./code/MediaSource_Win10/cs/MainPage.xaml.cs#SnippetAddDataTrack)]\n\nThe **CueEntered** event is raised when a cue's start time has been reached as long as the associated track has a presentation mode of **ApplicationPresented**, **Hidden**, or **PlatformPresented.** Cue events are not raised for metadata tracks while the presentation mode for the track is **Disabled**. This example simply outputs the custom data associated with the cue to the debug window.\n\n[!code-cs[DataCueEntered](./code/MediaSource_Win10/cs/MainPage.xaml.cs#SnippetDataCueEntered)]\n\nThis example adds a custom text track by specifying **TimedMetadataKind.Caption** when creating the track and using [**TimedTextCue**](https://msdn.microsoft.com/library/windows/apps/dn956655) objects to add cues to the track.\n\n[!code-cs[AddTextTrack](./code/MediaSource_Win10/cs/MainPage.xaml.cs#SnippetAddTextTrack)]\n\n[!code-cs[TextCueEntered](./code/MediaSource_Win10/cs/MainPage.xaml.cs#SnippetTextCueEntered)]\n\n## Play a list of media items with MediaPlaybackList\n\nThe [**MediaPlaybackList**](https://msdn.microsoft.com/library/windows/apps/dn930955) allows you to create a playlist of media items, which are represented by **MediaPlaybackItem** objects.\n\n**Note**  Items in a [**MediaPlaybackList**](https://msdn.microsoft.com/library/windows/apps/dn930955) are rendered using gapless playback. The system will use provided metadata in MP3 or AAC encoded files to determine the delay or padding compensation needed for gapless playback. If the MP3 or AAC encoded files don't provide this metadata, then the system determines the delay or padding heuristically. For lossless formats, such as PCM, FLAC, or ALAC, the system takes no action because these encoders don't introduce delay or padding.\n\nTo get started, declare a variable to store your **MediaPlaybackList**.\n\n[!code-cs[DeclareMediaPlaybackList](./code/MediaSource_Win10/cs/MainPage.xaml.cs#SnippetDeclareMediaPlaybackList)]\n\nCreate a **MediaPlaybackItem** for each media item you want to add to your list using the same procedure described previously in this article. Initialize your **MediaPlaybackList** object and add the media playback items to it. Register a handler for the [**CurrentItemChanged**](https://msdn.microsoft.com/library/windows/apps/dn930957) event. This event allows you to update your UI to reflect the currently playing media item. Finally, set the playback source of the **MediaElement** or **MediaPlayer** to your **MediaPlaybackList**.\n\n[!code-cs[PlayMediaPlaybackList](./code/MediaSource_Win10/cs/MainPage.xaml.cs#SnippetPlayMediaPlaybackList)]\n\nIn the **CurrentItemChanged** event handler, update your UI to reflect the currently playing item, which can be retrieved using the [**NewItem**](https://msdn.microsoft.com/library/windows/apps/dn930930) property of the [**CurrentMediaPlaybackItemChangedEventArgs**](https://msdn.microsoft.com/library/windows/apps/dn930929) object passed into the event. Remember that if you update the UI from this event, you should do so within a call to [**CoreDispatcher.RunAsync**](https://msdn.microsoft.com/library/windows/apps/hh750317) so that the updates are made on the UI thread.\n\n[!code-cs[MediaPlaybackListItemChanged](./code/MediaSource_Win10/cs/MainPage.xaml.cs#SnippetMediaPlaybackListItemChanged)]\n\nCall [**MovePrevious**](https://msdn.microsoft.com/library/windows/apps/mt146455) or [**MoveNext**](https://msdn.microsoft.com/library/windows/apps/mt146454) to cause the media player to play the previous or next item in your **MediaPlaybackList**.\n\n[!code-cs[PrevButton](./code/MediaSource_Win10/cs/MainPage.xaml.cs#SnippetPrevButton)]\n\n[!code-cs[NextButton](./code/MediaSource_Win10/cs/MainPage.xaml.cs#SnippetNextButton)]\n\nSet the [**ShuffleEnabled**](https://msdn.microsoft.com/library/windows/apps/mt146457) property to specify whether the media player should play the items in your list in random order.\n\n[!code-cs[ShuffleButton](./code/MediaSource_Win10/cs/MainPage.xaml.cs#SnippetShuffleButton)]\n\nSet the [**AutoRepeatEnabled**](https://msdn.microsoft.com/library/windows/apps/mt146452) property to specify whether the media player should loop playback of your list.\n\n[!code-cs[RepeatButton](./code/MediaSource_Win10/cs/MainPage.xaml.cs#SnippetRepeatButton)]\n\n \n\n \n\n\n\n\n"}