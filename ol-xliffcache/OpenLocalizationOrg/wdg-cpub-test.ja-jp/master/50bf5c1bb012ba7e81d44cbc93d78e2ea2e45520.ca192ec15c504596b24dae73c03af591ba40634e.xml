{"nodes":[{"pos":[66,154],"content":"This article shows you how to cast media to remote devices from a Universal Windows app.","needQuote":true,"needEscape":true,"nodes":[{"content":"This article shows you how to cast media to remote devices from a Universal Windows app.","pos":[0,88]}]},{"pos":[162,175],"content":"Media casting","needQuote":true,"needEscape":true,"nodes":[{"content":"Media casting","pos":[0,13]}]},{"content":"Media casting","pos":[183,196]},{"content":"\\[ Updated for UWP apps on Windows 10.","pos":[198,236]},{"content":"For Windows 8.x articles, see the <bpt id=\"p1\">[</bpt>archive<ept id=\"p1\">](http://go.microsoft.com/fwlink/p/?linkid=619132)</ept> \\]","pos":[237,332],"source":" For Windows 8.x articles, see the [archive](http://go.microsoft.com/fwlink/p/?linkid=619132) \\]"},{"content":"This article shows you how to cast media to remote devices from a Universal Windows app.","pos":[335,423]},{"content":"Built-in media casting with MediaElement","pos":[428,468]},{"pos":[470,664],"content":"The simplest way to cast media from a Universal Windows app is to use the built-in casting capability of the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>MediaElement<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br242926)</ept> control.","source":"The simplest way to cast media from a Universal Windows app is to use the built-in casting capability of the [**MediaElement**](https://msdn.microsoft.com/library/windows/apps/br242926) control."},{"pos":[666,796],"content":"To allow the user to open a video file to be played in the <bpt id=\"p1\">**</bpt>MediaElement<ept id=\"p1\">**</ept> control, add the following namespaces to your project.","source":"To allow the user to open a video file to be played in the **MediaElement** control, add the following namespaces to your project."},{"pos":[808,827],"content":"BuiltInCastingUsing"},{"pos":[904,1060],"content":"In your app's XAML file, add a <bpt id=\"p1\">**</bpt>MediaElement<ept id=\"p1\">**</ept> and set <bpt id=\"p2\">[</bpt><bpt id=\"p3\">**</bpt>AreTransportControlsEnabled<ept id=\"p3\">**</ept><ept id=\"p2\">](https://msdn.microsoft.com/library/windows/apps/dn298977)</ept> to true.","source":"In your app's XAML file, add a **MediaElement** and set [**AreTransportControlsEnabled**](https://msdn.microsoft.com/library/windows/apps/dn298977) to true."},{"pos":[1073,1085],"content":"MediaElement"},{"content":"Add a button to let the user initiate picking a file.","pos":[1152,1205]},{"pos":[1218,1228],"content":"OpenButton"},{"pos":[1293,1687],"content":"In the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>Click<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br227737)</ept> event handler for the button, create a new instance of the <bpt id=\"p3\">[</bpt><bpt id=\"p4\">**</bpt>FileOpenPicker<ept id=\"p4\">**</ept><ept id=\"p3\">](https://msdn.microsoft.com/library/windows/apps/br207847)</ept>, add video file types to the <bpt id=\"p5\">[</bpt><bpt id=\"p6\">**</bpt>FileTypeFilter<ept id=\"p6\">**</ept><ept id=\"p5\">](https://msdn.microsoft.com/library/windows/apps/br207850)</ept> collection, and set the starting location to the user's videos library.","source":"In the [**Click**](https://msdn.microsoft.com/library/windows/apps/br227737) event handler for the button, create a new instance of the [**FileOpenPicker**](https://msdn.microsoft.com/library/windows/apps/br207847), add video file types to the [**FileTypeFilter**](https://msdn.microsoft.com/library/windows/apps/br207850) collection, and set the starting location to the user's videos library."},{"content":"Call <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>PickSingleFileAsync<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/jj635275)</ept> to launch the file picker dialog.","pos":[1689,1811],"source":"Call [**PickSingleFileAsync**](https://msdn.microsoft.com/library/windows/apps/jj635275) to launch the file picker dialog."},{"content":"When this method returns, the result is a <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>StorageFile<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br227171)</ept> object representing the video file.","pos":[1812,1965],"source":" When this method returns, the result is a [**StorageFile**](https://msdn.microsoft.com/library/windows/apps/br227171) object representing the video file."},{"content":"Check to make sure the file isn't null, which it will be if the user cancels the picking operation.","pos":[1966,2065]},{"content":"Call the file's <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>OpenAsync<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br227221.aspx)</ept> method to get an <bpt id=\"p3\">[</bpt><bpt id=\"p4\">**</bpt>IRandomAccessStream<ept id=\"p4\">**</ept><ept id=\"p3\">](https://msdn.microsoft.com/library/windows/apps/br241731)</ept> for the file.","pos":[2066,2275],"source":" Call the file's [**OpenAsync**](https://msdn.microsoft.com/library/windows/apps/br227221.aspx) method to get an [**IRandomAccessStream**](https://msdn.microsoft.com/library/windows/apps/br241731) for the file."},{"content":"Finally, call the <bpt id=\"p1\">**</bpt>MediaElement<ept id=\"p1\">**</ept> object's <bpt id=\"p2\">[</bpt><bpt id=\"p3\">**</bpt>SetSource<ept id=\"p3\">**</ept><ept id=\"p2\">](https://msdn.microsoft.com/library/windows/apps/br244338)</ept> method to make the video file the video source for the control.","pos":[2276,2457],"source":" Finally, call the **MediaElement** object's [**SetSource**](https://msdn.microsoft.com/library/windows/apps/br244338) method to make the video file the video source for the control."},{"pos":[2469,2484],"content":"OpenButtonClick"},{"pos":[2557,2781],"content":"Once the video is loaded in the <bpt id=\"p1\">**</bpt>MediaElement<ept id=\"p1\">**</ept>, the user can simply press the casting button on the transport controls to launch a built-in dialog that allows them to choose a device to which the loaded media will be cast.","source":"Once the video is loaded in the **MediaElement**, the user can simply press the casting button on the transport controls to launch a built-in dialog that allows them to choose a device to which the loaded media will be cast."},{"content":"mediaelement casting button","pos":[2785,2812]},{"content":"Media casting with the CastingDevicePicker","pos":[2859,2901]},{"content":"A second way to cast media to a device is to use the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>CastingDevicePicker<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn972525)</ept>.","pos":[2903,3040],"source":"A second way to cast media to a device is to use the [**CastingDevicePicker**](https://msdn.microsoft.com/library/windows/apps/dn972525)."},{"content":"To use this class, include the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>Windows.Media.Casting<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn972568)</ept> namespace in your project.","pos":[3041,3184],"source":" To use this class, include the [**Windows.Media.Casting**](https://msdn.microsoft.com/library/windows/apps/dn972568) namespace in your project."},{"pos":[3196,3212],"content":"CastingNamespace"},{"pos":[3286,3351],"content":"Declare a member variable for the <bpt id=\"p1\">**</bpt>CastingDevicePicker<ept id=\"p1\">**</ept> object.","source":"Declare a member variable for the **CastingDevicePicker** object."},{"pos":[3363,3383],"content":"DeclareCastingPicker"},{"content":"When you page is initialized, create a new instance of the casting picker and set the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>Filter<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn972540)</ept> to <bpt id=\"p3\">[</bpt><bpt id=\"p4\">**</bpt>SupportsVideo<ept id=\"p4\">**</ept><ept id=\"p3\">](https://msdn.microsoft.com/library/windows/apps/dn972526)</ept> property to indicate that the casting devices listed by the picker should support video.","pos":[3461,3787],"source":"When you page is initialized, create a new instance of the casting picker and set the [**Filter**](https://msdn.microsoft.com/library/windows/apps/dn972540) to [**SupportsVideo**](https://msdn.microsoft.com/library/windows/apps/dn972526) property to indicate that the casting devices listed by the picker should support video."},{"content":"Register a handler for the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>CastingDeviceSelected<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn972539)</ept> event, which is raised when the user picks a device for casting.","pos":[3788,3965],"source":" Register a handler for the [**CastingDeviceSelected**](https://msdn.microsoft.com/library/windows/apps/dn972539) event, which is raised when the user picks a device for casting."},{"pos":[3977,3994],"content":"InitCastingPicker"},{"content":"In your XAML file, add a button to allow the user to launch the picker.","pos":[4069,4140]},{"pos":[4153,4169],"content":"CastPickerButton"},{"content":"In the <bpt id=\"p1\">**</bpt>Click<ept id=\"p1\">**</ept> event handler for the button, call <bpt id=\"p2\">[</bpt><bpt id=\"p3\">**</bpt>TransformToVisual<ept id=\"p3\">**</ept><ept id=\"p2\">](https://msdn.microsoft.com/library/windows/apps/br208986)</ept> to get the transform of a UI element relative to another element.","pos":[4240,4439],"source":"In the **Click** event handler for the button, call [**TransformToVisual**](https://msdn.microsoft.com/library/windows/apps/br208986) to get the transform of a UI element relative to another element."},{"content":"In this example, the transform is the position of the cast picker button relative to the visual root of the application window.","pos":[4440,4567]},{"content":"Call the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>Show<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn972542)</ept> method of the <bpt id=\"p3\">[</bpt><bpt id=\"p4\">**</bpt>CastingDevicePicker<ept id=\"p4\">**</ept><ept id=\"p3\">](https://msdn.microsoft.com/library/windows/apps/dn972525)</ept> object to launch the casting picker dialog.","pos":[4568,4787],"source":" Call the [**Show**](https://msdn.microsoft.com/library/windows/apps/dn972542) method of the [**CastingDevicePicker**](https://msdn.microsoft.com/library/windows/apps/dn972525) object to launch the casting picker dialog."},{"content":"Specify the location and dimensions of the cast picker button so that the system can make the dialog fly out from the button that the user pressed.","pos":[4788,4935]},{"pos":[4947,4968],"content":"CastPickerButtonClick"},{"content":"In the <bpt id=\"p1\">**</bpt>CastingDeviceSelected<ept id=\"p1\">**</ept> event handler, call the <bpt id=\"p2\">[</bpt><bpt id=\"p3\">**</bpt>CreateCastingConnection<ept id=\"p3\">**</ept><ept id=\"p2\">](https://msdn.microsoft.com/library/windows/apps/dn972547)</ept> method of the <bpt id=\"p4\">[</bpt><bpt id=\"p5\">**</bpt>SelectedCastingDevice<ept id=\"p5\">**</ept><ept id=\"p4\">](https://msdn.microsoft.com/library/windows/apps/dn972546)</ept> property of the event args, which represents the casting device selected by the user.","pos":[5047,5377],"source":"In the **CastingDeviceSelected** event handler, call the [**CreateCastingConnection**](https://msdn.microsoft.com/library/windows/apps/dn972547) method of the [**SelectedCastingDevice**](https://msdn.microsoft.com/library/windows/apps/dn972546) property of the event args, which represents the casting device selected by the user."},{"content":"Register handlers for the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>ErrorOccurred<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn972519)</ept> and <bpt id=\"p3\">[</bpt><bpt id=\"p4\">**</bpt>StateChanged<ept id=\"p4\">**</ept><ept id=\"p3\">](https://msdn.microsoft.com/library/windows/apps/dn972523)</ept> events.","pos":[5378,5570],"source":" Register handlers for the [**ErrorOccurred**](https://msdn.microsoft.com/library/windows/apps/dn972519) and [**StateChanged**](https://msdn.microsoft.com/library/windows/apps/dn972523) events."},{"content":"Finally, call <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>RequestStartCastingAsync<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn972520)</ept> to begin casting, passing in the result of the <bpt id=\"p3\">**</bpt>MediaElement<ept id=\"p3\">**</ept> object's <bpt id=\"p4\">[</bpt><bpt id=\"p5\">**</bpt>GetAsCastingSource<ept id=\"p5\">**</ept><ept id=\"p4\">](https://msdn.microsoft.com/library/windows/apps/dn920012)</ept> method to specify that the media to be cast is the content of the <bpt id=\"p6\">**</bpt>MediaElement<ept id=\"p6\">**</ept>.","pos":[5571,5913],"source":" Finally, call [**RequestStartCastingAsync**](https://msdn.microsoft.com/library/windows/apps/dn972520) to begin casting, passing in the result of the **MediaElement** object's [**GetAsCastingSource**](https://msdn.microsoft.com/library/windows/apps/dn920012) method to specify that the media to be cast is the content of the **MediaElement**."},{"content":"<bpt id=\"p1\">**</bpt>Note<ept id=\"p1\">**</ept>  The casting connection must be initiated on the UI thread.","pos":[5915,5983],"source":"**Note**  The casting connection must be initiated on the UI thread."},{"content":"Since the <bpt id=\"p1\">**</bpt>CastingDeviceSelected<ept id=\"p1\">**</ept> is not called on the UI thread, you must place these calls inside a call to <bpt id=\"p2\">[</bpt><bpt id=\"p3\">**</bpt>CoreDispatcher.RunAsync<ept id=\"p3\">**</ept><ept id=\"p2\">](https://msdn.microsoft.com/library/windows/apps/hh750317)</ept> which causes them to be called on the UI thread.","pos":[5984,6232],"source":" Since the **CastingDeviceSelected** is not called on the UI thread, you must place these calls inside a call to [**CoreDispatcher.RunAsync**](https://msdn.microsoft.com/library/windows/apps/hh750317) which causes them to be called on the UI thread."},{"pos":[6244,6265],"content":"CastingDeviceSelected"},{"content":"In the <bpt id=\"p1\">**</bpt>ErrorOccurred<ept id=\"p1\">**</ept> and <bpt id=\"p2\">**</bpt>StateChanged<ept id=\"p2\">**</ept> event handlers, you should update your UI to inform the user of the current casting status.","pos":[6344,6481],"source":"In the **ErrorOccurred** and **StateChanged** event handlers, you should update your UI to inform the user of the current casting status."},{"content":"These events are discussed in detail in the following section on creating a custom casting device picker.","pos":[6482,6587]},{"pos":[6599,6617],"content":"EmptyStateHandlers"},{"content":"Media casting with a custom device picker","pos":[6696,6737]},{"content":"The following section describes how to create your own casting device picker UI by enumerating the casting devices and initiating the connection from your code.","pos":[6739,6899]},{"pos":[6901,7075],"content":"To enumerate the available casting devices, include the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>Windows.Devices.Enumeration<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br225459)</ept> namespace in your project.","source":"To enumerate the available casting devices, include the [**Windows.Devices.Enumeration**](https://msdn.microsoft.com/library/windows/apps/br225459) namespace in your project."},{"pos":[7087,7107],"content":"EnumerationNamespace"},{"content":"Add the following controls to your XAML page to implement the rudimentary UI for this example:","pos":[7185,7279]},{"content":"A button to start the device watcher that looks for available casting devices.","pos":[7285,7363]},{"pos":[7368,7523],"content":"A <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>ProgressRing<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br227538)</ept> control to provide feedback to the user that casting enumeration is ongoing.","source":"A [**ProgressRing**](https://msdn.microsoft.com/library/windows/apps/br227538) control to provide feedback to the user that casting enumeration is ongoing."},{"content":"A <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>ListBox<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br242868)</ept> to list the discovered casting devices.","pos":[7528,7641],"source":"A [**ListBox**](https://msdn.microsoft.com/library/windows/apps/br242868) to list the discovered casting devices."},{"content":"Define an <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>ItemTemplate<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br242830)</ept> for the control so that we can assign the casting device objects directly to the control and still display the <bpt id=\"p3\">[</bpt><bpt id=\"p4\">**</bpt>FriendlyName<ept id=\"p4\">**</ept><ept id=\"p3\">](https://msdn.microsoft.com/library/windows/apps/dn972549)</ept> property.","pos":[7642,7926],"source":" Define an [**ItemTemplate**](https://msdn.microsoft.com/library/windows/apps/br242830) for the control so that we can assign the casting device objects directly to the control and still display the [**FriendlyName**](https://msdn.microsoft.com/library/windows/apps/dn972549) property."},{"content":"A button to allow the user to disconnect the casting device.","pos":[7931,7991]},{"pos":[8004,8020],"content":"CustomPickerXAML"},{"pos":[8091,8313],"content":"In your code behind, declare member variables for the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>DeviceWatcher<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br225446)</ept> and the <bpt id=\"p3\">[</bpt><bpt id=\"p4\">**</bpt>CastingConnection<ept id=\"p4\">**</ept><ept id=\"p3\">](https://msdn.microsoft.com/library/windows/apps/dn972510)</ept>.","source":"In your code behind, declare member variables for the [**DeviceWatcher**](https://msdn.microsoft.com/library/windows/apps/br225446) and the [**CastingConnection**](https://msdn.microsoft.com/library/windows/apps/dn972510)."},{"pos":[8325,8345],"content":"DeclareDeviceWatcher"},{"content":"In the <bpt id=\"p1\">**</bpt>Click<ept id=\"p1\">**</ept> handler for the <bpt id=\"p2\">*</bpt>startWatcherButton<ept id=\"p2\">*</ept>, first update the UI by disabling the button and making the progress ring active while device enumeration is ongoing.","pos":[8423,8594],"source":"In the **Click** handler for the *startWatcherButton*, first update the UI by disabling the button and making the progress ring active while device enumeration is ongoing."},{"content":"Clear the list box of casting devices.","pos":[8595,8633]},{"content":"Next, create a device watcher by calling <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>DeviceInformation.CreateWatcher<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br225427)</ept>.","pos":[8635,8772],"source":"Next, create a device watcher by calling [**DeviceInformation.CreateWatcher**](https://msdn.microsoft.com/library/windows/apps/br225427)."},{"content":"This method can be used to watch for many different types of devices.","pos":[8773,8842]},{"content":"Specify that you want to watch for devices that support video casting by using the device selector string returned by <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>CastingDevice.GetDeviceSelector<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn972551)</ept>.","pos":[8843,9057],"source":" Specify that you want to watch for devices that support video casting by using the device selector string returned by [**CastingDevice.GetDeviceSelector**](https://msdn.microsoft.com/library/windows/apps/dn972551)."},{"pos":[9059,9413],"content":"Finally, register event handlers for the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>Added<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br225450)</ept>, <bpt id=\"p3\">[</bpt><bpt id=\"p4\">**</bpt>Removed<ept id=\"p4\">**</ept><ept id=\"p3\">](https://msdn.microsoft.com/library/windows/apps/br225453)</ept>, <bpt id=\"p5\">[</bpt><bpt id=\"p6\">**</bpt>EnumerationCompleted<ept id=\"p6\">**</ept><ept id=\"p5\">](https://msdn.microsoft.com/library/windows/apps/br225451)</ept>, and <bpt id=\"p7\">[</bpt><bpt id=\"p8\">**</bpt>Stopped<ept id=\"p8\">**</ept><ept id=\"p7\">](https://msdn.microsoft.com/library/windows/apps/br225457)</ept> events.","source":"Finally, register event handlers for the [**Added**](https://msdn.microsoft.com/library/windows/apps/br225450), [**Removed**](https://msdn.microsoft.com/library/windows/apps/br225453), [**EnumerationCompleted**](https://msdn.microsoft.com/library/windows/apps/br225451), and [**Stopped**](https://msdn.microsoft.com/library/windows/apps/br225457) events."},{"pos":[9425,9448],"content":"StartWatcherButtonClick"},{"content":"The <bpt id=\"p1\">**</bpt>Added<ept id=\"p1\">**</ept> event is raised when a new device is discovered by the watcher.","pos":[9529,9606],"source":"The **Added** event is raised when a new device is discovered by the watcher."},{"content":"In the handler for this event, create a new <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>CastingDevice<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn972524)</ept> object by calling <bpt id=\"p3\">[</bpt><bpt id=\"p4\">**</bpt>CastingDevice.FromIdAsync<ept id=\"p4\">**</ept><ept id=\"p3\">](https://msdn.microsoft.com/library/windows/apps/dn972550)</ept> and passing in the ID of the discovered casting device, which is contained in the <bpt id=\"p5\">**</bpt>DeviceInformation<ept id=\"p5\">**</ept> object passed into the handler.","pos":[9607,9972],"source":" In the handler for this event, create a new [**CastingDevice**](https://msdn.microsoft.com/library/windows/apps/dn972524) object by calling [**CastingDevice.FromIdAsync**](https://msdn.microsoft.com/library/windows/apps/dn972550) and passing in the ID of the discovered casting device, which is contained in the **DeviceInformation** object passed into the handler."},{"content":"Add the <bpt id=\"p1\">**</bpt>CastingDevice<ept id=\"p1\">**</ept> to the casting device <bpt id=\"p2\">**</bpt>ListBox<ept id=\"p2\">**</ept> so that the user can select it.","pos":[9974,10065],"source":"Add the **CastingDevice** to the casting device **ListBox** so that the user can select it."},{"content":"Because of the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>ItemTemplate<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br242830)</ept> defined in the XAML, the <bpt id=\"p3\">[</bpt><bpt id=\"p4\">**</bpt>FriendlyName<ept id=\"p4\">**</ept><ept id=\"p3\">](https://msdn.microsoft.com/library/windows/apps/dn972549)</ept> property will be used as the item text for in the list box.","pos":[10066,10319],"source":" Because of the [**ItemTemplate**](https://msdn.microsoft.com/library/windows/apps/br242830) defined in the XAML, the [**FriendlyName**](https://msdn.microsoft.com/library/windows/apps/dn972549) property will be used as the item text for in the list box."},{"content":"Because this event handler is not called on the UI thread, you must update the UI from within a call to <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>CoreDispatcher.RunAsync<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/hh750317)</ept>.","pos":[10320,10512],"source":" Because this event handler is not called on the UI thread, you must update the UI from within a call to [**CoreDispatcher.RunAsync**](https://msdn.microsoft.com/library/windows/apps/hh750317)."},{"pos":[10524,10536],"content":"WatcherAdded"},{"content":"The <bpt id=\"p1\">**</bpt>Removed<ept id=\"p1\">**</ept> event is raised when the watcher detects that a casting device is no longer present.","pos":[10606,10706],"source":"The **Removed** event is raised when the watcher detects that a casting device is no longer present."},{"content":"Compare the ID property of the <bpt id=\"p1\">**</bpt>Added<ept id=\"p1\">**</ept> object passed into the handler to the ID of each <bpt id=\"p2\">**</bpt>Added<ept id=\"p2\">**</ept> in the list box's <bpt id=\"p3\">[</bpt><bpt id=\"p4\">**</bpt>Items<ept id=\"p4\">**</ept><ept id=\"p3\">](https://msdn.microsoft.com/library/windows/apps/br242823)</ept> collection.","pos":[10707,10906],"source":" Compare the ID property of the **Added** object passed into the handler to the ID of each **Added** in the list box's [**Items**](https://msdn.microsoft.com/library/windows/apps/br242823) collection."},{"content":"If the ID matches, remove that object from the collection.","pos":[10907,10965]},{"content":"Again, because the UI is being updated, this call must be made from within a <bpt id=\"p1\">**</bpt>RunAsync<ept id=\"p1\">**</ept> call.","pos":[10966,11061],"source":" Again, because the UI is being updated, this call must be made from within a **RunAsync** call."},{"pos":[11073,11087],"content":"WatcherRemoved"},{"content":"The <bpt id=\"p1\">**</bpt>EnumerationCompleted<ept id=\"p1\">**</ept> event is raised when the watcher has finished detecting devices.","pos":[11159,11252],"source":"The **EnumerationCompleted** event is raised when the watcher has finished detecting devices."},{"content":"In the handler for this event, update the UI to let the user know that device enumeration has completed and stop the device watcher by calling <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>Stop<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br225456)</ept>.","pos":[11253,11465],"source":" In the handler for this event, update the UI to let the user know that device enumeration has completed and stop the device watcher by calling [**Stop**](https://msdn.microsoft.com/library/windows/apps/br225456)."},{"pos":[11477,11504],"content":"WatcherEnumerationCompleted"},{"content":"The Stopped event is raised when the device watcher has finished stopping.","pos":[11589,11663]},{"content":"In the handler for this event, stop the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>ProgressRing<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br227538)</ept> control and reenable the <bpt id=\"p3\">*</bpt>startWatcherButton<ept id=\"p3\">*</ept> so that the user can restart the device enumeration process.","pos":[11664,11887],"source":" In the handler for this event, stop the [**ProgressRing**](https://msdn.microsoft.com/library/windows/apps/br227538) control and reenable the *startWatcherButton* so that the user can restart the device enumeration process."},{"pos":[11899,11913],"content":"WatcherStopped"},{"content":"When the user selects one of the casting devices from the list box, the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>SelectionChanged<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br209776)</ept> event is raised.","pos":[11985,12154],"source":"When the user selects one of the casting devices from the list box, the [**SelectionChanged**](https://msdn.microsoft.com/library/windows/apps/br209776) event is raised."},{"content":"It is within this handler that the casting connection will be created and casting will be started.","pos":[12155,12253]},{"content":"First, make sure the device watcher is stopped so that device enumeration doesn't interfere with media casting.","pos":[12255,12366]},{"content":"Create a casting connection by calling <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>CreateCastingConnection<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn972547)</ept> on the <bpt id=\"p3\">**</bpt>CastingDevice<ept id=\"p3\">**</ept> object selected by the user.","pos":[12367,12547],"source":" Create a casting connection by calling [**CreateCastingConnection**](https://msdn.microsoft.com/library/windows/apps/dn972547) on the **CastingDevice** object selected by the user."},{"content":"Add event handlers for the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>StateChanged<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn972523)</ept> and <bpt id=\"p3\">[</bpt><bpt id=\"p4\">**</bpt>ErrorOccurred<ept id=\"p4\">**</ept><ept id=\"p3\">](https://msdn.microsoft.com/library/windows/apps/dn972519)</ept> events.","pos":[12548,12741],"source":" Add event handlers for the [**StateChanged**](https://msdn.microsoft.com/library/windows/apps/dn972523) and [**ErrorOccurred**](https://msdn.microsoft.com/library/windows/apps/dn972519) events."},{"content":"Start media casting by calling <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>RequestStartCastingAsync<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn972520)</ept>, passing in the casting source returned by calling the <bpt id=\"p3\">**</bpt>MediaElement<ept id=\"p3\">**</ept> method <bpt id=\"p4\">[</bpt><bpt id=\"p5\">**</bpt>GetAsCastingSource<ept id=\"p5\">**</ept><ept id=\"p4\">](https://msdn.microsoft.com/library/windows/apps/dn920012)</ept>.","pos":[12743,13025],"source":"Start media casting by calling [**RequestStartCastingAsync**](https://msdn.microsoft.com/library/windows/apps/dn972520), passing in the casting source returned by calling the **MediaElement** method [**GetAsCastingSource**](https://msdn.microsoft.com/library/windows/apps/dn920012)."},{"content":"Finally, make the disconnect button visible to allow the user to stop media casting.","pos":[13026,13110]},{"pos":[13122,13138],"content":"SelectionChanged"},{"content":"In the state changed handler, the action you take depends on the new state of the casting connection:","pos":[13212,13313]},{"pos":[13319,13455],"content":"If the state is <bpt id=\"p1\">**</bpt>Connected<ept id=\"p1\">**</ept> or <bpt id=\"p2\">**</bpt>Rendering<ept id=\"p2\">**</ept>, make sure the <bpt id=\"p3\">**</bpt>ProgressRing<ept id=\"p3\">**</ept> control is inactive and the disconnect button is visible.","source":"If the state is **Connected** or **Rendering**, make sure the **ProgressRing** control is inactive and the disconnect button is visible."},{"pos":[13460,13622],"content":"If the state is <bpt id=\"p1\">**</bpt>Disconnected<ept id=\"p1\">**</ept>, unselect the current casting device in the list box, make the <bpt id=\"p2\">**</bpt>ProgressRing<ept id=\"p2\">**</ept> control inactive, and hide the disconnect button.","source":"If the state is **Disconnected**, unselect the current casting device in the list box, make the **ProgressRing** control inactive, and hide the disconnect button."},{"pos":[13627,13731],"content":"If the state is <bpt id=\"p1\">**</bpt>Connecting<ept id=\"p1\">**</ept>, make the <bpt id=\"p2\">**</bpt>ProgressRing<ept id=\"p2\">**</ept> control active and hide the disconnect button.","source":"If the state is **Connecting**, make the **ProgressRing** control active and hide the disconnect button."},{"pos":[13736,13843],"content":"If the state is <bpt id=\"p1\">**</bpt>Disconnecting<ept id=\"p1\">**</ept>, make the <bpt id=\"p2\">**</bpt>ProgressRing<ept id=\"p2\">**</ept> control active and hide the disconnect button.","source":"If the state is **Disconnecting**, make the **ProgressRing** control active and hide the disconnect button."},{"pos":[13855,13867],"content":"StateChanged"},{"pos":[13937,14117],"content":"In the handler for the <bpt id=\"p1\">**</bpt>ErrorOccurred<ept id=\"p1\">**</ept> event, update your UI to let the user know that a casting error occurred and unselect the current <bpt id=\"p2\">**</bpt>CastingDevice<ept id=\"p2\">**</ept> object in the list box.","source":"In the handler for the **ErrorOccurred** event, update your UI to let the user know that a casting error occurred and unselect the current **CastingDevice** object in the list box."},{"pos":[14129,14142],"content":"ErrorOccurred"},{"content":"Finally, implement the handler for the disconnect button.","pos":[14213,14270]},{"content":"Stop media casting and disconnect from the casting device by calling the <bpt id=\"p1\">**</bpt>CastingConnection<ept id=\"p1\">**</ept> object's <bpt id=\"p2\">[</bpt><bpt id=\"p3\">**</bpt>DisconnectAsync<ept id=\"p3\">**</ept><ept id=\"p2\">](https://msdn.microsoft.com/library/windows/apps/dn972518)</ept> method.","pos":[14271,14462],"source":" Stop media casting and disconnect from the casting device by calling the **CastingConnection** object's [**DisconnectAsync**](https://msdn.microsoft.com/library/windows/apps/dn972518) method."},{"content":"This call must be dispatched to the UI thread by calling <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>CoreDispatcher.RunAsync<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/hh750317)</ept>.","pos":[14463,14608],"source":" This call must be dispatched to the UI thread by calling [**CoreDispatcher.RunAsync**](https://msdn.microsoft.com/library/windows/apps/hh750317)."},{"pos":[14620,14636],"content":"DisconnectButton"}],"content":"---\nms.assetid: 40B97E0C-EB1B-40C2-A022-1AB95DFB085E\ndescription: This article shows you how to cast media to remote devices from a Universal Windows app.\ntitle: Media casting\n---\n\n# Media casting\n\n\\[ Updated for UWP apps on Windows 10. For Windows 8.x articles, see the [archive](http://go.microsoft.com/fwlink/p/?linkid=619132) \\]\n\n\nThis article shows you how to cast media to remote devices from a Universal Windows app.\n\n## Built-in media casting with MediaElement\n\nThe simplest way to cast media from a Universal Windows app is to use the built-in casting capability of the [**MediaElement**](https://msdn.microsoft.com/library/windows/apps/br242926) control.\n\nTo allow the user to open a video file to be played in the **MediaElement** control, add the following namespaces to your project.\n\n[!code-cs[BuiltInCastingUsing](./code/MediaCastingWin10/cs/MainPage.xaml.cs#SnippetBuiltInCastingUsing)]\n\nIn your app's XAML file, add a **MediaElement** and set [**AreTransportControlsEnabled**](https://msdn.microsoft.com/library/windows/apps/dn298977) to true.\n\n[!code-xml[MediaElement](./code/MediaCastingWin10/cs/MainPage.xaml#SnippetMediaElement)]\n\nAdd a button to let the user initiate picking a file.\n\n[!code-xml[OpenButton](./code/MediaCastingWin10/cs/MainPage.xaml#SnippetOpenButton)]\n\nIn the [**Click**](https://msdn.microsoft.com/library/windows/apps/br227737) event handler for the button, create a new instance of the [**FileOpenPicker**](https://msdn.microsoft.com/library/windows/apps/br207847), add video file types to the [**FileTypeFilter**](https://msdn.microsoft.com/library/windows/apps/br207850) collection, and set the starting location to the user's videos library.\n\nCall [**PickSingleFileAsync**](https://msdn.microsoft.com/library/windows/apps/jj635275) to launch the file picker dialog. When this method returns, the result is a [**StorageFile**](https://msdn.microsoft.com/library/windows/apps/br227171) object representing the video file. Check to make sure the file isn't null, which it will be if the user cancels the picking operation. Call the file's [**OpenAsync**](https://msdn.microsoft.com/library/windows/apps/br227221.aspx) method to get an [**IRandomAccessStream**](https://msdn.microsoft.com/library/windows/apps/br241731) for the file. Finally, call the **MediaElement** object's [**SetSource**](https://msdn.microsoft.com/library/windows/apps/br244338) method to make the video file the video source for the control.\n\n[!code-cs[OpenButtonClick](./code/MediaCastingWin10/cs/MainPage.xaml.cs#SnippetOpenButtonClick)]\n\nOnce the video is loaded in the **MediaElement**, the user can simply press the casting button on the transport controls to launch a built-in dialog that allows them to choose a device to which the loaded media will be cast.\n\n![mediaelement casting button](images/media-element-casting-button.png)\n\n## Media casting with the CastingDevicePicker\n\nA second way to cast media to a device is to use the [**CastingDevicePicker**](https://msdn.microsoft.com/library/windows/apps/dn972525). To use this class, include the [**Windows.Media.Casting**](https://msdn.microsoft.com/library/windows/apps/dn972568) namespace in your project.\n\n[!code-cs[CastingNamespace](./code/MediaCastingWin10/cs/MainPage.xaml.cs#SnippetCastingNamespace)]\n\nDeclare a member variable for the **CastingDevicePicker** object.\n\n[!code-cs[DeclareCastingPicker](./code/MediaCastingWin10/cs/MainPage.xaml.cs#SnippetDeclareCastingPicker)]\n\nWhen you page is initialized, create a new instance of the casting picker and set the [**Filter**](https://msdn.microsoft.com/library/windows/apps/dn972540) to [**SupportsVideo**](https://msdn.microsoft.com/library/windows/apps/dn972526) property to indicate that the casting devices listed by the picker should support video. Register a handler for the [**CastingDeviceSelected**](https://msdn.microsoft.com/library/windows/apps/dn972539) event, which is raised when the user picks a device for casting.\n\n[!code-cs[InitCastingPicker](./code/MediaCastingWin10/cs/MainPage.xaml.cs#SnippetInitCastingPicker)]\n\nIn your XAML file, add a button to allow the user to launch the picker.\n\n[!code-xml[CastPickerButton](./code/MediaCastingWin10/cs/MainPage.xaml#SnippetCastPickerButton)]\n\nIn the **Click** event handler for the button, call [**TransformToVisual**](https://msdn.microsoft.com/library/windows/apps/br208986) to get the transform of a UI element relative to another element. In this example, the transform is the position of the cast picker button relative to the visual root of the application window. Call the [**Show**](https://msdn.microsoft.com/library/windows/apps/dn972542) method of the [**CastingDevicePicker**](https://msdn.microsoft.com/library/windows/apps/dn972525) object to launch the casting picker dialog. Specify the location and dimensions of the cast picker button so that the system can make the dialog fly out from the button that the user pressed.\n\n[!code-cs[CastPickerButtonClick](./code/MediaCastingWin10/cs/MainPage.xaml.cs#SnippetCastPickerButtonClick)]\n\nIn the **CastingDeviceSelected** event handler, call the [**CreateCastingConnection**](https://msdn.microsoft.com/library/windows/apps/dn972547) method of the [**SelectedCastingDevice**](https://msdn.microsoft.com/library/windows/apps/dn972546) property of the event args, which represents the casting device selected by the user. Register handlers for the [**ErrorOccurred**](https://msdn.microsoft.com/library/windows/apps/dn972519) and [**StateChanged**](https://msdn.microsoft.com/library/windows/apps/dn972523) events. Finally, call [**RequestStartCastingAsync**](https://msdn.microsoft.com/library/windows/apps/dn972520) to begin casting, passing in the result of the **MediaElement** object's [**GetAsCastingSource**](https://msdn.microsoft.com/library/windows/apps/dn920012) method to specify that the media to be cast is the content of the **MediaElement**.\n\n**Note**  The casting connection must be initiated on the UI thread. Since the **CastingDeviceSelected** is not called on the UI thread, you must place these calls inside a call to [**CoreDispatcher.RunAsync**](https://msdn.microsoft.com/library/windows/apps/hh750317) which causes them to be called on the UI thread.\n\n[!code-cs[CastingDeviceSelected](./code/MediaCastingWin10/cs/MainPage.xaml.cs#SnippetCastingDeviceSelected)]\n\nIn the **ErrorOccurred** and **StateChanged** event handlers, you should update your UI to inform the user of the current casting status. These events are discussed in detail in the following section on creating a custom casting device picker.\n\n[!code-cs[EmptyStateHandlers](./code/MediaCastingWin10/cs/MainPage.xaml.cs#SnippetEmptyStateHandlers)]\n\n## Media casting with a custom device picker\n\nThe following section describes how to create your own casting device picker UI by enumerating the casting devices and initiating the connection from your code.\n\nTo enumerate the available casting devices, include the [**Windows.Devices.Enumeration**](https://msdn.microsoft.com/library/windows/apps/br225459) namespace in your project.\n\n[!code-cs[EnumerationNamespace](./code/MediaCastingWin10/cs/MainPage.xaml.cs#SnippetEnumerationNamespace)]\n\nAdd the following controls to your XAML page to implement the rudimentary UI for this example:\n\n-   A button to start the device watcher that looks for available casting devices.\n-   A [**ProgressRing**](https://msdn.microsoft.com/library/windows/apps/br227538) control to provide feedback to the user that casting enumeration is ongoing.\n-   A [**ListBox**](https://msdn.microsoft.com/library/windows/apps/br242868) to list the discovered casting devices. Define an [**ItemTemplate**](https://msdn.microsoft.com/library/windows/apps/br242830) for the control so that we can assign the casting device objects directly to the control and still display the [**FriendlyName**](https://msdn.microsoft.com/library/windows/apps/dn972549) property.\n-   A button to allow the user to disconnect the casting device.\n\n[!code-xml[CustomPickerXAML](./code/MediaCastingWin10/cs/MainPage.xaml#SnippetCustomPickerXAML)]\n\nIn your code behind, declare member variables for the [**DeviceWatcher**](https://msdn.microsoft.com/library/windows/apps/br225446) and the [**CastingConnection**](https://msdn.microsoft.com/library/windows/apps/dn972510).\n\n[!code-cs[DeclareDeviceWatcher](./code/MediaCastingWin10/cs/MainPage.xaml.cs#SnippetDeclareDeviceWatcher)]\n\nIn the **Click** handler for the *startWatcherButton*, first update the UI by disabling the button and making the progress ring active while device enumeration is ongoing. Clear the list box of casting devices.\n\nNext, create a device watcher by calling [**DeviceInformation.CreateWatcher**](https://msdn.microsoft.com/library/windows/apps/br225427). This method can be used to watch for many different types of devices. Specify that you want to watch for devices that support video casting by using the device selector string returned by [**CastingDevice.GetDeviceSelector**](https://msdn.microsoft.com/library/windows/apps/dn972551).\n\nFinally, register event handlers for the [**Added**](https://msdn.microsoft.com/library/windows/apps/br225450), [**Removed**](https://msdn.microsoft.com/library/windows/apps/br225453), [**EnumerationCompleted**](https://msdn.microsoft.com/library/windows/apps/br225451), and [**Stopped**](https://msdn.microsoft.com/library/windows/apps/br225457) events.\n\n[!code-cs[StartWatcherButtonClick](./code/MediaCastingWin10/cs/MainPage.xaml.cs#SnippetStartWatcherButtonClick)]\n\nThe **Added** event is raised when a new device is discovered by the watcher. In the handler for this event, create a new [**CastingDevice**](https://msdn.microsoft.com/library/windows/apps/dn972524) object by calling [**CastingDevice.FromIdAsync**](https://msdn.microsoft.com/library/windows/apps/dn972550) and passing in the ID of the discovered casting device, which is contained in the **DeviceInformation** object passed into the handler.\n\nAdd the **CastingDevice** to the casting device **ListBox** so that the user can select it. Because of the [**ItemTemplate**](https://msdn.microsoft.com/library/windows/apps/br242830) defined in the XAML, the [**FriendlyName**](https://msdn.microsoft.com/library/windows/apps/dn972549) property will be used as the item text for in the list box. Because this event handler is not called on the UI thread, you must update the UI from within a call to [**CoreDispatcher.RunAsync**](https://msdn.microsoft.com/library/windows/apps/hh750317).\n\n[!code-cs[WatcherAdded](./code/MediaCastingWin10/cs/MainPage.xaml.cs#SnippetWatcherAdded)]\n\nThe **Removed** event is raised when the watcher detects that a casting device is no longer present. Compare the ID property of the **Added** object passed into the handler to the ID of each **Added** in the list box's [**Items**](https://msdn.microsoft.com/library/windows/apps/br242823) collection. If the ID matches, remove that object from the collection. Again, because the UI is being updated, this call must be made from within a **RunAsync** call.\n\n[!code-cs[WatcherRemoved](./code/MediaCastingWin10/cs/MainPage.xaml.cs#SnippetWatcherRemoved)]\n\nThe **EnumerationCompleted** event is raised when the watcher has finished detecting devices. In the handler for this event, update the UI to let the user know that device enumeration has completed and stop the device watcher by calling [**Stop**](https://msdn.microsoft.com/library/windows/apps/br225456).\n\n[!code-cs[WatcherEnumerationCompleted](./code/MediaCastingWin10/cs/MainPage.xaml.cs#SnippetWatcherEnumerationCompleted)]\n\nThe Stopped event is raised when the device watcher has finished stopping. In the handler for this event, stop the [**ProgressRing**](https://msdn.microsoft.com/library/windows/apps/br227538) control and reenable the *startWatcherButton* so that the user can restart the device enumeration process.\n\n[!code-cs[WatcherStopped](./code/MediaCastingWin10/cs/MainPage.xaml.cs#SnippetWatcherStopped)]\n\nWhen the user selects one of the casting devices from the list box, the [**SelectionChanged**](https://msdn.microsoft.com/library/windows/apps/br209776) event is raised. It is within this handler that the casting connection will be created and casting will be started.\n\nFirst, make sure the device watcher is stopped so that device enumeration doesn't interfere with media casting. Create a casting connection by calling [**CreateCastingConnection**](https://msdn.microsoft.com/library/windows/apps/dn972547) on the **CastingDevice** object selected by the user. Add event handlers for the [**StateChanged**](https://msdn.microsoft.com/library/windows/apps/dn972523) and [**ErrorOccurred**](https://msdn.microsoft.com/library/windows/apps/dn972519) events.\n\nStart media casting by calling [**RequestStartCastingAsync**](https://msdn.microsoft.com/library/windows/apps/dn972520), passing in the casting source returned by calling the **MediaElement** method [**GetAsCastingSource**](https://msdn.microsoft.com/library/windows/apps/dn920012). Finally, make the disconnect button visible to allow the user to stop media casting.\n\n[!code-cs[SelectionChanged](./code/MediaCastingWin10/cs/MainPage.xaml.cs#SnippetSelectionChanged)]\n\nIn the state changed handler, the action you take depends on the new state of the casting connection:\n\n-   If the state is **Connected** or **Rendering**, make sure the **ProgressRing** control is inactive and the disconnect button is visible.\n-   If the state is **Disconnected**, unselect the current casting device in the list box, make the **ProgressRing** control inactive, and hide the disconnect button.\n-   If the state is **Connecting**, make the **ProgressRing** control active and hide the disconnect button.\n-   If the state is **Disconnecting**, make the **ProgressRing** control active and hide the disconnect button.\n\n[!code-cs[StateChanged](./code/MediaCastingWin10/cs/MainPage.xaml.cs#SnippetStateChanged)]\n\nIn the handler for the **ErrorOccurred** event, update your UI to let the user know that a casting error occurred and unselect the current **CastingDevice** object in the list box.\n\n[!code-cs[ErrorOccurred](./code/MediaCastingWin10/cs/MainPage.xaml.cs#SnippetErrorOccurred)]\n\nFinally, implement the handler for the disconnect button. Stop media casting and disconnect from the casting device by calling the **CastingConnection** object's [**DisconnectAsync**](https://msdn.microsoft.com/library/windows/apps/dn972518) method. This call must be dispatched to the UI thread by calling [**CoreDispatcher.RunAsync**](https://msdn.microsoft.com/library/windows/apps/hh750317).\n\n[!code-cs[DisconnectButton](./code/MediaCastingWin10/cs/MainPage.xaml.cs#SnippetDisconnectButton)]\n\n \n\n \n\n\n\n\n"}