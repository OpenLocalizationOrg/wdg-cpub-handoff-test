{"nodes":[{"pos":[11,42],"content":"Share certificates between apps","needQuote":true,"needEscape":true,"nodes":[{"content":"Share certificates between apps","pos":[0,31]}]},{"pos":[56,211],"content":"Universal Windows Platform (UWP) apps that require secure authentication beyond a user Id and password combination can use certificates for authentication.","needQuote":true,"needEscape":true,"nodes":[{"content":"Universal Windows Platform (UWP) apps that require secure authentication beyond a user Id and password combination can use certificates for authentication.","pos":[0,155]}]},{"content":"Share certificates between apps","pos":[268,299]},{"content":"\\[ Updated for UWP apps on Windows 10.","pos":[302,340]},{"content":"For Windows 8.x articles, see the <bpt id=\"p1\">[</bpt>archive<ept id=\"p1\">](http://go.microsoft.com/fwlink/p/?linkid=619132)</ept> \\]","pos":[341,436],"source":" For Windows 8.x articles, see the [archive](http://go.microsoft.com/fwlink/p/?linkid=619132) \\]"},{"content":"Universal Windows Platform (UWP) apps that require secure authentication beyond a user Id and password combination can use certificates for authentication.","pos":[439,594]},{"content":"Certificate authentication provides a high level of trust when authenticating a user.","pos":[595,680]},{"content":"In some cases, a group of services will want to authenticate a user for multiple apps.","pos":[681,767]},{"content":"This article shows how you can authenticate multiple apps using the same certificate, and how you can provide convenient code for a user to import a certificate that was provided to access secured web services.","pos":[768,978]},{"content":"Apps can authenticate to a web service using a certificate, and multiple apps can use a single certificate from the certificate store to authenticate the same user.","pos":[980,1144]},{"content":"If a certificate does not exist in the store, you can add code to your app to import a certificate from a PFX file.","pos":[1145,1260]},{"content":"Enable Microsoft Internet Information Services (IIS) and client certificate mapping","pos":[1265,1348]},{"content":"This article uses Microsoft Internet Information Services (IIS) for example purposes.","pos":[1351,1436]},{"content":"IIS is not enabled by default.","pos":[1437,1467]},{"content":"You can enable IIS by using the Control Panel.","pos":[1468,1514]},{"pos":[1520,1567],"content":"Open the Control Panel and select <bpt id=\"p1\">**</bpt>Programs<ept id=\"p1\">**</ept>.","source":"Open the Control Panel and select **Programs**."},{"pos":[1572,1615],"content":"Select <bpt id=\"p1\">**</bpt>Turn Windows features on or off<ept id=\"p1\">**</ept>.","source":"Select **Turn Windows features on or off**."},{"content":"Expand <bpt id=\"p1\">**</bpt>Internet Information Services<ept id=\"p1\">**</ept> and then expand <bpt id=\"p2\">**</bpt>World Wide Web Services<ept id=\"p2\">**</ept>.","pos":[1620,1705],"source":"Expand **Internet Information Services** and then expand **World Wide Web Services**."},{"content":"Expand <bpt id=\"p1\">**</bpt>Application Development Features<ept id=\"p1\">**</ept> and select <bpt id=\"p2\">**</bpt>ASP.NET 3.5<ept id=\"p2\">**</ept> and <bpt id=\"p3\">**</bpt>ASP.NET 4.5<ept id=\"p3\">**</ept>.","pos":[1706,1797],"source":" Expand **Application Development Features** and select **ASP.NET 3.5** and **ASP.NET 4.5**."},{"content":"Making these selections will automatically enable <bpt id=\"p1\">**</bpt>Internet Information Services<ept id=\"p1\">**</ept>.","pos":[1798,1882],"source":" Making these selections will automatically enable **Internet Information Services**."},{"pos":[1887,1921],"content":"Click <bpt id=\"p1\">**</bpt>OK<ept id=\"p1\">**</ept> to apply the changes.","source":"Click **OK** to apply the changes."},{"content":"Create and publish a secured web service","pos":[1926,1966]},{"content":"Run Microsoft Visual Studio as administrator and select <bpt id=\"p1\">**</bpt>New Project<ept id=\"p1\">**</ept> from the start page.","pos":[1973,2065],"source":"Run Microsoft Visual Studio as administrator and select **New Project** from the start page."},{"content":"Administrator access is required to publish a web service to an IIS server.","pos":[2066,2141]},{"content":"In the New Project dialog, change the framework to <bpt id=\"p1\">**</bpt>.NET Framework 3.5<ept id=\"p1\">**</ept>.","pos":[2142,2216],"source":" In the New Project dialog, change the framework to **.NET Framework 3.5**."},{"content":"Select <bpt id=\"p1\">**</bpt>Visual C#<ept id=\"p1\">**</ept><ph id=\"ph1\"> -&amp;gt;</ph> <bpt id=\"p2\">**</bpt>Web<ept id=\"p2\">**</ept><ph id=\"ph2\"> -&amp;gt;</ph> <bpt id=\"p3\">**</bpt>Visual Studio<ept id=\"p3\">**</ept><ph id=\"ph3\"> -&amp;gt;</ph> <bpt id=\"p4\">**</bpt>ASP.NET Web Service Application<ept id=\"p4\">**</ept>.","pos":[2217,2318],"source":" Select **Visual C#** -&gt; **Web** -&gt; **Visual Studio** -&gt; **ASP.NET Web Service Application**."},{"content":"Name the application \"FirstContosoBank\".","pos":[2319,2359]},{"content":"Click <bpt id=\"p1\">**</bpt>OK<ept id=\"p1\">**</ept> to create the project.","pos":[2360,2395],"source":" Click **OK** to create the project."},{"pos":[2400,2514],"content":"In the <bpt id=\"p1\">**</bpt>Service1.asmx.cs<ept id=\"p1\">**</ept> file, replace the default <bpt id=\"p2\">**</bpt>HelloWorld<ept id=\"p2\">**</ept> web method with the following \"Login\" method.","source":"In the **Service1.asmx.cs** file, replace the default **HelloWorld** web method with the following \"Login\" method."},{"pos":[2921,2956],"content":"Save the <bpt id=\"p1\">**</bpt>Service1.asmx.cs<ept id=\"p1\">**</ept> file.","source":"Save the **Service1.asmx.cs** file."},{"pos":[2961,3053],"content":"In the <bpt id=\"p1\">**</bpt>Solution Explorer<ept id=\"p1\">**</ept>, right-click the \"FirstContosoBank\" app and select <bpt id=\"p2\">**</bpt>Publish<ept id=\"p2\">**</ept>.","source":"In the **Solution Explorer**, right-click the \"FirstContosoBank\" app and select **Publish**."},{"content":"In the <bpt id=\"p1\">**</bpt>Publish Web<ept id=\"p1\">**</ept> dialog, create a new profile and name it \"ContosoProfile\".","pos":[3058,3139],"source":"In the **Publish Web** dialog, create a new profile and name it \"ContosoProfile\"."},{"content":"Click <bpt id=\"p1\">**</bpt>Next.<ept id=\"p1\">**</ept>","pos":[3140,3155],"source":" Click **Next.**"},{"content":"On the next page, enter the server name for your IIS server, and specify a site name of \"Default Web Site/FirstContosoBank\".","pos":[3160,3284]},{"content":"Click <bpt id=\"p1\">**</bpt>Publish<ept id=\"p1\">**</ept> to publish your web service.","pos":[3285,3331],"source":" Click **Publish** to publish your web service."},{"content":"Configure your web service to use client certificate authentication","pos":[3336,3403]},{"pos":[3410,3466],"content":"Run the <bpt id=\"p1\">**</bpt>Internet Information Services (IIS) Manager<ept id=\"p1\">**</ept>.","source":"Run the **Internet Information Services (IIS) Manager**."},{"content":"Expand the sites for your IIS server.","pos":[3471,3508]},{"content":"Under the <bpt id=\"p1\">**</bpt>Default Web Site<ept id=\"p1\">**</ept>, select the new \"FirstContosoBank\" web service.","pos":[3509,3587],"source":" Under the **Default Web Site**, select the new \"FirstContosoBank\" web service."},{"content":"In the <bpt id=\"p1\">**</bpt>Actions<ept id=\"p1\">**</ept> section, select <bpt id=\"p2\">**</bpt>Advanced Settings...<ept id=\"p2\">**</ept>.","pos":[3588,3648],"source":" In the **Actions** section, select **Advanced Settings...**."},{"pos":[3653,3716],"content":"Set the <bpt id=\"p1\">**</bpt>Application Pool<ept id=\"p1\">**</ept> to <bpt id=\"p2\">**</bpt>.NET v2.0<ept id=\"p2\">**</ept> and click <bpt id=\"p3\">**</bpt>OK<ept id=\"p3\">**</ept>.","source":"Set the **Application Pool** to **.NET v2.0** and click **OK**."},{"content":"In the <bpt id=\"p1\">**</bpt>Internet Information Services (IIS) Manager<ept id=\"p1\">**</ept>, select your IIS server and then double-click <bpt id=\"p2\">**</bpt>Server Certificates<ept id=\"p2\">**</ept>.","pos":[3721,3846],"source":"In the **Internet Information Services (IIS) Manager**, select your IIS server and then double-click **Server Certificates**."},{"content":"In the <bpt id=\"p1\">**</bpt>Actions<ept id=\"p1\">**</ept> section, select <bpt id=\"p2\">**</bpt>Create Self-Signed Certificate...<ept id=\"p2\">**</ept>.","pos":[3847,3920],"source":" In the **Actions** section, select **Create Self-Signed Certificate...**."},{"content":"Enter \"ContosoBank\" as the friendly name for the certificate and click <bpt id=\"p1\">**</bpt>OK<ept id=\"p1\">**</ept>.","pos":[3921,3999],"source":" Enter \"ContosoBank\" as the friendly name for the certificate and click **OK**."},{"content":"This will create a new certificate for use by the IIS server in the form of \"<ph id=\"ph1\">&amp;lt;</ph>server-name<ph id=\"ph2\">&amp;gt;</ph>.<ph id=\"ph3\">&amp;lt;</ph>domain-name<ph id=\"ph4\">&amp;gt;</ph>\".","pos":[4000,4118],"source":" This will create a new certificate for use by the IIS server in the form of \"&lt;server-name&gt;.&lt;domain-name&gt;\"."},{"content":"In the <bpt id=\"p1\">**</bpt>Internet Information Services (IIS) Manager<ept id=\"p1\">**</ept>, select the default web site.","pos":[4123,4207],"source":"In the **Internet Information Services (IIS) Manager**, select the default web site."},{"content":"In the <bpt id=\"p1\">**</bpt>Actions<ept id=\"p1\">**</ept> section, select <bpt id=\"p2\">**</bpt>Binding<ept id=\"p2\">**</ept> and then click <bpt id=\"p3\">**</bpt>Add...<ept id=\"p3\">**</ept>.","pos":[4208,4281],"source":" In the **Actions** section, select **Binding** and then click **Add...**."},{"content":"Select \"https\" as the type, set the port to \"443\", and enter the full host name for your IIS server (\"<ph id=\"ph1\">&amp;lt;</ph>server-name<ph id=\"ph2\">&amp;gt;</ph>.<ph id=\"ph3\">&amp;lt;</ph>domain-name<ph id=\"ph4\">&amp;gt;</ph>\").","pos":[4282,4426],"source":" Select \"https\" as the type, set the port to \"443\", and enter the full host name for your IIS server (\"&lt;server-name&gt;.&lt;domain-name&gt;\")."},{"content":"Set the SSL certificate to \"ContosoBank\".","pos":[4427,4468]},{"content":"Click <bpt id=\"p1\">**</bpt>OK<ept id=\"p1\">**</ept>.","pos":[4469,4482],"source":" Click **OK**."},{"content":"Click <bpt id=\"p1\">**</bpt>Close<ept id=\"p1\">**</ept> in the <bpt id=\"p2\">**</bpt>Site Bindings<ept id=\"p2\">**</ept> window.","pos":[4483,4531],"source":" Click **Close** in the **Site Bindings** window."},{"content":"In the <bpt id=\"p1\">**</bpt>Internet Information Services (IIS) Manager<ept id=\"p1\">**</ept>, select the \"FirstContosoBank\" web service.","pos":[4536,4634],"source":"In the **Internet Information Services (IIS) Manager**, select the \"FirstContosoBank\" web service."},{"content":"Double-click <bpt id=\"p1\">**</bpt>SSL Settings<ept id=\"p1\">**</ept>.","pos":[4635,4665],"source":" Double-click **SSL Settings**."},{"content":"Check <bpt id=\"p1\">**</bpt>Require SSL<ept id=\"p1\">**</ept>.","pos":[4666,4688],"source":" Check **Require SSL**."},{"content":"Under <bpt id=\"p1\">**</bpt>Client certificates<ept id=\"p1\">**</ept>, select <bpt id=\"p2\">**</bpt>Require<ept id=\"p2\">**</ept>.","pos":[4689,4739],"source":" Under **Client certificates**, select **Require**."},{"content":"In the <bpt id=\"p1\">**</bpt>Actions<ept id=\"p1\">**</ept> section, click <bpt id=\"p2\">**</bpt>Apply<ept id=\"p2\">**</ept>.","pos":[4740,4784],"source":" In the **Actions** section, click **Apply**."},{"content":"You can verify that the web service is configured correctly by opening your web browser and entering the following web address: \"https://<ph id=\"ph1\">&amp;lt;</ph>server-name<ph id=\"ph2\">&amp;gt;</ph>.<ph id=\"ph3\">&amp;lt;</ph>domain-name<ph id=\"ph4\">&amp;gt;</ph>/FirstContosoBank/Service1.asmx\".","pos":[4789,4998],"source":"You can verify that the web service is configured correctly by opening your web browser and entering the following web address: \"https://&lt;server-name&gt;.&lt;domain-name&gt;/FirstContosoBank/Service1.asmx\"."},{"content":"For example, \"https://myserver.example.com/FirstContosoBank/Service1.asmx\".","pos":[4999,5074]},{"content":"If your web service is configured correctly, you will be prompted to select a client certificate in order to access the web service.","pos":[5075,5207]},{"content":"You can repeat the previous steps to create multiple web services that can be accessed using the same client certificate.","pos":[5209,5330]},{"content":"Create a Windows Store app that uses certificate authentication","pos":[5335,5398]},{"content":"Now that you have one or more secured web services, your apps can use certificates to authenticate to those web services.","pos":[5401,5522]},{"content":"When you make a request to an authenticated web service using the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>HttpClient<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn298639)</ept> object, the initial request will not contain a client certificate.","pos":[5523,5730],"source":" When you make a request to an authenticated web service using the [**HttpClient**](https://msdn.microsoft.com/library/windows/apps/dn298639) object, the initial request will not contain a client certificate."},{"content":"The authenticated web service will respond with a request for client authentication.","pos":[5731,5815]},{"content":"When this occurs, the Windows client will automatically query the certificate store for available client certificates.","pos":[5816,5934]},{"content":"Your user can select from these certificates to authenticate to the web service.","pos":[5935,6015]},{"content":"Some certificates are password protected, so you will need to provide the user with a way to input the password for a certificate.","pos":[6016,6146]},{"content":"If there are no client certificates available, then the user will need to add a certificate to the certificate store.","pos":[6148,6265]},{"content":"You can include code in your app that enables a user to select a PFX file that contains a client certificate and then import that certificate into the client certificate store.","pos":[6266,6442]},{"content":"<bpt id=\"p1\">**</bpt>Tip<ept id=\"p1\">**</ept>  You can use makecert.exe to create a PFX file to use with this quickstart.","pos":[6444,6527],"source":"**Tip**  You can use makecert.exe to create a PFX file to use with this quickstart."},{"content":"For information on using makecert.exe, see <bpt id=\"p1\">[</bpt>MakeCert.<ept id=\"p1\">](https://msdn.microsoft.com/library/windows/desktop/aa386968)</ept>","pos":[6528,6643],"source":" For information on using makecert.exe, see [MakeCert.](https://msdn.microsoft.com/library/windows/desktop/aa386968)"},{"content":"Open Visual Studio and create a new project from the start page.","pos":[6652,6716]},{"content":"Name the new project \"FirstContosoBankApp\".","pos":[6717,6760]},{"content":"Click <bpt id=\"p1\">**</bpt>OK<ept id=\"p1\">**</ept> to create the new project.","pos":[6761,6800],"source":" Click **OK** to create the new project."},{"content":"In the MainPage.xaml file, add the following XAML to the default <bpt id=\"p1\">**</bpt>Grid<ept id=\"p1\">**</ept> element.","pos":[6805,6887],"source":"In the MainPage.xaml file, add the following XAML to the default **Grid** element."},{"content":"This XAML includes a button to browse for a PFX file to import, a text box to enter a password for a password-protected PFX file, a button to import a selected PFX file, a button to log in to the secured web service, and a text block to display the status of the current action.","pos":[6888,7166]},{"content":"Save the MainPage.xaml file.","pos":[8368,8396]},{"content":"In the MainPage.xaml.cs file, add the following using statements.","pos":[8401,8466]},{"content":"In the MainPage.xaml.cs file, add the following variables to the <bpt id=\"p1\">**</bpt>MainPage<ept id=\"p1\">**</ept> class.","pos":[8692,8776],"source":"In the MainPage.xaml.cs file, add the following variables to the **MainPage** class."},{"content":"They specify the address for the secured \"Login\" method of your \"FirstContosoBank\" web service, and a global variable that holds a PFX certificate to import into the certificate store.","pos":[8777,8961]},{"content":"Update the <ph id=\"ph1\">&amp;lt;</ph>server-name<ph id=\"ph2\">&amp;gt;</ph> to the fully-qualified server name for your Microsoft Internet Information Server (IIS) server.","pos":[8962,9088],"source":" Update the &lt;server-name&gt; to the fully-qualified server name for your Microsoft Internet Information Server (IIS) server."},{"content":"In the MainPage.xaml.cs file, add the following click handler for the login button and method to access the secured web service.","pos":[9256,9384]},{"content":"In the MainPage.xaml.cs file, add the following click handlers for the button to browse for a PFX file and the button to import a selected PFX file into the certificate store.","pos":[10325,10500]},{"content":"Run your app and log in to your secured web service as well as import a PFX file into the local certificate store.","pos":[12454,12568]},{"content":"You can use these steps to create multiple apps that use the same user certificate to access the same or different secured web services.","pos":[12570,12706]}],"content":"---\ntitle: Share certificates between apps\ndescription: Universal Windows Platform (UWP) apps that require secure authentication beyond a user Id and password combination can use certificates for authentication.\nms.assetid: 159BA284-9FD4-441A-BB45-A00E36A386F9\n---\n\n# Share certificates between apps\n\n\n\\[ Updated for UWP apps on Windows 10. For Windows 8.x articles, see the [archive](http://go.microsoft.com/fwlink/p/?linkid=619132) \\]\n\n\nUniversal Windows Platform (UWP) apps that require secure authentication beyond a user Id and password combination can use certificates for authentication. Certificate authentication provides a high level of trust when authenticating a user. In some cases, a group of services will want to authenticate a user for multiple apps. This article shows how you can authenticate multiple apps using the same certificate, and how you can provide convenient code for a user to import a certificate that was provided to access secured web services.\n\nApps can authenticate to a web service using a certificate, and multiple apps can use a single certificate from the certificate store to authenticate the same user. If a certificate does not exist in the store, you can add code to your app to import a certificate from a PFX file.\n\n## Enable Microsoft Internet Information Services (IIS) and client certificate mapping\n\n\nThis article uses Microsoft Internet Information Services (IIS) for example purposes. IIS is not enabled by default. You can enable IIS by using the Control Panel.\n\n1.  Open the Control Panel and select **Programs**.\n2.  Select **Turn Windows features on or off**.\n3.  Expand **Internet Information Services** and then expand **World Wide Web Services**. Expand **Application Development Features** and select **ASP.NET 3.5** and **ASP.NET 4.5**. Making these selections will automatically enable **Internet Information Services**.\n4.  Click **OK** to apply the changes.\n\n## Create and publish a secured web service\n\n\n1.  Run Microsoft Visual Studio as administrator and select **New Project** from the start page. Administrator access is required to publish a web service to an IIS server. In the New Project dialog, change the framework to **.NET Framework 3.5**. Select **Visual C#** -&gt; **Web** -&gt; **Visual Studio** -&gt; **ASP.NET Web Service Application**. Name the application \"FirstContosoBank\". Click **OK** to create the project.\n2.  In the **Service1.asmx.cs** file, replace the default **HelloWorld** web method with the following \"Login\" method.\n    ```cs\n            [WebMethod]\n            public string Login()\n            {\n                // Verify certificate with CA\n                var cert = new System.Security.Cryptography.X509Certificates.X509Certificate2(\n                    this.Context.Request.ClientCertificate.Certificate);\n                bool test = cert.Verify();\n                return test.ToString();\n            }\n    ```\n\n3.  Save the **Service1.asmx.cs** file.\n4.  In the **Solution Explorer**, right-click the \"FirstContosoBank\" app and select **Publish**.\n5.  In the **Publish Web** dialog, create a new profile and name it \"ContosoProfile\". Click **Next.**\n6.  On the next page, enter the server name for your IIS server, and specify a site name of \"Default Web Site/FirstContosoBank\". Click **Publish** to publish your web service.\n\n## Configure your web service to use client certificate authentication\n\n\n1.  Run the **Internet Information Services (IIS) Manager**.\n2.  Expand the sites for your IIS server. Under the **Default Web Site**, select the new \"FirstContosoBank\" web service. In the **Actions** section, select **Advanced Settings...**.\n3.  Set the **Application Pool** to **.NET v2.0** and click **OK**.\n4.  In the **Internet Information Services (IIS) Manager**, select your IIS server and then double-click **Server Certificates**. In the **Actions** section, select **Create Self-Signed Certificate...**. Enter \"ContosoBank\" as the friendly name for the certificate and click **OK**. This will create a new certificate for use by the IIS server in the form of \"&lt;server-name&gt;.&lt;domain-name&gt;\".\n5.  In the **Internet Information Services (IIS) Manager**, select the default web site. In the **Actions** section, select **Binding** and then click **Add...**. Select \"https\" as the type, set the port to \"443\", and enter the full host name for your IIS server (\"&lt;server-name&gt;.&lt;domain-name&gt;\"). Set the SSL certificate to \"ContosoBank\". Click **OK**. Click **Close** in the **Site Bindings** window.\n6.  In the **Internet Information Services (IIS) Manager**, select the \"FirstContosoBank\" web service. Double-click **SSL Settings**. Check **Require SSL**. Under **Client certificates**, select **Require**. In the **Actions** section, click **Apply**.\n7.  You can verify that the web service is configured correctly by opening your web browser and entering the following web address: \"https://&lt;server-name&gt;.&lt;domain-name&gt;/FirstContosoBank/Service1.asmx\". For example, \"https://myserver.example.com/FirstContosoBank/Service1.asmx\". If your web service is configured correctly, you will be prompted to select a client certificate in order to access the web service.\n\nYou can repeat the previous steps to create multiple web services that can be accessed using the same client certificate.\n\n## Create a Windows Store app that uses certificate authentication\n\n\nNow that you have one or more secured web services, your apps can use certificates to authenticate to those web services. When you make a request to an authenticated web service using the [**HttpClient**](https://msdn.microsoft.com/library/windows/apps/dn298639) object, the initial request will not contain a client certificate. The authenticated web service will respond with a request for client authentication. When this occurs, the Windows client will automatically query the certificate store for available client certificates. Your user can select from these certificates to authenticate to the web service. Some certificates are password protected, so you will need to provide the user with a way to input the password for a certificate.\n\nIf there are no client certificates available, then the user will need to add a certificate to the certificate store. You can include code in your app that enables a user to select a PFX file that contains a client certificate and then import that certificate into the client certificate store.\n\n**Tip**  You can use makecert.exe to create a PFX file to use with this quickstart. For information on using makecert.exe, see [MakeCert.](https://msdn.microsoft.com/library/windows/desktop/aa386968)\n\n \n\n1.  Open Visual Studio and create a new project from the start page. Name the new project \"FirstContosoBankApp\". Click **OK** to create the new project.\n2.  In the MainPage.xaml file, add the following XAML to the default **Grid** element. This XAML includes a button to browse for a PFX file to import, a text box to enter a password for a password-protected PFX file, a button to import a selected PFX file, a button to log in to the secured web service, and a text block to display the status of the current action.\n    ```xaml\n    <Button x:Name=\"Import\" Content=\"Import Certificate (PFX file)\" HorizontalAlignment=\"Left\" Margin=\"352,305,0,0\" VerticalAlignment=\"Top\" Height=\"77\" Width=\"260\" Click=\"Import_Click\" FontSize=\"16\"/>\n    <Button x:Name=\"Login\" Content=\"Login\" HorizontalAlignment=\"Left\" Margin=\"611,305,0,0\" VerticalAlignment=\"Top\" Height=\"75\" Width=\"240\" Click=\"Login_Click\" FontSize=\"16\"/>\n    <TextBlock x:Name=\"Result\" HorizontalAlignment=\"Left\" Margin=\"355,398,0,0\" TextWrapping=\"Wrap\" VerticalAlignment=\"Top\" Height=\"153\" Width=\"560\"/>\n    <PasswordBox x:Name=\"PfxPassword\" HorizontalAlignment=\"Left\" Margin=\"483,271,0,0\" VerticalAlignment=\"Top\" Width=\"229\"/>\n    <TextBlock HorizontalAlignment=\"Left\" Margin=\"355,271,0,0\" TextWrapping=\"Wrap\" Text=\"PFX password\" VerticalAlignment=\"Top\" FontSize=\"18\" Height=\"32\" Width=\"123\"/>\n    <Button x:Name=\"Browse\" Content=\"Browse for PFX file\" HorizontalAlignment=\"Left\" Margin=\"352,189,0,0\" VerticalAlignment=\"Top\" Click=\"Browse_Click\" Width=\"499\" Height=\"68\" FontSize=\"16\"/>\n    <TextBlock HorizontalAlignment=\"Left\" Margin=\"717,271,0,0\" TextWrapping=\"Wrap\" Text=\"(Optional)\" VerticalAlignment=\"Top\" Height=\"32\" Width=\"83\" FontSize=\"16\"/>\n    ```\n    \n3.  Save the MainPage.xaml file.\n4.  In the MainPage.xaml.cs file, add the following using statements.\n    ```cs\n    using Windows.Web.Http;\n    using System.Text;\n    using Windows.Security.Cryptography.Certificates;\n    using Windows.Storage.Pickers;\n    using Windows.Storage;\n    using Windows.Storage.Streams;\n    ```\n\n5.  In the MainPage.xaml.cs file, add the following variables to the **MainPage** class. They specify the address for the secured \"Login\" method of your \"FirstContosoBank\" web service, and a global variable that holds a PFX certificate to import into the certificate store. Update the &lt;server-name&gt; to the fully-qualified server name for your Microsoft Internet Information Server (IIS) server.\n    ```cs\n    private Uri requestUri = new Uri(\"https://&lt;server-name&gt;/FirstContosoBank/Service1.asmx?op=Login\");\n    private string pfxCert = null;\n    ```\n\n6.  In the MainPage.xaml.cs file, add the following click handler for the login button and method to access the secured web service.\n    ```cs\n    private void Login_Click(object sender, RoutedEventArgs e)\n    {\n        MakeHttpsCall();\n    }\n\n    private async void MakeHttpsCall()\n    {\n\n        StringBuilder result = new StringBuilder(\"Login \");\n        HttpResponseMessage response;\n        try\n        {\n            Windows.Web.Http.HttpClient httpClient = new Windows.Web.Http.HttpClient();\n            response = await httpClient.GetAsync(requestUri);\n            if (response.StatusCode == HttpStatusCode.Ok)\n            {\n                result.Append(\"successful\");\n            }\n            else\n            {\n                result = result.Append(\"failed with \");\n                result = result.Append(response.StatusCode);\n            }\n        }\n        catch (Exception ex)\n        {\n            result = result.Append(\"failed with \");\n            result = result.Append(ex.Message);\n        }\n\n        Result.Text = result.ToString();\n    }\n    ```\n\n7.  In the MainPage.xaml.cs file, add the following click handlers for the button to browse for a PFX file and the button to import a selected PFX file into the certificate store.\n    ```cs\n    private async void Import_Click(object sender, RoutedEventArgs e)\n    {\n        try\n        {\n            Result.Text = \"Importing selected certificate into user certificate store....\";\n            await CertificateEnrollmentManager.UserCertificateEnrollmentManager.ImportPfxDataAsync(\n                pfxCert,\n                PfxPassword.Password,\n                ExportOption.Exportable,\n                KeyProtectionLevel.NoConsent,\n                InstallOptions.DeleteExpired,\n                \"Import Pfx\");\n\n            Result.Text = \"Certificate import succeded\";\n        }\n        catch (Exception ex)\n        {\n            Result.Text = \"Certificate import failed with \" + ex.Message;\n        }\n    }\n\n    private async void Browse_Click(object sender, RoutedEventArgs e)\n    {\n\n        StringBuilder result = new StringBuilder(\"Pfx file selection \");\n        FileOpenPicker pfxFilePicker = new FileOpenPicker();\n        pfxFilePicker.FileTypeFilter.Add(\".pfx\");\n        pfxFilePicker.CommitButtonText = \"Open\";\n        try\n        {\n            StorageFile pfxFile = await pfxFilePicker.PickSingleFileAsync();\n            if (pfxFile != null)\n            {\n                IBuffer buffer = await FileIO.ReadBufferAsync(pfxFile);\n                using (DataReader dataReader = DataReader.FromBuffer(buffer))\n                {\n                    byte[] bytes = new byte[buffer.Length];\n                    dataReader.ReadBytes(bytes);\n                    pfxCert = System.Convert.ToBase64String(bytes);\n                    PfxPassword.Password = string.Empty;\n                    result.Append(\"succeeded\");\n                }\n            }\n            else\n            {\n                result.Append(\"failed\");\n            }\n        }\n        catch (Exception ex)\n        {\n            result.Append(\"failed with \");\n            result.Append(ex.Message); ;\n        }\n\n        Result.Text = result.ToString();\n    }\n    ```\n\n8.  Run your app and log in to your secured web service as well as import a PFX file into the local certificate store.\n\nYou can use these steps to create multiple apps that use the same user certificate to access the same or different secured web services.\n\n \n\n \n\n\n\n\n"}