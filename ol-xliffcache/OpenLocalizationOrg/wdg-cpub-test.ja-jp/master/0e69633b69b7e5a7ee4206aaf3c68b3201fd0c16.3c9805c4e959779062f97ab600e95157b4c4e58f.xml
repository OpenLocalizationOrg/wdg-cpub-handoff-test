{"nodes":[{"pos":[66,227],"content":"This article explains how to load and save image files using BitmapDecoder and BitmapEncoder and how to use the SoftwareBitmap object to represent bitmap images.","needQuote":true,"needEscape":true,"nodes":[{"content":"This article explains how to load and save image files using BitmapDecoder and BitmapEncoder and how to use the SoftwareBitmap object to represent bitmap images.","pos":[0,161]}]},{"pos":[235,242],"content":"Imaging","needQuote":true,"needEscape":true,"nodes":[{"content":"Imaging","pos":[0,7]}]},{"content":"Imaging","pos":[250,257]},{"content":"\\[ Updated for UWP apps on Windows 10.","pos":[259,297]},{"content":"For Windows 8.x articles, see the <bpt id=\"p1\">[</bpt>archive<ept id=\"p1\">](http://go.microsoft.com/fwlink/p/?linkid=619132)</ept> \\]","pos":[298,393],"source":" For Windows 8.x articles, see the [archive](http://go.microsoft.com/fwlink/p/?linkid=619132) \\]"},{"pos":[396,749],"content":"This article explains how to load and save image files using <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>BitmapDecoder<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br226176)</ept> and <bpt id=\"p3\">[</bpt><bpt id=\"p4\">**</bpt>BitmapEncoder<ept id=\"p4\">**</ept><ept id=\"p3\">](https://msdn.microsoft.com/library/windows/apps/br226206)</ept> and how to use the <bpt id=\"p5\">[</bpt><bpt id=\"p6\">**</bpt>SoftwareBitmap<ept id=\"p6\">**</ept><ept id=\"p5\">](https://msdn.microsoft.com/library/windows/apps/dn887358)</ept> object to represent bitmap images.","source":"This article explains how to load and save image files using [**BitmapDecoder**](https://msdn.microsoft.com/library/windows/apps/br226176) and [**BitmapEncoder**](https://msdn.microsoft.com/library/windows/apps/br226206) and how to use the [**SoftwareBitmap**](https://msdn.microsoft.com/library/windows/apps/dn887358) object to represent bitmap images."},{"content":"The <bpt id=\"p1\">**</bpt>SoftwareBitmap<ept id=\"p1\">**</ept> class is a versatile API that can be created from multiple sources including image files, <bpt id=\"p2\">[</bpt><bpt id=\"p3\">**</bpt>WriteableBitmap<ept id=\"p3\">**</ept><ept id=\"p2\">](https://msdn.microsoft.com/library/windows/apps/br243259)</ept> objects, Direct3D surfaces, and code.","pos":[751,981],"source":"The **SoftwareBitmap** class is a versatile API that can be created from multiple sources including image files, [**WriteableBitmap**](https://msdn.microsoft.com/library/windows/apps/br243259) objects, Direct3D surfaces, and code."},{"content":"<bpt id=\"p1\">**</bpt>SoftwareBitmap<ept id=\"p1\">**</ept> allows you to easily convert between different pixel formats and alpha modes, and allows low-level access to pixel data.","pos":[982,1121],"source":"**SoftwareBitmap** allows you to easily convert between different pixel formats and alpha modes, and allows low-level access to pixel data."},{"content":"Also, <bpt id=\"p1\">**</bpt>SoftwareBitmap<ept id=\"p1\">**</ept> is a common interface used by multiple features of Windows, including:","pos":[1122,1217],"source":" Also, **SoftwareBitmap** is a common interface used by multiple features of Windows, including:"},{"pos":[1223,1373],"content":"<bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>CapturedFrame<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn278725)</ept> allows you to get frames captured by the camera as a <bpt id=\"p3\">**</bpt>SoftwareBitmap<ept id=\"p3\">**</ept>.","source":"[**CapturedFrame**](https://msdn.microsoft.com/library/windows/apps/dn278725) allows you to get frames captured by the camera as a **SoftwareBitmap**."},{"pos":[1379,1528],"content":"<bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>VideoFrame<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn930917)</ept> allows you to get a <bpt id=\"p3\">**</bpt>SoftwareBitmap<ept id=\"p3\">**</ept> representation of a <bpt id=\"p4\">**</bpt>VideoFrame<ept id=\"p4\">**</ept>.","source":"[**VideoFrame**](https://msdn.microsoft.com/library/windows/apps/dn930917) allows you to get a **SoftwareBitmap** representation of a **VideoFrame**."},{"pos":[1534,1662],"content":"<bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>FaceDetector<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn974129)</ept> allows you to detect faces in a <bpt id=\"p3\">**</bpt>SoftwareBitmap<ept id=\"p3\">**</ept>.","source":"[**FaceDetector**](https://msdn.microsoft.com/library/windows/apps/dn974129) allows you to detect faces in a **SoftwareBitmap**."},{"content":"The sample code in this article uses APIs from the following namespaces.","pos":[1664,1736]},{"pos":[1748,1758],"content":"Namespaces"},{"content":"Create a SoftwareBitmap from an image file with BitmapDecoder","pos":[1824,1885]},{"content":"To create a <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>SoftwareBitmap<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn887358)</ept> from a file, get an instance of <bpt id=\"p3\">[</bpt><bpt id=\"p4\">**</bpt>StorageFile<ept id=\"p4\">**</ept><ept id=\"p3\">](https://msdn.microsoft.com/library/windows/apps/br227171)</ept> containing the image data.","pos":[1887,2112],"source":"To create a [**SoftwareBitmap**](https://msdn.microsoft.com/library/windows/apps/dn887358) from a file, get an instance of [**StorageFile**](https://msdn.microsoft.com/library/windows/apps/br227171) containing the image data."},{"content":"This example uses a <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>FileOpenPicker<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br207847)</ept> to allow the user to select an image file.","pos":[2113,2254],"source":" This example uses a [**FileOpenPicker**](https://msdn.microsoft.com/library/windows/apps/br207847) to allow the user to select an image file."},{"pos":[2266,2279],"content":"PickInputFile"},{"content":"Call the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>OpenAsync<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br227116)</ept> method of the <bpt id=\"p3\">**</bpt>StorageFile<ept id=\"p3\">**</ept> object to get a random access stream containing the image data.","pos":[2345,2521],"source":"Call the [**OpenAsync**](https://msdn.microsoft.com/library/windows/apps/br227116) method of the **StorageFile** object to get a random access stream containing the image data."},{"content":"Call the static method <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>BitmapDecoder.CreateAsync<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br226182)</ept> to get an instance of the <bpt id=\"p3\">[</bpt><bpt id=\"p4\">**</bpt>BitmapDecoder<ept id=\"p4\">**</ept><ept id=\"p3\">](https://msdn.microsoft.com/library/windows/apps/br226176)</ept> class for the specified stream.","pos":[2522,2770],"source":" Call the static method [**BitmapDecoder.CreateAsync**](https://msdn.microsoft.com/library/windows/apps/br226182) to get an instance of the [**BitmapDecoder**](https://msdn.microsoft.com/library/windows/apps/br226176) class for the specified stream."},{"content":"Call <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>GetSoftwareBitmapAsync<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn887332)</ept> to get a <bpt id=\"p3\">[</bpt><bpt id=\"p4\">**</bpt>SoftwareBitmap<ept id=\"p4\">**</ept><ept id=\"p3\">](https://msdn.microsoft.com/library/windows/apps/dn887358)</ept> object containing the image.","pos":[2771,2979],"source":" Call [**GetSoftwareBitmapAsync**](https://msdn.microsoft.com/library/windows/apps/dn887332) to get a [**SoftwareBitmap**](https://msdn.microsoft.com/library/windows/apps/dn887358) object containing the image."},{"pos":[2991,3019],"content":"CreateSoftwareBitmapFromFile"},{"content":"Save a SoftwareBitmap to a file with BitmapEncoder","pos":[3103,3153]},{"content":"To save a <bpt id=\"p1\">**</bpt>SoftwareBitmap<ept id=\"p1\">**</ept> to a file, get an instance of <bpt id=\"p2\">**</bpt>StorageFile<ept id=\"p2\">**</ept> to which the image will be saved.","pos":[3155,3263],"source":"To save a **SoftwareBitmap** to a file, get an instance of **StorageFile** to which the image will be saved."},{"content":"This example uses a <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>FileSavePicker<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br207871)</ept> to allow the user to select an output file.","pos":[3264,3406],"source":" This example uses a [**FileSavePicker**](https://msdn.microsoft.com/library/windows/apps/br207871) to allow the user to select an output file."},{"pos":[3418,3431],"content":"PickOuputFile"},{"content":"Call the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>OpenAsync<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br227116)</ept> method of the <bpt id=\"p3\">**</bpt>StorageFile<ept id=\"p3\">**</ept> object to get a random access stream to which the image will be written.","pos":[3497,3682],"source":"Call the [**OpenAsync**](https://msdn.microsoft.com/library/windows/apps/br227116) method of the **StorageFile** object to get a random access stream to which the image will be written."},{"content":"Call the static method <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>BitmapEncoder.CreateAsync<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br226211)</ept> to get an instance of the <bpt id=\"p3\">[</bpt><bpt id=\"p4\">**</bpt>BitmapEncoder<ept id=\"p4\">**</ept><ept id=\"p3\">](https://msdn.microsoft.com/library/windows/apps/br226206)</ept> class for the specified stream.","pos":[3683,3931],"source":" Call the static method [**BitmapEncoder.CreateAsync**](https://msdn.microsoft.com/library/windows/apps/br226211) to get an instance of the [**BitmapEncoder**](https://msdn.microsoft.com/library/windows/apps/br226206) class for the specified stream."},{"content":"The first parameter to <bpt id=\"p1\">**</bpt>CreateAsync<ept id=\"p1\">**</ept> is a GUID representing the codec that should be used to encode the image.","pos":[3932,4044],"source":" The first parameter to **CreateAsync** is a GUID representing the codec that should be used to encode the image."},{"content":"<bpt id=\"p1\">**</bpt>BitmapEncoder<ept id=\"p1\">**</ept> class exposes a property containing the ID for each codec supported by the encoder, such as <bpt id=\"p2\">[</bpt><bpt id=\"p3\">**</bpt>JpegEncoderId<ept id=\"p3\">**</ept><ept id=\"p2\">](https://msdn.microsoft.com/library/windows/apps/br226226)</ept>.","pos":[4045,4233],"source":"**BitmapEncoder** class exposes a property containing the ID for each codec supported by the encoder, such as [**JpegEncoderId**](https://msdn.microsoft.com/library/windows/apps/br226226)."},{"content":"Use the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>SetSoftwareBitmap<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn887337)</ept> method to set the image that will be encoded.","pos":[4235,4370],"source":"Use the [**SetSoftwareBitmap**](https://msdn.microsoft.com/library/windows/apps/dn887337) method to set the image that will be encoded."},{"content":"You can set values of the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>BitmapTransform<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br226254)</ept> property to apply basic transforms to the image while it is being encoded.","pos":[4371,4551],"source":" You can set values of the [**BitmapTransform**](https://msdn.microsoft.com/library/windows/apps/br226254) property to apply basic transforms to the image while it is being encoded."},{"content":"The <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>IsThumbnailGenerated<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br226225)</ept> property determines whether a thumbnail is generated by the encoder.","pos":[4552,4709],"source":" The [**IsThumbnailGenerated**](https://msdn.microsoft.com/library/windows/apps/br226225) property determines whether a thumbnail is generated by the encoder."},{"content":"Note that not all file formats support thumbnails, so if you use this feature, you should catch the unsupported operation error that will be thrown if thumbnails are not supported.","pos":[4710,4890]},{"pos":[4892,5039],"content":"Call <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>FlushAsync<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br226216)</ept> to cause the encoder to write the image data to the specified file.","source":"Call [**FlushAsync**](https://msdn.microsoft.com/library/windows/apps/br226216) to cause the encoder to write the image data to the specified file."},{"pos":[5051,5075],"content":"SaveSoftwareBitmapToFile"},{"content":"You can specify additional encoding options when you create the <bpt id=\"p1\">**</bpt>BitmapEncoder<ept id=\"p1\">**</ept> by creating a new <bpt id=\"p2\">[</bpt><bpt id=\"p3\">**</bpt>BitmapPropertySet<ept id=\"p3\">**</ept><ept id=\"p2\">](https://msdn.microsoft.com/library/windows/apps/hh974338)</ept> object and populating it with one or more <bpt id=\"p4\">[</bpt><bpt id=\"p5\">**</bpt>BitmapTypedValue<ept id=\"p5\">**</ept><ept id=\"p4\">](https://msdn.microsoft.com/library/windows/apps/hh700687)</ept> objects representing the encoder settings.","pos":[5152,5499],"source":"You can specify additional encoding options when you create the **BitmapEncoder** by creating a new [**BitmapPropertySet**](https://msdn.microsoft.com/library/windows/apps/hh974338) object and populating it with one or more [**BitmapTypedValue**](https://msdn.microsoft.com/library/windows/apps/hh700687) objects representing the encoder settings."},{"content":"For a list of supported encoder options, see <bpt id=\"p1\">[</bpt>BitmapEncoder options reference<ept id=\"p1\">](bitmapencoder-options-reference.md)</ept>.","pos":[5500,5615],"source":" For a list of supported encoder options, see [BitmapEncoder options reference](bitmapencoder-options-reference.md)."},{"pos":[5627,5645],"content":"UseEncodingOptions"},{"content":"Use SoftwareBitmap with a XAML Image control","pos":[5719,5763]},{"pos":[5765,5945],"content":"To display an image within a XAML page using the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>Image<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br242752)</ept> control, first define an <bpt id=\"p3\">**</bpt>Image<ept id=\"p3\">**</ept> control in your XAML page.","source":"To display an image within a XAML page using the [**Image**](https://msdn.microsoft.com/library/windows/apps/br242752) control, first define an **Image** control in your XAML page."},{"pos":[5958,5970],"content":"ImageControl"},{"content":"Create a new <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>SoftwareBitmapSource<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn997854)</ept> object.","pos":[6032,6137],"source":"Create a new [**SoftwareBitmapSource**](https://msdn.microsoft.com/library/windows/apps/dn997854) object."},{"content":"Set the contents of the source object by calling <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>SetBitmapAsync<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn997856)</ept>, passing in a <bpt id=\"p3\">**</bpt>SoftwareBitmap<ept id=\"p3\">**</ept>.","pos":[6138,6299],"source":" Set the contents of the source object by calling [**SetBitmapAsync**](https://msdn.microsoft.com/library/windows/apps/dn997856), passing in a **SoftwareBitmap**."},{"content":"Then you can set the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>Source<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br242760)</ept> property of the <bpt id=\"p3\">**</bpt>Image<ept id=\"p3\">**</ept> control to the newly created <bpt id=\"p4\">**</bpt>SoftwareBitmapSource<ept id=\"p4\">**</ept>.","pos":[6300,6472],"source":" Then you can set the [**Source**](https://msdn.microsoft.com/library/windows/apps/br242760) property of the **Image** control to the newly created **SoftwareBitmapSource**."},{"pos":[6484,6515],"content":"SoftwareBitmapToWriteableBitmap"},{"pos":[6599,6834],"content":"You can also use <bpt id=\"p1\">**</bpt>SoftwareBitmapSource<ept id=\"p1\">**</ept> to set a <bpt id=\"p2\">**</bpt>SoftwareBitmap<ept id=\"p2\">**</ept> as the <bpt id=\"p3\">[</bpt><bpt id=\"p4\">**</bpt>ImageSource<ept id=\"p4\">**</ept><ept id=\"p3\">](https://msdn.microsoft.com/library/windows/apps/br210105)</ept> for an <bpt id=\"p5\">[</bpt><bpt id=\"p6\">**</bpt>ImageBrush<ept id=\"p6\">**</ept><ept id=\"p5\">](https://msdn.microsoft.com/library/windows/apps/br210101)</ept>.","source":"You can also use **SoftwareBitmapSource** to set a **SoftwareBitmap** as the [**ImageSource**](https://msdn.microsoft.com/library/windows/apps/br210105) for an [**ImageBrush**](https://msdn.microsoft.com/library/windows/apps/br210101)."},{"content":"Create a SoftwareBitmap from a WriteableBitmap","pos":[6839,6885]},{"content":"You can create a <bpt id=\"p1\">**</bpt>SoftwareBitmap<ept id=\"p1\">**</ept> from an existing <bpt id=\"p2\">**</bpt>WriteableBitmap<ept id=\"p2\">**</ept> by calling <bpt id=\"p3\">[</bpt><bpt id=\"p4\">**</bpt>SoftwareBitmap.CreateCopyFromBuffer<ept id=\"p4\">**</ept><ept id=\"p3\">](https://msdn.microsoft.com/library/windows/apps/dn887370)</ept> and supplying the <bpt id=\"p5\">**</bpt>PixelBuffer<ept id=\"p5\">**</ept> property of the <bpt id=\"p6\">**</bpt>WriteableBitmap<ept id=\"p6\">**</ept> to set the pixel data.","pos":[6887,7163],"source":"You can create a **SoftwareBitmap** from an existing **WriteableBitmap** by calling [**SoftwareBitmap.CreateCopyFromBuffer**](https://msdn.microsoft.com/library/windows/apps/dn887370) and supplying the **PixelBuffer** property of the **WriteableBitmap** to set the pixel data."},{"content":"The second argument allows you to request a pixel format for the newly created <bpt id=\"p1\">**</bpt>WriteableBitmap<ept id=\"p1\">**</ept>.","pos":[7164,7263],"source":" The second argument allows you to request a pixel format for the newly created **WriteableBitmap**."},{"content":"You can use the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>PixelWidth<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br243253)</ept> and <bpt id=\"p3\">[</bpt><bpt id=\"p4\">**</bpt>PixelHeight<ept id=\"p4\">**</ept><ept id=\"p3\">](https://msdn.microsoft.com/library/windows/apps/br243251)</ept> properties of the <bpt id=\"p5\">**</bpt>WriteableBitmap<ept id=\"p5\">**</ept> to specify the dimensions of the new image.","pos":[7264,7516],"source":" You can use the [**PixelWidth**](https://msdn.microsoft.com/library/windows/apps/br243253) and [**PixelHeight**](https://msdn.microsoft.com/library/windows/apps/br243251) properties of the **WriteableBitmap** to specify the dimensions of the new image."},{"pos":[7528,7559],"content":"WriteableBitmapToSoftwareBitmap"},{"content":"Create or edit a SoftwareBitmap programmatically","pos":[7646,7694]},{"content":"So far this topic has addressed working with image files.","pos":[7696,7753]},{"content":"You can also create a new <bpt id=\"p1\">**</bpt>SoftwareBitmap<ept id=\"p1\">**</ept> programatically in code and use the same technique to access and modify the <bpt id=\"p2\">**</bpt>SoftwareBitmap<ept id=\"p2\">**</ept>'s pixel data.","pos":[7754,7907],"source":" You can also create a new **SoftwareBitmap** programatically in code and use the same technique to access and modify the **SoftwareBitmap**'s pixel data."},{"pos":[7909,7996],"content":"<bpt id=\"p1\">**</bpt>SoftwareBitmap<ept id=\"p1\">**</ept> uses COM interop to expose the raw buffer containing the pixel data.","source":"**SoftwareBitmap** uses COM interop to expose the raw buffer containing the pixel data."},{"pos":[7998,8115],"content":"To use COM interop, you must include a reference to the <bpt id=\"p1\">**</bpt>System.Runtime.InteropServices<ept id=\"p1\">**</ept> namespace in your project.","source":"To use COM interop, you must include a reference to the **System.Runtime.InteropServices** namespace in your project."},{"pos":[8127,8143],"content":"InteropNamespace"},{"pos":[8212,8383],"content":"Initialize the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>IMemoryBufferByteAccess<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/desktop/mt297505)</ept> COM interface by adding the following code within your namespace.","source":"Initialize the [**IMemoryBufferByteAccess**](https://msdn.microsoft.com/library/windows/desktop/mt297505) COM interface by adding the following code within your namespace."},{"pos":[8395,8404],"content":"COMImport"},{"content":"Create a new <bpt id=\"p1\">**</bpt>SoftwareBitmap<ept id=\"p1\">**</ept> with pixel format and size you want.","pos":[8466,8534],"source":"Create a new **SoftwareBitmap** with pixel format and size you want."},{"content":"Or, use an existing <bpt id=\"p1\">**</bpt>SoftwareBitmap<ept id=\"p1\">**</ept> for which you want to edit the pixel data.","pos":[8535,8616],"source":" Or, use an existing **SoftwareBitmap** for which you want to edit the pixel data."},{"content":"Call <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>SoftwareBitmap.LockBuffer<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn887380)</ept> to obtain an instance of the <bpt id=\"p3\">[</bpt><bpt id=\"p4\">**</bpt>BitmapBuffer<ept id=\"p4\">**</ept><ept id=\"p3\">](https://msdn.microsoft.com/library/windows/apps/dn887325)</ept> class representing the pixel data buffer.","pos":[8617,8859],"source":" Call [**SoftwareBitmap.LockBuffer**](https://msdn.microsoft.com/library/windows/apps/dn887380) to obtain an instance of the [**BitmapBuffer**](https://msdn.microsoft.com/library/windows/apps/dn887325) class representing the pixel data buffer."},{"content":"Cast the <bpt id=\"p1\">**</bpt>BitmapBuffer<ept id=\"p1\">**</ept> to the <bpt id=\"p2\">**</bpt>IMemoryBufferByteAccess<ept id=\"p2\">**</ept> COM interface and then call <bpt id=\"p3\">[</bpt><bpt id=\"p4\">**</bpt>IMemoryBufferByteAccess.GetBuffer<ept id=\"p4\">**</ept><ept id=\"p3\">](https://msdn.microsoft.com/library/windows/desktop/mt297506)</ept> to populate a byte array with data.","pos":[8860,9085],"source":" Cast the **BitmapBuffer** to the **IMemoryBufferByteAccess** COM interface and then call [**IMemoryBufferByteAccess.GetBuffer**](https://msdn.microsoft.com/library/windows/desktop/mt297506) to populate a byte array with data."},{"content":"Use the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>BitmapBuffer.GetPlaneDescription<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn887330)</ept> method to get a <bpt id=\"p3\">[</bpt><bpt id=\"p4\">**</bpt>BitmapPlaneDescription<ept id=\"p4\">**</ept><ept id=\"p3\">](https://msdn.microsoft.com/library/windows/apps/dn887342)</ept> object that will help you calculate the offset into the buffer for each pixel.","pos":[9086,9372],"source":" Use the [**BitmapBuffer.GetPlaneDescription**](https://msdn.microsoft.com/library/windows/apps/dn887330) method to get a [**BitmapPlaneDescription**](https://msdn.microsoft.com/library/windows/apps/dn887342) object that will help you calculate the offset into the buffer for each pixel."},{"pos":[9384,9407],"content":"CreateNewSoftwareBitmap"},{"content":"Because this method accesses the raw buffer underlying the Windows Runtime types, it must be declared using the <bpt id=\"p1\">**</bpt>unsafe<ept id=\"p1\">**</ept> keyword.","pos":[9483,9614],"source":"Because this method accesses the raw buffer underlying the Windows Runtime types, it must be declared using the **unsafe** keyword."},{"content":"You must also configure your project in Microsoft Visual Studio to allow the compilation of unsafe code by opening the project's <bpt id=\"p1\">**</bpt>Properties<ept id=\"p1\">**</ept> page, clicking the <bpt id=\"p2\">**</bpt>Build<ept id=\"p2\">**</ept> property page, and selecting the <bpt id=\"p3\">**</bpt>Allow Unsafe Code<ept id=\"p3\">**</ept> checkbox.","pos":[9615,9852],"source":" You must also configure your project in Microsoft Visual Studio to allow the compilation of unsafe code by opening the project's **Properties** page, clicking the **Build** property page, and selecting the **Allow Unsafe Code** checkbox."},{"content":"Create a SoftwareBitmap from a Direct3D surface","pos":[9857,9904]},{"pos":[9906,10116],"content":"To create a <bpt id=\"p1\">**</bpt>SoftwareBitmap<ept id=\"p1\">**</ept> object from a Direct3D surface, you must include the <bpt id=\"p2\">[</bpt><bpt id=\"p3\">**</bpt>Windows.Graphics.DirectX.Direct3D11<ept id=\"p3\">**</ept><ept id=\"p2\">](https://msdn.microsoft.com/library/windows/apps/dn895104)</ept> namespace in your project.","source":"To create a **SoftwareBitmap** object from a Direct3D surface, you must include the [**Windows.Graphics.DirectX.Direct3D11**](https://msdn.microsoft.com/library/windows/apps/dn895104) namespace in your project."},{"pos":[10128,10145],"content":"Direct3DNamespace"},{"content":"Call <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>CreateCopyFromSurfaceAsync<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn887373)</ept> to create a new <bpt id=\"p3\">**</bpt>SoftwareBitmap<ept id=\"p3\">**</ept> from the surface.","pos":[10215,10363],"source":"Call [**CreateCopyFromSurfaceAsync**](https://msdn.microsoft.com/library/windows/apps/dn887373) to create a new **SoftwareBitmap** from the surface."},{"content":"As the name indicates, the new <bpt id=\"p1\">**</bpt>SoftwareBitmap<ept id=\"p1\">**</ept> has a separate copy of the image data.","pos":[10364,10452],"source":" As the name indicates, the new **SoftwareBitmap** has a separate copy of the image data."},{"content":"Modifications to the <bpt id=\"p1\">**</bpt>SoftwareBitmap<ept id=\"p1\">**</ept> will not have any effect on the Direct3D surface.","pos":[10453,10542],"source":" Modifications to the **SoftwareBitmap** will not have any effect on the Direct3D surface."},{"pos":[10554,10585],"content":"CreateSoftwareBitmapFromSurface"},{"content":"Convert a SoftwareBitmap to a different pixel format","pos":[10672,10724]},{"content":"The <bpt id=\"p1\">**</bpt>SoftwareBitmap<ept id=\"p1\">**</ept> class provides the static method, <bpt id=\"p2\">[</bpt><bpt id=\"p3\">**</bpt>Convert<ept id=\"p3\">**</ept><ept id=\"p2\">](https://msdn.microsoft.com/library/windows/apps/dn887362)</ept>, that allows you to easily create a new <bpt id=\"p4\">**</bpt>SoftwareBitmap<ept id=\"p4\">**</ept> that uses the pixel format and alpha mode you specify from an existing <bpt id=\"p5\">**</bpt>SoftwareBitmap<ept id=\"p5\">**</ept>.","pos":[10726,11004],"source":"The **SoftwareBitmap** class provides the static method, [**Convert**](https://msdn.microsoft.com/library/windows/apps/dn887362), that allows you to easily create a new **SoftwareBitmap** that uses the pixel format and alpha mode you specify from an existing **SoftwareBitmap**."},{"content":"Note that the newly created bitmap has a separate copy of the image data.","pos":[11005,11078]},{"content":"Modifications to the new bitmap will not affect the source bitmap.","pos":[11079,11145]},{"pos":[11157,11164],"content":"Convert"},{"content":"Transcode an image file","pos":[11227,11250]},{"content":"You can transcode an image file directly from a <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>BitmapDecoder<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br226176)</ept> to a <bpt id=\"p3\">[</bpt><bpt id=\"p4\">**</bpt>BitmapEncoder<ept id=\"p4\">**</ept><ept id=\"p3\">](https://msdn.microsoft.com/library/windows/apps/br226206)</ept>.","pos":[11252,11461],"source":"You can transcode an image file directly from a [**BitmapDecoder**](https://msdn.microsoft.com/library/windows/apps/br226176) to a [**BitmapEncoder**](https://msdn.microsoft.com/library/windows/apps/br226206)."},{"content":"Create a <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>IRandomAccessStream<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br241731)</ept> from the file to be transcoded.","pos":[11462,11586],"source":" Create a [**IRandomAccessStream**](https://msdn.microsoft.com/library/windows/apps/br241731) from the file to be transcoded."},{"content":"Create a new <bpt id=\"p1\">**</bpt>BitmapDecoder<ept id=\"p1\">**</ept> from the input stream.","pos":[11587,11640],"source":" Create a new **BitmapDecoder** from the input stream."},{"content":"Create a new <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>InMemoryRandomAccessStream<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br241720)</ept> for the encoder to write to and call <bpt id=\"p3\">[</bpt><bpt id=\"p4\">**</bpt>BitmapEncoder.CreateForTranscodingAsync<ept id=\"p4\">**</ept><ept id=\"p3\">](https://msdn.microsoft.com/library/windows/apps/br226214)</ept>, passing in the in-memory stream and the decoder object.","pos":[11641,11942],"source":" Create a new [**InMemoryRandomAccessStream**](https://msdn.microsoft.com/library/windows/apps/br241720) for the encoder to write to and call [**BitmapEncoder.CreateForTranscodingAsync**](https://msdn.microsoft.com/library/windows/apps/br226214), passing in the in-memory stream and the decoder object."},{"content":"Set the encoding properties you want.","pos":[11943,11980]},{"content":"Any properties in the input image file that you do not specifically set on the encoder, will be written to the output file unchanged.","pos":[11981,12114]},{"content":"Call <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>FlushAsync<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br226216)</ept> to cause the encoder to encode to the in-memory stream.","pos":[12115,12250],"source":" Call [**FlushAsync**](https://msdn.microsoft.com/library/windows/apps/br226216) to cause the encoder to encode to the in-memory stream."},{"content":"Finally, seek the file stream and the in-memory stream to the beginning and call <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>CopyAsync<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/hh701827)</ept> to write the in-memory stream out to the file stream.","pos":[12251,12459],"source":" Finally, seek the file stream and the in-memory stream to the beginning and call [**CopyAsync**](https://msdn.microsoft.com/library/windows/apps/hh701827) to write the in-memory stream out to the file stream."},{"pos":[12471,12489],"content":"TranscodeImageFile"},{"content":"Related topics","pos":[12563,12577]},{"content":"BitmapEncoder options reference","pos":[12582,12613]},{"content":"Image Metadata","pos":[12654,12668]}],"content":"---\nms.assetid: 3FD2AA71-EF67-47B2-9332-3FFA5D3703EA\ndescription: This article explains how to load and save image files using BitmapDecoder and BitmapEncoder and how to use the SoftwareBitmap object to represent bitmap images.\ntitle: Imaging\n---\n\n# Imaging\n\n\\[ Updated for UWP apps on Windows 10. For Windows 8.x articles, see the [archive](http://go.microsoft.com/fwlink/p/?linkid=619132) \\]\n\n\nThis article explains how to load and save image files using [**BitmapDecoder**](https://msdn.microsoft.com/library/windows/apps/br226176) and [**BitmapEncoder**](https://msdn.microsoft.com/library/windows/apps/br226206) and how to use the [**SoftwareBitmap**](https://msdn.microsoft.com/library/windows/apps/dn887358) object to represent bitmap images.\n\nThe **SoftwareBitmap** class is a versatile API that can be created from multiple sources including image files, [**WriteableBitmap**](https://msdn.microsoft.com/library/windows/apps/br243259) objects, Direct3D surfaces, and code. **SoftwareBitmap** allows you to easily convert between different pixel formats and alpha modes, and allows low-level access to pixel data. Also, **SoftwareBitmap** is a common interface used by multiple features of Windows, including:\n\n-   [**CapturedFrame**](https://msdn.microsoft.com/library/windows/apps/dn278725) allows you to get frames captured by the camera as a **SoftwareBitmap**.\n\n-   [**VideoFrame**](https://msdn.microsoft.com/library/windows/apps/dn930917) allows you to get a **SoftwareBitmap** representation of a **VideoFrame**.\n\n-   [**FaceDetector**](https://msdn.microsoft.com/library/windows/apps/dn974129) allows you to detect faces in a **SoftwareBitmap**.\n\nThe sample code in this article uses APIs from the following namespaces.\n\n[!code-cs[Namespaces](./code/ImagingWin10/cs/MainPage.xaml.cs#SnippetNamespaces)]\n\n## Create a SoftwareBitmap from an image file with BitmapDecoder\n\nTo create a [**SoftwareBitmap**](https://msdn.microsoft.com/library/windows/apps/dn887358) from a file, get an instance of [**StorageFile**](https://msdn.microsoft.com/library/windows/apps/br227171) containing the image data. This example uses a [**FileOpenPicker**](https://msdn.microsoft.com/library/windows/apps/br207847) to allow the user to select an image file.\n\n[!code-cs[PickInputFile](./code/ImagingWin10/cs/MainPage.xaml.cs#SnippetPickInputFile)]\n\nCall the [**OpenAsync**](https://msdn.microsoft.com/library/windows/apps/br227116) method of the **StorageFile** object to get a random access stream containing the image data. Call the static method [**BitmapDecoder.CreateAsync**](https://msdn.microsoft.com/library/windows/apps/br226182) to get an instance of the [**BitmapDecoder**](https://msdn.microsoft.com/library/windows/apps/br226176) class for the specified stream. Call [**GetSoftwareBitmapAsync**](https://msdn.microsoft.com/library/windows/apps/dn887332) to get a [**SoftwareBitmap**](https://msdn.microsoft.com/library/windows/apps/dn887358) object containing the image.\n\n[!code-cs[CreateSoftwareBitmapFromFile](./code/ImagingWin10/cs/MainPage.xaml.cs#SnippetCreateSoftwareBitmapFromFile)]\n\n## Save a SoftwareBitmap to a file with BitmapEncoder\n\nTo save a **SoftwareBitmap** to a file, get an instance of **StorageFile** to which the image will be saved. This example uses a [**FileSavePicker**](https://msdn.microsoft.com/library/windows/apps/br207871) to allow the user to select an output file.\n\n[!code-cs[PickOuputFile](./code/ImagingWin10/cs/MainPage.xaml.cs#SnippetPickOuputFile)]\n\nCall the [**OpenAsync**](https://msdn.microsoft.com/library/windows/apps/br227116) method of the **StorageFile** object to get a random access stream to which the image will be written. Call the static method [**BitmapEncoder.CreateAsync**](https://msdn.microsoft.com/library/windows/apps/br226211) to get an instance of the [**BitmapEncoder**](https://msdn.microsoft.com/library/windows/apps/br226206) class for the specified stream. The first parameter to **CreateAsync** is a GUID representing the codec that should be used to encode the image. **BitmapEncoder** class exposes a property containing the ID for each codec supported by the encoder, such as [**JpegEncoderId**](https://msdn.microsoft.com/library/windows/apps/br226226).\n\nUse the [**SetSoftwareBitmap**](https://msdn.microsoft.com/library/windows/apps/dn887337) method to set the image that will be encoded. You can set values of the [**BitmapTransform**](https://msdn.microsoft.com/library/windows/apps/br226254) property to apply basic transforms to the image while it is being encoded. The [**IsThumbnailGenerated**](https://msdn.microsoft.com/library/windows/apps/br226225) property determines whether a thumbnail is generated by the encoder. Note that not all file formats support thumbnails, so if you use this feature, you should catch the unsupported operation error that will be thrown if thumbnails are not supported.\n\nCall [**FlushAsync**](https://msdn.microsoft.com/library/windows/apps/br226216) to cause the encoder to write the image data to the specified file.\n\n[!code-cs[SaveSoftwareBitmapToFile](./code/ImagingWin10/cs/MainPage.xaml.cs#SnippetSaveSoftwareBitmapToFile)]\n\nYou can specify additional encoding options when you create the **BitmapEncoder** by creating a new [**BitmapPropertySet**](https://msdn.microsoft.com/library/windows/apps/hh974338) object and populating it with one or more [**BitmapTypedValue**](https://msdn.microsoft.com/library/windows/apps/hh700687) objects representing the encoder settings. For a list of supported encoder options, see [BitmapEncoder options reference](bitmapencoder-options-reference.md).\n\n[!code-cs[UseEncodingOptions](./code/ImagingWin10/cs/MainPage.xaml.cs#SnippetUseEncodingOptions)]\n\n## Use SoftwareBitmap with a XAML Image control\n\nTo display an image within a XAML page using the [**Image**](https://msdn.microsoft.com/library/windows/apps/br242752) control, first define an **Image** control in your XAML page.\n\n[!code-xml[ImageControl](./code/ImagingWin10/cs/MainPage.xaml#SnippetImageControl)]\n\nCreate a new [**SoftwareBitmapSource**](https://msdn.microsoft.com/library/windows/apps/dn997854) object. Set the contents of the source object by calling [**SetBitmapAsync**](https://msdn.microsoft.com/library/windows/apps/dn997856), passing in a **SoftwareBitmap**. Then you can set the [**Source**](https://msdn.microsoft.com/library/windows/apps/br242760) property of the **Image** control to the newly created **SoftwareBitmapSource**.\n\n[!code-cs[SoftwareBitmapToWriteableBitmap](./code/ImagingWin10/cs/MainPage.xaml.cs#SnippetSoftwareBitmapToWriteableBitmap)]\n\nYou can also use **SoftwareBitmapSource** to set a **SoftwareBitmap** as the [**ImageSource**](https://msdn.microsoft.com/library/windows/apps/br210105) for an [**ImageBrush**](https://msdn.microsoft.com/library/windows/apps/br210101).\n\n## Create a SoftwareBitmap from a WriteableBitmap\n\nYou can create a **SoftwareBitmap** from an existing **WriteableBitmap** by calling [**SoftwareBitmap.CreateCopyFromBuffer**](https://msdn.microsoft.com/library/windows/apps/dn887370) and supplying the **PixelBuffer** property of the **WriteableBitmap** to set the pixel data. The second argument allows you to request a pixel format for the newly created **WriteableBitmap**. You can use the [**PixelWidth**](https://msdn.microsoft.com/library/windows/apps/br243253) and [**PixelHeight**](https://msdn.microsoft.com/library/windows/apps/br243251) properties of the **WriteableBitmap** to specify the dimensions of the new image.\n\n[!code-cs[WriteableBitmapToSoftwareBitmap](./code/ImagingWin10/cs/MainPage.xaml.cs#SnippetWriteableBitmapToSoftwareBitmap)]\n\n## Create or edit a SoftwareBitmap programmatically\n\nSo far this topic has addressed working with image files. You can also create a new **SoftwareBitmap** programatically in code and use the same technique to access and modify the **SoftwareBitmap**'s pixel data.\n\n**SoftwareBitmap** uses COM interop to expose the raw buffer containing the pixel data.\n\nTo use COM interop, you must include a reference to the **System.Runtime.InteropServices** namespace in your project.\n\n[!code-cs[InteropNamespace](./code/ImagingWin10/cs/MainPage.xaml.cs#SnippetInteropNamespace)]\n\nInitialize the [**IMemoryBufferByteAccess**](https://msdn.microsoft.com/library/windows/desktop/mt297505) COM interface by adding the following code within your namespace.\n\n[!code-cs[COMImport](./code/ImagingWin10/cs/MainPage.xaml.cs#SnippetCOMImport)]\n\nCreate a new **SoftwareBitmap** with pixel format and size you want. Or, use an existing **SoftwareBitmap** for which you want to edit the pixel data. Call [**SoftwareBitmap.LockBuffer**](https://msdn.microsoft.com/library/windows/apps/dn887380) to obtain an instance of the [**BitmapBuffer**](https://msdn.microsoft.com/library/windows/apps/dn887325) class representing the pixel data buffer. Cast the **BitmapBuffer** to the **IMemoryBufferByteAccess** COM interface and then call [**IMemoryBufferByteAccess.GetBuffer**](https://msdn.microsoft.com/library/windows/desktop/mt297506) to populate a byte array with data. Use the [**BitmapBuffer.GetPlaneDescription**](https://msdn.microsoft.com/library/windows/apps/dn887330) method to get a [**BitmapPlaneDescription**](https://msdn.microsoft.com/library/windows/apps/dn887342) object that will help you calculate the offset into the buffer for each pixel.\n\n[!code-cs[CreateNewSoftwareBitmap](./code/ImagingWin10/cs/MainPage.xaml.cs#SnippetCreateNewSoftwareBitmap)]\n\nBecause this method accesses the raw buffer underlying the Windows Runtime types, it must be declared using the **unsafe** keyword. You must also configure your project in Microsoft Visual Studio to allow the compilation of unsafe code by opening the project's **Properties** page, clicking the **Build** property page, and selecting the **Allow Unsafe Code** checkbox.\n\n## Create a SoftwareBitmap from a Direct3D surface\n\nTo create a **SoftwareBitmap** object from a Direct3D surface, you must include the [**Windows.Graphics.DirectX.Direct3D11**](https://msdn.microsoft.com/library/windows/apps/dn895104) namespace in your project.\n\n[!code-cs[Direct3DNamespace](./code/ImagingWin10/cs/MainPage.xaml.cs#SnippetDirect3DNamespace)]\n\nCall [**CreateCopyFromSurfaceAsync**](https://msdn.microsoft.com/library/windows/apps/dn887373) to create a new **SoftwareBitmap** from the surface. As the name indicates, the new **SoftwareBitmap** has a separate copy of the image data. Modifications to the **SoftwareBitmap** will not have any effect on the Direct3D surface.\n\n[!code-cs[CreateSoftwareBitmapFromSurface](./code/ImagingWin10/cs/MainPage.xaml.cs#SnippetCreateSoftwareBitmapFromSurface)]\n\n## Convert a SoftwareBitmap to a different pixel format\n\nThe **SoftwareBitmap** class provides the static method, [**Convert**](https://msdn.microsoft.com/library/windows/apps/dn887362), that allows you to easily create a new **SoftwareBitmap** that uses the pixel format and alpha mode you specify from an existing **SoftwareBitmap**. Note that the newly created bitmap has a separate copy of the image data. Modifications to the new bitmap will not affect the source bitmap.\n\n[!code-cs[Convert](./code/ImagingWin10/cs/MainPage.xaml.cs#SnippetConvert)]\n\n## Transcode an image file\n\nYou can transcode an image file directly from a [**BitmapDecoder**](https://msdn.microsoft.com/library/windows/apps/br226176) to a [**BitmapEncoder**](https://msdn.microsoft.com/library/windows/apps/br226206). Create a [**IRandomAccessStream**](https://msdn.microsoft.com/library/windows/apps/br241731) from the file to be transcoded. Create a new **BitmapDecoder** from the input stream. Create a new [**InMemoryRandomAccessStream**](https://msdn.microsoft.com/library/windows/apps/br241720) for the encoder to write to and call [**BitmapEncoder.CreateForTranscodingAsync**](https://msdn.microsoft.com/library/windows/apps/br226214), passing in the in-memory stream and the decoder object. Set the encoding properties you want. Any properties in the input image file that you do not specifically set on the encoder, will be written to the output file unchanged. Call [**FlushAsync**](https://msdn.microsoft.com/library/windows/apps/br226216) to cause the encoder to encode to the in-memory stream. Finally, seek the file stream and the in-memory stream to the beginning and call [**CopyAsync**](https://msdn.microsoft.com/library/windows/apps/hh701827) to write the in-memory stream out to the file stream.\n\n[!code-cs[TranscodeImageFile](./code/ImagingWin10/cs/MainPage.xaml.cs#SnippetTranscodeImageFile)]\n\n## Related topics\n\n* [BitmapEncoder options reference](bitmapencoder-options-reference.md)\n* [Image Metadata](image-metadata.md)\n \n\n \n\n\n\n\n"}