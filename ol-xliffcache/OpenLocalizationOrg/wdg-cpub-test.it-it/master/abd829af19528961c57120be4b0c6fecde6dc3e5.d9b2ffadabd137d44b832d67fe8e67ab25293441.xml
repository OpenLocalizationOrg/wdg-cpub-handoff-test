{"nodes":[{"pos":[11,37],"content":"The app object and DirectX","needQuote":true,"needEscape":true,"nodes":[{"content":"The app object and DirectX","pos":[0,26]}]},{"pos":[51,172],"content":"Universal Windows Platform (UWP) with DirectX games don't use many of the Windows UI user interface elements and objects.","needQuote":true,"needEscape":true,"nodes":[{"content":"Universal Windows Platform (UWP) with DirectX games don't use many of the Windows UI user interface elements and objects.","pos":[0,121]}]},{"content":"The app object and DirectX","pos":[229,255]},{"content":"\\[ Updated for UWP apps on Windows 10.","pos":[258,296]},{"content":"For Windows 8.x articles, see the <bpt id=\"p1\">[</bpt>archive<ept id=\"p1\">](http://go.microsoft.com/fwlink/p/?linkid=619132)</ept> \\]","pos":[297,392],"source":" For Windows 8.x articles, see the [archive](http://go.microsoft.com/fwlink/p/?linkid=619132) \\]"},{"content":"Universal Windows Platform (UWP) with DirectX games don't use many of the Windows UI user interface elements and objects.","pos":[394,515]},{"content":"Rather, because they run at a lower level in the Windows Runtime stack, they must interoperate with the user interface framework in a more fundamental way: by accessing and interoperating with the app object directly.","pos":[516,733]},{"content":"Learn when and how this interoperation occurs, and how you, as a DirectX developer, can effectively use this model in the development of your UWP app.","pos":[734,884]},{"content":"The important core user interface namespaces","pos":[889,933]},{"content":"First, let's note the Windows Runtime namespaces that you must include (with <bpt id=\"p1\">**</bpt>using<ept id=\"p1\">**</ept>) in your UWP app.","pos":[936,1040],"source":"First, let's note the Windows Runtime namespaces that you must include (with **using**) in your UWP app."},{"content":"We get into the details in a bit.","pos":[1041,1074]},{"content":"Windows.ApplicationModel.Core","pos":[1083,1112]},{"content":"Windows.ApplicationModel.Activation","pos":[1181,1216]},{"content":"Windows.UI.Core","pos":[1285,1300]},{"content":"Windows.System","pos":[1369,1383]},{"content":"Windows.Foundation","pos":[1452,1470]},{"pos":[1535,1737],"content":"<bpt id=\"p1\">**</bpt>Note<ept id=\"p1\">**</ept>   If you are not developing a UWP app, use the user interface components provided in the JavaScript- or XAML-specific libraries and namespaces instead of the types provided in these namespaces.","source":"**Note**   If you are not developing a UWP app, use the user interface components provided in the JavaScript- or XAML-specific libraries and namespaces instead of the types provided in these namespaces."},{"content":"The Windows Runtime app object","pos":[1745,1775]},{"content":"In your UWP app, you want to get a window and a view provider from which you can get a view and to which you can connect your swap chain (your display buffers).","pos":[1778,1938]},{"content":"You can also hook this view into the window-specific events for your running app.","pos":[1939,2020]},{"content":"To get the parent window for the app object, defined by the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>CoreWindow<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br208225)</ept> type, create a type that implements <bpt id=\"p3\">[</bpt><bpt id=\"p4\">**</bpt>IFrameworkViewSource<ept id=\"p4\">**</ept><ept id=\"p3\">](https://msdn.microsoft.com/library/windows/apps/hh700482)</ept>, as we did in the previous code snippet.","pos":[2021,2317],"source":" To get the parent window for the app object, defined by the [**CoreWindow**](https://msdn.microsoft.com/library/windows/apps/br208225) type, create a type that implements [**IFrameworkViewSource**](https://msdn.microsoft.com/library/windows/apps/hh700482), as we did in the previous code snippet."},{"content":"Here's the basic set of steps to get a window using the core user interface framework:","pos":[2319,2405]},{"content":"Create a type that implements <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>IFrameworkView<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/hh700478)</ept>.","pos":[2411,2520],"source":"Create a type that implements [**IFrameworkView**](https://msdn.microsoft.com/library/windows/apps/hh700478)."},{"content":"This is your view.","pos":[2521,2539]},{"content":"In this type, define:","pos":[2545,2566]},{"content":"An <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>Initialize<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/hh700495)</ept> method that takes an instance of <bpt id=\"p3\">[</bpt><bpt id=\"p4\">**</bpt>CoreApplicationView<ept id=\"p4\">**</ept><ept id=\"p3\">](https://msdn.microsoft.com/library/windows/apps/br225017)</ept> as a parameter.","pos":[2576,2786],"source":"An [**Initialize**](https://msdn.microsoft.com/library/windows/apps/hh700495) method that takes an instance of [**CoreApplicationView**](https://msdn.microsoft.com/library/windows/apps/br225017) as a parameter."},{"content":"You can get an instance of this type by calling <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>CoreApplication.CreateNewView<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn297278)</ept>.","pos":[2787,2929],"source":" You can get an instance of this type by calling [**CoreApplication.CreateNewView**](https://msdn.microsoft.com/library/windows/apps/dn297278)."},{"content":"The app object calls it when the app is launched.","pos":[2930,2979]},{"content":"A <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>SetWindow<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/hh700509)</ept> method that takes an instance of <bpt id=\"p3\">[</bpt><bpt id=\"p4\">**</bpt>CoreWindow<ept id=\"p4\">**</ept><ept id=\"p3\">](https://msdn.microsoft.com/library/windows/apps/br208225)</ept> as a parameter.","pos":[2988,3187],"source":"A [**SetWindow**](https://msdn.microsoft.com/library/windows/apps/hh700509) method that takes an instance of [**CoreWindow**](https://msdn.microsoft.com/library/windows/apps/br208225) as a parameter."},{"content":"You can get an instance of this type by accessing the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>CoreWindow<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br225019)</ept> property on your new <bpt id=\"p3\">[</bpt><bpt id=\"p4\">**</bpt>CoreApplicationView<ept id=\"p4\">**</ept><ept id=\"p3\">](https://msdn.microsoft.com/library/windows/apps/br225017)</ept> instance.","pos":[3188,3431],"source":" You can get an instance of this type by accessing the [**CoreWindow**](https://msdn.microsoft.com/library/windows/apps/br225019) property on your new [**CoreApplicationView**](https://msdn.microsoft.com/library/windows/apps/br225017) instance."},{"content":"A <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>Load<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/hh700501)</ept> method that takes a string for an entry point as the sole parameter.","pos":[3440,3579],"source":"A [**Load**](https://msdn.microsoft.com/library/windows/apps/hh700501) method that takes a string for an entry point as the sole parameter."},{"content":"The app object provides the entry point string when you call this method.","pos":[3580,3653]},{"content":"This is where you set up resources.","pos":[3654,3689]},{"content":"You create your device resources here.","pos":[3690,3728]},{"content":"The app object calls it when the app is launched.","pos":[3729,3778]},{"content":"A <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>Run<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/hh700505)</ept> method that activates the <bpt id=\"p3\">[</bpt><bpt id=\"p4\">**</bpt>CoreWindow<ept id=\"p4\">**</ept><ept id=\"p3\">](https://msdn.microsoft.com/library/windows/apps/br208225)</ept> object and starts the window event dispatcher.","pos":[3787,4004],"source":"A [**Run**](https://msdn.microsoft.com/library/windows/apps/hh700505) method that activates the [**CoreWindow**](https://msdn.microsoft.com/library/windows/apps/br208225) object and starts the window event dispatcher."},{"content":"The app object calls it when the app's process starts.","pos":[4005,4059]},{"content":"An <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>Uninitialize<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/hh700523)</ept> method that cleans up the resources set up in the call to <bpt id=\"p3\">[</bpt><bpt id=\"p4\">**</bpt>Load<ept id=\"p4\">**</ept><ept id=\"p3\">](https://msdn.microsoft.com/library/windows/apps/hh700501)</ept>.","pos":[4068,4275],"source":"An [**Uninitialize**](https://msdn.microsoft.com/library/windows/apps/hh700523) method that cleans up the resources set up in the call to [**Load**](https://msdn.microsoft.com/library/windows/apps/hh700501)."},{"content":"The app object calls this method when the app is closed.","pos":[4276,4332]},{"content":"Create a type that implements <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>IFrameworkViewSource<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/hh700482)</ept>.","pos":[4338,4453],"source":"Create a type that implements [**IFrameworkViewSource**](https://msdn.microsoft.com/library/windows/apps/hh700482)."},{"content":"This is your view provider.","pos":[4454,4481]},{"content":"In this type, define:","pos":[4487,4508]},{"pos":[4518,4757],"content":"A method named <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>CreateView<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/hh700491)</ept> that returns an instance of your <bpt id=\"p3\">[</bpt><bpt id=\"p4\">**</bpt>IFrameworkView<ept id=\"p4\">**</ept><ept id=\"p3\">](https://msdn.microsoft.com/library/windows/apps/hh700478)</ept> implementation, as created in Step 1.","source":"A method named [**CreateView**](https://msdn.microsoft.com/library/windows/apps/hh700491) that returns an instance of your [**IFrameworkView**](https://msdn.microsoft.com/library/windows/apps/hh700478) implementation, as created in Step 1."},{"pos":[4763,4902],"content":"Pass an instance of the view provider to <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>CoreApplication.Run<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/hh700469)</ept> from <bpt id=\"p3\">**</bpt>main<ept id=\"p3\">**</ept>.","source":"Pass an instance of the view provider to [**CoreApplication.Run**](https://msdn.microsoft.com/library/windows/apps/hh700469) from **main**."},{"content":"With those basics in mind, let's look at more options you have to extend this approach.","pos":[4904,4991]},{"content":"Core user interface types","pos":[4996,5021]},{"content":"Here are other core user interface types in the Windows Runtime that you might find helpful:","pos":[5024,5116]},{"content":"Windows.ApplicationModel.Core.CoreApplicationView","pos":[5125,5174]},{"content":"Windows.UI.Core.CoreWindow","pos":[5243,5269]},{"content":"Windows.UI.Core.CoreDispatcher","pos":[5338,5368]},{"content":"You can use these types to access your app's view, specifically, the bits that draw the contents of the app's parent window, and handle the events fired for that window.","pos":[5431,5600]},{"content":"The app window's process is an <bpt id=\"p1\">*</bpt>application single-threaded apartment<ept id=\"p1\">*</ept> (ASTA) that is isolated and that handles all callbacks.","pos":[5601,5727],"source":" The app window's process is an *application single-threaded apartment* (ASTA) that is isolated and that handles all callbacks."},{"content":"Your app's view is generated by the view provider for your app window, and in most cases will be implemented by a specific framework package or the system itself, so you don't need to implement it yourself.","pos":[5729,5935]},{"content":"For DirectX, you need to implement a thin view provider, as discussed previously.","pos":[5936,6017]},{"content":"There is a specific 1-to-1 relationship between the following components and behaviors:","pos":[6018,6105]},{"pos":[6111,6300],"content":"An app's view, which is represented by the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>CoreApplicationView<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br225017)</ept> type, and which defines the method(s) for updating the window.","source":"An app's view, which is represented by the [**CoreApplicationView**](https://msdn.microsoft.com/library/windows/apps/br225017) type, and which defines the method(s) for updating the window."},{"content":"An ASTA, the attribution of which defines the threading behavior of the app.","pos":[6305,6381]},{"content":"You cannot create instances of COM STA-attributed types on an ASTA.","pos":[6382,6449]},{"content":"A view provider, which your app obtains from the system or which you implement.","pos":[6454,6533]},{"pos":[6538,6663],"content":"A parent window, which is represented by the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>CoreWindow<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br208225)</ept> type.","source":"A parent window, which is represented by the [**CoreWindow**](https://msdn.microsoft.com/library/windows/apps/br208225) type."},{"content":"Sourcing for all activation events.","pos":[6668,6703]},{"content":"Both views and windows have separate activation events.","pos":[6704,6759]},{"content":"In summary, the app object provides a view provider factory.","pos":[6761,6821]},{"content":"It creates a view provider and instantiates a parent window for the app.","pos":[6822,6894]},{"content":"The view provider defines the app's view for the parent window of the app.","pos":[6895,6969]},{"content":"Now, let's discuss the specifics of the view and the parent window.","pos":[6970,7037]},{"content":"CoreApplicationView behaviors and properties","pos":[7042,7086]},{"content":"<bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>CoreApplicationView<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br225017)</ept> represents the current app view.","pos":[7089,7205],"source":"[**CoreApplicationView**](https://msdn.microsoft.com/library/windows/apps/br225017) represents the current app view."},{"content":"The app singleton creates the app view during initialization, but the view remains dormant until it is activated.","pos":[7206,7319]},{"content":"You can get the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>CoreWindow<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br208225)</ept> that displays the view by accessing the <bpt id=\"p3\">[</bpt><bpt id=\"p4\">**</bpt>CoreApplicationView.CoreWindow<ept id=\"p4\">**</ept><ept id=\"p3\">](https://msdn.microsoft.com/library/windows/apps/br225019)</ept> property on it, and you can handle activation and deactivation events for the view by registering delegates with the <bpt id=\"p5\">[</bpt><bpt id=\"p6\">**</bpt>CoreApplicationView.Activated<ept id=\"p6\">**</ept><ept id=\"p5\">](https://msdn.microsoft.com/library/windows/apps/br225018)</ept> event.","pos":[7320,7763],"source":" You can get the [**CoreWindow**](https://msdn.microsoft.com/library/windows/apps/br208225) that displays the view by accessing the [**CoreApplicationView.CoreWindow**](https://msdn.microsoft.com/library/windows/apps/br225019) property on it, and you can handle activation and deactivation events for the view by registering delegates with the [**CoreApplicationView.Activated**](https://msdn.microsoft.com/library/windows/apps/br225018) event."},{"content":"CoreWindow behaviors and properties","pos":[7768,7803]},{"content":"The parent window, which is a <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>CoreWindow<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br208225)</ept> instance, is created and passed to the view provider when the app object initializes.","pos":[7806,7996],"source":"The parent window, which is a [**CoreWindow**](https://msdn.microsoft.com/library/windows/apps/br208225) instance, is created and passed to the view provider when the app object initializes."},{"content":"If the app has a window to display, it displays it; otherwise, it simply initializes the view.","pos":[7997,8091]},{"content":"<bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>CoreWindow<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br208225)</ept> provides a number of events specific to input and basic window behaviors.","pos":[8093,8241],"source":"[**CoreWindow**](https://msdn.microsoft.com/library/windows/apps/br208225) provides a number of events specific to input and basic window behaviors."},{"content":"You can handle these events by registering your own delegates with them.","pos":[8242,8314]},{"pos":[8316,8601],"content":"You can also obtain the window event dispatcher for the window by accessing the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>CoreWindow.Dispatcher<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br208264)</ept> property, which provides an instance of <bpt id=\"p3\">[</bpt><bpt id=\"p4\">**</bpt>CoreDispatcher<ept id=\"p4\">**</ept><ept id=\"p3\">](https://msdn.microsoft.com/library/windows/apps/br208211)</ept>.","source":"You can also obtain the window event dispatcher for the window by accessing the [**CoreWindow.Dispatcher**](https://msdn.microsoft.com/library/windows/apps/br208264) property, which provides an instance of [**CoreDispatcher**](https://msdn.microsoft.com/library/windows/apps/br208211)."},{"content":"CoreDispatcher behaviors and properties","pos":[8606,8645]},{"content":"You can determine the threading behavior of event dispatching for a window with the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>CoreDispatcher<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br208211)</ept> type.","pos":[8648,8816],"source":"You can determine the threading behavior of event dispatching for a window with the [**CoreDispatcher**](https://msdn.microsoft.com/library/windows/apps/br208211) type."},{"content":"On this type, there's one particularly important method: the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>CoreDispatcher.ProcessEvents<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br208215)</ept> method, which starts window event processing.","pos":[8817,9016],"source":" On this type, there's one particularly important method: the [**CoreDispatcher.ProcessEvents**](https://msdn.microsoft.com/library/windows/apps/br208215) method, which starts window event processing."},{"content":"Calling this method with the wrong option for your app can lead to all sorts of unexpected event processing behaviors.","pos":[9017,9135]},{"content":"CoreProcessEventsOption option","pos":[9139,9169]},{"content":"Description","pos":[9230,9241]},{"content":"CoreProcessEventsOption.ProcessOneAndAllPending","pos":[9806,9853]},{"content":"Dispatch all currently available events in the queue.","pos":[9917,9970]},{"content":"If no events are pending, wait for the next new event.","pos":[9971,10025]},{"content":"CoreProcessEventsOption.ProcessOneIfPresent","pos":[10161,10204]},{"content":"Dispatch one event if it is pending in the queue.","pos":[10272,10321]},{"content":"If no events are pending, don't wait for a new event to be raised but instead return immediately.","pos":[10322,10419]},{"content":"CoreProcessEventsOption.ProcessUntilQuit","pos":[10516,10556]},{"content":"Wait for new events and dispatch all available events.","pos":[10627,10681]},{"content":"Continue this behavior until the window is closed or the application calls the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>Close<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br208260)</ept> method on the <bpt id=\"p3\">[</bpt><bpt id=\"p4\">**</bpt>CoreWindow<ept id=\"p4\">**</ept><ept id=\"p3\">](https://msdn.microsoft.com/library/windows/apps/br208225)</ept> instance.","pos":[10682,10929],"source":" Continue this behavior until the window is closed or the application calls the [**Close**](https://msdn.microsoft.com/library/windows/apps/br208260) method on the [**CoreWindow**](https://msdn.microsoft.com/library/windows/apps/br208225) instance."},{"content":"CoreProcessEventsOption.ProcessAllIfPresent","pos":[10937,10980]},{"content":"Dispatch all currently available events in the queue.","pos":[11048,11101]},{"content":"If no events are pending, return immediately.","pos":[11102,11147]},{"pos":[11291,11507],"content":"UWP using DirectX should use the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>CoreProcessEventsOption.ProcessAllIfPresent<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br208217)</ept> option to prevent blocking behaviors that might interrupt graphics updates.","source":"UWP using DirectX should use the [**CoreProcessEventsOption.ProcessAllIfPresent**](https://msdn.microsoft.com/library/windows/apps/br208217) option to prevent blocking behaviors that might interrupt graphics updates."},{"content":"ASTA considerations for DirectX devs","pos":[11512,11548]},{"content":"The app object that defines the run-time representation of yourUWP and DirectX app uses a threading model called Application Single-Threaded Apartment (ASTA) to host your app’s UI views.","pos":[11551,11737]},{"content":"If you are developing a UWP and DirectX app, you're familiar with the properties of an ASTA, because any thread you dispatch from your UWP and DirectX app must use the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>Windows::System::Threading<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br229642)</ept> APIs, or use <bpt id=\"p3\">[</bpt><bpt id=\"p4\">**</bpt>CoreWindow::CoreDispatcher<ept id=\"p4\">**</ept><ept id=\"p3\">](https://msdn.microsoft.com/library/windows/apps/br208211)</ept>.","pos":[11738,12101],"source":" If you are developing a UWP and DirectX app, you're familiar with the properties of an ASTA, because any thread you dispatch from your UWP and DirectX app must use the [**Windows::System::Threading**](https://msdn.microsoft.com/library/windows/apps/br229642) APIs, or use [**CoreWindow::CoreDispatcher**](https://msdn.microsoft.com/library/windows/apps/br208211)."},{"content":"(You can get the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>CoreWindow<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br208225)</ept> object for the ASTA by calling <bpt id=\"p3\">[</bpt><bpt id=\"p4\">**</bpt>CoreWindow::GetForCurrentThread<ept id=\"p4\">**</ept><ept id=\"p3\">](https://msdn.microsoft.com/library/windows/apps/hh701589)</ept> from your app.)","pos":[12102,12336],"source":" (You can get the [**CoreWindow**](https://msdn.microsoft.com/library/windows/apps/br208225) object for the ASTA by calling [**CoreWindow::GetForCurrentThread**](https://msdn.microsoft.com/library/windows/apps/hh701589) from your app.)"},{"pos":[12338,12537],"content":"The most important thing for you to be aware of, as a developer of a UWP DirectX app, is that you must enable your app thread to dispatch MTA threads by setting <bpt id=\"p1\">**</bpt>Platform::MTAThread<ept id=\"p1\">**</ept> on <bpt id=\"p2\">**</bpt>main()<ept id=\"p2\">**</ept>.","source":"The most important thing for you to be aware of, as a developer of a UWP DirectX app, is that you must enable your app thread to dispatch MTA threads by setting **Platform::MTAThread** on **main()**."},{"content":"When the app object for your UWP DirectX app activates, it creates the ASTA that will be used for the UI view.","pos":[12759,12869]},{"content":"The new ASTA thread calls into your view provider factory, to create the view provider for your app object, and as a result, your view provider code will run on that ASTA thread.","pos":[12870,13048]},{"content":"Also, any thread that you spin off from the ASTA must be in an MTA.","pos":[13050,13117]},{"content":"Be aware that any MTA threads that you spin off can still create reentrancy issues and result in a deadlock.","pos":[13118,13226]},{"content":"If you're porting existing code to run on the ASTA thread, keep these considerations in mind:","pos":[13228,13321]},{"pos":[13327,13490],"content":"Wait primitives, such as <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>CoWaitForMultipleObjects<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/desktop/hh404144)</ept>, behave differently in an ASTA than in an STA.","source":"Wait primitives, such as [**CoWaitForMultipleObjects**](https://msdn.microsoft.com/library/windows/desktop/hh404144), behave differently in an ASTA than in an STA."},{"content":"The COM call modal loop operates differently in an ASTA.","pos":[13495,13551]},{"content":"You can no longer receive unrelated calls while an outgoing call is in progress.","pos":[13552,13632]},{"content":"For example, the following behavior will create a deadlock from an ASTA (and immediately crash the app):","pos":[13633,13737]},{"content":"The ASTA calls an MTA object and passes an interface pointer P1.","pos":[13746,13810]},{"content":"Later, the ASTA calls the same MTA object.","pos":[13819,13861]},{"content":"The MTA object calls P1 before it returns to the ASTA.","pos":[13862,13916]},{"content":"P1 cannot enter the ASTA as it's blocked making an unrelated call.","pos":[13925,13991]},{"content":"However, the MTA thread is blocked as it tries to make the call to P1.","pos":[13992,14062]},{"content":"You can resolve this by :","pos":[14068,14093]},{"pos":[14102,14183],"content":"Using the <bpt id=\"p1\">**</bpt>async<ept id=\"p1\">**</ept> pattern defined in the Parallel Patterns Library (PPLTasks.h)","source":"Using the **async** pattern defined in the Parallel Patterns Library (PPLTasks.h)"},{"pos":[14192,14390],"content":"Calling <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>CoreDispatcher::ProcessEvents<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br208215)</ept> from your app's ASTA (the main thread of your app) as soon as possible to allow arbitrary calls.","source":"Calling [**CoreDispatcher::ProcessEvents**](https://msdn.microsoft.com/library/windows/apps/br208215) from your app's ASTA (the main thread of your app) as soon as possible to allow arbitrary calls."},{"content":"That said, you cannot rely on immediate delivery of unrelated calls to your app's ASTA.","pos":[14396,14483]},{"content":"For more info about async calls, read <bpt id=\"p1\">[</bpt>Asynchronous programming in C++<ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/mt187334)</ept>.","pos":[14484,14614],"source":" For more info about async calls, read [Asynchronous programming in C++](https://msdn.microsoft.com/library/windows/apps/mt187334)."},{"content":"Overall, when designing your UWP app, use the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>CoreDispatcher<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br208211)</ept> for your app's <bpt id=\"p3\">[</bpt><bpt id=\"p4\">**</bpt>CoreWindow<ept id=\"p4\">**</ept><ept id=\"p3\">](https://msdn.microsoft.com/library/windows/apps/br208225)</ept> and <bpt id=\"p5\">[</bpt><bpt id=\"p6\">**</bpt>CoreDispatcher::ProcessEvents<ept id=\"p6\">**</ept><ept id=\"p5\">](https://msdn.microsoft.com/library/windows/apps/br208215)</ept> to handle all UI threads rather than trying to create and manage your MTA threads yourself.","pos":[14616,15020],"source":"Overall, when designing your UWP app, use the [**CoreDispatcher**](https://msdn.microsoft.com/library/windows/apps/br208211) for your app's [**CoreWindow**](https://msdn.microsoft.com/library/windows/apps/br208225) and [**CoreDispatcher::ProcessEvents**](https://msdn.microsoft.com/library/windows/apps/br208215) to handle all UI threads rather than trying to create and manage your MTA threads yourself."},{"content":"When you need a separate thread that you cannot handle with the <bpt id=\"p1\">**</bpt>CoreDispatcher<ept id=\"p1\">**</ept>, use async patterns and follow the guidance mentioned earlier to avoid reentrancy issues.","pos":[15021,15193],"source":" When you need a separate thread that you cannot handle with the **CoreDispatcher**, use async patterns and follow the guidance mentioned earlier to avoid reentrancy issues."}],"content":"---\ntitle: The app object and DirectX\ndescription: Universal Windows Platform (UWP) with DirectX games don't use many of the Windows UI user interface elements and objects.\nms.assetid: 46f92156-29f8-d65e-2587-7ba1de5b48a6\n---\n\n# The app object and DirectX\n\n\n\\[ Updated for UWP apps on Windows 10. For Windows 8.x articles, see the [archive](http://go.microsoft.com/fwlink/p/?linkid=619132) \\]\n\nUniversal Windows Platform (UWP) with DirectX games don't use many of the Windows UI user interface elements and objects. Rather, because they run at a lower level in the Windows Runtime stack, they must interoperate with the user interface framework in a more fundamental way: by accessing and interoperating with the app object directly. Learn when and how this interoperation occurs, and how you, as a DirectX developer, can effectively use this model in the development of your UWP app.\n\n## The important core user interface namespaces\n\n\nFirst, let's note the Windows Runtime namespaces that you must include (with **using**) in your UWP app. We get into the details in a bit.\n\n-   [**Windows.ApplicationModel.Core**](https://msdn.microsoft.com/library/windows/apps/br205865)\n-   [**Windows.ApplicationModel.Activation**](https://msdn.microsoft.com/library/windows/apps/br224766)\n-   [**Windows.UI.Core**](https://msdn.microsoft.com/library/windows/apps/br208383)\n-   [**Windows.System**](https://msdn.microsoft.com/library/windows/apps/br241814)\n-   [**Windows.Foundation**](https://msdn.microsoft.com/library/windows/apps/br226021)\n\n> **Note**   If you are not developing a UWP app, use the user interface components provided in the JavaScript- or XAML-specific libraries and namespaces instead of the types provided in these namespaces.\n\n \n\n## The Windows Runtime app object\n\n\nIn your UWP app, you want to get a window and a view provider from which you can get a view and to which you can connect your swap chain (your display buffers). You can also hook this view into the window-specific events for your running app. To get the parent window for the app object, defined by the [**CoreWindow**](https://msdn.microsoft.com/library/windows/apps/br208225) type, create a type that implements [**IFrameworkViewSource**](https://msdn.microsoft.com/library/windows/apps/hh700482), as we did in the previous code snippet.\n\nHere's the basic set of steps to get a window using the core user interface framework:\n\n1.  Create a type that implements [**IFrameworkView**](https://msdn.microsoft.com/library/windows/apps/hh700478). This is your view.\n\n    In this type, define:\n\n    -   An [**Initialize**](https://msdn.microsoft.com/library/windows/apps/hh700495) method that takes an instance of [**CoreApplicationView**](https://msdn.microsoft.com/library/windows/apps/br225017) as a parameter. You can get an instance of this type by calling [**CoreApplication.CreateNewView**](https://msdn.microsoft.com/library/windows/apps/dn297278). The app object calls it when the app is launched.\n    -   A [**SetWindow**](https://msdn.microsoft.com/library/windows/apps/hh700509) method that takes an instance of [**CoreWindow**](https://msdn.microsoft.com/library/windows/apps/br208225) as a parameter. You can get an instance of this type by accessing the [**CoreWindow**](https://msdn.microsoft.com/library/windows/apps/br225019) property on your new [**CoreApplicationView**](https://msdn.microsoft.com/library/windows/apps/br225017) instance.\n    -   A [**Load**](https://msdn.microsoft.com/library/windows/apps/hh700501) method that takes a string for an entry point as the sole parameter. The app object provides the entry point string when you call this method. This is where you set up resources. You create your device resources here. The app object calls it when the app is launched.\n    -   A [**Run**](https://msdn.microsoft.com/library/windows/apps/hh700505) method that activates the [**CoreWindow**](https://msdn.microsoft.com/library/windows/apps/br208225) object and starts the window event dispatcher. The app object calls it when the app's process starts.\n    -   An [**Uninitialize**](https://msdn.microsoft.com/library/windows/apps/hh700523) method that cleans up the resources set up in the call to [**Load**](https://msdn.microsoft.com/library/windows/apps/hh700501). The app object calls this method when the app is closed.\n\n2.  Create a type that implements [**IFrameworkViewSource**](https://msdn.microsoft.com/library/windows/apps/hh700482). This is your view provider.\n\n    In this type, define:\n\n    -   A method named [**CreateView**](https://msdn.microsoft.com/library/windows/apps/hh700491) that returns an instance of your [**IFrameworkView**](https://msdn.microsoft.com/library/windows/apps/hh700478) implementation, as created in Step 1.\n\n3.  Pass an instance of the view provider to [**CoreApplication.Run**](https://msdn.microsoft.com/library/windows/apps/hh700469) from **main**.\n\nWith those basics in mind, let's look at more options you have to extend this approach.\n\n## Core user interface types\n\n\nHere are other core user interface types in the Windows Runtime that you might find helpful:\n\n-   [**Windows.ApplicationModel.Core.CoreApplicationView**](https://msdn.microsoft.com/library/windows/apps/br225017)\n-   [**Windows.UI.Core.CoreWindow**](https://msdn.microsoft.com/library/windows/apps/br208225)\n-   [**Windows.UI.Core.CoreDispatcher**](https://msdn.microsoft.com/library/windows/apps/br208211)\n\nYou can use these types to access your app's view, specifically, the bits that draw the contents of the app's parent window, and handle the events fired for that window. The app window's process is an *application single-threaded apartment* (ASTA) that is isolated and that handles all callbacks.\n\nYour app's view is generated by the view provider for your app window, and in most cases will be implemented by a specific framework package or the system itself, so you don't need to implement it yourself. For DirectX, you need to implement a thin view provider, as discussed previously. There is a specific 1-to-1 relationship between the following components and behaviors:\n\n-   An app's view, which is represented by the [**CoreApplicationView**](https://msdn.microsoft.com/library/windows/apps/br225017) type, and which defines the method(s) for updating the window.\n-   An ASTA, the attribution of which defines the threading behavior of the app. You cannot create instances of COM STA-attributed types on an ASTA.\n-   A view provider, which your app obtains from the system or which you implement.\n-   A parent window, which is represented by the [**CoreWindow**](https://msdn.microsoft.com/library/windows/apps/br208225) type.\n-   Sourcing for all activation events. Both views and windows have separate activation events.\n\nIn summary, the app object provides a view provider factory. It creates a view provider and instantiates a parent window for the app. The view provider defines the app's view for the parent window of the app. Now, let's discuss the specifics of the view and the parent window.\n\n## CoreApplicationView behaviors and properties\n\n\n[**CoreApplicationView**](https://msdn.microsoft.com/library/windows/apps/br225017) represents the current app view. The app singleton creates the app view during initialization, but the view remains dormant until it is activated. You can get the [**CoreWindow**](https://msdn.microsoft.com/library/windows/apps/br208225) that displays the view by accessing the [**CoreApplicationView.CoreWindow**](https://msdn.microsoft.com/library/windows/apps/br225019) property on it, and you can handle activation and deactivation events for the view by registering delegates with the [**CoreApplicationView.Activated**](https://msdn.microsoft.com/library/windows/apps/br225018) event.\n\n## CoreWindow behaviors and properties\n\n\nThe parent window, which is a [**CoreWindow**](https://msdn.microsoft.com/library/windows/apps/br208225) instance, is created and passed to the view provider when the app object initializes. If the app has a window to display, it displays it; otherwise, it simply initializes the view.\n\n[**CoreWindow**](https://msdn.microsoft.com/library/windows/apps/br208225) provides a number of events specific to input and basic window behaviors. You can handle these events by registering your own delegates with them.\n\nYou can also obtain the window event dispatcher for the window by accessing the [**CoreWindow.Dispatcher**](https://msdn.microsoft.com/library/windows/apps/br208264) property, which provides an instance of [**CoreDispatcher**](https://msdn.microsoft.com/library/windows/apps/br208211).\n\n## CoreDispatcher behaviors and properties\n\n\nYou can determine the threading behavior of event dispatching for a window with the [**CoreDispatcher**](https://msdn.microsoft.com/library/windows/apps/br208211) type. On this type, there's one particularly important method: the [**CoreDispatcher.ProcessEvents**](https://msdn.microsoft.com/library/windows/apps/br208215) method, which starts window event processing. Calling this method with the wrong option for your app can lead to all sorts of unexpected event processing behaviors.\n\n| CoreProcessEventsOption option                                                           | Description                                                                                                                                                                                                                                  |\n|------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|\n| [**CoreProcessEventsOption.ProcessOneAndAllPending**](https://msdn.microsoft.com/library/windows/apps/br208217) | Dispatch all currently available events in the queue. If no events are pending, wait for the next new event.                                                                                                                                 |\n| [**CoreProcessEventsOption.ProcessOneIfPresent**](https://msdn.microsoft.com/library/windows/apps/br208217)     | Dispatch one event if it is pending in the queue. If no events are pending, don't wait for a new event to be raised but instead return immediately.                                                                                          |\n| [**CoreProcessEventsOption.ProcessUntilQuit**](https://msdn.microsoft.com/library/windows/apps/br208217)        | Wait for new events and dispatch all available events. Continue this behavior until the window is closed or the application calls the [**Close**](https://msdn.microsoft.com/library/windows/apps/br208260) method on the [**CoreWindow**](https://msdn.microsoft.com/library/windows/apps/br208225) instance. |\n| [**CoreProcessEventsOption.ProcessAllIfPresent**](https://msdn.microsoft.com/library/windows/apps/br208217)     | Dispatch all currently available events in the queue. If no events are pending, return immediately.                                                                                                                                          |\n\n \n\nUWP using DirectX should use the [**CoreProcessEventsOption.ProcessAllIfPresent**](https://msdn.microsoft.com/library/windows/apps/br208217) option to prevent blocking behaviors that might interrupt graphics updates.\n\n## ASTA considerations for DirectX devs\n\n\nThe app object that defines the run-time representation of yourUWP and DirectX app uses a threading model called Application Single-Threaded Apartment (ASTA) to host your app’s UI views. If you are developing a UWP and DirectX app, you're familiar with the properties of an ASTA, because any thread you dispatch from your UWP and DirectX app must use the [**Windows::System::Threading**](https://msdn.microsoft.com/library/windows/apps/br229642) APIs, or use [**CoreWindow::CoreDispatcher**](https://msdn.microsoft.com/library/windows/apps/br208211). (You can get the [**CoreWindow**](https://msdn.microsoft.com/library/windows/apps/br208225) object for the ASTA by calling [**CoreWindow::GetForCurrentThread**](https://msdn.microsoft.com/library/windows/apps/hh701589) from your app.)\n\nThe most important thing for you to be aware of, as a developer of a UWP DirectX app, is that you must enable your app thread to dispatch MTA threads by setting **Platform::MTAThread** on **main()**.\n\n```cpp\n[Platform::MTAThread]\nint main(Platform::Array<Platform::String^>^)\n{\n    auto myDXAppSource = ref new MyDXAppSource(); // your view provider factory \n    CoreApplication::Run(myDXAppSource);\n    return 0;\n}\n```\n\nWhen the app object for your UWP DirectX app activates, it creates the ASTA that will be used for the UI view. The new ASTA thread calls into your view provider factory, to create the view provider for your app object, and as a result, your view provider code will run on that ASTA thread.\n\nAlso, any thread that you spin off from the ASTA must be in an MTA. Be aware that any MTA threads that you spin off can still create reentrancy issues and result in a deadlock.\n\nIf you're porting existing code to run on the ASTA thread, keep these considerations in mind:\n\n-   Wait primitives, such as [**CoWaitForMultipleObjects**](https://msdn.microsoft.com/library/windows/desktop/hh404144), behave differently in an ASTA than in an STA.\n-   The COM call modal loop operates differently in an ASTA. You can no longer receive unrelated calls while an outgoing call is in progress. For example, the following behavior will create a deadlock from an ASTA (and immediately crash the app):\n    1.  The ASTA calls an MTA object and passes an interface pointer P1.\n    2.  Later, the ASTA calls the same MTA object. The MTA object calls P1 before it returns to the ASTA.\n    3.  P1 cannot enter the ASTA as it's blocked making an unrelated call. However, the MTA thread is blocked as it tries to make the call to P1.\n\n    You can resolve this by :\n    -   Using the **async** pattern defined in the Parallel Patterns Library (PPLTasks.h)\n    -   Calling [**CoreDispatcher::ProcessEvents**](https://msdn.microsoft.com/library/windows/apps/br208215) from your app's ASTA (the main thread of your app) as soon as possible to allow arbitrary calls.\n\n    That said, you cannot rely on immediate delivery of unrelated calls to your app's ASTA. For more info about async calls, read [Asynchronous programming in C++](https://msdn.microsoft.com/library/windows/apps/mt187334).\n\nOverall, when designing your UWP app, use the [**CoreDispatcher**](https://msdn.microsoft.com/library/windows/apps/br208211) for your app's [**CoreWindow**](https://msdn.microsoft.com/library/windows/apps/br208225) and [**CoreDispatcher::ProcessEvents**](https://msdn.microsoft.com/library/windows/apps/br208215) to handle all UI threads rather than trying to create and manage your MTA threads yourself. When you need a separate thread that you cannot handle with the **CoreDispatcher**, use async patterns and follow the guidance mentioned earlier to avoid reentrancy issues.\n\n \n\n \n\n\n\n\n"}