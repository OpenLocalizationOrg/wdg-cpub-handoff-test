{"nodes":[{"pos":[66,270],"content":"If you have a catalog of apps and in-app products (IAPs), you can use the Windows Store collection API and Windows Store purchase API to access ownership information for these products from your services.","needQuote":true,"needEscape":true,"nodes":[{"content":"If you have a catalog of apps and in-app products (IAPs), you can use the Windows Store collection API and Windows Store purchase API to access ownership information for these products from your services.","pos":[0,204]}]},{"pos":[278,316],"content":"View and grant products from a service","needQuote":true,"needEscape":true,"nodes":[{"content":"View and grant products from a service","pos":[0,38]}]},{"content":"View and grant products from a service","pos":[324,362]},{"content":"\\[ Updated for UWP apps on Windows 10.","pos":[365,403]},{"content":"For Windows 8.x articles, see the <bpt id=\"p1\">[</bpt>archive<ept id=\"p1\">](http://go.microsoft.com/fwlink/p/?linkid=619132)</ept> \\]","pos":[404,499],"source":" For Windows 8.x articles, see the [archive](http://go.microsoft.com/fwlink/p/?linkid=619132) \\]"},{"pos":[502,710],"content":"If you have a catalog of apps and in-app products (IAPs), you can use the <bpt id=\"p1\">*</bpt>Windows Store collection API<ept id=\"p1\">*</ept> and <bpt id=\"p2\">*</bpt>Windows Store purchase API<ept id=\"p2\">*</ept> to access ownership information for these products from your services.","source":"If you have a catalog of apps and in-app products (IAPs), you can use the *Windows Store collection API* and *Windows Store purchase API* to access ownership information for these products from your services."},{"content":"These APIs consist of REST methods that are designed to be used by developers with IAP catalogs that are supported by cross-platform services.","pos":[712,854]},{"content":"These APIs enable you to do the following:","pos":[855,897]},{"content":"Windows Store collection API: Query for apps and IAPs owned by a given user, or report a consumable product as fulfilled.","pos":[903,1024]},{"content":"Windows Store purchase API: Grant a free app or IAP to a given user.","pos":[1029,1097]},{"content":"Using the Windows Store collection API and Windows Store purchase API","pos":[1102,1171]},{"content":"The Windows Store collection API and purchase API use Azure Active Directory (Azure AD) authentication to access customer ownership information.","pos":[1174,1318]},{"content":"Before you can call these APIs, you must apply Azure AD metadata to your application in the Windows Dev Center dashboard and generate several required access tokens and keys.","pos":[1319,1493]},{"content":"The following steps describe the end-to-end process:","pos":[1494,1546]},{"content":"<bpt id=\"p1\">[</bpt>Configure a Web application in Azure AD<ept id=\"p1\">](#step-1:-configure-a-web-application-in-azure-ad)</ept>.","pos":[1552,1644],"source":"[Configure a Web application in Azure AD](#step-1:-configure-a-web-application-in-azure-ad)."},{"content":"This application represents your cross-platform services in the context of Azure AD.","pos":[1645,1729]},{"pos":[1734,1930],"content":"<bpt id=\"p1\">[</bpt>Associate your Azure AD client ID with your application in the Windows Dev Center dashboard<ept id=\"p1\">](#step-2:-associate-your-azure-ad-client-id-with-your-application-in-the-windows-dev-denter-dashboard)</ept>.","source":"[Associate your Azure AD client ID with your application in the Windows Dev Center dashboard](#step-2:-associate-your-azure-ad-client-id-with-your-application-in-the-windows-dev-denter-dashboard)."},{"pos":[1935,2072],"content":"In your service, <bpt id=\"p1\">[</bpt>generate Azure AD access tokens<ept id=\"p1\">](#step-3:-retrieve-access-tokens-from-azure-ad)</ept> that represent your publisher identity.","source":"In your service, [generate Azure AD access tokens](#step-3:-retrieve-access-tokens-from-azure-ad) that represent your publisher identity."},{"pos":[2077,2333],"content":"In client-side code in your Windows app, <bpt id=\"p1\">[</bpt>generate a Windows Store ID key<ept id=\"p1\">](#step-4:-generate-a-windows-store-id-key-from-client-side-code-in-your-app)</ept> that represents the identity of the current user, and pass the Windows Store ID key back to your service.","source":"In client-side code in your Windows app, [generate a Windows Store ID key](#step-4:-generate-a-windows-store-id-key-from-client-side-code-in-your-app) that represents the identity of the current user, and pass the Windows Store ID key back to your service."},{"pos":[2338,2570],"content":"After you have the required Azure AD access token and Windows Store ID key, <bpt id=\"p1\">[</bpt>call the Windows Store collection API or purchase API from your service<ept id=\"p1\">](#step-5:-call-the-windows-store-collection-api-or-purchase-api-from-your-service)</ept>.","source":"After you have the required Azure AD access token and Windows Store ID key, [call the Windows Store collection API or purchase API from your service](#step-5:-call-the-windows-store-collection-api-or-purchase-api-from-your-service)."},{"content":"The following sections provide more details about each of these steps.","pos":[2572,2642]},{"content":"Step 1: Configure a Web application in Azure AD","pos":[2648,2695]},{"pos":[2701,3255],"content":"Follow the instructions in [Integrating Applications with Azure Active Directory](http://go.microsoft.com/fwlink/?LinkId=722502) to add a Web application to Azure AD.\n**Note**  On the **Tell us about your application page**, make sure that you choose **Web application and/or web API**. This is required so that you can obtain a key (also called a *client secret*) for your application. In order to call the Windows Store collection API or purchase API, you must provide a client secret when you request an access token from Azure AD in a later step.","leadings":["","    "],"nodes":[{"content":"Follow the instructions in <bpt id=\"p1\">[</bpt>Integrating Applications with Azure Active Directory<ept id=\"p1\">](http://go.microsoft.com/fwlink/?LinkId=722502)</ept> to add a Web application to Azure AD.","pos":[0,166],"source":"Follow the instructions in [Integrating Applications with Azure Active Directory](http://go.microsoft.com/fwlink/?LinkId=722502) to add a Web application to Azure AD."},{"content":"<bpt id=\"p1\">**</bpt>Note<ept id=\"p1\">**</ept>  On the <bpt id=\"p2\">**</bpt>Tell us about your application page<ept id=\"p2\">**</ept>, make sure that you choose <bpt id=\"p3\">**</bpt>Web application and/or web API<ept id=\"p3\">**</ept>.","pos":[167,286],"source":"**Note**  On the **Tell us about your application page**, make sure that you choose **Web application and/or web API**."},{"content":"This is required so that you can obtain a key (also called a <bpt id=\"p1\">*</bpt>client secret<ept id=\"p1\">*</ept>) for your application.","pos":[287,386],"source":" This is required so that you can obtain a key (also called a *client secret*) for your application."},{"content":"In order to call the Windows Store collection API or purchase API, you must provide a client secret when you request an access token from Azure AD in a later step.","pos":[387,550]}]},{"content":"In the <bpt id=\"p1\">[</bpt>Azure Management Portal<ept id=\"p1\">](http://manage.windowsazure.com/)</ept>, navigate to <bpt id=\"p2\">**</bpt>Active Directory<ept id=\"p2\">**</ept>.","pos":[3260,3360],"source":"In the [Azure Management Portal](http://manage.windowsazure.com/), navigate to **Active Directory**."},{"content":"Select your directory, click the <bpt id=\"p1\">**</bpt>Applications<ept id=\"p1\">**</ept> tab at the top, and then select your application.","pos":[3361,3460],"source":" Select your directory, click the **Applications** tab at the top, and then select your application."},{"content":"Click the <bpt id=\"p1\">**</bpt>Configure<ept id=\"p1\">**</ept> tab.","pos":[3465,3493],"source":"Click the **Configure** tab."},{"content":"On this tab, obtain the client ID for your application and request a key (this is called a <bpt id=\"p1\">*</bpt>client secret<ept id=\"p1\">*</ept> in later steps).","pos":[3494,3617],"source":" On this tab, obtain the client ID for your application and request a key (this is called a *client secret* in later steps)."},{"content":"At the bottom of the screen, click <bpt id=\"p1\">**</bpt>Manage manifest<ept id=\"p1\">**</ept>.","pos":[3622,3677],"source":"At the bottom of the screen, click **Manage manifest**."},{"content":"Download your Azure AD application manifest and replace the <ph id=\"ph1\">`\"identifierUris\"`</ph> section with the following text.","pos":[3678,3789],"source":" Download your Azure AD application manifest and replace the `\"identifierUris\"` section with the following text."},{"content":"These strings represent the audiences supported by your application.","pos":[4074,4142]},{"content":"In a later step, you will create Azure AD access tokens that are associated with each of these audience values.","pos":[4143,4254]},{"content":"For more information about how to download your application manifest, see <bpt id=\"p1\">[</bpt>Understanding the Azure Active Directory application manifest<ept id=\"p1\">]( http://go.microsoft.com/fwlink/?LinkId=722500)</ept>.","pos":[4255,4441],"source":" For more information about how to download your application manifest, see [Understanding the Azure Active Directory application manifest]( http://go.microsoft.com/fwlink/?LinkId=722500)."},{"pos":[4447,4578],"content":"Save your application manifest and upload it to your application in the <bpt id=\"p1\">[</bpt>Azure Management Portal<ept id=\"p1\">](http://manage.windowsazure.com/)</ept>.","source":"Save your application manifest and upload it to your application in the [Azure Management Portal](http://manage.windowsazure.com/)."},{"content":"Step 2: Associate your Azure AD client ID with your application in the Windows Dev Center dashboard","pos":[4584,4683]},{"content":"The Windows Store collection API and purchase API only provide access to a user's ownership information for apps and IAPs that you have associated with your Azure AD client ID.","pos":[4685,4861]},{"pos":[4867,4967],"content":"Sign in to the <bpt id=\"p1\">[</bpt>Windows Dev Center dashboard<ept id=\"p1\">](https://dev.windows.com/overview)</ept> and select your app.","source":"Sign in to the [Windows Dev Center dashboard](https://dev.windows.com/overview) and select your app."},{"pos":[4972,5110],"content":"Go to the <bpt id=\"p1\">**</bpt>Services<ept id=\"p1\">**</ept> <ph id=\"ph1\">&amp;gt;</ph> <bpt id=\"p2\">**</bpt>Product collections and purchases<ept id=\"p2\">**</ept> page and enter your Azure AD client ID into one of the available fields.","source":"Go to the **Services** &gt; **Product collections and purchases** page and enter your Azure AD client ID into one of the available fields."},{"content":"Step 3: Retrieve access tokens from Azure AD","pos":[5116,5160]},{"content":"Before you can retrieve a Windows Store ID key or call the Windows Store collection API or purchase API, your service must request three Azure AD access tokens that represent your publisher identity.","pos":[5162,5361]},{"content":"Each of these access tokens is associated with a different audience URI, and each token will be used with a different API call.","pos":[5362,5489]},{"content":"The lifetime of each token is 60 minutes, and you can refresh them after they expire.","pos":[5490,5575]},{"content":"To create the access tokens, use the OAuth 2.0 API in your service by following the instructions in <bpt id=\"p1\">[</bpt>Service to Service Calls Using Client Credentials<ept id=\"p1\">](https://msdn.microsoft.com/library/azure/dn645543.aspx)</ept>.","pos":[5577,5785],"source":"To create the access tokens, use the OAuth 2.0 API in your service by following the instructions in [Service to Service Calls Using Client Credentials](https://msdn.microsoft.com/library/azure/dn645543.aspx)."},{"content":"For each token, specify the following parameter data:","pos":[5786,5839]},{"content":"For the <bpt id=\"p1\">*</bpt>client\\_id<ept id=\"p1\">*</ept> and <bpt id=\"p2\">*</bpt>client\\_secret<ept id=\"p2\">*</ept> parameters, specify the client ID and the client secret for your application as obtained from the <bpt id=\"p3\">[</bpt>Azure Management Portal<ept id=\"p3\">](http://manage.windowsazure.com/)</ept>.","pos":[5845,6044],"source":"For the *client\\_id* and *client\\_secret* parameters, specify the client ID and the client secret for your application as obtained from the [Azure Management Portal](http://manage.windowsazure.com/)."},{"content":"Both of these parameters are required in order to generate an access token with the level of authentication required by the Windows Store collection API or purchase API.","pos":[6045,6214]},{"content":"For the <bpt id=\"p1\">*</bpt>resource<ept id=\"p1\">*</ept> parameter, specify one of the following app ID URIs (these are the same URIs that you previously added to the <ph id=\"ph1\">`\"identifierUris\"`</ph> section of the application manifest).","pos":[6219,6404],"source":"For the *resource* parameter, specify one of the following app ID URIs (these are the same URIs that you previously added to the `\"identifierUris\"` section of the application manifest)."},{"content":"At the end of this process, you should have three access tokens that each have one of these app ID URIs associated with them:","pos":[6405,6530]},{"pos":[6539,6769],"content":"<bpt id=\"p1\">**</bpt>https://onestore.microsoft.com/b2b/keys/create/collections<ept id=\"p1\">**</ept>: In a later step, you will use the access token that you create with this URI to request a Windows Store ID key that you can use with the Windows Store collection API.","source":"**https://onestore.microsoft.com/b2b/keys/create/collections**: In a later step, you will use the access token that you create with this URI to request a Windows Store ID key that you can use with the Windows Store collection API."},{"pos":[6778,7003],"content":"<bpt id=\"p1\">**</bpt>https://onestore.microsoft.com/b2b/keys/create/purchase<ept id=\"p1\">**</ept>: In a later step, you will use the access token that you create with this URI to request a Windows Store ID key that you can use with the Windows Store purchase API.","source":"**https://onestore.microsoft.com/b2b/keys/create/purchase**: In a later step, you will use the access token that you create with this URI to request a Windows Store ID key that you can use with the Windows Store purchase API."},{"pos":[7012,7193],"content":"<bpt id=\"p1\">**</bpt>https://onestore.microsoft.com<ept id=\"p1\">**</ept>: In a later step, you will use the access token that you create with this URI in direct calls to the Windows Store collection API or purchase API.","source":"**https://onestore.microsoft.com**: In a later step, you will use the access token that you create with this URI in direct calls to the Windows Store collection API or purchase API."},{"content":"<bpt id=\"p1\">**</bpt>Important<ept id=\"p1\">**</ept>  Use the <bpt id=\"p2\">**</bpt>https://onestore.microsoft.com<ept id=\"p2\">**</ept> audience only with access tokens that are stored securely within your service.","pos":[7199,7335],"source":"**Important**  Use the **https://onestore.microsoft.com** audience only with access tokens that are stored securely within your service."},{"content":"Exposing access tokens with this audience outside your service could make your service vulnerable to replay attacks.","pos":[7336,7452]},{"pos":[7454,7596],"content":"For more details about the structure of an access token, see <bpt id=\"p1\">[</bpt>Supported Token and Claim Types<ept id=\"p1\">](http://go.microsoft.com/fwlink/?LinkId=722501)</ept>.","source":"For more details about the structure of an access token, see [Supported Token and Claim Types](http://go.microsoft.com/fwlink/?LinkId=722501)."},{"content":"<bpt id=\"p1\">**</bpt>Important<ept id=\"p1\">**</ept>  You should create Azure AD access tokens only in the context of your service, not in your app.","pos":[7598,7707],"source":"**Important**  You should create Azure AD access tokens only in the context of your service, not in your app."},{"content":"Your client secret could be compromised if it is sent to your app.","pos":[7708,7774]},{"content":"Step 4: Generate a Windows Store ID key from client-side code in your app","pos":[7783,7856]},{"content":"Before you can call the Windows Store collection API or purchase API, your service must obtain a Windows Store ID key.","pos":[7858,7976]},{"content":"This is a JSON Web Token (JWT) that represents the identity of the user whose product ownership information you want to access.","pos":[7977,8104]},{"content":"For more information about the claims in this key, see <bpt id=\"p1\">[</bpt>Claims in a Windows Store ID key<ept id=\"p1\">](#windowsstorekey)</ept>.","pos":[8105,8213],"source":" For more information about the claims in this key, see [Claims in a Windows Store ID key](#windowsstorekey)."},{"content":"Currently, the only way to obtain a Windows Store ID key is by calling a Universal Windows Platform (UWP) API from client-side code in your app to retrieve the identity of the user who is currently signed in to the Windows Store.","pos":[8215,8444]},{"content":"To generate a Windows Store ID key:","pos":[8445,8480]},{"content":"Pass one of the following access tokens from your service to your client app:","pos":[8486,8563]},{"pos":[8572,8791],"content":"To get a Windows Store ID key that you can use with the Windows Store collection API, pass the Azure AD access token that you created with the <bpt id=\"p1\">**</bpt>https://onestore.microsoft.com/b2b/keys/create/collections<ept id=\"p1\">**</ept> audience URI.","source":"To get a Windows Store ID key that you can use with the Windows Store collection API, pass the Azure AD access token that you created with the **https://onestore.microsoft.com/b2b/keys/create/collections** audience URI."},{"pos":[8800,9014],"content":"To get a Windows Store ID key that you can use with the Windows Store purchase API, pass the Azure AD access token that you created with the <bpt id=\"p1\">**</bpt>https://onestore.microsoft.com/b2b/keys/create/purchase<ept id=\"p1\">**</ept> audience URI.","source":"To get a Windows Store ID key that you can use with the Windows Store purchase API, pass the Azure AD access token that you created with the **https://onestore.microsoft.com/b2b/keys/create/purchase** audience URI."},{"pos":[9020,9195],"content":"In your app code, call one of the following methods of the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>CurrentApp<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/hh779765)</ept> class to retrieve a Windows Store ID key.","source":"In your app code, call one of the following methods of the [**CurrentApp**](https://msdn.microsoft.com/library/windows/apps/hh779765) class to retrieve a Windows Store ID key."},{"pos":[9205,9371],"content":"<bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>GetCustomerCollectionsIdAsync<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/mt608674)</ept>: Call this method if you intend to use the Windows Store collection API.","source":"[**GetCustomerCollectionsIdAsync**](https://msdn.microsoft.com/library/windows/apps/mt608674): Call this method if you intend to use the Windows Store collection API."},{"pos":[9380,9541],"content":"<bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>GetCustomerPurchaseIdAsync<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/mt608675)</ept>: Call this method if you intend to use the Windows Store purchase API.","source":"[**GetCustomerPurchaseIdAsync**](https://msdn.microsoft.com/library/windows/apps/mt608675): Call this method if you intend to use the Windows Store purchase API."},{"content":"For either method, pass your Azure AD access token to the <bpt id=\"p1\">*</bpt>serviceTicket<ept id=\"p1\">*</ept> parameter.","pos":[9547,9631],"source":"For either method, pass your Azure AD access token to the *serviceTicket* parameter."},{"content":"You can optionally pass an ID to the <bpt id=\"p1\">*</bpt>publisherUserId<ept id=\"p1\">*</ept> parameter that identifies the current user in the context of your services.","pos":[9632,9762],"source":" You can optionally pass an ID to the *publisherUserId* parameter that identifies the current user in the context of your services."},{"content":"If you maintain user IDs for your services, you can use this parameter to correlate these user IDs with the calls you make to the Windows Store collection API or purchase API.","pos":[9763,9938]},{"content":"After your app successfully retrieves a Windows Store ID key, pass the key back to your service.","pos":[9944,10040]},{"content":"<bpt id=\"p1\">**</bpt>Note<ept id=\"p1\">**</ept>  Each Windows Store ID key is valid for 90 days.","pos":[10042,10099],"source":"**Note**  Each Windows Store ID key is valid for 90 days."},{"content":"After a key expires, you can <bpt id=\"p1\">[</bpt>renew the key<ept id=\"p1\">](renew-a-windows-store-id-key.md)</ept>.","pos":[10100,10178],"source":" After a key expires, you can [renew the key](renew-a-windows-store-id-key.md)."},{"content":"We recommend that you renew your Windows Store ID keys rather than creating new ones.","pos":[10179,10264]},{"content":"Step 5: Call the Windows Store collection API or purchase API from your service","pos":[10273,10352]},{"content":"After your service has a Windows Store ID key that enables it to access a specific user's product ownership information, your service can call the Windows Store collection API or purchase API.","pos":[10354,10546]},{"content":"Use the instructions that apply to your scenario:","pos":[10547,10596]},{"content":"Query for products","pos":[10603,10621]},{"content":"Report consumable products as fulfilled","pos":[10651,10690]},{"content":"Grant free products","pos":[10741,10760]},{"content":"For each scenario, pass the following information to the API:","pos":[10787,10848]},{"content":"The Azure AD access token that you created earlier with the <bpt id=\"p1\">**</bpt>https://onestore.microsoft.com<ept id=\"p1\">**</ept> audience URI.","pos":[10854,10962],"source":"The Azure AD access token that you created earlier with the **https://onestore.microsoft.com** audience URI."},{"content":"This token represents your publisher identity.","pos":[10963,11009]},{"content":"Pass this token in the request header.","pos":[11010,11048]},{"content":"The Windows Store ID key you retrieved from <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>GetCustomerCollectionsIdAsync<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/mt608674)</ept> or <bpt id=\"p3\">[</bpt><bpt id=\"p4\">**</bpt>GetCustomerPurchaseIdAsync<ept id=\"p4\">**</ept><ept id=\"p3\">](https://msdn.microsoft.com/library/windows/apps/mt608675)</ept> in your app.","pos":[11053,11297],"source":"The Windows Store ID key you retrieved from [**GetCustomerCollectionsIdAsync**](https://msdn.microsoft.com/library/windows/apps/mt608674) or [**GetCustomerPurchaseIdAsync**](https://msdn.microsoft.com/library/windows/apps/mt608675) in your app."},{"content":"This key represents the identity of the user whose product ownership information you want to access.","pos":[11298,11398]},{"content":"Claims in a Windows Store ID key","pos":[11403,11435]},{"content":"A Windows Store ID key is a JSON Web Token (JWT) that represents the identity of the user whose product ownership information you want to access.","pos":[11438,11583]},{"content":"When decoded using Base64, a Windows Store ID key contains the following claims.","pos":[11584,11664]},{"content":"Claim name","pos":[11668,11678]},{"content":"Description","pos":[11741,11752]},{"content":"iat","pos":[12574,12577]},{"content":"Identifies the time at which the key was issued.","pos":[12647,12695]},{"content":"This claim can be used to determine the age of the token.","pos":[12696,12753]},{"content":"This value is expressed as epoch time.","pos":[12754,12792]},{"content":"iss","pos":[13027,13030]},{"content":"Identifies the issuer.","pos":[13100,13122]},{"content":"This has the same value as the <bpt id=\"p1\">*</bpt>aud<ept id=\"p1\">*</ept> claim.","pos":[13123,13166],"source":" This has the same value as the *aud* claim."},{"content":"aud","pos":[13480,13483]},{"content":"Identifies the audience.","pos":[13553,13577]},{"content":"Must be one of the following values: <bpt id=\"p1\">**</bpt>https://collections.mp.microsoft.com/v6.0/keys<ept id=\"p1\">**</ept> or <bpt id=\"p2\">**</bpt>https://purchase.mp.microsoft.com/v6.0/keys<ept id=\"p2\">**</ept>.","pos":[13578,13717],"source":" Must be one of the following values: **https://collections.mp.microsoft.com/v6.0/keys** or **https://purchase.mp.microsoft.com/v6.0/keys**."},{"content":"exp","pos":[13933,13936]},{"content":"Identifies the expiration time on or after which the key will no longer be accepted for processing anything except for renewing keys.","pos":[14006,14139]},{"content":"The value of this claim is expressed as epoch time.","pos":[14140,14191]},{"content":"nbf","pos":[14386,14389]},{"content":"Identifies the time at which the token will be accepted for processing.","pos":[14459,14530]},{"content":"The value of this claim is expressed as epoch time.","pos":[14531,14582]},{"content":"http://schemas.microsoft.com/marketplace/2015/08/claims/key/clientId","pos":[14839,14907]},{"content":"The client ID that identifies the developer.","pos":[14912,14956]},{"content":"http://schemas.microsoft.com/marketplace/2015/08/claims/key/payload","pos":[15292,15359]},{"content":"An opaque payload (encrypted and Base64 encoded) that contains information that is intended only for use by Windows Store services.","pos":[15365,15496]},{"content":"http://schemas.microsoft.com/marketplace/2015/08/claims/key/userId","pos":[15745,15811]},{"content":"A user ID that identifies the current user in the context of your services.","pos":[15818,15893]},{"content":"This is the same value you pass into the optional <bpt id=\"p1\">*</bpt>publisherUserId<ept id=\"p1\">*</ept> parameter of the <bpt id=\"p2\">[</bpt><bpt id=\"p3\">**</bpt>GetCustomerCollectionsIdAsync<ept id=\"p3\">**</ept><ept id=\"p2\">](https://msdn.microsoft.com/library/windows/apps/mt608674)</ept> or <bpt id=\"p4\">[</bpt><bpt id=\"p5\">**</bpt>GetCustomerPurchaseIdAsync<ept id=\"p5\">**</ept><ept id=\"p4\">](https://msdn.microsoft.com/library/windows/apps/mt608675)</ept> method when you create the key.","pos":[15894,16198],"source":" This is the same value you pass into the optional *publisherUserId* parameter of the [**GetCustomerCollectionsIdAsync**](https://msdn.microsoft.com/library/windows/apps/mt608674) or [**GetCustomerPurchaseIdAsync**](https://msdn.microsoft.com/library/windows/apps/mt608675) method when you create the key."},{"content":"http://schemas.microsoft.com/marketplace/2015/08/claims/key/refreshUri","pos":[16203,16273]},{"content":"The URI that you can use to renew the key.","pos":[16276,16318]},{"content":"Here is an example of a decoded Windows Store ID key header.","pos":[16658,16718]},{"content":"Here is an example of a decoded Windows Store ID key claim set.","pos":[16814,16877]},{"content":"Related topics","pos":[18231,18245]},{"content":"Query for products","pos":[18250,18268]},{"content":"Report consumable products as fulfilled","pos":[18296,18335]},{"content":"Grant free products","pos":[18384,18403]},{"content":"Renew a Windows Store ID key","pos":[18432,18460]},{"content":"Integrating Applications with Azure Active Directory","pos":[18498,18550]},{"content":"Understanding the Azure Active Directory application manifest","pos":[18602,18663]},{"content":"Supported Token and Claim Types","pos":[18716,18747]}],"content":"---\nms.assetid: B071F6BC-49D3-4E74-98EA-0461A1A55EFB\ndescription: If you have a catalog of apps and in-app products (IAPs), you can use the Windows Store collection API and Windows Store purchase API to access ownership information for these products from your services.\ntitle: View and grant products from a service\n---\n\n# View and grant products from a service\n\n\n\\[ Updated for UWP apps on Windows 10. For Windows 8.x articles, see the [archive](http://go.microsoft.com/fwlink/p/?linkid=619132) \\]\n\n\nIf you have a catalog of apps and in-app products (IAPs), you can use the *Windows Store collection API* and *Windows Store purchase API* to access ownership information for these products from your services.\n\nThese APIs consist of REST methods that are designed to be used by developers with IAP catalogs that are supported by cross-platform services. These APIs enable you to do the following:\n\n-   Windows Store collection API: Query for apps and IAPs owned by a given user, or report a consumable product as fulfilled.\n-   Windows Store purchase API: Grant a free app or IAP to a given user.\n\n## Using the Windows Store collection API and Windows Store purchase API\n\n\nThe Windows Store collection API and purchase API use Azure Active Directory (Azure AD) authentication to access customer ownership information. Before you can call these APIs, you must apply Azure AD metadata to your application in the Windows Dev Center dashboard and generate several required access tokens and keys. The following steps describe the end-to-end process:\n\n1.  [Configure a Web application in Azure AD](#step-1:-configure-a-web-application-in-azure-ad). This application represents your cross-platform services in the context of Azure AD.\n2.  [Associate your Azure AD client ID with your application in the Windows Dev Center dashboard](#step-2:-associate-your-azure-ad-client-id-with-your-application-in-the-windows-dev-denter-dashboard).\n3.  In your service, [generate Azure AD access tokens](#step-3:-retrieve-access-tokens-from-azure-ad) that represent your publisher identity.\n4.  In client-side code in your Windows app, [generate a Windows Store ID key](#step-4:-generate-a-windows-store-id-key-from-client-side-code-in-your-app) that represents the identity of the current user, and pass the Windows Store ID key back to your service.\n5.  After you have the required Azure AD access token and Windows Store ID key, [call the Windows Store collection API or purchase API from your service](#step-5:-call-the-windows-store-collection-api-or-purchase-api-from-your-service).\n\nThe following sections provide more details about each of these steps.\n\n### Step 1: Configure a Web application in Azure AD\n\n1.  Follow the instructions in [Integrating Applications with Azure Active Directory](http://go.microsoft.com/fwlink/?LinkId=722502) to add a Web application to Azure AD.\n    **Note**  On the **Tell us about your application page**, make sure that you choose **Web application and/or web API**. This is required so that you can obtain a key (also called a *client secret*) for your application. In order to call the Windows Store collection API or purchase API, you must provide a client secret when you request an access token from Azure AD in a later step.\n2.  In the [Azure Management Portal](http://manage.windowsazure.com/), navigate to **Active Directory**. Select your directory, click the **Applications** tab at the top, and then select your application.\n3.  Click the **Configure** tab. On this tab, obtain the client ID for your application and request a key (this is called a *client secret* in later steps).\n4.  At the bottom of the screen, click **Manage manifest**. Download your Azure AD application manifest and replace the `\"identifierUris\"` section with the following text.\n\n    ```json\n    \"identifierUris\" : [                                \n            \"https://onestore.microsoft.com\",\n            \"https://onestore.microsoft.com/b2b/keys/create/collections\",\n            \"https://onestore.microsoft.com/b2b/keys/create/purchase\"\n        ],\n    ```\n\n    These strings represent the audiences supported by your application. In a later step, you will create Azure AD access tokens that are associated with each of these audience values. For more information about how to download your application manifest, see [Understanding the Azure Active Directory application manifest]( http://go.microsoft.com/fwlink/?LinkId=722500).\n\n5.  Save your application manifest and upload it to your application in the [Azure Management Portal](http://manage.windowsazure.com/).\n\n### Step 2: Associate your Azure AD client ID with your application in the Windows Dev Center dashboard\n\nThe Windows Store collection API and purchase API only provide access to a user's ownership information for apps and IAPs that you have associated with your Azure AD client ID.\n\n1.  Sign in to the [Windows Dev Center dashboard](https://dev.windows.com/overview) and select your app.\n2.  Go to the **Services** &gt; **Product collections and purchases** page and enter your Azure AD client ID into one of the available fields.\n\n### Step 3: Retrieve access tokens from Azure AD\n\nBefore you can retrieve a Windows Store ID key or call the Windows Store collection API or purchase API, your service must request three Azure AD access tokens that represent your publisher identity. Each of these access tokens is associated with a different audience URI, and each token will be used with a different API call. The lifetime of each token is 60 minutes, and you can refresh them after they expire.\n\nTo create the access tokens, use the OAuth 2.0 API in your service by following the instructions in [Service to Service Calls Using Client Credentials](https://msdn.microsoft.com/library/azure/dn645543.aspx). For each token, specify the following parameter data:\n\n-   For the *client\\_id* and *client\\_secret* parameters, specify the client ID and the client secret for your application as obtained from the [Azure Management Portal](http://manage.windowsazure.com/). Both of these parameters are required in order to generate an access token with the level of authentication required by the Windows Store collection API or purchase API.\n-   For the *resource* parameter, specify one of the following app ID URIs (these are the same URIs that you previously added to the `\"identifierUris\"` section of the application manifest). At the end of this process, you should have three access tokens that each have one of these app ID URIs associated with them:\n    -   **https://onestore.microsoft.com/b2b/keys/create/collections**: In a later step, you will use the access token that you create with this URI to request a Windows Store ID key that you can use with the Windows Store collection API.\n    -   **https://onestore.microsoft.com/b2b/keys/create/purchase**: In a later step, you will use the access token that you create with this URI to request a Windows Store ID key that you can use with the Windows Store purchase API.\n    -   **https://onestore.microsoft.com**: In a later step, you will use the access token that you create with this URI in direct calls to the Windows Store collection API or purchase API.\n\n    **Important**  Use the **https://onestore.microsoft.com** audience only with access tokens that are stored securely within your service. Exposing access tokens with this audience outside your service could make your service vulnerable to replay attacks.\n\nFor more details about the structure of an access token, see [Supported Token and Claim Types](http://go.microsoft.com/fwlink/?LinkId=722501).\n\n**Important**  You should create Azure AD access tokens only in the context of your service, not in your app. Your client secret could be compromised if it is sent to your app.\n\n \n\n### Step 4: Generate a Windows Store ID key from client-side code in your app\n\nBefore you can call the Windows Store collection API or purchase API, your service must obtain a Windows Store ID key. This is a JSON Web Token (JWT) that represents the identity of the user whose product ownership information you want to access. For more information about the claims in this key, see [Claims in a Windows Store ID key](#windowsstorekey).\n\nCurrently, the only way to obtain a Windows Store ID key is by calling a Universal Windows Platform (UWP) API from client-side code in your app to retrieve the identity of the user who is currently signed in to the Windows Store. To generate a Windows Store ID key:\n\n1.  Pass one of the following access tokens from your service to your client app:\n    -   To get a Windows Store ID key that you can use with the Windows Store collection API, pass the Azure AD access token that you created with the **https://onestore.microsoft.com/b2b/keys/create/collections** audience URI.\n    -   To get a Windows Store ID key that you can use with the Windows Store purchase API, pass the Azure AD access token that you created with the **https://onestore.microsoft.com/b2b/keys/create/purchase** audience URI.\n\n2.  In your app code, call one of the following methods of the [**CurrentApp**](https://msdn.microsoft.com/library/windows/apps/hh779765) class to retrieve a Windows Store ID key.\n\n    -   [**GetCustomerCollectionsIdAsync**](https://msdn.microsoft.com/library/windows/apps/mt608674): Call this method if you intend to use the Windows Store collection API.\n    -   [**GetCustomerPurchaseIdAsync**](https://msdn.microsoft.com/library/windows/apps/mt608675): Call this method if you intend to use the Windows Store purchase API.\n\n    For either method, pass your Azure AD access token to the *serviceTicket* parameter. You can optionally pass an ID to the *publisherUserId* parameter that identifies the current user in the context of your services. If you maintain user IDs for your services, you can use this parameter to correlate these user IDs with the calls you make to the Windows Store collection API or purchase API.\n\n3.  After your app successfully retrieves a Windows Store ID key, pass the key back to your service.\n\n**Note**  Each Windows Store ID key is valid for 90 days. After a key expires, you can [renew the key](renew-a-windows-store-id-key.md). We recommend that you renew your Windows Store ID keys rather than creating new ones.\n\n \n\n### Step 5: Call the Windows Store collection API or purchase API from your service\n\nAfter your service has a Windows Store ID key that enables it to access a specific user's product ownership information, your service can call the Windows Store collection API or purchase API. Use the instructions that apply to your scenario:\n\n-   [Query for products](query-for-products.md)\n-   [Report consumable products as fulfilled](report-consumable-products-as-fulfilled.md)\n-   [Grant free products](grant-free-products.md)\n\nFor each scenario, pass the following information to the API:\n\n-   The Azure AD access token that you created earlier with the **https://onestore.microsoft.com** audience URI. This token represents your publisher identity. Pass this token in the request header.\n-   The Windows Store ID key you retrieved from [**GetCustomerCollectionsIdAsync**](https://msdn.microsoft.com/library/windows/apps/mt608674) or [**GetCustomerPurchaseIdAsync**](https://msdn.microsoft.com/library/windows/apps/mt608675) in your app. This key represents the identity of the user whose product ownership information you want to access.\n\n## Claims in a Windows Store ID key\n\n\nA Windows Store ID key is a JSON Web Token (JWT) that represents the identity of the user whose product ownership information you want to access. When decoded using Base64, a Windows Store ID key contains the following claims.\n\n| Claim name                                                             | Description                                                                                                                                                                                                                                                                                                                                                                             |\n|------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|\n| iat                                                                    | Identifies the time at which the key was issued. This claim can be used to determine the age of the token. This value is expressed as epoch time.                                                                                                                                                                                                                                       |\n| iss                                                                    | Identifies the issuer. This has the same value as the *aud* claim.                                                                                                                                                                                                                                                                                                                      |\n| aud                                                                    | Identifies the audience. Must be one of the following values: **https://collections.mp.microsoft.com/v6.0/keys** or **https://purchase.mp.microsoft.com/v6.0/keys**.                                                                                                                                                                                                                    |\n| exp                                                                    | Identifies the expiration time on or after which the key will no longer be accepted for processing anything except for renewing keys. The value of this claim is expressed as epoch time.                                                                                                                                                                                               |\n| nbf                                                                    | Identifies the time at which the token will be accepted for processing. The value of this claim is expressed as epoch time.                                                                                                                                                                                                                                                             |\n| http://schemas.microsoft.com/marketplace/2015/08/claims/key/clientId   | The client ID that identifies the developer.                                                                                                                                                                                                                                                                                                                                            |\n| http://schemas.microsoft.com/marketplace/2015/08/claims/key/payload    | An opaque payload (encrypted and Base64 encoded) that contains information that is intended only for use by Windows Store services.                                                                                                                                                                                                                                                     |\n| http://schemas.microsoft.com/marketplace/2015/08/claims/key/userId     | A user ID that identifies the current user in the context of your services. This is the same value you pass into the optional *publisherUserId* parameter of the [**GetCustomerCollectionsIdAsync**](https://msdn.microsoft.com/library/windows/apps/mt608674) or [**GetCustomerPurchaseIdAsync**](https://msdn.microsoft.com/library/windows/apps/mt608675) method when you create the key. |\n| http://schemas.microsoft.com/marketplace/2015/08/claims/key/refreshUri | The URI that you can use to renew the key.                                                                                                                                                                                                                                                                                                                                              |\n\n \n\nHere is an example of a decoded Windows Store ID key header.\n\n```\n{ \n    \"typ\":\"JWT\", \n    \"alg\":\"RS256\", \n    \"x5t\":\"agA_pgJ7Twx_Ex2_rEeQ2o5fZ5g\" \n} \n```\n\nHere is an example of a decoded Windows Store ID key claim set.\n\n```\n{ \n    \"http://schemas.microsoft.com/marketplace/2015/08/claims/key/clientId\": \"1d5773695a3b44928227393bfef1e13d\", \n    \"http://schemas.microsoft.com/marketplace/2015/08/claims/key/payload\": \"ZdcOq0/N2rjytCRzCHSqnfczv3f0343wfSydx7hghfu0snWzMqyoAGy5DSJ5rMSsKoQFAccs1iNlwlGrX+/eIwh/VlUhLrncyP8c18mNAzAGK+lTAd2oiMQWRRAZxPwGrJrwiq2fTq5NOVDnQS9Za6/GdRjeiQrv6c0x+WNKxSQ7LV/uH1x+IEhYVtDu53GiXIwekltwaV6EkQGphYy7tbNsW2GqxgcoLLMUVOsQjI+FYBA3MdQpalV/aFN4UrJDkMWJBnmz3vrxBNGEApLWTS4Bd3cMswXsV9m+VhOEfnv+6PrL2jq8OZFoF3FUUpY8Fet2DfFr6xjZs3CBS1095J2yyNFWKBZxAXXNjn+zkvqqiVRjjkjNajhuaNKJk4MGHfk2rZiMy/aosyaEpCyncdisHVSx/S4JwIuxTnfnlY24vS0OXy7mFiZjjB8qL03cLsBXM4utCyXSIggb90GAx0+EFlVoJD7+ZKlm1M90xO/QSMDlrzFyuqcXXDBOnt7rPynPTrOZLVF+ODI5HhWEqArkVnc5MYnrZD06YEwClmTDkHQcxCvU+XUEvTbEk69qR2sfnuXV4cJRRWseUTfYoGyuxkQ2eWAAI1BXGxYECIaAnWF0W6ThweL5ZZDdadW9Ug5U3fZd4WxiDlB/EZ3aTy8kYXTW4Uo0adTkCmdLibw=\", \n    \"http://schemas.microsoft.com/marketplace/2015/08/claims/key/userId\": \"infusQMLaYCrgtC0d/SZWoPB4FqLEwHXgZFuMJ6TuTY=\", \n    \"http://schemas.microsoft.com/marketplace/2015/08/claims/key/refreshUri\": \"https://collections.mp.microsoft.com/v6.0/b2b/keys/renew\", \n    \"iat\": 1442395542, \n    \"iss\": \"https://collections.mp.microsoft.com/v6.0/keys\", \n    \"aud\": \"https://collections.mp.microsoft.com/v6.0/keys\", \n    \"exp\": 1450171541, \n    \"nbf\": 1442391941 \n} \n```\n\n## Related topics\n\n* [Query for products](query-for-products.md)\n* [Report consumable products as fulfilled](report-consumable-products-as-fulfilled.md)\n* [Grant free products](grant-free-products.md)\n* [Renew a Windows Store ID key](renew-a-windows-store-id-key.md)\n* [Integrating Applications with Azure Active Directory](http://go.microsoft.com/fwlink/?LinkId=722502)\n* [Understanding the Azure Active Directory application manifest]( http://go.microsoft.com/fwlink/?LinkId=722500)\n* [Supported Token and Claim Types](http://go.microsoft.com/fwlink/?LinkId=722501)\n \n\n \n\n\n\n"}