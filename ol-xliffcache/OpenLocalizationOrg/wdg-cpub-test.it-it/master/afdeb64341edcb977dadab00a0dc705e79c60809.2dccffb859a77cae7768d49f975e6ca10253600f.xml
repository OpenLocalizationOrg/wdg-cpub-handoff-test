{"nodes":[{"pos":[17,144],"content":"WebSockets provide a mechanism for fast, secure two-way communication between a client and a server over the web using HTTP(S).","needQuote":true,"needEscape":true,"nodes":[{"content":"WebSockets provide a mechanism for fast, secure two-way communication between a client and a server over the web using HTTP(S).","pos":[0,127]}]},{"pos":[152,162],"content":"WebSockets","needQuote":true,"needEscape":true,"nodes":[{"content":"WebSockets","pos":[0,10]}]},{"content":"WebSockets","pos":[219,229]},{"content":"\\[ Updated for UWP apps on Windows 10.","pos":[231,269]},{"content":"For Windows 8.x articles, see the <bpt id=\"p1\">[</bpt>archive<ept id=\"p1\">](http://go.microsoft.com/fwlink/p/?linkid=619132)</ept> \\]","pos":[270,365],"source":" For Windows 8.x articles, see the [archive](http://go.microsoft.com/fwlink/p/?linkid=619132) \\]"},{"content":"Important APIs","pos":[369,383]},{"content":"MessageWebSocket","pos":[394,410]},{"content":"StreamWebSocket","pos":[479,494]},{"content":"WebSockets provide a mechanism for fast, secure two-way communication between a client and a server over the web using HTTP(S).","pos":[557,684]},{"content":"Under the <bpt id=\"p1\">[</bpt>WebSocket Protocol<ept id=\"p1\">](http://tools.ietf.org/html/rfc6455)</ept>, data is transferred immediately over a full-duplex single socket connection, allowing messages to be sent and received from both endpoints in real time.","pos":[686,906],"source":"Under the [WebSocket Protocol](http://tools.ietf.org/html/rfc6455), data is transferred immediately over a full-duplex single socket connection, allowing messages to be sent and received from both endpoints in real time."},{"content":"WebSockets are ideal for use in real-time gaming where instant social network notifications and up-to-date displays of information (game statistics ) need to be secure and use fast data transfer.","pos":[907,1102]},{"content":"Universal Windows Platform (UWP) developers can use the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>MessageWebSocket<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br226842)</ept> and <bpt id=\"p3\">[</bpt><bpt id=\"p4\">**</bpt>StreamWebSocket<ept id=\"p4\">**</ept><ept id=\"p3\">](https://msdn.microsoft.com/library/windows/apps/br226923)</ept> classes to connect with servers that support the Websocket protocol.","pos":[1103,1392],"source":" Universal Windows Platform (UWP) developers can use the [**MessageWebSocket**](https://msdn.microsoft.com/library/windows/apps/br226842) and [**StreamWebSocket**](https://msdn.microsoft.com/library/windows/apps/br226923) classes to connect with servers that support the Websocket protocol."},{"content":"MessageWebSocket","pos":[1396,1412]},{"content":"StreamWebSocket","pos":[1471,1486]},{"content":"Suitable for typical scenarios where messages are not extremely large.","pos":[1742,1812]},{"content":"Suitable for scenarios in which large files (such as photos or videos) are being transferred.","pos":[1817,1910]},{"content":"Enables notification that an entire WebSocket message has been received.","pos":[1915,1987]},{"content":"Allows sections of a message to be read with each read operation.","pos":[1990,2055]},{"content":"Supports both UTF-8 and binary messages.","pos":[2088,2128]},{"content":"Supports only binary messages.","pos":[2163,2193]},{"content":"Similar to a UDP or datagram socket.","pos":[2261,2297]},{"content":"Similar to a TCP or stream socket.","pos":[2336,2370]},{"content":"In most cases you'll want to use a secure WebSocket connection to encrypt data sent and received.","pos":[2433,2530]},{"content":"This will also increase the chances that your connection will succeed, as many proxies will reject unencrypted WebSocket connections.","pos":[2531,2664]},{"content":"The WebSocket protocol defines the following two URI schemes.","pos":[2665,2726]},{"content":"ws: - use for unencrypted connections.","pos":[2732,2770]},{"content":"wss: - use for secure connections that should be encrypted.","pos":[2775,2834]},{"pos":[2836,2946],"content":"To encrypt a WebSocket connection, use the wss: URI scheme, for example, <ph id=\"ph1\">`wss://www.contoso.com/mywebservice`</ph>.","source":"To encrypt a WebSocket connection, use the wss: URI scheme, for example, `wss://www.contoso.com/mywebservice`."},{"content":"Using MessageWebSocket","pos":[2951,2973]},{"content":"The <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>MessageWebSocket<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br226842)</ept> allows sections of a message to be read with each read operation.","pos":[2975,3125],"source":"The [**MessageWebSocket**](https://msdn.microsoft.com/library/windows/apps/br226842) allows sections of a message to be read with each read operation."},{"content":"A <bpt id=\"p1\">**</bpt>MessageWebSocket<ept id=\"p1\">**</ept> is typically used in scenarios where messages are not extremely large.","pos":[3126,3219],"source":" A **MessageWebSocket** is typically used in scenarios where messages are not extremely large."},{"content":"Both UTF-8 and binary files are supported.","pos":[3220,3262]},{"content":"The code in this section creates a new <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>MessageWebSocket<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br226842)</ept>, connects to a WebSocket server, and sends data to the server.","pos":[3264,3446],"source":"The code in this section creates a new [**MessageWebSocket**](https://msdn.microsoft.com/library/windows/apps/br226842), connects to a WebSocket server, and sends data to the server."},{"content":"Once a successful connection is established, the app waits for the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>MessageWebSocket.MessageReceived<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br241358)</ept> event to be triggered, indicating that data was received.","pos":[3447,3668],"source":" Once a successful connection is established, the app waits for the [**MessageWebSocket.MessageReceived**](https://msdn.microsoft.com/library/windows/apps/br241358) event to be triggered, indicating that data was received."},{"content":"This sample uses the WebSocket.org echo server, a service which simply echoes back to the sender any string sent to it.","pos":[3670,3789]},{"content":"By using the \"wss:\" protocol specifier, this sample uses a secure connection to send and receive messages.","pos":[3790,3896]},{"content":"Once you have initialized the WebSocket connection, your code must perform the following activities to properly send and receive data.","pos":[6166,6300]},{"content":"Implement a callback for the MessageWebSocket.MessageReceived event","pos":[6306,6373]},{"content":"Before establishing a connection and sending data with a WebSocket, your app needs to register an event callback to receive notification when data is received.","pos":[6375,6534]},{"content":"When the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>MessageWebSocket.MessageReceived<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br241358)</ept> event occurs, the registered callback is called and receives data from <bpt id=\"p3\">[</bpt><bpt id=\"p4\">**</bpt>MessageWebSocketMessageReceivedEventArgs<ept id=\"p4\">**</ept><ept id=\"p3\">](https://msdn.microsoft.com/library/windows/apps/br226852)</ept>.","pos":[6535,6817],"source":" When the [**MessageWebSocket.MessageReceived**](https://msdn.microsoft.com/library/windows/apps/br241358) event occurs, the registered callback is called and receives data from [**MessageWebSocketMessageReceivedEventArgs**](https://msdn.microsoft.com/library/windows/apps/br226852)."},{"content":"This example is written with the assumption that the messages being sent are in UTF-8 format.","pos":[6818,6911]},{"content":"The following sample function receives a string from a connected WebSocket server and prints the string to the debugger output window.","pos":[6913,7047]},{"content":"Implement a callback for the MessageWebSocket.Closed event","pos":[8093,8151]},{"content":"Before establishing a connection and sending data with a WebSocket, your app needs to register an event callback to receive notification when the WebSocket is closed by the WebSocket server.","pos":[8153,8343]},{"content":"When the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>MessageWebSocket.Closed<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/hh701364)</ept> event occurs, the registered callback is called to indicate the connection was closed by the WebSocket server.","pos":[8344,8551],"source":" When the [**MessageWebSocket.Closed**](https://msdn.microsoft.com/library/windows/apps/hh701364) event occurs, the registered callback is called to indicate the connection was closed by the WebSocket server."},{"content":"Send a message on a WebSocket","pos":[9338,9367]},{"content":"Once a connection is established, the WebSocket client can send data to the server.","pos":[9369,9452]},{"content":"The <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>DataWriter.StoreAsync<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br208171)</ept> method returns a parameter that maps to an unsigned int.","pos":[9453,9599],"source":" The [**DataWriter.StoreAsync**](https://msdn.microsoft.com/library/windows/apps/br208171) method returns a parameter that maps to an unsigned int."},{"content":"This changes how we define the task to send the message compared with the task to make the connection.","pos":[9600,9702]},{"content":"<bpt id=\"p1\">**</bpt>Note<ept id=\"p1\">**</ept>   When you create a new DataWriter object using the MessageWebSocket's OutputStream, the DataWriter takes ownership of the OutputStream, and will deallocate the Outputstream when the DataWriter goes out of scope.","pos":[9704,9925],"source":"**Note**   When you create a new DataWriter object using the MessageWebSocket's OutputStream, the DataWriter takes ownership of the OutputStream, and will deallocate the Outputstream when the DataWriter goes out of scope."},{"content":"This causes any subsequent attempts to use the OutputStream to fail with an HRESULT value of 0x80000013.","pos":[9926,10030]},{"content":"To avoid deallocating the OutputStream, this code calls the DataWriter's DetachStream method, which returns ownership of the stream to the WebSocket object.","pos":[10031,10187]},{"content":"The following function sends the given string to a connected WebSocket, and prints a verification message in the debugger output window.","pos":[10189,10325]},{"content":"Using advanced controls with WebSockets","pos":[11750,11789]},{"content":"<bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>MessageWebSocket<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br226842)</ept> and <bpt id=\"p3\">[</bpt><bpt id=\"p4\">**</bpt>StreamWebSocket<ept id=\"p4\">**</ept><ept id=\"p3\">](https://msdn.microsoft.com/library/windows/apps/br226923)</ept> follow the same model for using advanced controls.","pos":[11791,12006],"source":"[**MessageWebSocket**](https://msdn.microsoft.com/library/windows/apps/br226842) and [**StreamWebSocket**](https://msdn.microsoft.com/library/windows/apps/br226923) follow the same model for using advanced controls."},{"content":"Corresponding with each of the above primary classes are related classes to access advanced controls.","pos":[12007,12108]},{"content":"<bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>MessageWebSocketControl<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br226843)</ept> provides socket control data on a <bpt id=\"p3\">[</bpt><bpt id=\"p4\">**</bpt>MessageWebSocket<ept id=\"p4\">**</ept><ept id=\"p3\">](https://msdn.microsoft.com/library/windows/apps/br226842)</ept> object.","pos":[12110,12320],"source":"[**MessageWebSocketControl**](https://msdn.microsoft.com/library/windows/apps/br226843) provides socket control data on a [**MessageWebSocket**](https://msdn.microsoft.com/library/windows/apps/br226842) object."},{"content":"<bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>StreamWebSocketControl<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br226924)</ept> provides socket control data on a <bpt id=\"p3\">[</bpt><bpt id=\"p4\">**</bpt>StreamWebSocket<ept id=\"p4\">**</ept><ept id=\"p3\">](https://msdn.microsoft.com/library/windows/apps/br226923)</ept> object.","pos":[12321,12529],"source":"[**StreamWebSocketControl**](https://msdn.microsoft.com/library/windows/apps/br226924) provides socket control data on a [**StreamWebSocket**](https://msdn.microsoft.com/library/windows/apps/br226923) object."},{"content":"The basic model to use advanced controls is the same for both types of WebSockets.","pos":[12530,12612],"source":"\nThe basic model to use advanced controls is the same for both types of WebSockets."},{"content":"The following discussion uses a <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>StreamWebSocket<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br226923)</ept> as an example, but the same process can be used with a <bpt id=\"p3\">[</bpt><bpt id=\"p4\">**</bpt>MessageWebSocket<ept id=\"p4\">**</ept><ept id=\"p3\">](https://msdn.microsoft.com/library/windows/apps/br226842)</ept>.","pos":[12613,12861],"source":" The following discussion uses a [**StreamWebSocket**](https://msdn.microsoft.com/library/windows/apps/br226923) as an example, but the same process can be used with a [**MessageWebSocket**](https://msdn.microsoft.com/library/windows/apps/br226842)."},{"pos":[12867,12965],"content":"Create the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>StreamWebSocket<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br226923)</ept> object.","source":"Create the [**StreamWebSocket**](https://msdn.microsoft.com/library/windows/apps/br226923) object."},{"pos":[12970,13295],"content":"Use the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>StreamWebSocket.Control<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br226934)</ept> property to retrieve the <bpt id=\"p3\">[</bpt><bpt id=\"p4\">**</bpt>StreamWebSocketControl<ept id=\"p4\">**</ept><ept id=\"p3\">](https://msdn.microsoft.com/library/windows/apps/br226924)</ept> instance associated with this <bpt id=\"p5\">[</bpt><bpt id=\"p6\">**</bpt>StreamWebSocket<ept id=\"p6\">**</ept><ept id=\"p5\">](https://msdn.microsoft.com/library/windows/apps/br226923)</ept> object.","source":"Use the [**StreamWebSocket.Control**](https://msdn.microsoft.com/library/windows/apps/br226934) property to retrieve the [**StreamWebSocketControl**](https://msdn.microsoft.com/library/windows/apps/br226924) instance associated with this [**StreamWebSocket**](https://msdn.microsoft.com/library/windows/apps/br226923) object."},{"pos":[13300,13466],"content":"Get or set properties on the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>StreamWebSocketControl<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br226924)</ept> instance to get or set specific advanced controls.","source":"Get or set properties on the [**StreamWebSocketControl**](https://msdn.microsoft.com/library/windows/apps/br226924) instance to get or set specific advanced controls."},{"pos":[13468,13695],"content":"Both <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>StreamWebSocket<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br226923)</ept> and <bpt id=\"p3\">[</bpt><bpt id=\"p4\">**</bpt>MessageWebSocket<ept id=\"p4\">**</ept><ept id=\"p3\">](https://msdn.microsoft.com/library/windows/apps/br226842)</ept> impose requirements on when advanced controls can be set.","source":"Both [**StreamWebSocket**](https://msdn.microsoft.com/library/windows/apps/br226923) and [**MessageWebSocket**](https://msdn.microsoft.com/library/windows/apps/br226842) impose requirements on when advanced controls can be set."},{"content":"For all advanced controls on the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>StreamWebSocket<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br226923)</ept>, the app must always set the property before issuing a Connect operation.","pos":[13701,13887],"source":"For all advanced controls on the [**StreamWebSocket**](https://msdn.microsoft.com/library/windows/apps/br226923), the app must always set the property before issuing a Connect operation."},{"content":"Because of this requirement, it is best practice to set all control properties immediately after creating the <bpt id=\"p1\">**</bpt>StreamWebSocket<ept id=\"p1\">**</ept> object.","pos":[13888,14025],"source":" Because of this requirement, it is best practice to set all control properties immediately after creating the **StreamWebSocket** object."},{"content":"Do not try to set a control property after the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>StreamWebSocket.ConnectAsync<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br226933)</ept> method has been called.","pos":[14026,14189],"source":" Do not try to set a control property after the [**StreamWebSocket.ConnectAsync**](https://msdn.microsoft.com/library/windows/apps/br226933) method has been called."},{"content":"For all of the advanced controls on the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>MessageWebSocket<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br226842)</ept> except the message type, you must set the property before issuing a Connect operation.","pos":[14194,14401],"source":"For all of the advanced controls on the [**MessageWebSocket**](https://msdn.microsoft.com/library/windows/apps/br226842) except the message type, you must set the property before issuing a Connect operation."},{"content":"It is best practice to set all control properties immediately after creating the <bpt id=\"p1\">**</bpt>MessageWebSocket<ept id=\"p1\">**</ept> object.","pos":[14402,14511],"source":" It is best practice to set all control properties immediately after creating the **MessageWebSocket** object."},{"content":"Except for the message type, do not attempt to change a control property after <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>MessageWebSocket.ConnectAsync<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br226859)</ept> has been called.","pos":[14512,14701],"source":" Except for the message type, do not attempt to change a control property after [**MessageWebSocket.ConnectAsync**](https://msdn.microsoft.com/library/windows/apps/br226859) has been called."},{"content":"WebSocket information classes","pos":[14706,14735]},{"pos":[14737,14998],"content":"<bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>MessageWebSocket<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br226842)</ept> and <bpt id=\"p3\">[</bpt><bpt id=\"p4\">**</bpt>StreamWebSocket<ept id=\"p4\">**</ept><ept id=\"p3\">](https://msdn.microsoft.com/library/windows/apps/br226923)</ept> each have a corresponding class that provides additional information about a WebSocket instance.","source":"[**MessageWebSocket**](https://msdn.microsoft.com/library/windows/apps/br226842) and [**StreamWebSocket**](https://msdn.microsoft.com/library/windows/apps/br226923) each have a corresponding class that provides additional information about a WebSocket instance."},{"pos":[15000,15369],"content":"<bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>MessageWebSocketInformation<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br226849)</ept> provides information about a <bpt id=\"p3\">[</bpt><bpt id=\"p4\">**</bpt>MessageWebSocket<ept id=\"p4\">**</ept><ept id=\"p3\">](https://msdn.microsoft.com/library/windows/apps/br226842)</ept>, and you retrieve an instance of the information class using the <bpt id=\"p5\">[</bpt><bpt id=\"p6\">**</bpt>MessageWebSocket.Information<ept id=\"p6\">**</ept><ept id=\"p5\">](https://msdn.microsoft.com/library/windows/apps/br226861)</ept> property.","source":"[**MessageWebSocketInformation**](https://msdn.microsoft.com/library/windows/apps/br226849) provides information about a [**MessageWebSocket**](https://msdn.microsoft.com/library/windows/apps/br226842), and you retrieve an instance of the information class using the [**MessageWebSocket.Information**](https://msdn.microsoft.com/library/windows/apps/br226861) property."},{"pos":[15371,15737],"content":"<bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>StreamWebSocketInformation<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br226929)</ept> provides information about a <bpt id=\"p3\">[</bpt><bpt id=\"p4\">**</bpt>StreamWebSocket<ept id=\"p4\">**</ept><ept id=\"p3\">](https://msdn.microsoft.com/library/windows/apps/br226923)</ept>, and you retrieve an instance of the information class using the <bpt id=\"p5\">[</bpt><bpt id=\"p6\">**</bpt>StreamWebSocket.Information<ept id=\"p6\">**</ept><ept id=\"p5\">](https://msdn.microsoft.com/library/windows/apps/br226935)</ept> property.","source":"[**StreamWebSocketInformation**](https://msdn.microsoft.com/library/windows/apps/br226929) provides information about a [**StreamWebSocket**](https://msdn.microsoft.com/library/windows/apps/br226923), and you retrieve an instance of the information class using the [**StreamWebSocket.Information**](https://msdn.microsoft.com/library/windows/apps/br226935) property."},{"content":"Note that all of the properties on both Information classes are read-only, and that you can retrieve current information at any time during the lifetime of a web socket object.","pos":[15739,15915]},{"content":"Handling network exceptions","pos":[15920,15947]},{"content":"An error encountered on a <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>MessageWebSocket<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br226842)</ept> or <bpt id=\"p3\">[</bpt><bpt id=\"p4\">**</bpt>StreamWebSocket<ept id=\"p4\">**</ept><ept id=\"p3\">](https://msdn.microsoft.com/library/windows/apps/br226923)</ept> operation is returned as an <bpt id=\"p5\">**</bpt>HRESULT<ept id=\"p5\">**</ept> value.","pos":[15949,16185],"source":"An error encountered on a [**MessageWebSocket**](https://msdn.microsoft.com/library/windows/apps/br226842) or [**StreamWebSocket**](https://msdn.microsoft.com/library/windows/apps/br226923) operation is returned as an **HRESULT** value."},{"content":"The <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>WebSocketError.GetStatus<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/hh701529)</ept> method is used to convert a network error from a WebSocket operation to a <bpt id=\"p3\">[</bpt><bpt id=\"p4\">**</bpt>WebErrorStatus<ept id=\"p4\">**</ept><ept id=\"p3\">](https://msdn.microsoft.com/library/windows/apps/hh747818)</ept> enumeration value.","pos":[16186,16450],"source":" The [**WebSocketError.GetStatus**](https://msdn.microsoft.com/library/windows/apps/hh701529) method is used to convert a network error from a WebSocket operation to a [**WebErrorStatus**](https://msdn.microsoft.com/library/windows/apps/hh747818) enumeration value."},{"content":"Most of the <bpt id=\"p1\">**</bpt>WebErrorStatus<ept id=\"p1\">**</ept> enumeration values correspond to an error returned by the native HTTP client operation.","pos":[16451,16569],"source":" Most of the **WebErrorStatus** enumeration values correspond to an error returned by the native HTTP client operation."},{"content":"Your app can filter on specific <bpt id=\"p1\">**</bpt>WebErrorStatus<ept id=\"p1\">**</ept> enumeration values to modify app behavior depending on the cause of the exception.","pos":[16570,16703],"source":" Your app can filter on specific **WebErrorStatus** enumeration values to modify app behavior depending on the cause of the exception."},{"content":"For parameter validation errors, an app can also use the <bpt id=\"p1\">**</bpt>HRESULT<ept id=\"p1\">**</ept> from the exception to learn more detailed information on the error that caused the exception.","pos":[16705,16867],"source":"For parameter validation errors, an app can also use the **HRESULT** from the exception to learn more detailed information on the error that caused the exception."},{"content":"Possible <bpt id=\"p1\">**</bpt>HRESULT<ept id=\"p1\">**</ept> values are listed in the <bpt id=\"p2\">*</bpt>Winerror.h<ept id=\"p2\">*</ept> header file.","pos":[16868,16939],"source":" Possible **HRESULT** values are listed in the *Winerror.h* header file."},{"content":"For most parameter validation errors, the <bpt id=\"p1\">**</bpt>HRESULT<ept id=\"p1\">**</ept> returned is <bpt id=\"p2\">**</bpt>E\\_INVALIDARG<ept id=\"p2\">**</ept>.","pos":[16940,17024],"source":" For most parameter validation errors, the **HRESULT** returned is **E\\_INVALIDARG**."},{"content":"Setting timeouts on WebSocket operations","pos":[17029,17069]},{"content":"The MessageWebSocket and StreamWebSocket classes uses an internal system service to send WebSocket client requests and receive responses from a server.","pos":[17071,17222]},{"content":"The default timeout value used for a WebSocket connect operation is 60 seconds.","pos":[17223,17302]},{"content":"If the HTTP server that supports WebSockets is temporarily down or blocked by a network outage and the server doesn't or can't respond to the WebSocket connection request, the internal system service waits the default 60 seconds before it returns an error which causes an exception to be thrown on the WebSocket ConnectAsync method.","pos":[17303,17635]},{"content":"If the name query for an HTTP server name in the URI returns multiple IP addresses for the name, the internal system service tries up to 5 IP addresses for the site each with a default timeout of 60 seconds before it fails.","pos":[17636,17859]},{"content":"An app making a WebSocket connection request could wait several minutes trying to connect to multiple IP addresses before an error is returned and an exception is thrown.","pos":[17860,18030]},{"content":"This behavior could appear to the user as if the app stopped working.","pos":[18031,18100]},{"content":"The default timeout used for send and receive operations after a WebSocket connection has been established is 30 seconds.","pos":[18101,18222]},{"content":"To make your app more responsive and minimize these issues, it can set a shorter timeout on connection requests so that the operation fails due to timeout sooner than from the default settings.","pos":[18224,18417]},{"content":"You set timeouts similarly for both StreamWebSockets and MessageWebSockets.","pos":[18419,18494]},{"content":"The following example shows how to set a timeout on StreamWebSocket, but the process is similar for a MessageWebSocket.","pos":[18495,18614]},{"content":"Create a task that completes after a specified delay using a timer.","pos":[18620,18687]},{"content":"Create a task for the WebSocket operation with a cancellation\\_token\\_source to support cancellation.","pos":[18692,18793]},{"content":"If the task with the specified timeout delay completes before the WebSocket connect operation, cancel the task for the WebSocket operation.","pos":[18798,18937]},{"content":"The following example creates one task that completes after a specified delay, and creates a second task that cancels after a specified delay.","pos":[18939,19081]},{"content":"These classes can be used with StreamWebSocket and MessageWebSocket when trying to establish a connection to set a specific timeout.","pos":[19082,19214]},{"content":"An example usage would be calling the StreamWebSocket.ConnectAsync method in a task with a cancellation\\_token\\_source that supports cancellation.","pos":[19215,19361]},{"content":"If timeout completes first, then the cancellation\\_token\\_source is used to cancel the task for the WebSocket connect operation.","pos":[19362,19490]}],"content":"---\ndescription: WebSockets provide a mechanism for fast, secure two-way communication between a client and a server over the web using HTTP(S).\ntitle: WebSockets\nms.assetid: EAA9CB3E-6A3A-4C13-9636-CCD3DE46E7E2\n---\n\n# WebSockets\n\n\\[ Updated for UWP apps on Windows 10. For Windows 8.x articles, see the [archive](http://go.microsoft.com/fwlink/p/?linkid=619132) \\]\n\n**Important APIs**\n\n-   [**MessageWebSocket**](https://msdn.microsoft.com/library/windows/apps/br226842)\n-   [**StreamWebSocket**](https://msdn.microsoft.com/library/windows/apps/br226923)\n\nWebSockets provide a mechanism for fast, secure two-way communication between a client and a server over the web using HTTP(S).\n\nUnder the [WebSocket Protocol](http://tools.ietf.org/html/rfc6455), data is transferred immediately over a full-duplex single socket connection, allowing messages to be sent and received from both endpoints in real time. WebSockets are ideal for use in real-time gaming where instant social network notifications and up-to-date displays of information (game statistics ) need to be secure and use fast data transfer. Universal Windows Platform (UWP) developers can use the [**MessageWebSocket**](https://msdn.microsoft.com/library/windows/apps/br226842) and [**StreamWebSocket**](https://msdn.microsoft.com/library/windows/apps/br226923) classes to connect with servers that support the Websocket protocol.\n\n| MessageWebSocket                                                         | StreamWebSocket                                                                               |\n|--------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------|\n| Suitable for typical scenarios where messages are not extremely large.   | Suitable for scenarios in which large files (such as photos or videos) are being transferred. |\n| Enables notification that an entire WebSocket message has been received. | Allows sections of a message to be read with each read operation.                             |\n| Supports both UTF-8 and binary messages.                                 | Supports only binary messages.                                                                |\n| Similar to a UDP or datagram socket.                                     | Similar to a TCP or stream socket.                                                            |\n\nIn most cases you'll want to use a secure WebSocket connection to encrypt data sent and received. This will also increase the chances that your connection will succeed, as many proxies will reject unencrypted WebSocket connections. The WebSocket protocol defines the following two URI schemes.\n\n-   ws: - use for unencrypted connections.\n-   wss: - use for secure connections that should be encrypted.\n\nTo encrypt a WebSocket connection, use the wss: URI scheme, for example, `wss://www.contoso.com/mywebservice`.\n\n## Using MessageWebSocket\n\nThe [**MessageWebSocket**](https://msdn.microsoft.com/library/windows/apps/br226842) allows sections of a message to be read with each read operation. A **MessageWebSocket** is typically used in scenarios where messages are not extremely large. Both UTF-8 and binary files are supported.\n\nThe code in this section creates a new [**MessageWebSocket**](https://msdn.microsoft.com/library/windows/apps/br226842), connects to a WebSocket server, and sends data to the server. Once a successful connection is established, the app waits for the [**MessageWebSocket.MessageReceived**](https://msdn.microsoft.com/library/windows/apps/br241358) event to be triggered, indicating that data was received.\n\nThis sample uses the WebSocket.org echo server, a service which simply echoes back to the sender any string sent to it. By using the \"wss:\" protocol specifier, this sample uses a secure connection to send and receive messages.\n\n> [!div class=\"tabbedCodeSnippets\"]\n```cpp\nvoid Game::InitWebSockets()\n{\n    // Create a new web socket\n    m_messageWebSocket = ref new MessageWebSocket();\n\n    // Set the message type to UTF-8\n    m_messageWebSocket->Control->MessageType = Windows::Networking::Sockets::SocketMessageType::Utf8;\n\n    // Register callbacks for notifications of interest\n    m_messageWebSocket->MessageReceived += ref new TypedEventHandler<MessageWebSocket^, MessageWebSocketMessageReceivedEventArgs^>(this, &amp;Game:/:WebSocketMessageReceived);\n    m_messageWebSocket->Closed += ref new TypedEventHandler<IWebSocket^, WebSocketClosedEventArgs^>(this, &amp;Game::WebSocketClosed);\n\n    // This test code uses the websocket.org echo service to illustrate sending a string and receiving the echoed string back\n    // Note that wss: makes this an encrypted connection.\n    m_serverUri = ref new Uri(\"wss://echo.websocket.org\");\n\n    // Establish the connection, and set m_socketConnected on success\n    create_task(m_messageWebSocket->ConnectAsync(m_serverUri)).then([this] (task<void> previousTask)\n    {\n        try\n        {\n            // Try getting all exceptions from the continuation chain above this point.\n            previousTask.get();\n\n            // websocket connected. update state variable\n            m_socketConnected = true;\n            OutputDebugString(L\"Successfully initialized websockets\\n\");\n        }\n        catch (Platform::COMException^ exception)\n        {\n            // Add code here to handle any exceptions\n            // HandleException(exception);\n\n        }\n    });\n}\n```\n```csharp\nMessageWebSocket webSock = new MessageWebSocket();\n\n//In this case we will be sending/receiving a string so we need to set the MessageType to Utf8.\nwebSock.Control.MessageType = SocketMessageType.Utf8;\n\n//Add the MessageReceived event handler.\nwebSock.MessageReceived += WebSock_MessageReceived;\n\n//Add the Closed event handler.\nwebSock.Closed += WebSock_Closed;\n\nUri serverUri = new Uri(\"wss://echo.websocket.org\");\n\ntry\n{\n    //Connect to the server.\n    await webSock.ConnectAsync(serverUri);\n\n    //Send a message to the server.\n    await WebSock_SendMessage(webSock, \"Hello, world!\");\n}\ncatch (Exception ex)\n{\n    //Add code here to handle any exceptions\n}\n```\n\nOnce you have initialized the WebSocket connection, your code must perform the following activities to properly send and receive data.\n\n### Implement a callback for the MessageWebSocket.MessageReceived event\n\nBefore establishing a connection and sending data with a WebSocket, your app needs to register an event callback to receive notification when data is received. When the [**MessageWebSocket.MessageReceived**](https://msdn.microsoft.com/library/windows/apps/br241358) event occurs, the registered callback is called and receives data from [**MessageWebSocketMessageReceivedEventArgs**](https://msdn.microsoft.com/library/windows/apps/br226852). This example is written with the assumption that the messages being sent are in UTF-8 format.\n\nThe following sample function receives a string from a connected WebSocket server and prints the string to the debugger output window.\n\n> [!div class=\"tabbedCodeSnippets\"]\n```cpp\nvoid Game::WebSocketMessageReceived(MessageWebSocket^ sender, MessageWebSocketMessageReceivedEventArgs^ args)\n{\n    DataReader^ messageReader = args->GetDataReader();\n    messageReader->UnicodeEncoding = Windows::Storage::Streams::UnicodeEncoding::Utf8;\n\n    String^ readString = messageReader->ReadString(messageReader->UnconsumedBufferLength);\n    // Data has been read and is now available from the readString variable.\n    swprintf(m_debugBuffer, 511, L\"WebSocket Message received: %s\\n\", readString->Data());\n    OutputDebugString(m_debugBuffer);\n}\n```\n```csharp\n//The MessageReceived event handler.\nprivate void WebSock_MessageReceived(MessageWebSocket sender, MessageWebSocketMessageReceivedEventArgs args)\n{\n    DataReader messageReader = args.GetDataReader();\n    messageReader.UnicodeEncoding = UnicodeEncoding.Utf8;\n    string messageString = messageReader.ReadString(messageReader.UnconsumedBufferLength);\n\n    //Add code here to do something with the string that is received.\n}\n```\n\n###  Implement a callback for the MessageWebSocket.Closed event\n\nBefore establishing a connection and sending data with a WebSocket, your app needs to register an event callback to receive notification when the WebSocket is closed by the WebSocket server. When the [**MessageWebSocket.Closed**](https://msdn.microsoft.com/library/windows/apps/hh701364) event occurs, the registered callback is called to indicate the connection was closed by the WebSocket server.\n\n> [!div class=\"tabbedCodeSnippets\"]\n```cpp\nvoid Game::WebSocketClosed(IWebSocket^ sender, WebSocketClosedEventArgs^ args)\n{\n    // The method may be triggered remotely by the server sending unsolicited close frame or locally by Close()/delete operator.\n    // This method assumes we saved the connected WebSocket to a variable called m_messageWebSocket\n    if (m_messageWebSocket != nullptr)\n    {\n        delete m_messageWebSocket;\n        m_messageWebSocket = nullptr;\n        OutputDebugString(L\"Socket was closed\\n\");\n    }\n    m_socketConnected = false;\n}\n```\n```csharp\n//The Closed event handler\nprivate void WebSock_Closed(IWebSocket sender, WebSocketClosedEventArgs args)\n{\n    //Add code here to do something when the connection is closed locally or by the server\n}\n```\n\n###  Send a message on a WebSocket\n\nOnce a connection is established, the WebSocket client can send data to the server. The [**DataWriter.StoreAsync**](https://msdn.microsoft.com/library/windows/apps/br208171) method returns a parameter that maps to an unsigned int. This changes how we define the task to send the message compared with the task to make the connection.\n\n**Note**   When you create a new DataWriter object using the MessageWebSocket's OutputStream, the DataWriter takes ownership of the OutputStream, and will deallocate the Outputstream when the DataWriter goes out of scope. This causes any subsequent attempts to use the OutputStream to fail with an HRESULT value of 0x80000013. To avoid deallocating the OutputStream, this code calls the DataWriter's DetachStream method, which returns ownership of the stream to the WebSocket object.\n\nThe following function sends the given string to a connected WebSocket, and prints a verification message in the debugger output window.\n\n> [!div class=\"tabbedCodeSnippets\"]\n```cpp\nvoid Game::SendWebSocketMessage(Windows::Networking::Sockets::MessageWebSocket^ sendingSocket, Platform::String^ message)\n{\n    if (m_socketConnected)\n    {\n        // WebSocket is connected, so send a message\n        m_messageWriter = ref new DataWriter(sendingSocket->OutputStream);\n\n        m_messageWriter->WriteString(message);\n\n        // Send the data as one complete message\n        create_task(m_messageWriter->StoreAsync()).then([this] (unsigned int)\n        {\n            // Send Completed\n            m_messageWriter->DetachStream();    // give the stream back to m_messageWebSocket\n            OutputDebugString(L\"Sent websocket message\\n\");\n        })\n            .then([this] (task<void>> previousTask)\n        {\n            try\n            {\n                // Try getting all exceptions from the continuation chain above this point.\n                previousTask.get();\n            }\n            catch (Platform::COMException ^ex)\n            {\n                // Add code to handle the exception\n                // HandleException(exception);\n            }\n        });\n    }\n}\n```\n```csharp\n//Send a message to the server.\nprivate async Task WebSock_SendMessage(MessageWebSocket webSock, string message)\n{\n    DataWriter messageWriter = new DataWriter(webSock.OutputStream);\n    messageWriter.WriteString(message);\n    await messageWriter.StoreAsync();\n}\n```\n\n## Using advanced controls with WebSockets\n\n[**MessageWebSocket**](https://msdn.microsoft.com/library/windows/apps/br226842) and [**StreamWebSocket**](https://msdn.microsoft.com/library/windows/apps/br226923) follow the same model for using advanced controls. Corresponding with each of the above primary classes are related classes to access advanced controls.\n\n[**MessageWebSocketControl**](https://msdn.microsoft.com/library/windows/apps/br226843) provides socket control data on a [**MessageWebSocket**](https://msdn.microsoft.com/library/windows/apps/br226842) object.\n[**StreamWebSocketControl**](https://msdn.microsoft.com/library/windows/apps/br226924) provides socket control data on a [**StreamWebSocket**](https://msdn.microsoft.com/library/windows/apps/br226923) object.\nThe basic model to use advanced controls is the same for both types of WebSockets. The following discussion uses a [**StreamWebSocket**](https://msdn.microsoft.com/library/windows/apps/br226923) as an example, but the same process can be used with a [**MessageWebSocket**](https://msdn.microsoft.com/library/windows/apps/br226842).\n\n1.  Create the [**StreamWebSocket**](https://msdn.microsoft.com/library/windows/apps/br226923) object.\n2.  Use the [**StreamWebSocket.Control**](https://msdn.microsoft.com/library/windows/apps/br226934) property to retrieve the [**StreamWebSocketControl**](https://msdn.microsoft.com/library/windows/apps/br226924) instance associated with this [**StreamWebSocket**](https://msdn.microsoft.com/library/windows/apps/br226923) object.\n3.  Get or set properties on the [**StreamWebSocketControl**](https://msdn.microsoft.com/library/windows/apps/br226924) instance to get or set specific advanced controls.\n\nBoth [**StreamWebSocket**](https://msdn.microsoft.com/library/windows/apps/br226923) and [**MessageWebSocket**](https://msdn.microsoft.com/library/windows/apps/br226842) impose requirements on when advanced controls can be set.\n\n-   For all advanced controls on the [**StreamWebSocket**](https://msdn.microsoft.com/library/windows/apps/br226923), the app must always set the property before issuing a Connect operation. Because of this requirement, it is best practice to set all control properties immediately after creating the **StreamWebSocket** object. Do not try to set a control property after the [**StreamWebSocket.ConnectAsync**](https://msdn.microsoft.com/library/windows/apps/br226933) method has been called.\n-   For all of the advanced controls on the [**MessageWebSocket**](https://msdn.microsoft.com/library/windows/apps/br226842) except the message type, you must set the property before issuing a Connect operation. It is best practice to set all control properties immediately after creating the **MessageWebSocket** object. Except for the message type, do not attempt to change a control property after [**MessageWebSocket.ConnectAsync**](https://msdn.microsoft.com/library/windows/apps/br226859) has been called.\n\n## WebSocket information classes\n\n[**MessageWebSocket**](https://msdn.microsoft.com/library/windows/apps/br226842) and [**StreamWebSocket**](https://msdn.microsoft.com/library/windows/apps/br226923) each have a corresponding class that provides additional information about a WebSocket instance.\n\n[**MessageWebSocketInformation**](https://msdn.microsoft.com/library/windows/apps/br226849) provides information about a [**MessageWebSocket**](https://msdn.microsoft.com/library/windows/apps/br226842), and you retrieve an instance of the information class using the [**MessageWebSocket.Information**](https://msdn.microsoft.com/library/windows/apps/br226861) property.\n\n[**StreamWebSocketInformation**](https://msdn.microsoft.com/library/windows/apps/br226929) provides information about a [**StreamWebSocket**](https://msdn.microsoft.com/library/windows/apps/br226923), and you retrieve an instance of the information class using the [**StreamWebSocket.Information**](https://msdn.microsoft.com/library/windows/apps/br226935) property.\n\nNote that all of the properties on both Information classes are read-only, and that you can retrieve current information at any time during the lifetime of a web socket object.\n\n## Handling network exceptions\n\nAn error encountered on a [**MessageWebSocket**](https://msdn.microsoft.com/library/windows/apps/br226842) or [**StreamWebSocket**](https://msdn.microsoft.com/library/windows/apps/br226923) operation is returned as an **HRESULT** value. The [**WebSocketError.GetStatus**](https://msdn.microsoft.com/library/windows/apps/hh701529) method is used to convert a network error from a WebSocket operation to a [**WebErrorStatus**](https://msdn.microsoft.com/library/windows/apps/hh747818) enumeration value. Most of the **WebErrorStatus** enumeration values correspond to an error returned by the native HTTP client operation. Your app can filter on specific **WebErrorStatus** enumeration values to modify app behavior depending on the cause of the exception.\n\nFor parameter validation errors, an app can also use the **HRESULT** from the exception to learn more detailed information on the error that caused the exception. Possible **HRESULT** values are listed in the *Winerror.h* header file. For most parameter validation errors, the **HRESULT** returned is **E\\_INVALIDARG**.\n\n## Setting timeouts on WebSocket operations\n\nThe MessageWebSocket and StreamWebSocket classes uses an internal system service to send WebSocket client requests and receive responses from a server. The default timeout value used for a WebSocket connect operation is 60 seconds. If the HTTP server that supports WebSockets is temporarily down or blocked by a network outage and the server doesn't or can't respond to the WebSocket connection request, the internal system service waits the default 60 seconds before it returns an error which causes an exception to be thrown on the WebSocket ConnectAsync method. If the name query for an HTTP server name in the URI returns multiple IP addresses for the name, the internal system service tries up to 5 IP addresses for the site each with a default timeout of 60 seconds before it fails. An app making a WebSocket connection request could wait several minutes trying to connect to multiple IP addresses before an error is returned and an exception is thrown. This behavior could appear to the user as if the app stopped working. The default timeout used for send and receive operations after a WebSocket connection has been established is 30 seconds.\n\nTo make your app more responsive and minimize these issues, it can set a shorter timeout on connection requests so that the operation fails due to timeout sooner than from the default settings.\n\nYou set timeouts similarly for both StreamWebSockets and MessageWebSockets. The following example shows how to set a timeout on StreamWebSocket, but the process is similar for a MessageWebSocket.\n\n1.  Create a task that completes after a specified delay using a timer.\n2.  Create a task for the WebSocket operation with a cancellation\\_token\\_source to support cancellation.\n3.  If the task with the specified timeout delay completes before the WebSocket connect operation, cancel the task for the WebSocket operation.\n\nThe following example creates one task that completes after a specified delay, and creates a second task that cancels after a specified delay. These classes can be used with StreamWebSocket and MessageWebSocket when trying to establish a connection to set a specific timeout. An example usage would be calling the StreamWebSocket.ConnectAsync method in a task with a cancellation\\_token\\_source that supports cancellation. If timeout completes first, then the cancellation\\_token\\_source is used to cancel the task for the WebSocket connect operation.\n\n```cpp\n    #include <agents.h>\n    #include <ppl.h>\n    #include <ppltasks.h>\n\n    using namespace concurrency;\n    using namespace std;\n\n    // Creates a task that completes after the specified delay.\n    task<void> complete_after(unsigned int timeout)\n    {\n        // A task completion event that is set when a timer fires.\n        task_completion_event<void> tce;\n\n        // Create a non-repeating timer.\n        shared_ptr<timer<int>> fire_once(new timer<int>(timeout, 0, nullptr, false));\n        \n        // Create a call object that sets the completion event after the timer fires.\n        shared_ptr<call<int>> callback(new call<int>([tce](int)\n        {\n            tce.set();\n        }));\n\n        // Connect the timer to the callback and start the timer.\n        fire_once->link_target(callback.get());\n        fire_once->start();\n\n        // Create a task that completes after the completion event is set.\n        task<void> event_set(tce);\n\n        // Create a continuation task that cleans up resources and\n        // and return that continuation task.\n        return event_set.then([callback, fire_once]()\n        {\n        });\n        \n    }\n\n    // Cancels the provided task after the specifed delay, if the task\n    // did not complete.\n    template<typename T>\n    task<T> cancel_after_timeout(task<T> t, cancellation_token_source cts, unsigned int timeout)\n    {\n        // Create a task that returns true after the specified task completes.\n        task<bool> success_task = t.then([](T)\n        {\n            return true;\n        });\n        // Create a task that returns false after the specified timeout.\n        task<bool> failure_task = complete_after(timeout).then([]\n        {\n            return false;\n        });\n\n        // Create a continuation task that cancels the overall task  \n        // if the timeout task finishes first. \n        return (failure_task || success_task).then([t, cts](bool success)\n        {\n            if (!success)\n            {\n                // Set the cancellation token. The task that is passed as the \n                // t parameter should respond to the cancellation and stop \n                // as soon as it can.\n                cts.cancel();\n            }\n \n            // Return the original task.\n            return t;\n        });\n    }\n```\n\n"}