{"nodes":[{"pos":[11,36],"content":"Use a maintenance trigger","needQuote":true,"needEscape":true,"nodes":[{"content":"Use a maintenance trigger","pos":[0,25]}]},{"pos":[50,169],"content":"Learn how to use the MaintenanceTrigger class to run lightweight code in the background while the device is plugged in.","needQuote":true,"needEscape":true,"nodes":[{"content":"Learn how to use the MaintenanceTrigger class to run lightweight code in the background while the device is plugged in.","pos":[0,119]}]},{"content":"Use a maintenance trigger","pos":[226,251]},{"content":"\\[ Updated for UWP apps on Windows 10.","pos":[254,292]},{"content":"For Windows 8.x articles, see the <bpt id=\"p1\">[</bpt>archive<ept id=\"p1\">](http://go.microsoft.com/fwlink/p/?linkid=619132)</ept> \\]","pos":[293,388],"source":" For Windows 8.x articles, see the [archive](http://go.microsoft.com/fwlink/p/?linkid=619132) \\]"},{"content":"Important APIs","pos":[393,407]},{"content":"MaintenanceTrigger","pos":[418,436]},{"content":"BackgroundTaskBuilder","pos":[505,526]},{"content":"SystemCondition","pos":[595,610]},{"pos":[673,856],"content":"Learn how to use the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>MaintenanceTrigger<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/hh700517)</ept> class to run lightweight code in the background while the device is plugged in.","source":"Learn how to use the [**MaintenanceTrigger**](https://msdn.microsoft.com/library/windows/apps/hh700517) class to run lightweight code in the background while the device is plugged in."},{"content":"Create a maintenance trigger object","pos":[861,896]},{"content":"This example assumes that you have lightweight code you can run in the background to enhance your app while the device is plugged in.","pos":[899,1032]},{"content":"This topic focuses on the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>MaintenanceTrigger<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/hh700517)</ept> class, which is similar to <bpt id=\"p3\">[</bpt><bpt id=\"p4\">**</bpt>SystemTrigger<ept id=\"p4\">**</ept><ept id=\"p3\">](https://msdn.microsoft.com/library/windows/apps/br224839)</ept>.","pos":[1033,1247],"source":" This topic focuses on the [**MaintenanceTrigger**](https://msdn.microsoft.com/library/windows/apps/hh700517) class, which is similar to [**SystemTrigger**](https://msdn.microsoft.com/library/windows/apps/br224839)."},{"content":"More information on writing a background task class is available in <bpt id=\"p1\">[</bpt>Create and register a background task<ept id=\"p1\">](create-and-register-a-background-task.md)</ept>.","pos":[1248,1398],"source":" More information on writing a background task class is available in [Create and register a background task](create-and-register-a-background-task.md)."},{"content":"Create a new <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>MaintenanceTrigger<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br224843)</ept> object.","pos":[1400,1503],"source":"Create a new [**MaintenanceTrigger**](https://msdn.microsoft.com/library/windows/apps/br224843) object."},{"content":"The second parameter, <bpt id=\"p1\">*</bpt>OneShot<ept id=\"p1\">*</ept>, specifies whether the maintenance task will run once or continue to run periodically.","pos":[1504,1622],"source":" The second parameter, *OneShot*, specifies whether the maintenance task will run once or continue to run periodically."},{"content":"If <bpt id=\"p1\">*</bpt>OneShot<ept id=\"p1\">*</ept> is set to true, the first parameter (<bpt id=\"p2\">*</bpt>FreshnessTime<ept id=\"p2\">*</ept>) specifies the number of minutes to wait before scheduling the background task.","pos":[1623,1768],"source":" If *OneShot* is set to true, the first parameter (*FreshnessTime*) specifies the number of minutes to wait before scheduling the background task."},{"content":"If <bpt id=\"p1\">*</bpt>OneShot<ept id=\"p1\">*</ept> is set to false, <bpt id=\"p2\">*</bpt>FreshnessTime<ept id=\"p2\">*</ept> specifies the frequency by which the background task will run.","pos":[1769,1877],"source":" If *OneShot* is set to false, *FreshnessTime* specifies the frequency by which the background task will run."},{"pos":[1881,2013],"content":"<bpt id=\"p1\">**</bpt>Note<ept id=\"p1\">**</ept>  If <bpt id=\"p2\">*</bpt>FreshnessTime<ept id=\"p2\">*</ept> is set to less than 15 minutes, an exception is thrown when attempting to register the background task.","source":"**Note**  If *FreshnessTime* is set to less than 15 minutes, an exception is thrown when attempting to register the background task."},{"content":"This example code creates a trigger that runs once an hour:","pos":[2018,2077]},{"content":"(Optional) Add a condition","pos":[2408,2434]},{"content":"If necessary, create a background task condition to control when the task runs.","pos":[2440,2519]},{"content":"A condition prevents your background task from running until the condition is met - for more information, see <bpt id=\"p1\">[</bpt>Set conditions for running a background task<ept id=\"p1\">](set-conditions-for-running-a-background-task.md)</ept>","pos":[2520,2725],"source":" A condition prevents your background task from running until the condition is met - for more information, see [Set conditions for running a background task](set-conditions-for-running-a-background-task.md)"},{"content":"In this example, the condition is set to <bpt id=\"p1\">**</bpt>InternetAvailable<ept id=\"p1\">**</ept> so that maintenance runs when the Internet is available (or when it becomes available).","pos":[2731,2881],"source":"In this example, the condition is set to **InternetAvailable** so that maintenance runs when the Internet is available (or when it becomes available)."},{"content":"For a list of possible background task conditions, see <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>SystemConditionType<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br224835)</ept>.","pos":[2882,3021],"source":" For a list of possible background task conditions, see [**SystemConditionType**](https://msdn.microsoft.com/library/windows/apps/br224835)."},{"content":"The following code adds a condition to the maintenance task builder:","pos":[3027,3095]},{"content":"Register the background task","pos":[3395,3423]},{"content":"Register the background task by calling your background task registration function.","pos":[3430,3513]},{"content":"For more information on registering background tasks, see <bpt id=\"p1\">[</bpt>Register a background task<ept id=\"p1\">](register-a-background-task.md)</ept>.","pos":[3514,3632],"source":" For more information on registering background tasks, see [Register a background task](register-a-background-task.md)."},{"content":"The following code registers the maintenance task:","pos":[3638,3688]},{"content":"<bpt id=\"p1\">**</bpt>Note<ept id=\"p1\">**</ept>  For all device families except desktop, if the device becomes low on memory, background tasks may be terminated.","pos":[4294,4416],"source":"**Note**  For all device families except desktop, if the device becomes low on memory, background tasks may be terminated."},{"content":"If an out of memory exception is not surfaced, or the app does not handle it, then the background task will be terminated without warning and without raising the OnCanceled event.","pos":[4417,4596]},{"content":"This helps to ensure the user experience of the app in the foreground.","pos":[4597,4667]},{"content":"Your background task should be designed to handle this scenario.","pos":[4668,4732]},{"pos":[4740,4921],"content":"<bpt id=\"p1\">**</bpt>Note<ept id=\"p1\">**</ept>  Universal Windows apps must call <bpt id=\"p2\">[</bpt><bpt id=\"p3\">**</bpt>RequestAccessAsync<ept id=\"p3\">**</ept><ept id=\"p2\">](https://msdn.microsoft.com/library/windows/apps/hh700485)</ept> before registering any of the background trigger types.","source":"**Note**  Universal Windows apps must call [**RequestAccessAsync**](https://msdn.microsoft.com/library/windows/apps/hh700485) before registering any of the background trigger types."},{"content":"To ensure that your Universal Windows app continues to run properly after you release an update, you must call <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>RemoveAccess<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/hh700471)</ept> and then call <bpt id=\"p3\">[</bpt><bpt id=\"p4\">**</bpt>RequestAccessAsync<ept id=\"p4\">**</ept><ept id=\"p3\">](https://msdn.microsoft.com/library/windows/apps/hh700485)</ept> when your app launches after being updated.","pos":[4927,5255],"source":"To ensure that your Universal Windows app continues to run properly after you release an update, you must call [**RemoveAccess**](https://msdn.microsoft.com/library/windows/apps/hh700471) and then call [**RequestAccessAsync**](https://msdn.microsoft.com/library/windows/apps/hh700485) when your app launches after being updated."},{"content":"For more information, see <bpt id=\"p1\">[</bpt>Guidelines for background tasks<ept id=\"p1\">](guidelines-for-background-tasks.md)</ept>.","pos":[5256,5352],"source":" For more information, see [Guidelines for background tasks](guidelines-for-background-tasks.md)."},{"content":"<bpt id=\"p1\">**</bpt>Note<ept id=\"p1\">**</ept>  Background task registration parameters are validated at the time of registration.","pos":[5360,5452],"source":"**Note**  Background task registration parameters are validated at the time of registration."},{"content":"An error is returned if any of the registration parameters are invalid.","pos":[5453,5524]},{"content":"Ensure that your app gracefully handles scenarios where background task registration fails - if instead your app depends on having a valid registration object after attempting to register a task, it may crash.","pos":[5525,5734]},{"content":"<bpt id=\"p1\">**</bpt>Note<ept id=\"p1\">**</ept>  This article is for Windows 10 developers writing Universal Windows Platform (UWP) apps.","pos":[5739,5837],"source":"**Note**  This article is for Windows 10 developers writing Universal Windows Platform (UWP) apps."},{"content":"If you’re developing for Windows 8.x or Windows Phone 8.x, see the <bpt id=\"p1\">[</bpt>archived documentation<ept id=\"p1\">](http://go.microsoft.com/fwlink/p/?linkid=619132)</ept>.","pos":[5838,5979],"source":" If you’re developing for Windows 8.x or Windows Phone 8.x, see the [archived documentation](http://go.microsoft.com/fwlink/p/?linkid=619132)."},{"content":"Related topics","pos":[5984,5998]},{"content":"Create and register a background task","pos":[6010,6047]},{"content":"Declare background tasks in the application manifest","pos":[6094,6146]},{"content":"Handle a cancelled background task","pos":[6208,6242]},{"content":"Monitor background task progress and completion","pos":[6286,6333]},{"content":"Register a background task","pos":[6390,6416]},{"content":"Respond to system events with background tasks","pos":[6452,6498]},{"content":"Set conditions for running a background task","pos":[6554,6598]},{"content":"Update a live tile from a background task","pos":[6652,6693]},{"content":"Run a background task on a timer","pos":[6744,6776]},{"content":"Guidelines for background tasks","pos":[6819,6850]},{"content":"Debug a background task","pos":[6898,6921]},{"content":"How to trigger suspend, resume, and background events in Windows Store apps (when debugging)","pos":[6954,7046]}],"content":"---\ntitle: Use a maintenance trigger\ndescription: Learn how to use the MaintenanceTrigger class to run lightweight code in the background while the device is plugged in.\nms.assetid: 727D9D84-6C1D-4DF3-B3B0-2204EA4D76DD\n---\n\n# Use a maintenance trigger\n\n\n\\[ Updated for UWP apps on Windows 10. For Windows 8.x articles, see the [archive](http://go.microsoft.com/fwlink/p/?linkid=619132) \\]\n\n\n**Important APIs**\n\n-   [**MaintenanceTrigger**](https://msdn.microsoft.com/library/windows/apps/hh700517)\n-   [**BackgroundTaskBuilder**](https://msdn.microsoft.com/library/windows/apps/br224768)\n-   [**SystemCondition**](https://msdn.microsoft.com/library/windows/apps/br224834)\n\nLearn how to use the [**MaintenanceTrigger**](https://msdn.microsoft.com/library/windows/apps/hh700517) class to run lightweight code in the background while the device is plugged in.\n\n## Create a maintenance trigger object\n\n\nThis example assumes that you have lightweight code you can run in the background to enhance your app while the device is plugged in. This topic focuses on the [**MaintenanceTrigger**](https://msdn.microsoft.com/library/windows/apps/hh700517) class, which is similar to [**SystemTrigger**](https://msdn.microsoft.com/library/windows/apps/br224839). More information on writing a background task class is available in [Create and register a background task](create-and-register-a-background-task.md).\n\nCreate a new [**MaintenanceTrigger**](https://msdn.microsoft.com/library/windows/apps/br224843) object. The second parameter, *OneShot*, specifies whether the maintenance task will run once or continue to run periodically. If *OneShot* is set to true, the first parameter (*FreshnessTime*) specifies the number of minutes to wait before scheduling the background task. If *OneShot* is set to false, *FreshnessTime* specifies the frequency by which the background task will run.\n\n> **Note**  If *FreshnessTime* is set to less than 15 minutes, an exception is thrown when attempting to register the background task.\n\n \n\nThis example code creates a trigger that runs once an hour:\n\n> [!div class=\"tabbedCodeSnippets\"]\n> ```cs\n> uint waitIntervalMinutes = 60;\n> \n> MaintenanceTrigger taskTrigger = new MaintenanceTrigger(waitIntervalMinutes, false);\n> ```\n> ```cpp\n> unsigned int waitIntervalMinutes = 60;\n> \n> MaintenanceTrigger ^ taskTrigger = ref new MaintenanceTrigger(waitIntervalMinutes, false);\n> ```\n\n## (Optional) Add a condition\n\n-   If necessary, create a background task condition to control when the task runs. A condition prevents your background task from running until the condition is met - for more information, see [Set conditions for running a background task](set-conditions-for-running-a-background-task.md)\n\n    In this example, the condition is set to **InternetAvailable** so that maintenance runs when the Internet is available (or when it becomes available). For a list of possible background task conditions, see [**SystemConditionType**](https://msdn.microsoft.com/library/windows/apps/br224835).\n\n    The following code adds a condition to the maintenance task builder:\n\n    > [!div class=\"tabbedCodeSnippets\"]\n    > ```cs\n    > SystemCondition exampleCondition = new SystemCondition(SystemConditionType.InternetAvailable);\n    > ```\n    > ```cpp\n    > SystemCondition ^ exampleCondition = ref new SystemCondition(SystemConditionType::InternetAvailable);\n    > ```\n\n## Register the background task\n\n\n-   Register the background task by calling your background task registration function. For more information on registering background tasks, see [Register a background task](register-a-background-task.md).\n\n    The following code registers the maintenance task:\n\n    > [!div class=\"tabbedCodeSnippets\"]\n    > ```cs\n    > string entryPoint = \"Tasks.ExampleBackgroundTaskClass\";\n    > string taskName   = \"Maintenance background task example\";\n    > \n    > BackgroundTaskRegistration task = RegisterBackgroundTask(entryPoint, taskName, taskTrigger, exampleCondition);\n    > ```\n    > ```cpp\n    > String ^ entryPoint = \"Tasks.ExampleBackgroundTaskClass\";\n    > String ^ taskName   = \"Maintenance background task example\";\n    > \n    > BackgroundTaskRegistration ^ task = RegisterBackgroundTask(entryPoint, taskName, taskTrigger, exampleCondition);\n    > ```\n    \n    > **Note**  For all device families except desktop, if the device becomes low on memory, background tasks may be terminated. If an out of memory exception is not surfaced, or the app does not handle it, then the background task will be terminated without warning and without raising the OnCanceled event. This helps to ensure the user experience of the app in the foreground. Your background task should be designed to handle this scenario.\n\n    > **Note**  Universal Windows apps must call [**RequestAccessAsync**](https://msdn.microsoft.com/library/windows/apps/hh700485) before registering any of the background trigger types.\n\n    To ensure that your Universal Windows app continues to run properly after you release an update, you must call [**RemoveAccess**](https://msdn.microsoft.com/library/windows/apps/hh700471) and then call [**RequestAccessAsync**](https://msdn.microsoft.com/library/windows/apps/hh700485) when your app launches after being updated. For more information, see [Guidelines for background tasks](guidelines-for-background-tasks.md).\n\n    > **Note**  Background task registration parameters are validated at the time of registration. An error is returned if any of the registration parameters are invalid. Ensure that your app gracefully handles scenarios where background task registration fails - if instead your app depends on having a valid registration object after attempting to register a task, it may crash.\n\n\n> **Note**  This article is for Windows 10 developers writing Universal Windows Platform (UWP) apps. If you’re developing for Windows 8.x or Windows Phone 8.x, see the [archived documentation](http://go.microsoft.com/fwlink/p/?linkid=619132).\n\n## Related topics\n\n\n****\n\n* [Create and register a background task](create-and-register-a-background-task.md)\n* [Declare background tasks in the application manifest](declare-background-tasks-in-the-application-manifest.md)\n* [Handle a cancelled background task](handle-a-cancelled-background-task.md)\n* [Monitor background task progress and completion](monitor-background-task-progress-and-completion.md)\n* [Register a background task](register-a-background-task.md)\n* [Respond to system events with background tasks](respond-to-system-events-with-background-tasks.md)\n* [Set conditions for running a background task](set-conditions-for-running-a-background-task.md)\n* [Update a live tile from a background task](update-a-live-tile-from-a-background-task.md)\n* [Run a background task on a timer](run-a-background-task-on-a-timer-.md)\n* [Guidelines for background tasks](guidelines-for-background-tasks.md)\n\n****\n\n* [Debug a background task](debug-a-background-task.md)\n* [How to trigger suspend, resume, and background events in Windows Store apps (when debugging)](http://go.microsoft.com/fwlink/p/?linkid=254345)\n\n \n\n \n\n\n\n"}