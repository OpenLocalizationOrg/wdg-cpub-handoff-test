{"nodes":[{"content":"Files and folders in the Music, Pictures, and Videos libraries","pos":[3,65]},{"content":"\\[ Updated for UWP apps on Windows 10.","pos":[68,106]},{"content":"For Windows 8.x articles, see the <bpt id=\"p1\">[</bpt>archive<ept id=\"p1\">](http://go.microsoft.com/fwlink/p/?linkid=619132)</ept> \\]","pos":[107,202],"source":" For Windows 8.x articles, see the [archive](http://go.microsoft.com/fwlink/p/?linkid=619132) \\]"},{"content":"Add existing folders of music, pictures, or videos to the corresponding libraries.","pos":[205,287]},{"content":"You can also remove folders from libraries, get the list of folders in a library, and discover stored photos, music, and videos.","pos":[288,416]},{"content":"A library is a virtual collection of folders, which includes a known folder by default plus any other folders the user has added to the library by using your app or one of the built-in apps.","pos":[418,608]},{"content":"For example, the Pictures library includes the Pictures known folder by default.","pos":[609,689]},{"content":"The user can add folders to, or remove them from, the Pictures library by using your app or the built-in Photos app.","pos":[690,806]},{"content":"Prerequisites","pos":[811,824]},{"content":"Understand async programming for Universal Windows Platform (UWP) apps","pos":[833,903]},{"content":"You can learn how to write asynchronous apps in C\\# or Visual Basic, see <bpt id=\"p1\">[</bpt>Call asynchronous APIs in C\\# or Visual Basic<ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/mt187337)</ept>.","pos":[911,1090],"source":"You can learn how to write asynchronous apps in C\\# or Visual Basic, see [Call asynchronous APIs in C\\# or Visual Basic](https://msdn.microsoft.com/library/windows/apps/mt187337)."},{"content":"To learn how to write asynchronous apps in C++, see <bpt id=\"p1\">[</bpt>Asynchronous programming in C++<ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/mt187334)</ept>.","pos":[1091,1235],"source":" To learn how to write asynchronous apps in C++, see [Asynchronous programming in C++](https://msdn.microsoft.com/library/windows/apps/mt187334)."},{"content":"Access permissions to the location","pos":[1243,1277]},{"content":"In Visual Studio, open the app manifest file in Manifest Designer.","pos":[1285,1351]},{"content":"On the <bpt id=\"p1\">**</bpt>Capabilities<ept id=\"p1\">**</ept> page, select the libraries that your app manages.","pos":[1352,1425],"source":" On the **Capabilities** page, select the libraries that your app manages."},{"content":"Music Library","pos":[1437,1450]},{"content":"Pictures Library","pos":[1463,1479]},{"content":"Videos Library","pos":[1492,1506]},{"pos":[1514,1587],"content":"To learn more, see <bpt id=\"p1\">[</bpt>File access permissions<ept id=\"p1\">](file-access-permissions.md)</ept>.","source":"To learn more, see [File access permissions](file-access-permissions.md)."},{"content":"Get a reference to a library","pos":[1592,1620]},{"pos":[1623,1680],"content":"<bpt id=\"p1\">**</bpt>Note<ept id=\"p1\">**</ept>  Remember to declare the appropriate capability.","source":"**Note**  Remember to declare the appropriate capability."},{"content":"To get a reference to the user's Music, Pictures, or Video library, call the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>StorageLibrary.GetLibraryAsync<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn251725)</ept> method.","pos":[1684,1863],"source":"To get a reference to the user's Music, Pictures, or Video library, call the [**StorageLibrary.GetLibraryAsync**](https://msdn.microsoft.com/library/windows/apps/dn251725) method."},{"content":"Provide the corresponding value from the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>KnownLibraryId<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn298399)</ept> enumeration.","pos":[1864,1996],"source":" Provide the corresponding value from the [**KnownLibraryId**](https://msdn.microsoft.com/library/windows/apps/dn298399) enumeration."},{"content":"KnownLibraryId.Music","pos":[2005,2025]},{"content":"KnownLibraryId.Pictures","pos":[2094,2117]},{"content":"KnownLibraryId.Videos","pos":[2186,2207]},{"content":"Get the list of folders in a library","pos":[2413,2449]},{"pos":[2452,2610],"content":"To get the list of folders in a library, get the value of the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>StorageLibrary.Folders<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn251724)</ept> property.","source":"To get the list of folders in a library, get the value of the [**StorageLibrary.Folders**](https://msdn.microsoft.com/library/windows/apps/dn251724) property."},{"content":"Get the folder in a library where new files are saved by default","pos":[2789,2853]},{"pos":[2856,3045],"content":"To get the folder in a library where new files are saved by default, get the value of the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>StorageLibrary.SaveFolder<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn251728)</ept> property.","source":"To get the folder in a library where new files are saved by default, get the value of the [**StorageLibrary.SaveFolder**](https://msdn.microsoft.com/library/windows/apps/dn251728) property."},{"content":"Add an existing folder to a library","pos":[3143,3178]},{"content":"To add a folder to a library, you call the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>StorageLibrary.RequestAddFolderAsync<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn251726)</ept>.","pos":[3181,3325],"source":"To add a folder to a library, you call the [**StorageLibrary.RequestAddFolderAsync**](https://msdn.microsoft.com/library/windows/apps/dn251726)."},{"content":"Taking the Pictures Library as an example, calling this method causes a folder picker to be shown to the user with an <bpt id=\"p1\">**</bpt>Add this folder to Pictures<ept id=\"p1\">**</ept> button.","pos":[3326,3483],"source":" Taking the Pictures Library as an example, calling this method causes a folder picker to be shown to the user with an **Add this folder to Pictures** button."},{"content":"If the user picks a folder then the folder remains in its original location on disk and it becomes an item in the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>StorageLibrary.Folders<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn251724)</ept> property (and in the built-in Photos app), but the folder does not appear as a child of the Pictures folder in File Explorer.","pos":[3484,3810],"source":" If the user picks a folder then the folder remains in its original location on disk and it becomes an item in the [**StorageLibrary.Folders**](https://msdn.microsoft.com/library/windows/apps/dn251724) property (and in the built-in Photos app), but the folder does not appear as a child of the Pictures folder in File Explorer."},{"content":"Remove a folder from a library","pos":[3919,3949]},{"content":"To remove a folder from a library, call the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>StorageLibrary.RequestRemoveFolderAsync<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn251727)</ept> method and specify the folder to be removed.","pos":[3952,4144],"source":"To remove a folder from a library, call the [**StorageLibrary.RequestRemoveFolderAsync**](https://msdn.microsoft.com/library/windows/apps/dn251727) method and specify the folder to be removed."},{"content":"You could use <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>StorageLibrary.Folders<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn251724)</ept> and a <bpt id=\"p3\">[</bpt><bpt id=\"p4\">**</bpt>ListView<ept id=\"p4\">**</ept><ept id=\"p3\">](https://msdn.microsoft.com/library/windows/apps/br242878)</ept> control (or similar) for the user to select a folder to remove.","pos":[4145,4388],"source":" You could use [**StorageLibrary.Folders**](https://msdn.microsoft.com/library/windows/apps/dn251724) and a [**ListView**](https://msdn.microsoft.com/library/windows/apps/br242878) control (or similar) for the user to select a folder to remove."},{"content":"When you call <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>StorageLibrary.RequestRemoveFolderAsync<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn251727)</ept>, the user sees a confirmation dialog saying that the folder \"won't appear in Pictures anymore, but won't be deleted.\"","pos":[4390,4625],"source":"When you call [**StorageLibrary.RequestRemoveFolderAsync**](https://msdn.microsoft.com/library/windows/apps/dn251727), the user sees a confirmation dialog saying that the folder \"won't appear in Pictures anymore, but won't be deleted.\""},{"content":"What this means is that the folder remains in its original location on disk, is removed from the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>StorageLibrary.Folders<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn251724)</ept> property, and will no longer included in the built-in Photos app.","pos":[4626,4875],"source":" What this means is that the folder remains in its original location on disk, is removed from the [**StorageLibrary.Folders**](https://msdn.microsoft.com/library/windows/apps/dn251724) property, and will no longer included in the built-in Photos app."},{"pos":[4877,5070],"content":"The following example assumes that the user has selected the folder to remove from a <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>ListView<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br242878)</ept> control named <bpt id=\"p3\">**</bpt>lvPictureFolders<ept id=\"p3\">**</ept>.","source":"The following example assumes that the user has selected the folder to remove from a [**ListView**](https://msdn.microsoft.com/library/windows/apps/br242878) control named **lvPictureFolders**."},{"content":"Get notified of changes to the list of folders in a library","pos":[5160,5219]},{"pos":[5222,5434],"content":"To get notified about changes to the list of folders in a library, register a handler for the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>StorageLibrary.DefinitionChanged<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn251723)</ept> event of the library.","source":"To get notified about changes to the list of folders in a library, register a handler for the [**StorageLibrary.DefinitionChanged**](https://msdn.microsoft.com/library/windows/apps/dn251723) event of the library."},{"content":"Media library folders","pos":[5629,5650]},{"content":"A device provides five predefined locations for users and apps to store media files.","pos":[5653,5737]},{"content":"Built-in apps store both user-created media and downloaded media in these locations.","pos":[5738,5822]},{"content":"The locations are:","pos":[5824,5842]},{"content":"<bpt id=\"p1\">**</bpt>Pictures<ept id=\"p1\">**</ept> folder.","pos":[5848,5868],"source":"**Pictures** folder."},{"content":"Contains pictures.","pos":[5869,5887]},{"content":"<bpt id=\"p1\">**</bpt>Camera Roll<ept id=\"p1\">**</ept> folder.","pos":[5897,5920],"source":"**Camera Roll** folder."},{"content":"Contains photos and video from the built-in camera.","pos":[5921,5972]},{"content":"<bpt id=\"p1\">**</bpt>Saved Pictures<ept id=\"p1\">**</ept> folder.","pos":[5982,6008],"source":"**Saved Pictures** folder."},{"content":"Contains pictures that the user has saved from other apps.","pos":[6009,6067]},{"content":"<bpt id=\"p1\">**</bpt>Music<ept id=\"p1\">**</ept> folder.","pos":[6073,6090],"source":"**Music** folder."},{"content":"Contains songs, podcasts, and audio books.","pos":[6091,6133]},{"content":"<bpt id=\"p1\">**</bpt>Video<ept id=\"p1\">**</ept> folder.","pos":[6139,6156],"source":"**Video** folder."},{"content":"Contains videos.","pos":[6157,6173]},{"content":"Users or apps may also store media files outside the media library folders on the SD card.","pos":[6175,6265]},{"content":"To find a media file reliably on the SD card, scan the contents of the SD card, or ask the user to locate the file by using a file picker.","pos":[6266,6404]},{"content":"For more info, see <bpt id=\"p1\">[</bpt>Access the SD card<ept id=\"p1\">](access-the-sd-card.md)</ept>.","pos":[6405,6468],"source":" For more info, see [Access the SD card](access-the-sd-card.md)."},{"content":"Querying the media libraries","pos":[6473,6501]},{"content":"Query results include both internal and removable storage","pos":[6508,6565]},{"content":"Users can choose to store files by default on the optional SD card.","pos":[6567,6634]},{"content":"Apps, however, can opt out of allowing files to be stored on the SD card.","pos":[6635,6708]},{"content":"As a result, the media libraries can be split across the device's internal storage and the SD card.","pos":[6709,6808]},{"content":"You don't have to write additional code to handle this possibility.","pos":[6810,6877]},{"content":"The methods in the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>Windows.Storage<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br227346)</ept> namespace that query known folders transparently combine the query results from both locations.","pos":[6878,7072],"source":" The methods in the [**Windows.Storage**](https://msdn.microsoft.com/library/windows/apps/br227346) namespace that query known folders transparently combine the query results from both locations."},{"content":"You don't have to specify the <bpt id=\"p1\">**</bpt>removableStorage<ept id=\"p1\">**</ept> capability in the app manifest file to get these combined results, either.","pos":[7073,7198],"source":" You don't have to specify the **removableStorage** capability in the app manifest file to get these combined results, either."},{"content":"Consider the state of the device's storage shown in the following image:","pos":[7200,7272]},{"content":"images on the phone and sd card","pos":[7276,7307]},{"pos":[7344,7514],"content":"If you query the contents of the Pictures Library by calling <ph id=\"ph1\">`await KnownFolders.PicturesLibrary.GetFilesAsync()`</ph>, the results include both internalPic.jpg and SDPic.jpg.","source":"If you query the contents of the Pictures Library by calling `await KnownFolders.PicturesLibrary.GetFilesAsync()`, the results include both internalPic.jpg and SDPic.jpg."},{"content":"Deep queries","pos":[7520,7532]},{"content":"Use the deep queries to enumerate the entire contents of a media library quickly.","pos":[7534,7615]},{"content":"The deep queries return only files of the specified media type.","pos":[7617,7680]},{"content":"For example, if you query the Music Library with a deep query, the query results do not include any picture files found in the Music folder.","pos":[7681,7821]},{"content":"On devices where the camera saves both a low-resolution image and a high-resolution image of every picture, the deep queries return only the low-resolution image.","pos":[7823,7985]},{"content":"The Camera Roll and the Saved Pictures folder do not support the deep queries.","pos":[7987,8065]},{"content":"The following deep queries are available:","pos":[8067,8108]},{"content":"Pictures library","pos":[8112,8128]},{"content":"Music library","pos":[8184,8197]},{"content":"Video library","pos":[8476,8489]},{"content":"Flat queries","pos":[8547,8559]},{"content":"To get a complete listing of all the files and folders in a library, call <ph id=\"ph1\">`GetFilesAsync(CommonFileQuery.DefaultQuery)`</ph>.","pos":[8561,8681],"source":"To get a complete listing of all the files and folders in a library, call `GetFilesAsync(CommonFileQuery.DefaultQuery)`."},{"content":"This method returns all files in the library, regardless of their type.","pos":[8682,8753]},{"content":"This is a shallow query, so you have to enumerate the contents of subfolders recursively if the user has created subfolders in the library.","pos":[8754,8893]},{"content":"Use flat queries to return media files of types that are not recognized by the built-in queries, or to return all the files in a library, including files that are not of the specified type.","pos":[8895,9084]},{"content":"For example, if you query the Music Library with a flat query, the query results include any picture files found by the query in the Music folder.","pos":[9085,9231]},{"content":"Sample queries","pos":[9237,9251]},{"content":"Assume that the device and its optional SD card contain the folders and files shown in the following image:","pos":[9253,9360]},{"content":"files on","pos":[9364,9372]},{"content":"Here are a few examples of queries and the results that they return.","pos":[9408,9476]},{"content":"Query","pos":[9480,9485]},{"content":"Results","pos":[9488,9495]},{"content":"KnownFolders.PicturesLibrary.GetItemsAsync();","pos":[9681,9726]},{"content":"- Camera Roll folder from internal storage","pos":[9730,9772]},{"content":"- Camera Roll folder from the SD card","pos":[9777,9814]},{"content":"- Saved Pictures folder from internal storage","pos":[9819,9864]},{"content":"- Saved Pictures folder from the SD card","pos":[9869,9909]},{"content":"This is a flat query, so only immediate children of the Pictures folder   are returned.","pos":[9918,10005]},{"content":"KnownFolders.PicturesLibrary.GetFilesAsync();","pos":[10010,10055]},{"content":"No results.","pos":[10059,10070]},{"content":"This is flat query, and the Pictures folder does not contain any files as its immediate children.","pos":[10079,10176]},{"content":"KnownFolders.PicturesLibrary.GetFilesAsync(CommonFileQuery.OrderByDate);","pos":[10181,10253]},{"content":"- 4-3-2012.jpg file from the SD card","pos":[10256,10292]},{"content":"- 1-1-2014.jpg file from internal storage","pos":[10297,10338]},{"content":"- 1-2-2014.jpg file from internal storage","pos":[10343,10384]},{"content":"- 1-6-2014.jpg file from the SD card","pos":[10389,10425]},{"content":"This is a deep query, so the contents of the Pictures folder and of its   child folders are returned.","pos":[10434,10535]},{"content":"KnownFolders.CameraRoll.GetFilesAsync();","pos":[10540,10580]},{"content":"- 1-1-2014.jpg file from internal storage","pos":[10583,10624]},{"content":"- 4-3-2012.jpg file from the SD card","pos":[10629,10665]},{"content":"This is a flat query.","pos":[10674,10695]},{"content":"The ordering of the results is not guaranteed.","pos":[10696,10742]},{"content":"Media library capabilities and file types","pos":[10751,10792]},{"content":"Here are the capabilities that you can specify in the app manifest file to access media files in your app.","pos":[10795,10901]},{"content":"<bpt id=\"p1\">**</bpt>Music<ept id=\"p1\">**</ept>.","pos":[10907,10917],"source":"**Music**."},{"content":"Specify the <bpt id=\"p1\">**</bpt>Music Library<ept id=\"p1\">**</ept> capability in the app manifest file to let your app see and access files of the following file types:","pos":[10918,11049],"source":" Specify the **Music Library** capability in the app manifest file to let your app see and access files of the following file types:"},{"content":".qcp","pos":[11059,11063]},{"content":".wav","pos":[11072,11076]},{"content":".mp3","pos":[11085,11089]},{"content":".m4r","pos":[11098,11102]},{"content":".m4a","pos":[11111,11115]},{"content":".aac","pos":[11124,11128]},{"content":".amr","pos":[11137,11141]},{"content":".wma","pos":[11150,11154]},{"content":".3g2","pos":[11163,11167]},{"content":".3gp","pos":[11176,11180]},{"content":".mp4","pos":[11189,11193]},{"content":".wm","pos":[11202,11205]},{"content":".asf","pos":[11214,11218]},{"content":".3gpp","pos":[11227,11232]},{"content":".3gp2","pos":[11241,11246]},{"content":".mpa","pos":[11255,11259]},{"content":".adt","pos":[11268,11272]},{"content":".adts","pos":[11281,11286]},{"content":".pya","pos":[11295,11299]},{"content":"<bpt id=\"p1\">**</bpt>Photos<ept id=\"p1\">**</ept>.","pos":[11304,11315],"source":"**Photos**."},{"content":"Specify the <bpt id=\"p1\">**</bpt>Pictures Library<ept id=\"p1\">**</ept> capability in the app manifest file to let your app see and access files of the following file types:","pos":[11316,11450],"source":" Specify the **Pictures Library** capability in the app manifest file to let your app see and access files of the following file types:"},{"content":".jpeg","pos":[11460,11465]},{"content":".jpe","pos":[11474,11478]},{"content":".jpg","pos":[11487,11491]},{"content":".gif","pos":[11500,11504]},{"content":".tiff","pos":[11513,11518]},{"content":".tif","pos":[11527,11531]},{"content":".png","pos":[11540,11544]},{"content":".bmp","pos":[11553,11557]},{"content":".wdp","pos":[11566,11570]},{"content":".jxr","pos":[11579,11583]},{"content":".hdp","pos":[11592,11596]},{"content":"<bpt id=\"p1\">**</bpt>Videos<ept id=\"p1\">**</ept>.","pos":[11601,11612],"source":"**Videos**."},{"content":"Specify the <bpt id=\"p1\">**</bpt>Video Library<ept id=\"p1\">**</ept> capability in the app manifest file to let your app see and access files of the following file types:","pos":[11613,11744],"source":" Specify the **Video Library** capability in the app manifest file to let your app see and access files of the following file types:"},{"content":".wm","pos":[11754,11757]},{"content":".m4v","pos":[11766,11770]},{"content":".wmv","pos":[11779,11783]},{"content":".asf","pos":[11792,11796]},{"content":".mov","pos":[11805,11809]},{"content":".mp4","pos":[11818,11822]},{"content":".3g2","pos":[11831,11835]},{"content":".3gp","pos":[11844,11848]},{"content":".mp4v","pos":[11857,11862]},{"content":".avi","pos":[11871,11875]},{"content":".pyv","pos":[11884,11888]},{"content":".3gpp","pos":[11897,11902]},{"content":".3gp2","pos":[11911,11916]},{"content":"Working with photos","pos":[11921,11940]},{"content":"On devices where the camera saves both a low-resolution image and a high-resolution image of every picture, the deep queries return only the low-resolution image.","pos":[11943,12105]},{"content":"The Camera Roll and the Saved Pictures folder do not support the deep queries.","pos":[12107,12185]},{"content":"Opening a photo in the app that captured it","pos":[12189,12232]},{"content":"If you want to let the user open a photo again later in the app that captured it, you can save the <bpt id=\"p1\">**</bpt>CreatorAppId<ept id=\"p1\">**</ept> with the photo's metadata by using code similar to the following example.","pos":[12236,12425],"source":"If you want to let the user open a photo again later in the app that captured it, you can save the **CreatorAppId** with the photo's metadata by using code similar to the following example."},{"content":"In this example, <bpt id=\"p1\">**</bpt>testPhoto<ept id=\"p1\">**</ept> is a <bpt id=\"p2\">[</bpt><bpt id=\"p3\">**</bpt>StorageFile<ept id=\"p3\">**</ept><ept id=\"p2\">](https://msdn.microsoft.com/library/windows/apps/br227171)</ept>.","pos":[12426,12538],"source":" In this example, **testPhoto** is a [**StorageFile**](https://msdn.microsoft.com/library/windows/apps/br227171)."},{"content":"Using stream methods to add a file to a media library","pos":[12837,12890]},{"content":"When you access a media library by using a known folder such as <bpt id=\"p1\">**</bpt>KnownFolders.PictureLibrary<ept id=\"p1\">**</ept>, and you use stream methods to add a file to the media library, you have to make sure to close all the streams that your code opens.","pos":[12893,13121],"source":"When you access a media library by using a known folder such as **KnownFolders.PictureLibrary**, and you use stream methods to add a file to the media library, you have to make sure to close all the streams that your code opens."},{"content":"Otherwise these methods fail to add the file to the media library as expected because at least one stream still has a handle to the file.","pos":[13122,13259]},{"content":"For example, when you run the following code, the file is not added to the media library.","pos":[13261,13350]},{"content":"In the line of code, <ph id=\"ph1\">`using (var destinationStream = (await destinationFile.OpenAsync(FileAccessMode.ReadWrite)).GetOutputStreamAt(0))`</ph>, both the <bpt id=\"p1\">**</bpt>OpenAsync<ept id=\"p1\">**</ept> method and the <bpt id=\"p2\">**</bpt>GetOutputStreamAt<ept id=\"p2\">**</ept> method open a stream.","pos":[13351,13569],"source":" In the line of code, `using (var destinationStream = (await destinationFile.OpenAsync(FileAccessMode.ReadWrite)).GetOutputStreamAt(0))`, both the **OpenAsync** method and the **GetOutputStreamAt** method open a stream."},{"content":"However only the stream opened by the <bpt id=\"p1\">**</bpt>GetOutputStreamAt<ept id=\"p1\">**</ept> method is disposed as a result of the <bpt id=\"p2\">**</bpt>using<ept id=\"p2\">**</ept> statement.","pos":[13570,13688],"source":" However only the stream opened by the **GetOutputStreamAt** method is disposed as a result of the **using** statement."},{"content":"The other stream remains open and prevents saving the file.","pos":[13689,13748]},{"content":"To use stream methods successfully to add a file to the media library, make sure to close all the streams that your code opens, as shown in the following example.","pos":[14318,14480]}],"content":"\n# Files and folders in the Music, Pictures, and Videos libraries\n\n\n\\[ Updated for UWP apps on Windows 10. For Windows 8.x articles, see the [archive](http://go.microsoft.com/fwlink/p/?linkid=619132) \\]\n\n\nAdd existing folders of music, pictures, or videos to the corresponding libraries. You can also remove folders from libraries, get the list of folders in a library, and discover stored photos, music, and videos.\n\nA library is a virtual collection of folders, which includes a known folder by default plus any other folders the user has added to the library by using your app or one of the built-in apps. For example, the Pictures library includes the Pictures known folder by default. The user can add folders to, or remove them from, the Pictures library by using your app or the built-in Photos app.\n\n## Prerequisites\n\n\n-   **Understand async programming for Universal Windows Platform (UWP) apps**\n\n    You can learn how to write asynchronous apps in C\\# or Visual Basic, see [Call asynchronous APIs in C\\# or Visual Basic](https://msdn.microsoft.com/library/windows/apps/mt187337). To learn how to write asynchronous apps in C++, see [Asynchronous programming in C++](https://msdn.microsoft.com/library/windows/apps/mt187334).\n\n-   **Access permissions to the location**\n\n    In Visual Studio, open the app manifest file in Manifest Designer. On the **Capabilities** page, select the libraries that your app manages.\n\n    -   **Music Library**\n    -   **Pictures Library**\n    -   **Videos Library**\n\n    To learn more, see [File access permissions](file-access-permissions.md).\n\n## Get a reference to a library\n\n\n**Note**  Remember to declare the appropriate capability.\n \n\nTo get a reference to the user's Music, Pictures, or Video library, call the [**StorageLibrary.GetLibraryAsync**](https://msdn.microsoft.com/library/windows/apps/dn251725) method. Provide the corresponding value from the [**KnownLibraryId**](https://msdn.microsoft.com/library/windows/apps/dn298399) enumeration.\n\n-   [**KnownLibraryId.Music**](https://msdn.microsoft.com/library/windows/apps/br227155)\n-   [**KnownLibraryId.Pictures**](https://msdn.microsoft.com/library/windows/apps/br227156)\n-   [**KnownLibraryId.Videos**](https://msdn.microsoft.com/library/windows/apps/br227159)\n\n```CSharp\n    var myPictures = await Windows.Storage.StorageLibrary.GetLibraryAsync\n        (Windows.Storage.KnownLibraryId.Pictures);\n```\n\n## Get the list of folders in a library\n\n\nTo get the list of folders in a library, get the value of the [**StorageLibrary.Folders**](https://msdn.microsoft.com/library/windows/apps/dn251724) property.\n\n```CSharp\n    using Windows.Foundation.Collections;\n\n    // ...\n            \n    IObservableVector<Windows.Storage.StorageFolder> myPictureFolders = myPictures.Folders;\n```\n\n## Get the folder in a library where new files are saved by default\n\n\nTo get the folder in a library where new files are saved by default, get the value of the [**StorageLibrary.SaveFolder**](https://msdn.microsoft.com/library/windows/apps/dn251728) property.\n\n```CSharp\n    Windows.Storage.StorageFolder savePicturesFolder = myPictures.SaveFolder;\n```\n\n## Add an existing folder to a library\n\n\nTo add a folder to a library, you call the [**StorageLibrary.RequestAddFolderAsync**](https://msdn.microsoft.com/library/windows/apps/dn251726). Taking the Pictures Library as an example, calling this method causes a folder picker to be shown to the user with an **Add this folder to Pictures** button. If the user picks a folder then the folder remains in its original location on disk and it becomes an item in the [**StorageLibrary.Folders**](https://msdn.microsoft.com/library/windows/apps/dn251724) property (and in the built-in Photos app), but the folder does not appear as a child of the Pictures folder in File Explorer.\n\n\n```CSharp\n    Windows.Storage.StorageFolder newFolder = await myPictures.RequestAddFolderAsync();\n```\n\n## Remove a folder from a library\n\n\nTo remove a folder from a library, call the [**StorageLibrary.RequestRemoveFolderAsync**](https://msdn.microsoft.com/library/windows/apps/dn251727) method and specify the folder to be removed. You could use [**StorageLibrary.Folders**](https://msdn.microsoft.com/library/windows/apps/dn251724) and a [**ListView**](https://msdn.microsoft.com/library/windows/apps/br242878) control (or similar) for the user to select a folder to remove.\n\nWhen you call [**StorageLibrary.RequestRemoveFolderAsync**](https://msdn.microsoft.com/library/windows/apps/dn251727), the user sees a confirmation dialog saying that the folder \"won't appear in Pictures anymore, but won't be deleted.\" What this means is that the folder remains in its original location on disk, is removed from the [**StorageLibrary.Folders**](https://msdn.microsoft.com/library/windows/apps/dn251724) property, and will no longer included in the built-in Photos app.\n\nThe following example assumes that the user has selected the folder to remove from a [**ListView**](https://msdn.microsoft.com/library/windows/apps/br242878) control named **lvPictureFolders**.\n\n\n```CSharp\n    bool result = await myPictures.RequestRemoveFolderAsync(folder);\n```\n\n## Get notified of changes to the list of folders in a library\n\n\nTo get notified about changes to the list of folders in a library, register a handler for the [**StorageLibrary.DefinitionChanged**](https://msdn.microsoft.com/library/windows/apps/dn251723) event of the library.\n\n\n```CSharp\n    myPictures.DefinitionChanged += MyPictures_DefinitionChanged;\n    // ...\n\nvoid HandleDefinitionChanged(Windows.Storage.StorageLibrary sender, object args)\n{\n    // ...\n}\n```\n\n## Media library folders\n\n\nA device provides five predefined locations for users and apps to store media files. Built-in apps store both user-created media and downloaded media in these locations.\n\nThe locations are:\n\n-   **Pictures** folder. Contains pictures.\n\n    -   **Camera Roll** folder. Contains photos and video from the built-in camera.\n\n    -   **Saved Pictures** folder. Contains pictures that the user has saved from other apps.\n\n-   **Music** folder. Contains songs, podcasts, and audio books.\n\n-   **Video** folder. Contains videos.\n\nUsers or apps may also store media files outside the media library folders on the SD card. To find a media file reliably on the SD card, scan the contents of the SD card, or ask the user to locate the file by using a file picker. For more info, see [Access the SD card](access-the-sd-card.md).\n\n## Querying the media libraries\n\n\n### Query results include both internal and removable storage\n\nUsers can choose to store files by default on the optional SD card. Apps, however, can opt out of allowing files to be stored on the SD card. As a result, the media libraries can be split across the device's internal storage and the SD card.\n\nYou don't have to write additional code to handle this possibility. The methods in the [**Windows.Storage**](https://msdn.microsoft.com/library/windows/apps/br227346) namespace that query known folders transparently combine the query results from both locations. You don't have to specify the **removableStorage** capability in the app manifest file to get these combined results, either.\n\nConsider the state of the device's storage shown in the following image:\n\n![images on the phone and sd card](images/phone-media-locations.png)\n\nIf you query the contents of the Pictures Library by calling `await KnownFolders.PicturesLibrary.GetFilesAsync()`, the results include both internalPic.jpg and SDPic.jpg.\n\n### Deep queries\n\nUse the deep queries to enumerate the entire contents of a media library quickly.\n\nThe deep queries return only files of the specified media type. For example, if you query the Music Library with a deep query, the query results do not include any picture files found in the Music folder.\n\nOn devices where the camera saves both a low-resolution image and a high-resolution image of every picture, the deep queries return only the low-resolution image.\n\nThe Camera Roll and the Saved Pictures folder do not support the deep queries.\n\nThe following deep queries are available:\n\n**Pictures library**\n\n-   `GetFilesAsync(CommonFileQuery.OrderByDate)`\n\n**Music library**\n\n-   `GetFilesAsync(CommonFileQuery.OrderByName)`\n-   `GetFoldersAsync(CommonFolderQuery.GroupByArtist)`\n-   `GetFoldersAysnc(CommonFolderQuery.GroupByAlbum)`\n-   `GetFoldersAysnc(CommonFolderQuery.GroupByAlbumArtist)`\n-   `GetFoldersAsync(CommonFolderQuery.GroupByGenre)`\n\n**Video library**\n\n-   `GetFilesAsync(CommonFileQuery.OrderByDate)`\n\n### Flat queries\n\nTo get a complete listing of all the files and folders in a library, call `GetFilesAsync(CommonFileQuery.DefaultQuery)`. This method returns all files in the library, regardless of their type. This is a shallow query, so you have to enumerate the contents of subfolders recursively if the user has created subfolders in the library.\n\nUse flat queries to return media files of types that are not recognized by the built-in queries, or to return all the files in a library, including files that are not of the specified type. For example, if you query the Music Library with a flat query, the query results include any picture files found by the query in the Music folder.\n\n### Sample queries\n\nAssume that the device and its optional SD card contain the folders and files shown in the following image:\n\n![files on ](images/phone-media-queries.png)\n\nHere are a few examples of queries and the results that they return.\n\n| Query | Results |\n|--------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------|\n| KnownFolders.PicturesLibrary.GetItemsAsync();  | - Camera Roll folder from internal storage <br>- Camera Roll folder from the SD card <br>- Saved Pictures folder from internal storage <br>- Saved Pictures folder from the SD card <br><br>This is a flat query, so only immediate children of the Pictures folder   are returned. |\n| KnownFolders.PicturesLibrary.GetFilesAsync();  | No results. <br><br>This is flat query, and the Pictures folder does not contain any files as its immediate children. |\n| KnownFolders.PicturesLibrary.GetFilesAsync(CommonFileQuery.OrderByDate); | - 4-3-2012.jpg file from the SD card <br>- 1-1-2014.jpg file from internal storage <br>- 1-2-2014.jpg file from internal storage <br>- 1-6-2014.jpg file from the SD card <br><br>This is a deep query, so the contents of the Pictures folder and of its   child folders are returned. |\n| KnownFolders.CameraRoll.GetFilesAsync(); | - 1-1-2014.jpg file from internal storage <br>- 4-3-2012.jpg file from the SD card <br><br>This is a flat query. The ordering of the results is not guaranteed. |\n\n \n## Media library capabilities and file types\n\n\nHere are the capabilities that you can specify in the app manifest file to access media files in your app.\n\n-   **Music**. Specify the **Music Library** capability in the app manifest file to let your app see and access files of the following file types:\n\n    -   .qcp\n    -   .wav\n    -   .mp3\n    -   .m4r\n    -   .m4a\n    -   .aac\n    -   .amr\n    -   .wma\n    -   .3g2\n    -   .3gp\n    -   .mp4\n    -   .wm\n    -   .asf\n    -   .3gpp\n    -   .3gp2\n    -   .mpa\n    -   .adt\n    -   .adts\n    -   .pya\n-   **Photos**. Specify the **Pictures Library** capability in the app manifest file to let your app see and access files of the following file types:\n\n    -   .jpeg\n    -   .jpe\n    -   .jpg\n    -   .gif\n    -   .tiff\n    -   .tif\n    -   .png\n    -   .bmp\n    -   .wdp\n    -   .jxr\n    -   .hdp\n-   **Videos**. Specify the **Video Library** capability in the app manifest file to let your app see and access files of the following file types:\n\n    -   .wm\n    -   .m4v\n    -   .wmv\n    -   .asf\n    -   .mov\n    -   .mp4\n    -   .3g2\n    -   .3gp\n    -   .mp4v\n    -   .avi\n    -   .pyv\n    -   .3gpp\n    -   .3gp2\n\n## Working with photos\n\n\nOn devices where the camera saves both a low-resolution image and a high-resolution image of every picture, the deep queries return only the low-resolution image.\n\nThe Camera Roll and the Saved Pictures folder do not support the deep queries.\n\n**Opening a photo in the app that captured it**\n\nIf you want to let the user open a photo again later in the app that captured it, you can save the **CreatorAppId** with the photo's metadata by using code similar to the following example. In this example, **testPhoto** is a [**StorageFile**](https://msdn.microsoft.com/library/windows/apps/br227171).\n\n```CSharp\n  IDictionary<string, object> propertiesToSave = new Dictionary<string, object>();\n\n  propertiesToSave.Add(\"System.CreatorOpenWithUIOptions\", 1);\n  propertiesToSave.Add(\"System.CreatorAppId\", appId);\n \n  testPhoto.Properties.SavePropertiesAsync(propertiesToSave).AsyncWait();   \n```\n\n## Using stream methods to add a file to a media library\n\n\nWhen you access a media library by using a known folder such as **KnownFolders.PictureLibrary**, and you use stream methods to add a file to the media library, you have to make sure to close all the streams that your code opens. Otherwise these methods fail to add the file to the media library as expected because at least one stream still has a handle to the file.\n\nFor example, when you run the following code, the file is not added to the media library. In the line of code, `using (var destinationStream = (await destinationFile.OpenAsync(FileAccessMode.ReadWrite)).GetOutputStreamAt(0))`, both the **OpenAsync** method and the **GetOutputStreamAt** method open a stream. However only the stream opened by the **GetOutputStreamAt** method is disposed as a result of the **using** statement. The other stream remains open and prevents saving the file.\n\n```CSharp\nStorageFolder testFolder = await StorageFolder.GetFolderFromPathAsync(@\"C:\\test\");\nStorageFile sourceFile = await testFolder.GetFileAsync(\"TestImage.jpg\");\nStorageFile destinationFile = await KnownFolders.CameraRoll.CreateFileAsync(\"MyTestImage.jpg\");\nusing (var sourceStream = (await sourceFile.OpenReadAsync()).GetInputStreamAt(0))\n{\n    using (var destinationStream = (await destinationFile.OpenAsync(FileAccessMode.ReadWrite)).GetOutputStreamAt(0))\n    {\n        await RandomAccessStream.CopyAndCloseAsync(sourceStream, destinationStream);\n    }\n}\n\n```\n\nTo use stream methods successfully to add a file to the media library, make sure to close all the streams that your code opens, as shown in the following example.\n\n```CSharp\nStorageFolder testFolder = await StorageFolder.GetFolderFromPathAsync(@\"C:\\test\");\nStorageFile sourceFile = await testFolder.GetFileAsync(\"TestImage.jpg\");\nStorageFile destinationFile = await KnownFolders.CameraRoll.CreateFileAsync(\"MyTestImage.jpg\");\n\nusing (var sourceStream = await sourceFile.OpenReadAsync())\n{\n    using (var sourceInputStream = sourceStream.GetInputStreamAt(0))\n    {\n        using (var destinationStream = await destinationFile.OpenAsync(FileAccessMode.ReadWrite))\n        {\n            using (var destinationOutputStream = destinationStream.GetOutputStreamAt(0))\n            {\n                await RandomAccessStream.CopyAndCloseAsync(sourceInputStream, destinationStream);\n            }\n        }\n    }\n}\n```\n\n \n\n \n\n\n\n"}