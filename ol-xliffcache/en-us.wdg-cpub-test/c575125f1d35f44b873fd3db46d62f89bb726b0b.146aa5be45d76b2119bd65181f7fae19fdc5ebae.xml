{"nodes":[{"pos":[86,238],"content":"This section describes how to modify your PlayReady Web app to support the changes made from the previous Windows 8.1 version to the Windows 10 version.","needQuote":true,"needEscape":true,"nodes":[{"content":"This section describes how to modify your PlayReady Web app to support the changes made from the previous Windows 8.1 version to the Windows 10 version.","pos":[0,152]}]},{"pos":[246,281],"content":"PlayReady Encrypted Media Extension","needQuote":true,"needEscape":true,"nodes":[{"content":"PlayReady Encrypted Media Extension","pos":[0,35]}]},{"content":"PlayReady Encrypted Media Extension","pos":[289,324]},{"content":"\\[ Updated for UWP apps on Windows 10.","pos":[326,364]},{"content":"For Windows 8.x articles, see the <bpt id=\"p1\">[</bpt>archive<ept id=\"p1\">](http://go.microsoft.com/fwlink/p/?linkid=619132)</ept> \\]","pos":[365,460],"source":" For Windows 8.x articles, see the [archive](http://go.microsoft.com/fwlink/p/?linkid=619132) \\]"},{"content":"This section describes how to modify your PlayReady Web app to support the changes made from the previous Windows 8.1 version to the Windows 10 version.","pos":[463,615]},{"content":"Using PlayReady media elements in Internet Explorer enables developers to create Web apps capable of providing PlayReady content to the user while enforcing the access rules defined by the content provider.","pos":[617,823]},{"content":"This section describes how to add PlayReady media elements to your existing Web apps using only HTML5 and JavaScript.","pos":[824,941]},{"content":"What's New in PlayReady Encrypted Media Extension","pos":[946,995]},{"content":"This section provides a list of changes made to the PlayReady Encrypted Media Extension to enable PlayReady content protection on Windows 10.","pos":[997,1138]},{"content":"The following list describes the new features and changes made to PlayReady Encrypted Media Extension for Windows 10:","pos":[1140,1257]},{"content":"Added hardware digital rights management (DRM).","pos":[1263,1310]},{"content":"Hardware-based content protection support enables secure playback of high definition (HD) and ultra-high definition (UHD) content on multiple device platforms.","pos":[1316,1475]},{"content":"Key material (including private keys, content keys, and any other key material used to derive or unlock said keys), and decrypted compressed and uncompressed video samples are protected by leveraging hardware security.","pos":[1476,1694]},{"content":"Provides proactive acquisition of non-persistent licenses.","pos":[1700,1758]},{"content":"Provides acquisition of multiple licenses in one message.","pos":[1763,1820]},{"pos":[1826,2042],"content":"You can either use a PlayReady object with multiple key identifiers (KeyIDs) as in Windows 8.1, or use <bpt id=\"p1\">[</bpt>content decryption model data (CDMData)<ept id=\"p1\">](https://go.microsoft.com/fwlink/p/?LinkID=626819)</ept> with multiple KeyIDs.","source":"You can either use a PlayReady object with multiple key identifiers (KeyIDs) as in Windows 8.1, or use [content decryption model data (CDMData)](https://go.microsoft.com/fwlink/p/?LinkID=626819) with multiple KeyIDs."},{"pos":[2048,2143],"content":"<bpt id=\"p1\">**</bpt>Note<ept id=\"p1\">**</ept>  In Windows 10, multiple key identifiers are supported under <ph id=\"ph1\">&amp;lt;</ph>KeyID<ph id=\"ph2\">&amp;gt;</ph> in CDMData.","source":"**Note**  In Windows 10, multiple key identifiers are supported under &lt;KeyID&gt; in CDMData."},{"content":"Added real time expiration support, or limited duration license (LDL).","pos":[2156,2226]},{"content":"Provides the ability to set real-time expiration on licenses.","pos":[2232,2293]},{"content":"Added HDCP Type 1 (version 2.2) policy support.","pos":[2299,2346]},{"content":"Miracast is now implicit as an output.","pos":[2351,2389]},{"content":"Added secure stop.","pos":[2394,2412]},{"content":"Secure stop provides the means for a PlayReady device to confidently assert to a media streaming service that media playback has stopped for any given piece of content.","pos":[2418,2586]},{"content":"Added audio and video license separation.","pos":[2592,2633]},{"content":"Separate tracks prevent video from being decoded as audio; enabling more robust content protection.","pos":[2639,2738]},{"content":"Emerging standards are requiring separate keys for audio and visual tracks.","pos":[2739,2814]},{"content":"Added MaxResDecode.","pos":[2820,2839]},{"content":"This feature was added to limit playback of content to a maximum resolution even when in possession of a more capable key (but not a license).","pos":[2845,2987]},{"content":"It supports cases where multiple stream sizes are encoded with a single key.","pos":[2988,3064]},{"content":"Encrypted Media Extension Support in PlayReady","pos":[3069,3115]},{"content":"This section describes the version of the W3C Encrypted Media Extension supported by PlayReady.","pos":[3117,3212]},{"content":"PlayReady for Web Apps is currently bound to the <bpt id=\"p1\">[</bpt>W3C Encrypted Media Extension (EME) draft of May 10, 2013<ept id=\"p1\">](http://www.w3.org/TR/2013/WD-encrypted-media-20130510/)</ept>.","pos":[3214,3379],"source":"PlayReady for Web Apps is currently bound to the [W3C Encrypted Media Extension (EME) draft of May 10, 2013](http://www.w3.org/TR/2013/WD-encrypted-media-20130510/)."},{"content":"This support will be changed to the updated EME specification in future versions of Windows.","pos":[3380,3472]},{"content":"Use Hardware DRM","pos":[3477,3493]},{"content":"This section describes how your web app can use PlayReady hardware DRM, and how to disable hardware DRM if the protected content does not support it.","pos":[3495,3644]},{"pos":[3646,3875],"content":"To use PlayReady hardware DRM, your JavaScript web app should use the <bpt id=\"p1\">**</bpt>isTypeSupported<ept id=\"p1\">**</ept> EME method with a key system identifier of <ph id=\"ph1\">`com.microsoft.playready.hardware`</ph> to query for PlayReady hardware DRM support from the browser.","source":"To use PlayReady hardware DRM, your JavaScript web app should use the **isTypeSupported** EME method with a key system identifier of `com.microsoft.playready.hardware` to query for PlayReady hardware DRM support from the browser."},{"content":"Occasionally, some content is not supported in hardware DRM.","pos":[3877,3937]},{"content":"Cocktail content is never supported in hardware DRM; if you want to play cocktail content, you must opt out of hardware DRM.","pos":[3938,4062]},{"content":"Some hardware DRM will support HEVC and some will not; if you want to play HEVC content and hardware DRM doesn’t support it, you will want to opt out as well.","pos":[4063,4221]},{"pos":[4223,4447],"content":"<bpt id=\"p1\">**</bpt>Note<ept id=\"p1\">**</ept>  To determine whether HEVC content is supported, after instantiating <ph id=\"ph1\">`com.microsoft.playready`</ph>, use the <bpt id=\"p2\">[</bpt><bpt id=\"p3\">**</bpt>PlayReadyStatics.CheckSupportedHardware<ept id=\"p3\">**</ept><ept id=\"p2\">](https://msdn.microsoft.com/library/windows/apps/dn986441)</ept> method.","source":"**Note**  To determine whether HEVC content is supported, after instantiating `com.microsoft.playready`, use the [**PlayReadyStatics.CheckSupportedHardware**](https://msdn.microsoft.com/library/windows/apps/dn986441) method."},{"content":"Add Secure Stop to your Web App","pos":[4455,4486]},{"content":"This section describes how to add secure stop to your web app.","pos":[4488,4550]},{"content":"Secure stop provides the means for a PlayReady device to confidently assert to a media streaming service that media playback has stopped for any given piece of content.","pos":[4552,4720]},{"content":"This capability ensures your media streaming services provide accurate enforcement and reporting of usage limitations on different devices for a given account.","pos":[4721,4880]},{"content":"There are two primary scenarios for sending a secure stop challenge:","pos":[4882,4950]},{"content":"When the media presentation stops because end of content was reached or when the user stopped the media presentation somewhere in the middle.","pos":[4956,5097]},{"content":"When the previous session ends unexpectedly (for example, due to a system or app crash).","pos":[5102,5190]},{"content":"The app will need to query, either at startup or shutdown, for any outstanding secure stop sessions and send challenge(s) separate from any other media playback.","pos":[5191,5352]},{"content":"The following procedures describe how to set up secure stop for various scenarios.","pos":[5354,5436]},{"content":"To set up secure stop for a normal end of a presentation:","pos":[5438,5495]},{"pos":[5501,5555],"content":"Register the <bpt id=\"p1\">**</bpt>onEnded<ept id=\"p1\">**</ept> event before playback starts.","source":"Register the **onEnded** event before playback starts."},{"pos":[5560,5811],"content":"The <bpt id=\"p1\">**</bpt>onEnded<ept id=\"p1\">**</ept> event handler needs to call <ph id=\"ph1\">`removeAttribute(“src”)`</ph> from the video/audio element object to set the source to <bpt id=\"p2\">**</bpt>NULL<ept id=\"p2\">**</ept> which will trigger the media foundation to tear down the topology, destroy the decryptor(s), and set the stop state.","source":"The **onEnded** event handler needs to call `removeAttribute(“src”)` from the video/audio element object to set the source to **NULL** which will trigger the media foundation to tear down the topology, destroy the decryptor(s), and set the stop state."},{"content":"You can start the secure stop CDM session inside the handler to send the secure stop challenge to the server to notify the playback has stopped at this time, but it can be done later as well.","pos":[5816,6007]},{"content":"To set up secure stop if the user navigates away from the page or closes down the tab or browser:","pos":[6009,6106]},{"content":"No app action is required to record the stop state; it will be recorded for you.","pos":[6112,6192]},{"content":"To set up secure stop for custom page controls or user actions (such as custom navigation buttons or starting a new presentation before the current presentation completed):","pos":[6194,6366]},{"pos":[6372,6564],"content":"When custom user action occurs, the app needs to set the source to <bpt id=\"p1\">**</bpt>NULL<ept id=\"p1\">**</ept> which will trigger the media foundation to tear down the topology, destroy the decryptor(s), and set the stop state.","source":"When custom user action occurs, the app needs to set the source to **NULL** which will trigger the media foundation to tear down the topology, destroy the decryptor(s), and set the stop state."},{"content":"The following example demonstrates how to use secure stop in your web app:","pos":[6566,6640]},{"content":"<bpt id=\"p1\">**</bpt>Note<ept id=\"p1\">**</ept>  The secure stop data’s <ph id=\"ph1\">`&lt;SessionID&gt;B64 encoded session ID&lt;/SessionID&gt;`</ph> in the sample above can be an asterisk (\\*), which is a wild card for all the secure stop sessions recorded.","pos":[11721,11910],"source":"**Note**  The secure stop data’s `<SessionID>B64 encoded session ID</SessionID>` in the sample above can be an asterisk (\\*), which is a wild card for all the secure stop sessions recorded."},{"content":"That is, the <bpt id=\"p1\">**</bpt>SessionID<ept id=\"p1\">**</ept> tag can be a specific session, or a wild card (\\*) to select all the secure stop sessions.","pos":[11911,12028],"source":" That is, the **SessionID** tag can be a specific session, or a wild card (\\*) to select all the secure stop sessions."},{"content":"Programming Considerations for Encrypted Media Extension","pos":[12033,12089]},{"content":"This section lists the programming considerations that you should take into account when creating your PlayReady-enabled web app for Windows 10.","pos":[12091,12235]},{"content":"The <bpt id=\"p1\">**</bpt>MSMediaKeys<ept id=\"p1\">**</ept> and <bpt id=\"p2\">**</bpt>MSMediaKeySession<ept id=\"p2\">**</ept> objects created by your app must be kept alive until your app closes.","pos":[12237,12352],"source":"The **MSMediaKeys** and **MSMediaKeySession** objects created by your app must be kept alive until your app closes."},{"content":"One way of ensuring these objects stay alive is to assign them as global variables (the variables would become out of scope and subject to garbage collection if declared as a local variable inside of a function).","pos":[12353,12565]},{"content":"For example, the following sample assigns the variables <bpt id=\"p1\">*</bpt>g\\_msMediaKeys<ept id=\"p1\">*</ept> and <bpt id=\"p2\">*</bpt>g\\_mediaKeySession<ept id=\"p2\">*</ept> as global variables, which are then assigned to the <bpt id=\"p3\">**</bpt>MSMediaKeys<ept id=\"p3\">**</ept> and <bpt id=\"p4\">**</bpt>MSMediaKeySession<ept id=\"p4\">**</ept> objects in the function.","pos":[12566,12782],"source":" For example, the following sample assigns the variables *g\\_msMediaKeys* and *g\\_mediaKeySession* as global variables, which are then assigned to the **MSMediaKeys** and **MSMediaKeySession** objects in the function."},{"pos":[13369,13501],"content":"Refer to the <bpt id=\"p1\">[</bpt>sample applications<ept id=\"p1\">](https://code.msdn.microsoft.com/windowsapps/PlayReady-samples-for-124a3738)</ept> for more information.","source":"Refer to the [sample applications](https://code.msdn.microsoft.com/windowsapps/PlayReady-samples-for-124a3738) for more information."}],"content":"---\nauthor: eliotcowley\nms.assetid: 79C284CA-C53A-4C24-807E-6D4CE1A29BFA\ndescription: This section describes how to modify your PlayReady Web app to support the changes made from the previous Windows 8.1 version to the Windows 10 version.\ntitle: PlayReady Encrypted Media Extension\n---\n\n# PlayReady Encrypted Media Extension\n\n\\[ Updated for UWP apps on Windows 10. For Windows 8.x articles, see the [archive](http://go.microsoft.com/fwlink/p/?linkid=619132) \\]\n\n\nThis section describes how to modify your PlayReady Web app to support the changes made from the previous Windows 8.1 version to the Windows 10 version.\n\nUsing PlayReady media elements in Internet Explorer enables developers to create Web apps capable of providing PlayReady content to the user while enforcing the access rules defined by the content provider. This section describes how to add PlayReady media elements to your existing Web apps using only HTML5 and JavaScript.\n\n## What's New in PlayReady Encrypted Media Extension\n\nThis section provides a list of changes made to the PlayReady Encrypted Media Extension to enable PlayReady content protection on Windows 10.\n\nThe following list describes the new features and changes made to PlayReady Encrypted Media Extension for Windows 10:\n\n-   Added hardware digital rights management (DRM).\n\n    Hardware-based content protection support enables secure playback of high definition (HD) and ultra-high definition (UHD) content on multiple device platforms. Key material (including private keys, content keys, and any other key material used to derive or unlock said keys), and decrypted compressed and uncompressed video samples are protected by leveraging hardware security.\n\n-   Provides proactive acquisition of non-persistent licenses.\n-   Provides acquisition of multiple licenses in one message.\n\n    You can either use a PlayReady object with multiple key identifiers (KeyIDs) as in Windows 8.1, or use [content decryption model data (CDMData)](https://go.microsoft.com/fwlink/p/?LinkID=626819) with multiple KeyIDs.\n\n    **Note**  In Windows 10, multiple key identifiers are supported under &lt;KeyID&gt; in CDMData.\n\n     \n\n-   Added real time expiration support, or limited duration license (LDL).\n\n    Provides the ability to set real-time expiration on licenses.\n\n-   Added HDCP Type 1 (version 2.2) policy support.\n-   Miracast is now implicit as an output.\n-   Added secure stop.\n\n    Secure stop provides the means for a PlayReady device to confidently assert to a media streaming service that media playback has stopped for any given piece of content.\n\n-   Added audio and video license separation.\n\n    Separate tracks prevent video from being decoded as audio; enabling more robust content protection. Emerging standards are requiring separate keys for audio and visual tracks.\n\n-   Added MaxResDecode.\n\n    This feature was added to limit playback of content to a maximum resolution even when in possession of a more capable key (but not a license). It supports cases where multiple stream sizes are encoded with a single key.\n\n## Encrypted Media Extension Support in PlayReady\n\nThis section describes the version of the W3C Encrypted Media Extension supported by PlayReady.\n\nPlayReady for Web Apps is currently bound to the [W3C Encrypted Media Extension (EME) draft of May 10, 2013](http://www.w3.org/TR/2013/WD-encrypted-media-20130510/). This support will be changed to the updated EME specification in future versions of Windows.\n\n## Use Hardware DRM\n\nThis section describes how your web app can use PlayReady hardware DRM, and how to disable hardware DRM if the protected content does not support it.\n\nTo use PlayReady hardware DRM, your JavaScript web app should use the **isTypeSupported** EME method with a key system identifier of `com.microsoft.playready.hardware` to query for PlayReady hardware DRM support from the browser.\n\nOccasionally, some content is not supported in hardware DRM. Cocktail content is never supported in hardware DRM; if you want to play cocktail content, you must opt out of hardware DRM. Some hardware DRM will support HEVC and some will not; if you want to play HEVC content and hardware DRM doesn’t support it, you will want to opt out as well.\n\n**Note**  To determine whether HEVC content is supported, after instantiating `com.microsoft.playready`, use the [**PlayReadyStatics.CheckSupportedHardware**](https://msdn.microsoft.com/library/windows/apps/dn986441) method.\n\n \n\n## Add Secure Stop to your Web App\n\nThis section describes how to add secure stop to your web app.\n\nSecure stop provides the means for a PlayReady device to confidently assert to a media streaming service that media playback has stopped for any given piece of content. This capability ensures your media streaming services provide accurate enforcement and reporting of usage limitations on different devices for a given account.\n\nThere are two primary scenarios for sending a secure stop challenge:\n\n-   When the media presentation stops because end of content was reached or when the user stopped the media presentation somewhere in the middle.\n-   When the previous session ends unexpectedly (for example, due to a system or app crash). The app will need to query, either at startup or shutdown, for any outstanding secure stop sessions and send challenge(s) separate from any other media playback.\n\nThe following procedures describe how to set up secure stop for various scenarios.\n\nTo set up secure stop for a normal end of a presentation:\n\n1.  Register the **onEnded** event before playback starts.\n2.  The **onEnded** event handler needs to call `removeAttribute(“src”)` from the video/audio element object to set the source to **NULL** which will trigger the media foundation to tear down the topology, destroy the decryptor(s), and set the stop state.\n3.  You can start the secure stop CDM session inside the handler to send the secure stop challenge to the server to notify the playback has stopped at this time, but it can be done later as well.\n\nTo set up secure stop if the user navigates away from the page or closes down the tab or browser:\n\n-   No app action is required to record the stop state; it will be recorded for you.\n\nTo set up secure stop for custom page controls or user actions (such as custom navigation buttons or starting a new presentation before the current presentation completed):\n\n-   When custom user action occurs, the app needs to set the source to **NULL** which will trigger the media foundation to tear down the topology, destroy the decryptor(s), and set the stop state.\n\nThe following example demonstrates how to use secure stop in your web app:\n\n```JavaScript\n// JavaScript source code\n\nvar g_prkey = null;\nvar g_keySession = null;\nvar g_fUseSpecificSecureStopSessionID = false;\nvar g_encodedMeteringCert = 'Base64 encoded of your metering cert (aka publisher cert)';\n\n// Note: g_encodedLASessionId is the CDM session ID of the proactive or reactive license acquisition \n//       that we want to initiate the secure stop process.\nvar g_encodedLASessionId = null;\n\nfunction main()\n{\n    ...\n\n    g_prkey = new MSMediaKeys(\"com.microsoft.playready\");\n\n    ...\n\n    // add 'onended' event handler to the video element\n    // Assume 'myvideo' is the ID of the video element\n    var videoElement = document.getElementById(\"myvideo\");\n    videoElement.onended = function (e) { \n\n        //\n        // Calling removeAttribute(\"src\") will set the source to null\n        // which will trigger the MF to tear down the topology, destroy the\n        // decryptor(s) and set the stop state.  This is required in order\n        // to set the stop state.\n        //\n        videoElement.removeAttribute(\"src\");\n        videoElement.load();\n\n        onEndOfStream();\n    };\n}\n\nfunction onEndOfStream()\n{\n    ...\n\n    createSecureStopCDMSession();\n\n    ...    \n}\n\nfunction createSecureStopCDMSession()\n{\n    try{    \n        var targetMediaCodec = \"video/mp4\";\n        var customData = \"my custom data\";\n\n        var encodedSessionId = g_encodedLASessionId;\n        if( !g_fUseSpecificSecureStopSessionID )\n        {\n            // Use \"*\" (wildcard) as the session ID to include all secure stop sessions\n            // TODO: base64 encode \"*\" and place encoded result to encodedSessionId\n        }\n\n        var int8ArrayCDMdata = formatSecureStopCDMData( encodedSessionId, customData,  g_encodedMeteringCert );\n        var emptyArrayofInitData = new Uint8Array();\n\n        g_keySession = g_prkey.createSession(targetMediaCodec, emptyArrayofInitData, int8ArrayCDMdata);\n\n        addPlayreadyKeyEventHandler();\n\n    } catch( e )\n    {\n        // TODO: Handle exception\n    }\n}\n\nfunction addPlayreadyKeyEventHandler()\n{\n    // add 'keymessage' eventhandler   \n    g_keySession.addEventListener('mskeymessage', function (event) {\n\n        // TODO: Get the keyMessage from event.message.buffer which contains the secure stop challenge\n        //       The keyMessage format for the secure stop is similar to LA as below:\n        //\n        //            <PlayReadyKeyMessage type=\"SecureStop\" >\n        //              <SecureStop version=\"1.0\" >\n        //                <Challenge encoding=\"base64encoded\">\n        //                    secure stop challenge\n        //                </Challenge>\n        //                <HttpHeaders>\n        //                    <HttpHeader>\n        //                      <name>Content-Type</name>\n        //                         <value>\"content type data\"</value>\n        //                    </HttpHeader>\n        //                    <HttpHeader>\n        //                         <name>SOAPAction</name>\n        //                         <value>soap action</value>\n        //                     </HttpHeader>\n        //                    ....\n        //                </HttpHeaders>\n        //              </SecureStop>\n        //            </PlayReadyKeyMessage>\n                \n        // TODO: send the secure stop challenge to a server that handles the secure stop challenge\n\n        // TODO: Recevie and response and call event.target.Update() to proecess the response\n    });\n    \n    // add 'keyerror' eventhandler\n    g_keySession.addEventListener('mskeyerror', function (event) {\n        var session = event.target;\n        \n        ...\n\n        session.close();\n    });\n    \n    // add 'keyadded' eventhandler\n    g_keySession.addEventListener('mskeyadded', function (event) {\n        \n        var session = event.target;\n\n        ...\n\n        session.close();             \n    });\n}\n\n/**\n* desc@ formatSecureStopCDMData\n*   generate playready CDMData\n*   CDMData is in xml format:\n*   <PlayReadyCDMData type=\"SecureStop\">\n*     <SecureStop version=\"1.0\">\n*       <SessionID>B64 encoded session ID</SessionID>\n*       <CustomData>B64 encoded custom data</CustomData>\n*       <ServerCert>B64 encoded server cert</ServerCert>\n*     </SecureCert>\n* </PlayReadyCDMData>        \n*/\nfunction formatSecureStopCDMData(encodedSessionId, customData, encodedPublisherCert) \n{\n    var encodedCustomData = null;\n\n    // TODO: base64 encode the custom data and place the encoded result to encodedCustomData\n\n    var CDMDataStr = \"<PlayReadyCDMData type=\\\"SecureStop\\\">\" +\n                     \"<SecureStop version=\\\"1.0\\\" >\" +\n                     \"<SessionID>\" + encodedSessionId + \"</SessionID>\" +\n                     \"<CustomData>\" + encodedCustomData + \"</CustomData>\" +\n                     \"<ServerCert>\" + encodedPublisherCert + \"</ServerCert>\" +\n                     \"</SecureStop></PlayReadyCDMData>\";\n    \n    var int8ArrayCDMdata = null\n\n    // TODO: Convert CDMDataStr to Uint8 byte array and palce the converted result to int8ArrayCDMdata\n\n    return int8ArrayCDMdata;\n}\n```\n\n**Note**  The secure stop data’s `<SessionID>B64 encoded session ID</SessionID>` in the sample above can be an asterisk (\\*), which is a wild card for all the secure stop sessions recorded. That is, the **SessionID** tag can be a specific session, or a wild card (\\*) to select all the secure stop sessions.\n\n## Programming Considerations for Encrypted Media Extension\n\nThis section lists the programming considerations that you should take into account when creating your PlayReady-enabled web app for Windows 10.\n\nThe **MSMediaKeys** and **MSMediaKeySession** objects created by your app must be kept alive until your app closes. One way of ensuring these objects stay alive is to assign them as global variables (the variables would become out of scope and subject to garbage collection if declared as a local variable inside of a function). For example, the following sample assigns the variables *g\\_msMediaKeys* and *g\\_mediaKeySession* as global variables, which are then assigned to the **MSMediaKeys** and **MSMediaKeySession** objects in the function.\n\n``` syntax\nvar g_msMediaKeys;\nvar g_mediaKeySession;\n\nfunction foo() {\n  ...\n  g_msMediaKeys = new MSMediaKeys(\"com.microsoft.playready\");\n  ...\n  g_mediaKeySession = g_msMediaKeys.createSession(\"video/mp4\", intiData, null);\n  g_mediaKeySession.addEventListener(this.KEYMESSAGE_EVENT, function (e) \n  {\n    ...\n    downloadPlayReadyKey(url, keyMessage, function (data) \n    {\n      g_mediaKeySession.update(data);\n    });\n  });\n  g_mediaKeySession.addEventListener(this.KEYADDED_EVENT, function () \n  {\n    ...\n    g_mediaKeySession.close();\n    g_mediaKeySession = null;\n  });\n}\n```\n\nRefer to the [sample applications](https://code.msdn.microsoft.com/windowsapps/PlayReady-samples-for-124a3738) for more information.\n\n \n\n \n\n\n\n\n"}