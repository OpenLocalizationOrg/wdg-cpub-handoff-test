{"nodes":[{"pos":[60,100],"content":"Best practices for using the thread pool","needQuote":true,"needEscape":true,"nodes":[{"content":"Best practices for using the thread pool","pos":[0,40]}]},{"pos":[114,183],"content":"This topic describes best practices for working with the thread pool.","needQuote":true,"needEscape":true,"nodes":[{"content":"This topic describes best practices for working with the thread pool.","pos":[0,69]}]},{"content":"Best practices for using the thread pool","pos":[190,230]},{"content":"\\[ Updated for UWP apps on Windows 10.","pos":[232,270]},{"content":"For Windows 8.x articles, see the <bpt id=\"p1\">[</bpt>archive<ept id=\"p1\">](http://go.microsoft.com/fwlink/p/?linkid=619132)</ept> \\]","pos":[271,366],"source":" For Windows 8.x articles, see the [archive](http://go.microsoft.com/fwlink/p/?linkid=619132) \\]"},{"content":"This topic describes best practices for working with the thread pool.","pos":[369,438]},{"content":"Do's","pos":[443,447]},{"content":"Use the thread pool to do parallel work in your app.","pos":[454,506]},{"content":"Use work items to accomplish extended tasks without blocking the UI thread.","pos":[512,587]},{"content":"Create work items that are short-lived and independent.","pos":[593,648]},{"content":"Work items run asynchronously and they can be submitted to the pool in any order from the queue.","pos":[649,745]},{"pos":[751,889],"content":"Dispatch updates to the UI thread with the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>Windows.UI.Core.CoreDispatcher<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/BR208211)</ept>.","source":"Dispatch updates to the UI thread with the [**Windows.UI.Core.CoreDispatcher**](https://msdn.microsoft.com/library/windows/apps/BR208211)."},{"pos":[895,1025],"content":"Use <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>ThreadPoolTimer.CreateTimer<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/Hh967921)</ept> instead of the <bpt id=\"p3\">**</bpt>Sleep<ept id=\"p3\">**</ept> function.","source":"Use [**ThreadPoolTimer.CreateTimer**](https://msdn.microsoft.com/library/windows/apps/Hh967921) instead of the **Sleep** function."},{"content":"Use the thread pool instead of creating your own thread management system.","pos":[1031,1105]},{"content":"The thread pool runs at the OS level with advanced capability and is optimized to dynamically scale according to device resources and activity within the process and across the system.","pos":[1106,1290]},{"content":"In C++, ensure that work item delegates use the agile threading model (C++ delegates are agile by default).","pos":[1296,1403]},{"content":"Use pre-allocated work items when you can't tolerate a resource allocation failure at time of use.","pos":[1409,1507]},{"content":"Dont's","pos":[1512,1518]},{"content":"Don't create periodic timers with a <bpt id=\"p1\">*</bpt>period<ept id=\"p1\">*</ept> value of <ph id=\"ph1\">&amp;lt;</ph>1 millisecond (including 0).","pos":[1525,1611],"source":"Don't create periodic timers with a *period* value of &lt;1 millisecond (including 0)."},{"content":"This will cause the work item to behave as a single-shot timer.","pos":[1612,1675]},{"pos":[1681,1807],"content":"Don't submit periodic work items that take longer to complete than the amount of time you specified in the <bpt id=\"p1\">*</bpt>period<ept id=\"p1\">*</ept> parameter.","source":"Don't submit periodic work items that take longer to complete than the amount of time you specified in the *period* parameter."},{"content":"Don't try to send UI updates (other than toasts and notifications) from a work item dispatched from a background task.","pos":[1813,1931]},{"content":"Instead, use background task progress and completion handlers - for example, <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>IBackgroundTaskInstance.Progress<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/BR224800)</ept>.","pos":[1932,2106],"source":" Instead, use background task progress and completion handlers - for example, [**IBackgroundTaskInstance.Progress**](https://msdn.microsoft.com/library/windows/apps/BR224800)."},{"content":"When you use work-item handlers that use the <bpt id=\"p1\">**</bpt>async<ept id=\"p1\">**</ept> keyword, be aware that the thread pool work item may be set to the complete state before all of the code in the handler has executed.","pos":[2112,2300],"source":"When you use work-item handlers that use the **async** keyword, be aware that the thread pool work item may be set to the complete state before all of the code in the handler has executed."},{"content":"Code following an <bpt id=\"p1\">**</bpt>await<ept id=\"p1\">**</ept> keyword within the handler may execute after the work item has been set to the complete state.","pos":[2301,2423],"source":" Code following an **await** keyword within the handler may execute after the work item has been set to the complete state."},{"content":"Don't try to run a pre-allocated work item more than once without reinitializing it.","pos":[2429,2513]},{"content":"Create a periodic work item","pos":[2515,2542]},{"content":"Related topics","pos":[2580,2594]},{"content":"Create a periodic work item","pos":[2600,2627]},{"content":"Submit a work item to the thread pool","pos":[2664,2701]},{"content":"Use a timer to submit a work item","pos":[2748,2781]}],"content":"---\nms.assetid: 95CF7F3D-9E3A-40AC-A083-D8A375272181\ntitle: Best practices for using the thread pool\ndescription: This topic describes best practices for working with the thread pool.\n---\n# Best practices for using the thread pool\n\n\\[ Updated for UWP apps on Windows 10. For Windows 8.x articles, see the [archive](http://go.microsoft.com/fwlink/p/?linkid=619132) \\]\n\n\nThis topic describes best practices for working with the thread pool.\n\n## Do's\n\n\n-   Use the thread pool to do parallel work in your app.\n\n-   Use work items to accomplish extended tasks without blocking the UI thread.\n\n-   Create work items that are short-lived and independent. Work items run asynchronously and they can be submitted to the pool in any order from the queue.\n\n-   Dispatch updates to the UI thread with the [**Windows.UI.Core.CoreDispatcher**](https://msdn.microsoft.com/library/windows/apps/BR208211).\n\n-   Use [**ThreadPoolTimer.CreateTimer**](https://msdn.microsoft.com/library/windows/apps/Hh967921) instead of the **Sleep** function.\n\n-   Use the thread pool instead of creating your own thread management system. The thread pool runs at the OS level with advanced capability and is optimized to dynamically scale according to device resources and activity within the process and across the system.\n\n-   In C++, ensure that work item delegates use the agile threading model (C++ delegates are agile by default).\n\n-   Use pre-allocated work items when you can't tolerate a resource allocation failure at time of use.\n\n## Dont's\n\n\n-   Don't create periodic timers with a *period* value of &lt;1 millisecond (including 0). This will cause the work item to behave as a single-shot timer.\n\n-   Don't submit periodic work items that take longer to complete than the amount of time you specified in the *period* parameter.\n\n-   Don't try to send UI updates (other than toasts and notifications) from a work item dispatched from a background task. Instead, use background task progress and completion handlers - for example, [**IBackgroundTaskInstance.Progress**](https://msdn.microsoft.com/library/windows/apps/BR224800).\n\n-   When you use work-item handlers that use the **async** keyword, be aware that the thread pool work item may be set to the complete state before all of the code in the handler has executed. Code following an **await** keyword within the handler may execute after the work item has been set to the complete state.\n\n-   Don't try to run a pre-allocated work item more than once without reinitializing it. [Create a periodic work item](create-a-periodic-work-item.md)\n\n## Related topics\n\n\n* [Create a periodic work item](create-a-periodic-work-item.md)\n* [Submit a work item to the thread pool](submit-a-work-item-to-the-thread-pool.md)\n* [Use a timer to submit a work item](use-a-timer-to-submit-a-work-item.md)\n\n"}