{"nodes":[{"pos":[85,208],"content":"This topic describes effects designed to be used for video capture scenarios. This includes the video stabilization effect.","needQuote":true,"needEscape":true,"nodes":[{"content":"This topic describes effects designed to be used for video capture scenarios. This includes the video stabilization effect.","pos":[0,123],"nodes":[{"content":"This topic describes effects designed to be used for video capture scenarios.","pos":[0,77]},{"content":"This includes the video stabilization effect.","pos":[78,123]}]}]},{"pos":[216,241],"content":"Effects for video capture","needQuote":true,"needEscape":true,"nodes":[{"content":"Effects for video capture","pos":[0,25]}]},{"content":"Effects for video capture","pos":[249,274]},{"content":"\\[ Updated for UWP apps on Windows 10.","pos":[276,314]},{"content":"For Windows 8.x articles, see the <bpt id=\"p1\">[</bpt>archive<ept id=\"p1\">](http://go.microsoft.com/fwlink/p/?linkid=619132)</ept> \\]","pos":[315,410],"source":" For Windows 8.x articles, see the [archive](http://go.microsoft.com/fwlink/p/?linkid=619132) \\]"},{"content":"This topic describes effects designed to be used for video capture scenarios.","pos":[412,489]},{"content":"This includes the video stabilization effect.","pos":[490,535]},{"content":"Note","pos":[539,543]},{"content":"This article builds on concepts and code discussed in <bpt id=\"p1\">[</bpt>Capture Photos and Video with MediaCapture<ept id=\"p1\">](capture-photos-and-video-with-mediacapture.md)</ept>, which describes the steps for implementing basic photo and video capture.","pos":[548,768],"source":"This article builds on concepts and code discussed in [Capture Photos and Video with MediaCapture](capture-photos-and-video-with-mediacapture.md), which describes the steps for implementing basic photo and video capture."},{"content":"It is recommended that you familiarize yourself with the basic media capture pattern in that article before moving on to more advanced capture scenarios.","pos":[769,922]},{"content":"The code in this article assumes that your app already has an instance of MediaCapture that has been properly initialized.","pos":[923,1045]},{"content":"Video stabilization effect","pos":[1050,1076]},{"content":"The video stabilization effect manipulates the frames of a video stream to minimize shaking caused by holding the capture device in your hand.","pos":[1078,1220]},{"content":"Because this technique causes the pixels to be shifted right, left, up, and down, and because the effect can't know what the content just outside the video frame is, the stabilized video is cropped slightly from the original video.","pos":[1221,1452]},{"content":"A utility function is provided to allow you to adjust your video encoding settings to optimally manage the cropping performed by the effect.","pos":[1453,1593]},{"content":"On devices that support it, Optical Image Stabilization (OIS) stabilizes video by mechanically manipulating the capture device and, therefore, does not need to crop the edges of the video frames.","pos":[1595,1790]},{"content":"For more information, see <bpt id=\"p1\">[</bpt>Capture device controls for video capture<ept id=\"p1\">](capture-device-controls-for-video-capture.md)</ept>.","pos":[1791,1907],"source":" For more information, see [Capture device controls for video capture](capture-device-controls-for-video-capture.md)."},{"content":"Set up your app to use video stabilization","pos":[1913,1955]},{"content":"In addition to the namespaces required for basic media capture, using the video stabilization effect requires the following namespace.","pos":[1957,2091]},{"pos":[2103,2132],"content":"VideoStabilizationEffectUsing"},{"content":"Declare a member variable to store the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>VideoStabilizationEffect<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn926760)</ept> object.","pos":[2224,2359],"source":"Declare a member variable to store the [**VideoStabilizationEffect**](https://msdn.microsoft.com/library/windows/apps/dn926760) object."},{"content":"As part of the effect implementation, you will modify the encoding properties that you use to encode the captured video.","pos":[2360,2480]},{"content":"Declare two variables to store a backup copy of the initial input and output encoding properties so that you can restore them later when the effect is disabled.","pos":[2481,2641]},{"content":"Finally, declare a member variable of type <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>MediaEncodingProfile<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/hh701026)</ept> because this object will be accessed from multiple locations within your code.","pos":[2642,2848],"source":" Finally, declare a member variable of type [**MediaEncodingProfile**](https://msdn.microsoft.com/library/windows/apps/hh701026) because this object will be accessed from multiple locations within your code."},{"pos":[2860,2891],"content":"DeclareVideoStabilizationEffect"},{"content":"In the basic video capture implementation described in the article <bpt id=\"p1\">[</bpt>Capture Photos and Video with MediaCapture<ept id=\"p1\">](capture-photos-and-video-with-mediacapture.md)</ept>, the media encoding profile object is assigned to a local variable because it isn't used elsewhere in the code.","pos":[2985,3255],"source":"In the basic video capture implementation described in the article [Capture Photos and Video with MediaCapture](capture-photos-and-video-with-mediacapture.md), the media encoding profile object is assigned to a local variable because it isn't used elsewhere in the code."},{"content":"For this scenario, you should assign the object to a member variable so that you can access it later.","pos":[3256,3357]},{"pos":[3369,3390],"content":"EncodingProfileMember"},{"content":"Initialize the video stabilization effect","pos":[3478,3519]},{"content":"After your <bpt id=\"p1\">**</bpt>MediaCapture<ept id=\"p1\">**</ept> object has been initialized, create a new instance of the <bpt id=\"p2\">[</bpt><bpt id=\"p3\">**</bpt>VideoStabilizationEffectDefinition<ept id=\"p3\">**</ept><ept id=\"p2\">](https://msdn.microsoft.com/library/windows/apps/dn926762)</ept> object.","pos":[3521,3713],"source":"After your **MediaCapture** object has been initialized, create a new instance of the [**VideoStabilizationEffectDefinition**](https://msdn.microsoft.com/library/windows/apps/dn926762) object."},{"content":"Call <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>MediaCapture.AddVideoEffectAsync<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn878035)</ept> to add the effect to the video pipeline and retrieve an instance of the <bpt id=\"p3\">[</bpt><bpt id=\"p4\">**</bpt>VideoStabilizationEffect<ept id=\"p4\">**</ept><ept id=\"p3\">](https://msdn.microsoft.com/library/windows/apps/dn926760)</ept> class.","pos":[3714,3983],"source":" Call [**MediaCapture.AddVideoEffectAsync**](https://msdn.microsoft.com/library/windows/apps/dn878035) to add the effect to the video pipeline and retrieve an instance of the [**VideoStabilizationEffect**](https://msdn.microsoft.com/library/windows/apps/dn926760) class."},{"content":"Specify <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>MediaStreamType.VideoRecord<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br226640)</ept> to indicate that the effect should be applied to the video record stream.","pos":[3984,4157],"source":" Specify [**MediaStreamType.VideoRecord**](https://msdn.microsoft.com/library/windows/apps/br226640) to indicate that the effect should be applied to the video record stream."},{"content":"Register an event handler for the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>EnabledChanged<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn948982)</ept> event and call the helper method <bpt id=\"p3\">**</bpt>SetUpVideoStabilizationRecommendationAsync<ept id=\"p3\">**</ept>, both of which are discussed later in this article.","pos":[4159,4403],"source":"Register an event handler for the [**EnabledChanged**](https://msdn.microsoft.com/library/windows/apps/dn948982) event and call the helper method **SetUpVideoStabilizationRecommendationAsync**, both of which are discussed later in this article."},{"content":"Finally, set the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>Enabled<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn926775)</ept> property of the effect to true to enable the effect.","pos":[4404,4545],"source":" Finally, set the [**Enabled**](https://msdn.microsoft.com/library/windows/apps/dn926775) property of the effect to true to enable the effect."},{"pos":[4557,4587],"content":"CreateVideoStabilizationEffect"},{"content":"Use recommended encoding properties","pos":[4684,4719]},{"content":"As discussed earlier in this article, the technique that the video stabilization effect uses necessarily causes the stabilized video to be cropped slightly from the source video.","pos":[4721,4899]},{"content":"Define the following helper function in your code in order to adjust the video encoding properties to optimally handle this limitation of the effect.","pos":[4900,5049]},{"content":"This step is not required in order to use the video stabilization effect, but if you don't perform this step, the resulting video will be upscaled slightly and therefore have slightly lower visual fidelity.","pos":[5050,5256]},{"content":"Call <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>GetRecommendedStreamConfiguration<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn948983)</ept> on your video stabilization effect instance, passing in the <bpt id=\"p3\">[</bpt><bpt id=\"p4\">**</bpt>VideoDeviceController<ept id=\"p4\">**</ept><ept id=\"p3\">](https://msdn.microsoft.com/library/windows/apps/br226825)</ept> object, which informs the effect about your current input stream encoding properties, and your <bpt id=\"p5\">**</bpt>MediaEncodingProfile<ept id=\"p5\">**</ept> which lets the effect know your current output encoding properties.","pos":[5258,5694],"source":"Call [**GetRecommendedStreamConfiguration**](https://msdn.microsoft.com/library/windows/apps/dn948983) on your video stabilization effect instance, passing in the [**VideoDeviceController**](https://msdn.microsoft.com/library/windows/apps/br226825) object, which informs the effect about your current input stream encoding properties, and your **MediaEncodingProfile** which lets the effect know your current output encoding properties."},{"content":"This method returns a <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>VideoStreamConfiguration<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn926727)</ept> object containing new recommended input and output stream encoding properties.","pos":[5695,5884],"source":" This method returns a [**VideoStreamConfiguration**](https://msdn.microsoft.com/library/windows/apps/dn926727) object containing new recommended input and output stream encoding properties."},{"content":"The recommended input encoding properties are, if it is supported by the device, a higher resolution that the initial settings you provided so that there is minimal loss in resolution after the effect's cropping is applied.","pos":[5886,6109]},{"content":"Call <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>VideoDeviceController.SetMediaStreamPropertiesAsync<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/hh700895)</ept> to set the new encoding properties.","pos":[6111,6267],"source":"Call [**VideoDeviceController.SetMediaStreamPropertiesAsync**](https://msdn.microsoft.com/library/windows/apps/hh700895) to set the new encoding properties."},{"content":"Before setting the new properties, use the member variable to store the initial encoding properties so that you can change the settings back when you disable the effect.","pos":[6268,6437]},{"content":"If the video stabilization effect must crop the output video, the recommended output encoding properties will be the size of the cropped video.","pos":[6439,6582]},{"content":"This means that the output resolution will match the cropped video size.","pos":[6583,6655]},{"content":"If you do not use the recommended output properties, then the video will be scaled up to match the initial output size, which will result in a loss of visual fidelity.","pos":[6656,6823]},{"content":"Set the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>Video<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/hh701124)</ept> property of the <bpt id=\"p3\">**</bpt>MediaEncodingProfile<ept id=\"p3\">**</ept> object.","pos":[6825,6951],"source":"Set the [**Video**](https://msdn.microsoft.com/library/windows/apps/hh701124) property of the **MediaEncodingProfile** object."},{"content":"Before setting the new properties, use the member variable to store the initial encoding properties so that you can change the settings back when you disable the effect.","pos":[6952,7121]},{"pos":[7133,7175],"content":"SetUpVideoStabilizationRecommendationAsync"},{"content":"Handle the video stabilization effect being disabled","pos":[7284,7336]},{"content":"The system may automatically disable the video stabilization effect if the pixel throughput is too high for the effect to handle or if it detects that the effect is running slowly.","pos":[7338,7518]},{"content":"If this occurs, the EnabledChanged event is raised.","pos":[7519,7570]},{"content":"The <bpt id=\"p1\">**</bpt>VideoStabilizationEffect<ept id=\"p1\">**</ept> instance in the <bpt id=\"p2\">*</bpt>sender<ept id=\"p2\">*</ept> parameter indicates the new state of the effect, enabled or disabled.","pos":[7571,7698],"source":" The **VideoStabilizationEffect** instance in the *sender* parameter indicates the new state of the effect, enabled or disabled."},{"content":"The <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>VideoStabilizationEffectEnabledChangedEventArgs<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn948979)</ept> has a <bpt id=\"p3\">[</bpt><bpt id=\"p4\">**</bpt>VideoStabilizationEffectEnabledChangedReason<ept id=\"p4\">**</ept><ept id=\"p3\">](https://msdn.microsoft.com/library/windows/apps/dn948981)</ept> value indicating why the effect was enabled or disabled.","pos":[7699,7986],"source":" The [**VideoStabilizationEffectEnabledChangedEventArgs**](https://msdn.microsoft.com/library/windows/apps/dn948979) has a [**VideoStabilizationEffectEnabledChangedReason**](https://msdn.microsoft.com/library/windows/apps/dn948981) value indicating why the effect was enabled or disabled."},{"content":"Note that this event is also raised if you programmatically enable or disable the effect, in which case the reason will be <bpt id=\"p1\">**</bpt>Programmatic<ept id=\"p1\">**</ept>.","pos":[7987,8127],"source":" Note that this event is also raised if you programmatically enable or disable the effect, in which case the reason will be **Programmatic**."},{"content":"Typically, you would use this event to adjust your app's UI to indicate the current status of video stabilization.","pos":[8129,8243]},{"pos":[8255,8287],"content":"VideoStabilizationEnabledChanged"},{"content":"Clean up the video stabilization effect","pos":[8386,8425]},{"content":"To clean up the video stabilization effect, call <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>ClearEffectsAsync<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br226592)</ept> to clear all effects from the video pipeline.","pos":[8427,8603],"source":"To clean up the video stabilization effect, call [**ClearEffectsAsync**](https://msdn.microsoft.com/library/windows/apps/br226592) to clear all effects from the video pipeline."},{"content":"If the member variables containing the initial encoding properties are not null, use them to restore the encoding properties.","pos":[8604,8729]},{"content":"Finally, remove the <bpt id=\"p1\">**</bpt>EnabledChanged<ept id=\"p1\">**</ept> event handler and set the effect to null.","pos":[8730,8810],"source":" Finally, remove the **EnabledChanged** event handler and set the effect to null."},{"pos":[8822,8854],"content":"CleanUpVisualStabilizationEffect"},{"content":"Related topics","pos":[8952,8966]},{"content":"Capture photos and video with MediaCapture","pos":[8971,9013]}],"content":"---\nauthor: drewbatgit\nms.assetid: E0189423-1DF3-4052-AB2E-846EA18254C4\ndescription: This topic describes effects designed to be used for video capture scenarios. This includes the video stabilization effect.\ntitle: Effects for video capture\n---\n\n# Effects for video capture\n\n\\[ Updated for UWP apps on Windows 10. For Windows 8.x articles, see the [archive](http://go.microsoft.com/fwlink/p/?linkid=619132) \\]\n\nThis topic describes effects designed to be used for video capture scenarios. This includes the video stabilization effect.\n\n**Note**  \nThis article builds on concepts and code discussed in [Capture Photos and Video with MediaCapture](capture-photos-and-video-with-mediacapture.md), which describes the steps for implementing basic photo and video capture. It is recommended that you familiarize yourself with the basic media capture pattern in that article before moving on to more advanced capture scenarios. The code in this article assumes that your app already has an instance of MediaCapture that has been properly initialized.\n\n## Video stabilization effect\n\nThe video stabilization effect manipulates the frames of a video stream to minimize shaking caused by holding the capture device in your hand. Because this technique causes the pixels to be shifted right, left, up, and down, and because the effect can't know what the content just outside the video frame is, the stabilized video is cropped slightly from the original video. A utility function is provided to allow you to adjust your video encoding settings to optimally manage the cropping performed by the effect.\n\nOn devices that support it, Optical Image Stabilization (OIS) stabilizes video by mechanically manipulating the capture device and, therefore, does not need to crop the edges of the video frames. For more information, see [Capture device controls for video capture](capture-device-controls-for-video-capture.md).\n\n### Set up your app to use video stabilization\n\nIn addition to the namespaces required for basic media capture, using the video stabilization effect requires the following namespace.\n\n[!code-cs[VideoStabilizationEffectUsing](./code/BasicMediaCaptureWin10/cs/MainPage.xaml.cs#SnippetVideoStabilizationEffectUsing)]\n\nDeclare a member variable to store the [**VideoStabilizationEffect**](https://msdn.microsoft.com/library/windows/apps/dn926760) object. As part of the effect implementation, you will modify the encoding properties that you use to encode the captured video. Declare two variables to store a backup copy of the initial input and output encoding properties so that you can restore them later when the effect is disabled. Finally, declare a member variable of type [**MediaEncodingProfile**](https://msdn.microsoft.com/library/windows/apps/hh701026) because this object will be accessed from multiple locations within your code.\n\n[!code-cs[DeclareVideoStabilizationEffect](./code/BasicMediaCaptureWin10/cs/MainPage.xaml.cs#SnippetDeclareVideoStabilizationEffect)]\n\nIn the basic video capture implementation described in the article [Capture Photos and Video with MediaCapture](capture-photos-and-video-with-mediacapture.md), the media encoding profile object is assigned to a local variable because it isn't used elsewhere in the code. For this scenario, you should assign the object to a member variable so that you can access it later.\n\n[!code-cs[EncodingProfileMember](./code/BasicMediaCaptureWin10/cs/MainPage.xaml.cs#SnippetEncodingProfileMember)]\n\n### Initialize the video stabilization effect\n\nAfter your **MediaCapture** object has been initialized, create a new instance of the [**VideoStabilizationEffectDefinition**](https://msdn.microsoft.com/library/windows/apps/dn926762) object. Call [**MediaCapture.AddVideoEffectAsync**](https://msdn.microsoft.com/library/windows/apps/dn878035) to add the effect to the video pipeline and retrieve an instance of the [**VideoStabilizationEffect**](https://msdn.microsoft.com/library/windows/apps/dn926760) class. Specify [**MediaStreamType.VideoRecord**](https://msdn.microsoft.com/library/windows/apps/br226640) to indicate that the effect should be applied to the video record stream.\n\nRegister an event handler for the [**EnabledChanged**](https://msdn.microsoft.com/library/windows/apps/dn948982) event and call the helper method **SetUpVideoStabilizationRecommendationAsync**, both of which are discussed later in this article. Finally, set the [**Enabled**](https://msdn.microsoft.com/library/windows/apps/dn926775) property of the effect to true to enable the effect.\n\n[!code-cs[CreateVideoStabilizationEffect](./code/BasicMediaCaptureWin10/cs/MainPage.xaml.cs#SnippetCreateVideoStabilizationEffect)]\n\n### Use recommended encoding properties\n\nAs discussed earlier in this article, the technique that the video stabilization effect uses necessarily causes the stabilized video to be cropped slightly from the source video. Define the following helper function in your code in order to adjust the video encoding properties to optimally handle this limitation of the effect. This step is not required in order to use the video stabilization effect, but if you don't perform this step, the resulting video will be upscaled slightly and therefore have slightly lower visual fidelity.\n\nCall [**GetRecommendedStreamConfiguration**](https://msdn.microsoft.com/library/windows/apps/dn948983) on your video stabilization effect instance, passing in the [**VideoDeviceController**](https://msdn.microsoft.com/library/windows/apps/br226825) object, which informs the effect about your current input stream encoding properties, and your **MediaEncodingProfile** which lets the effect know your current output encoding properties. This method returns a [**VideoStreamConfiguration**](https://msdn.microsoft.com/library/windows/apps/dn926727) object containing new recommended input and output stream encoding properties.\n\nThe recommended input encoding properties are, if it is supported by the device, a higher resolution that the initial settings you provided so that there is minimal loss in resolution after the effect's cropping is applied.\n\nCall [**VideoDeviceController.SetMediaStreamPropertiesAsync**](https://msdn.microsoft.com/library/windows/apps/hh700895) to set the new encoding properties. Before setting the new properties, use the member variable to store the initial encoding properties so that you can change the settings back when you disable the effect.\n\nIf the video stabilization effect must crop the output video, the recommended output encoding properties will be the size of the cropped video. This means that the output resolution will match the cropped video size. If you do not use the recommended output properties, then the video will be scaled up to match the initial output size, which will result in a loss of visual fidelity.\n\nSet the [**Video**](https://msdn.microsoft.com/library/windows/apps/hh701124) property of the **MediaEncodingProfile** object. Before setting the new properties, use the member variable to store the initial encoding properties so that you can change the settings back when you disable the effect.\n\n[!code-cs[SetUpVideoStabilizationRecommendationAsync](./code/BasicMediaCaptureWin10/cs/MainPage.xaml.cs#SnippetSetUpVideoStabilizationRecommendationAsync)]\n\n### Handle the video stabilization effect being disabled\n\nThe system may automatically disable the video stabilization effect if the pixel throughput is too high for the effect to handle or if it detects that the effect is running slowly. If this occurs, the EnabledChanged event is raised. The **VideoStabilizationEffect** instance in the *sender* parameter indicates the new state of the effect, enabled or disabled. The [**VideoStabilizationEffectEnabledChangedEventArgs**](https://msdn.microsoft.com/library/windows/apps/dn948979) has a [**VideoStabilizationEffectEnabledChangedReason**](https://msdn.microsoft.com/library/windows/apps/dn948981) value indicating why the effect was enabled or disabled. Note that this event is also raised if you programmatically enable or disable the effect, in which case the reason will be **Programmatic**.\n\nTypically, you would use this event to adjust your app's UI to indicate the current status of video stabilization.\n\n[!code-cs[VideoStabilizationEnabledChanged](./code/BasicMediaCaptureWin10/cs/MainPage.xaml.cs#SnippetVideoStabilizationEnabledChanged)]\n\n### Clean up the video stabilization effect\n\nTo clean up the video stabilization effect, call [**ClearEffectsAsync**](https://msdn.microsoft.com/library/windows/apps/br226592) to clear all effects from the video pipeline. If the member variables containing the initial encoding properties are not null, use them to restore the encoding properties. Finally, remove the **EnabledChanged** event handler and set the effect to null.\n\n[!code-cs[CleanUpVisualStabilizationEffect](./code/BasicMediaCaptureWin10/cs/MainPage.xaml.cs#SnippetCleanUpVisualStabilizationEffect)]\n\n## Related topics\n\n* [Capture photos and video with MediaCapture](capture-photos-and-video-with-mediacapture.md)\n \n\n \n\n\n\n\n"}