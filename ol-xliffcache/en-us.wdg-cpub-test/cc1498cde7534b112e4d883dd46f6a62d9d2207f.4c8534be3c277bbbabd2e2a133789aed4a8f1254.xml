{"nodes":[{"pos":[11,55],"content":"Set conditions for running a background task","needQuote":true,"needEscape":true,"nodes":[{"content":"Set conditions for running a background task","pos":[0,44]}]},{"pos":[69,145],"content":"Learn how to set conditions that control when your background task will run.","needQuote":true,"needEscape":true,"nodes":[{"content":"Learn how to set conditions that control when your background task will run.","pos":[0,76]}]},{"content":"Set conditions for running a background task","pos":[202,246]},{"content":"\\[ Updated for UWP apps on Windows 10.","pos":[249,287]},{"content":"For Windows 8.x articles, see the <bpt id=\"p1\">[</bpt>archive<ept id=\"p1\">](http://go.microsoft.com/fwlink/p/?linkid=619132)</ept> \\]","pos":[288,383],"source":" For Windows 8.x articles, see the [archive](http://go.microsoft.com/fwlink/p/?linkid=619132) \\]"},{"content":"Important APIs","pos":[388,402]},{"content":"SystemCondition","pos":[413,428]},{"content":"SystemConditionType","pos":[497,516]},{"content":"BackgroundTaskBuilder","pos":[585,606]},{"content":"Learn how to set conditions that control when your background task will run.","pos":[669,745]},{"content":"Sometimes, background tasks require certain conditions to be met, in addition to the event that triggers the task, so that the background task can succeed.","pos":[747,902]},{"content":"You can specify one or more of the conditions specified by <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>SystemConditionType<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br224835)</ept> when registering your background task.","pos":[903,1084],"source":" You can specify one or more of the conditions specified by [**SystemConditionType**](https://msdn.microsoft.com/library/windows/apps/br224835) when registering your background task."},{"content":"The condition will be checked after the trigger has been fired; the background task will be queued, but it will not run until all the required conditions are satisfied.","pos":[1085,1253]},{"content":"Putting conditions on background tasks saves battery life and CPU runtime by preventing tasks from running unnecessarily.","pos":[1255,1376]},{"content":"For example, if your background task runs on a timer and requires Internet connectivity, add the <bpt id=\"p1\">**</bpt>InternetAvailable<ept id=\"p1\">**</ept> condition to the <bpt id=\"p2\">[</bpt><bpt id=\"p3\">**</bpt>TaskBuilder<ept id=\"p3\">**</ept><ept id=\"p2\">](https://msdn.microsoft.com/library/windows/apps/br224768)</ept> before registering the task.","pos":[1377,1617],"source":" For example, if your background task runs on a timer and requires Internet connectivity, add the **InternetAvailable** condition to the [**TaskBuilder**](https://msdn.microsoft.com/library/windows/apps/br224768) before registering the task."},{"content":"This will help prevent the task from using system resources and battery life unnecessarily by letting it run when the timer has elapsed and the Internet is available.","pos":[1618,1784]},{"content":"<bpt id=\"p1\">**</bpt>Note<ept id=\"p1\">**</ept>  It is possible to combine multiple conditions by calling AddCondition multiple times on the same <bpt id=\"p2\">[</bpt><bpt id=\"p3\">**</bpt>TaskBuilder<ept id=\"p3\">**</ept><ept id=\"p2\">](https://msdn.microsoft.com/library/windows/apps/br224768)</ept>.","pos":[1786,1969],"source":"**Note**  It is possible to combine multiple conditions by calling AddCondition multiple times on the same [**TaskBuilder**](https://msdn.microsoft.com/library/windows/apps/br224768)."},{"content":"Take care not to add conflicting conditions, such as <bpt id=\"p1\">**</bpt>UserPresent<ept id=\"p1\">**</ept> and <bpt id=\"p2\">**</bpt>UserNotPresent<ept id=\"p2\">**</ept>.","pos":[1970,2062],"source":" Take care not to add conflicting conditions, such as **UserPresent** and **UserNotPresent**."},{"content":"Create a SystemCondition object","pos":[2070,2101]},{"pos":[2104,2358],"content":"This topic assumes that you have a background task already associated with your app, and that your app already includes code that creates a <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>BackgroundTaskBuilder<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br224768)</ept> object named <bpt id=\"p3\">**</bpt>taskBuilder<ept id=\"p3\">**</ept>","source":"This topic assumes that you have a background task already associated with your app, and that your app already includes code that creates a [**BackgroundTaskBuilder**](https://msdn.microsoft.com/library/windows/apps/br224768) object named **taskBuilder**"},{"content":"Before adding the condition, create a <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>SystemCondition<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br224834)</ept> object representing the condition that must be in effect for a background task to run.","pos":[2360,2564],"source":"Before adding the condition, create a [**SystemCondition**](https://msdn.microsoft.com/library/windows/apps/br224834) object representing the condition that must be in effect for a background task to run."},{"content":"In the constructor, specify the condition that must be met by providing a <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>SystemConditionType<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br224835)</ept> enumeration value.","pos":[2565,2741],"source":" In the constructor, specify the condition that must be met by providing a [**SystemConditionType**](https://msdn.microsoft.com/library/windows/apps/br224835) enumeration value."},{"pos":[2743,2923],"content":"The following code creates a <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>SystemCondition<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br224834)</ept> object specifying Internet availability as the conditional requirement:","source":"The following code creates a [**SystemCondition**](https://msdn.microsoft.com/library/windows/apps/br224834) object specifying Internet availability as the conditional requirement:"},{"content":"Add the SystemCondition object to your background task","pos":[3197,3251]},{"pos":[3254,3573],"content":"To add the condition, call the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>AddCondition<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br224769)</ept> method on the <bpt id=\"p3\">[</bpt><bpt id=\"p4\">**</bpt>BackgroundTaskBuilder<ept id=\"p4\">**</ept><ept id=\"p3\">](https://msdn.microsoft.com/library/windows/apps/br224768)</ept> object, and pass it the <bpt id=\"p5\">[</bpt><bpt id=\"p6\">**</bpt>SystemCondition<ept id=\"p6\">**</ept><ept id=\"p5\">](https://msdn.microsoft.com/library/windows/apps/br224834)</ept> object.","source":"To add the condition, call the [**AddCondition**](https://msdn.microsoft.com/library/windows/apps/br224769) method on the [**BackgroundTaskBuilder**](https://msdn.microsoft.com/library/windows/apps/br224768) object, and pass it the [**SystemCondition**](https://msdn.microsoft.com/library/windows/apps/br224834) object."},{"content":"The following code registers the InternetAvailable background task condition with the TaskBuilder:","pos":[3575,3673]},{"content":"Register your background task","pos":[3839,3868]},{"pos":[3871,4068],"content":"Now you can register your background task with the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>Register<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br224772)</ept> method, and the task will not start until the specified condition is met.","source":"Now you can register your background task with the [**Register**](https://msdn.microsoft.com/library/windows/apps/br224772) method, and the task will not start until the specified condition is met."},{"content":"The following code registers the task and stores the resulting BackgroundTaskRegistration object:","pos":[4070,4167]},{"pos":[4360,4541],"content":"<bpt id=\"p1\">**</bpt>Note<ept id=\"p1\">**</ept>  Universal Windows apps must call <bpt id=\"p2\">[</bpt><bpt id=\"p3\">**</bpt>RequestAccessAsync<ept id=\"p3\">**</ept><ept id=\"p2\">](https://msdn.microsoft.com/library/windows/apps/hh700485)</ept> before registering any of the background trigger types.","source":"**Note**  Universal Windows apps must call [**RequestAccessAsync**](https://msdn.microsoft.com/library/windows/apps/hh700485) before registering any of the background trigger types."},{"content":"To ensure that your Universal Windows app continues to run properly after you release an update, you must call <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>RemoveAccess<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/hh700471)</ept> and then call <bpt id=\"p3\">[</bpt><bpt id=\"p4\">**</bpt>RequestAccessAsync<ept id=\"p4\">**</ept><ept id=\"p3\">](https://msdn.microsoft.com/library/windows/apps/hh700485)</ept> when your app launches after being updated.","pos":[4543,4871],"source":"To ensure that your Universal Windows app continues to run properly after you release an update, you must call [**RemoveAccess**](https://msdn.microsoft.com/library/windows/apps/hh700471) and then call [**RequestAccessAsync**](https://msdn.microsoft.com/library/windows/apps/hh700485) when your app launches after being updated."},{"content":"For more information, see <bpt id=\"p1\">[</bpt>Guidelines for background tasks<ept id=\"p1\">](guidelines-for-background-tasks.md)</ept>.","pos":[4872,4968],"source":" For more information, see [Guidelines for background tasks](guidelines-for-background-tasks.md)."},{"content":"<bpt id=\"p1\">**</bpt>Note<ept id=\"p1\">**</ept>  Background task registration parameters are validated at the time of registration.","pos":[4972,5064],"source":"**Note**  Background task registration parameters are validated at the time of registration."},{"content":"An error is returned if any of the registration parameters are invalid.","pos":[5065,5136]},{"content":"Ensure that your app gracefully handles scenarios where background task registration fails - if instead your app depends on having a valid registration object after attempting to register a task, it may crash.","pos":[5137,5346]},{"content":"Place multiple conditions on your background task","pos":[5351,5400]},{"content":"To add multiple conditions, your app makes multiple calls to the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>AddCondition<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br224769)</ept> method.","pos":[5402,5551],"source":"To add multiple conditions, your app makes multiple calls to the [**AddCondition**](https://msdn.microsoft.com/library/windows/apps/br224769) method."},{"content":"These calls must come before task registration to be effective.","pos":[5552,5615]},{"pos":[5619,5694],"content":"<bpt id=\"p1\">**</bpt>Note<ept id=\"p1\">**</ept>  Take care not to add conflicting conditions to a background task.","source":"**Note**  Take care not to add conflicting conditions to a background task."},{"content":"The following snippet shows multiple conditions in the context of creating and registering a background task:","pos":[5698,5807]}],"content":"---\ntitle: Set conditions for running a background task\ndescription: Learn how to set conditions that control when your background task will run.\nms.assetid: 10ABAC9F-AA8C-41AC-A29D-871CD9AD9471\n---\n\n# Set conditions for running a background task\n\n\n\\[ Updated for UWP apps on Windows 10. For Windows 8.x articles, see the [archive](http://go.microsoft.com/fwlink/p/?linkid=619132) \\]\n\n\n**Important APIs**\n\n-   [**SystemCondition**](https://msdn.microsoft.com/library/windows/apps/br224834)\n-   [**SystemConditionType**](https://msdn.microsoft.com/library/windows/apps/br224835)\n-   [**BackgroundTaskBuilder**](https://msdn.microsoft.com/library/windows/apps/br224768)\n\nLearn how to set conditions that control when your background task will run.\n\nSometimes, background tasks require certain conditions to be met, in addition to the event that triggers the task, so that the background task can succeed. You can specify one or more of the conditions specified by [**SystemConditionType**](https://msdn.microsoft.com/library/windows/apps/br224835) when registering your background task. The condition will be checked after the trigger has been fired; the background task will be queued, but it will not run until all the required conditions are satisfied.\n\nPutting conditions on background tasks saves battery life and CPU runtime by preventing tasks from running unnecessarily. For example, if your background task runs on a timer and requires Internet connectivity, add the **InternetAvailable** condition to the [**TaskBuilder**](https://msdn.microsoft.com/library/windows/apps/br224768) before registering the task. This will help prevent the task from using system resources and battery life unnecessarily by letting it run when the timer has elapsed and the Internet is available.\n\n**Note**  It is possible to combine multiple conditions by calling AddCondition multiple times on the same [**TaskBuilder**](https://msdn.microsoft.com/library/windows/apps/br224768). Take care not to add conflicting conditions, such as **UserPresent** and **UserNotPresent**.\n\n \n\n## Create a SystemCondition object\n\n\nThis topic assumes that you have a background task already associated with your app, and that your app already includes code that creates a [**BackgroundTaskBuilder**](https://msdn.microsoft.com/library/windows/apps/br224768) object named **taskBuilder**\n\nBefore adding the condition, create a [**SystemCondition**](https://msdn.microsoft.com/library/windows/apps/br224834) object representing the condition that must be in effect for a background task to run. In the constructor, specify the condition that must be met by providing a [**SystemConditionType**](https://msdn.microsoft.com/library/windows/apps/br224835) enumeration value.\n\nThe following code creates a [**SystemCondition**](https://msdn.microsoft.com/library/windows/apps/br224834) object specifying Internet availability as the conditional requirement:\n\n> [!div class=\"tabbedCodeSnippets\"]\n> ```cs\n> SystemCondition internetCondition = new SystemCondition(SystemConditionType.InternetAvailable);\n> ```\n> ```cpp\n> SystemCondition ^ internetCondition = ref new SystemCondition(SystemConditionType::InternetAvailable);\n> ```\n\n## Add the SystemCondition object to your background task\n\n\nTo add the condition, call the [**AddCondition**](https://msdn.microsoft.com/library/windows/apps/br224769) method on the [**BackgroundTaskBuilder**](https://msdn.microsoft.com/library/windows/apps/br224768) object, and pass it the [**SystemCondition**](https://msdn.microsoft.com/library/windows/apps/br224834) object.\n\nThe following code registers the InternetAvailable background task condition with the TaskBuilder:\n\n> [!div class=\"tabbedCodeSnippets\"]\n> ```cs\n> taskBuilder.AddCondition(internetCondition);\n> ```\n> ```cpp\n> taskBuilder->AddCondition(internetCondition);\n> ```\n\n## Register your background task\n\n\nNow you can register your background task with the [**Register**](https://msdn.microsoft.com/library/windows/apps/br224772) method, and the task will not start until the specified condition is met.\n\nThe following code registers the task and stores the resulting BackgroundTaskRegistration object:\n\n> [!div class=\"tabbedCodeSnippets\"]\n> ```cs\n> BackgroundTaskRegistration task = taskBuilder.Register();\n> ```\n> ```cpp\n> BackgroundTaskRegistration ^ task = taskBuilder->Register();\n> ```\n\n> **Note**  Universal Windows apps must call [**RequestAccessAsync**](https://msdn.microsoft.com/library/windows/apps/hh700485) before registering any of the background trigger types.\n\nTo ensure that your Universal Windows app continues to run properly after you release an update, you must call [**RemoveAccess**](https://msdn.microsoft.com/library/windows/apps/hh700471) and then call [**RequestAccessAsync**](https://msdn.microsoft.com/library/windows/apps/hh700485) when your app launches after being updated. For more information, see [Guidelines for background tasks](guidelines-for-background-tasks.md).\n\n> **Note**  Background task registration parameters are validated at the time of registration. An error is returned if any of the registration parameters are invalid. Ensure that your app gracefully handles scenarios where background task registration fails - if instead your app depends on having a valid registration object after attempting to register a task, it may crash.\n\n## Place multiple conditions on your background task\n\nTo add multiple conditions, your app makes multiple calls to the [**AddCondition**](https://msdn.microsoft.com/library/windows/apps/br224769) method. These calls must come before task registration to be effective.\n\n> **Note**  Take care not to add conflicting conditions to a background task.\n \n\nThe following snippet shows multiple conditions in the context of creating and registering a background task:\n\n> [!div class=\"tabbedCodeSnippets\"]\n```cs\n> // \n> // Set up the background task.\n> // \n> \n> TimeTrigger hourlyTrigger = new TimeTrigger(60, false);\n> \n> var recurringTaskBuilder = new BackgroundTaskBuilder();\n> \n> recurringTaskBuilder.Name           = \"Hourly background task\";\n> recurringTaskBuilder.TaskEntryPoint = \"Tasks.ExampleBackgroundTaskClass\";\n> recurringTaskBuilder.SetTrigger(hourlyTrigger);\n> \n> // \n> // Begin adding conditions.\n> // \n> \n> SystemCondition userCondition     = new SystemCondition(SystemConditionType.UserPresent);\n> SystemCondition internetCondition = new SystemCondition(SystemConditionType.InternetAvailable);\n> \n> recurringTaskBuilder.AddCondition(userCondition);\n> recurringTaskBuilder.AddCondition(internetCondition);\n> \n> // \n> // Done adding conditions, now register the background task.\n> // \n> \n> BackgroundTaskRegistration task = recurringTaskBuilder.Register();\n> ```\n> ```cpp\n> // \n> // Set up the background task.\n> // \n> \n> TimeTrigger ^ hourlyTrigger = ref new TimeTrigger(60, false);\n> \n> auto recurringTaskBuilder = ref new BackgroundTaskBuilder();\n> \n> recurringTaskBuilder->Name           = \"Hourly background task\";\n> recurringTaskBuilder->TaskEntryPoint = \"Tasks.ExampleBackgroundTaskClass\";\n> recurringTaskBuilder->SetTrigger(hourlyTrigger);\n> \n> // \n> // Begin adding conditions.\n> // \n> \n> SystemCondition ^ userCondition     = ref new SystemCondition(SystemConditionType::UserPresent);\n> SystemCondition ^ internetCondition = ref new SystemCondition(SystemConditionType::InternetAvailable);\n> \n> recurringTaskBuilder->AddCondition(userCondition);\n> recurringTaskBuilder->AddCondition(internetCondition);\n> \n> // \n> // Done adding conditions, now register the background task.\n> // \n> \n> BackgroundTaskRegistration ^ task = recurringTaskBuilder->Register();\n> ```\n\n## Remarks\n\n\n> **Note**  Chose the right conditions for your background task so that it only runs when it's needed, and doesn't run when it won't work. See [**SystemConditionType**](https://msdn.microsoft.com/library/windows/apps/br224835) for descriptions of the different background task conditions.\n\n> **Note**  This article is for Windows 10 developers writing Universal Windows Platform (UWP) apps. If youâ€™re developing for Windows 8.x or Windows Phone 8.x, see the [archived documentation](http://go.microsoft.com/fwlink/p/?linkid=619132).\n\n \n\n## Related topics\n\n\n****\n\n* [Create and register a background task](create-and-register-a-background-task.md)\n* [Declare background tasks in the application manifest](declare-background-tasks-in-the-application-manifest.md)\n* [Handle a cancelled background task](handle-a-cancelled-background-task.md)\n* [Monitor background task progress and completion](monitor-background-task-progress-and-completion.md)\n* [Register a background task](register-a-background-task.md)\n* [Respond to system events with background tasks](respond-to-system-events-with-background-tasks.md)\n* [Update a live tile from a background task](update-a-live-tile-from-a-background-task.md)\n* [Use a maintenance trigger](use-a-maintenance-trigger.md)\n* [Run a background task on a timer](run-a-background-task-on-a-timer-.md)\n* [Guidelines for background tasks](guidelines-for-background-tasks.md)\n\n****\n\n* [Debug a background task](debug-a-background-task.md)\n* [How to trigger suspend, resume, and background events in Windows Store apps (when debugging)](http://go.microsoft.com/fwlink/p/?linkid=254345)\n\n \n\n \n\n\n\n"}